/*! For license information please see main.9abc46df.js.LICENSE.txt */
!function(){var e={371:function(e,t,n){var r;!function(i){var a=Object.hasOwnProperty,s=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},o="object"==typeof process&&"function"==typeof process.nextTick,u="function"===typeof Symbol,c="object"===typeof Reflect,l="function"===typeof setImmediate?setImmediate:setTimeout,d=u?c&&"function"===typeof Reflect.ownKeys?Reflect.ownKeys:function(e){var t=Object.getOwnPropertyNames(e);return t.push.apply(t,Object.getOwnPropertySymbols(e)),t}:Object.keys;function f(){this._events={},this._conf&&h.call(this,this._conf)}function h(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners!==i&&(this._maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),e.ignoreErrors&&(this.ignoreErrors=e.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function p(e,t){var n="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(n+=" Event name: "+t+"."),"undefined"!==typeof process&&process.emitWarning){var r=new Error(n);r.name="MaxListenersExceededWarning",r.emitter=this,r.count=e,process.emitWarning(r)}else console.error(n),console.trace&&console.trace()}var v=function(e,t,n){var r=arguments.length;switch(r){case 0:return[];case 1:return[e];case 2:return[e,t];case 3:return[e,t,n];default:for(var i=new Array(r);r--;)i[r]=arguments[r];return i}};function g(e,t){for(var n={},r=e.length,a=t?t.length:0,s=0;s<r;s++)n[e[s]]=s<a?t[s]:i;return n}function m(e,t,n){var r,i;if(this._emitter=e,this._target=t,this._listeners={},this._listenersCount=0,(n.on||n.off)&&(r=n.on,i=n.off),t.addEventListener?(r=t.addEventListener,i=t.removeEventListener):t.addListener?(r=t.addListener,i=t.removeListener):t.on&&(r=t.on,i=t.off),!r&&!i)throw Error("target does not implement any known event API");if("function"!==typeof r)throw TypeError("on method must be a function");if("function"!==typeof i)throw TypeError("off method must be a function");this._on=r,this._off=i;var a=e._observers;a?a.push(this):e._observers=[this]}function y(e,t,n,r){var s=Object.assign({},t);if(!e)return s;if("object"!==typeof e)throw TypeError("options must be an object");var o,u,c,l=Object.keys(e),d=l.length;function f(e){throw Error('Invalid "'+o+'" option value'+(e?". Reason: "+e:""))}for(var h=0;h<d;h++){if(o=l[h],!r&&!a.call(t,o))throw Error('Unknown "'+o+'" option');(u=e[o])!==i&&(c=n[o],s[o]=c?c(u,f):u)}return s}function b(e,t){return"function"===typeof e&&e.hasOwnProperty("prototype")||t("value must be a constructor"),e}function k(e){var t="value must be type of "+e.join("|"),n=e.length,r=e[0],i=e[1];return 1===n?function(e,n){if(typeof e===r)return e;n(t)}:2===n?function(e,n){var a=typeof e;if(a===r||a===i)return e;n(t)}:function(r,i){for(var a=typeof r,s=n;s-- >0;)if(a===e[s])return r;i(t)}}Object.assign(m.prototype,{subscribe:function(e,t,n){var r=this,i=this._target,a=this._emitter,s=this._listeners,o=function(){var r=v.apply(null,arguments),s={data:r,name:t,original:e};if(n){var o=n.call(i,s);!1!==o&&a.emit.apply(a,[s.name].concat(r))}else a.emit.apply(a,[t].concat(r))};if(s[e])throw Error("Event '"+e+"' is already listening");this._listenersCount++,a._newListener&&a._removeListener&&!r._onNewListener?(this._onNewListener=function(n){n===t&&null===s[e]&&(s[e]=o,r._on.call(i,e,o))},a.on("newListener",this._onNewListener),this._onRemoveListener=function(n){n===t&&!a.hasListeners(n)&&s[e]&&(s[e]=null,r._off.call(i,e,o))},s[e]=null,a.on("removeListener",this._onRemoveListener)):(s[e]=o,r._on.call(i,e,o))},unsubscribe:function(e){var t,n,r,i=this,a=this._listeners,s=this._emitter,o=this._off,u=this._target;if(e&&"string"!==typeof e)throw TypeError("event must be a string");function c(){i._onNewListener&&(s.off("newListener",i._onNewListener),s.off("removeListener",i._onRemoveListener),i._onNewListener=null,i._onRemoveListener=null);var e=w.call(s,i);s._observers.splice(e,1)}if(e){if(!(t=a[e]))return;o.call(u,e,t),delete a[e],--this._listenersCount||c()}else{for(r=(n=d(a)).length;r-- >0;)e=n[r],o.call(u,e,a[e]);this._listeners={},this._listenersCount=0,c()}}});var T=k(["function"]),E=k(["object","function"]);function S(e,t,n){var r,i,a,s=0,o=new e((function(u,c,l){function d(){i&&(i=null),s&&(clearTimeout(s),s=0)}n=y(n,{timeout:0,overload:!1},{timeout:function(e,t){return("number"!==typeof(e*=1)||e<0||!Number.isFinite(e))&&t("timeout must be a positive number"),e}}),r=!n.overload&&"function"===typeof e.prototype.cancel&&"function"===typeof l;var f=function(e){d(),u(e)},h=function(e){d(),c(e)};r?t(f,h,l):(i=[function(e){h(e||Error("canceled"))}],t(f,h,(function(e){if(a)throw Error("Unable to subscribe on cancel event asynchronously");if("function"!==typeof e)throw TypeError("onCancel callback must be a function");i.push(e)})),a=!0),n.timeout>0&&(s=setTimeout((function(){var e=Error("timeout");e.code="ETIMEDOUT",s=0,o.cancel(e),c(e)}),n.timeout))}));return r||(o.cancel=function(e){if(i){for(var t=i.length,n=1;n<t;n++)i[n](e);i[0](e),i=null}}),o}function w(e){var t=this._observers;if(!t)return-1;for(var n=t.length,r=0;r<n;r++)if(t[r]._target===e)return r;return-1}function x(e,t,n,r,i){if(!n)return null;if(0===r){var a=typeof t;if("string"===a){var s,o,u=0,c=0,l=this.delimiter,f=l.length;if(-1!==(o=t.indexOf(l))){s=new Array(5);do{s[u++]=t.slice(c,o),c=o+f}while(-1!==(o=t.indexOf(l,c)));s[u++]=t.slice(c),t=s,i=u}else t=[t],i=1}else"object"===a?i=t.length:(t=[t],i=1)}var h,p,v,g,m,y,b,k=null,T=t[r],E=t[r+1];if(r===i)n._listeners&&("function"===typeof n._listeners?(e&&e.push(n._listeners),k=[n]):(e&&e.push.apply(e,n._listeners),k=[n]));else{if("*"===T){for(o=(y=d(n)).length;o-- >0;)"_listeners"!==(h=y[o])&&(b=x(e,t,n[h],r+1,i))&&(k?k.push.apply(k,b):k=b);return k}if("**"===T){for((m=r+1===i||r+2===i&&"*"===E)&&n._listeners&&(k=x(e,t,n,i,i)),o=(y=d(n)).length;o-- >0;)"_listeners"!==(h=y[o])&&("*"===h||"**"===h?(n[h]._listeners&&!m&&(b=x(e,t,n[h],i,i))&&(k?k.push.apply(k,b):k=b),b=x(e,t,n[h],r,i)):b=x(e,t,n[h],h===E?r+2:r,i),b&&(k?k.push.apply(k,b):k=b));return k}n[T]&&(k=x(e,t,n[T],r+1,i))}if((p=n["*"])&&x(e,t,p,r+1,i),v=n["**"])if(r<i)for(v._listeners&&x(e,t,v,i,i),o=(y=d(v)).length;o-- >0;)"_listeners"!==(h=y[o])&&(h===E?x(e,t,v[h],r+2,i):h===T?x(e,t,v[h],r+1,i):((g={})[h]=v[h],x(e,t,{"**":g},r+1,i)));else v._listeners?x(e,t,v,i,i):v["*"]&&v["*"]._listeners&&x(e,t,v["*"],i,i);return k}function R(e,t,n){var r,i,a=0,s=0,o=this.delimiter,u=o.length;if("string"===typeof e)if(-1!==(r=e.indexOf(o))){i=new Array(5);do{i[a++]=e.slice(s,r),s=r+u}while(-1!==(r=e.indexOf(o,s)));i[a++]=e.slice(s)}else i=[e],a=1;else i=e,a=e.length;if(a>1)for(r=0;r+1<a;r++)if("**"===i[r]&&"**"===i[r+1])return;var c,l=this.listenerTree;for(r=0;r<a;r++)if(l=l[c=i[r]]||(l[c]={}),r===a-1)return l._listeners?("function"===typeof l._listeners&&(l._listeners=[l._listeners]),n?l._listeners.unshift(t):l._listeners.push(t),!l._listeners.warned&&this._maxListeners>0&&l._listeners.length>this._maxListeners&&(l._listeners.warned=!0,p.call(this,l._listeners.length,c))):l._listeners=t,!0;return!0}function C(e,t,n,r){for(var i,a,s,o,u=d(e),c=u.length,l=e._listeners;c-- >0;)i=e[a=u[c]],s="_listeners"===a?n:n?n.concat(a):[a],o=r||"symbol"===typeof a,l&&t.push(o?s:s.join(this.delimiter)),"object"===typeof i&&C.call(this,i,t,s,o);return t}function A(e){for(var t,n,r,i=d(e),a=i.length;a-- >0;)(t=e[n=i[a]])&&(r=!0,"_listeners"===n||A(t)||delete e[n]);return r}function I(e,t,n){this.emitter=e,this.event=t,this.listener=n}function P(e,t,n){if(!0===n)a=!0;else if(!1===n)r=!0;else{if(!n||"object"!==typeof n)throw TypeError("options should be an object or true");var r=n.async,a=n.promisify,s=n.nextTick,u=n.objectify}if(r||s||a){var c=t,d=t._origin||t;if(s&&!o)throw Error("process.nextTick is not supported");a===i&&(a="AsyncFunction"===t.constructor.name),t=function(){var e=arguments,t=this,n=this.event;return a?s?Promise.resolve():new Promise((function(e){l(e)})).then((function(){return t.event=n,c.apply(t,e)})):(s?process.nextTick:l)((function(){t.event=n,c.apply(t,e)}))},t._async=!0,t._origin=d}return[t,u?new I(this,e,t):this]}function _(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,h.call(this,e)}I.prototype.off=function(){return this.emitter.off(this.event,this.listener),this},_.EventEmitter2=_,_.prototype.listenTo=function(e,t,n){if("object"!==typeof e)throw TypeError("target musts be an object");var r=this;function a(t){if("object"!==typeof t)throw TypeError("events must be an object");var i,a=n.reducers,s=w.call(r,e);i=-1===s?new m(r,e,n):r._observers[s];for(var o,u=d(t),c=u.length,l="function"===typeof a,f=0;f<c;f++)o=u[f],i.subscribe(o,t[o]||o,l?a:a&&a[o])}return n=y(n,{on:i,off:i,reducers:i},{on:T,off:T,reducers:E}),s(t)?a(g(t)):a("string"===typeof t?g(t.split(/\s+/)):t),this},_.prototype.stopListeningTo=function(e,t){var n=this._observers;if(!n)return!1;var r,i=n.length,a=!1;if(e&&"object"!==typeof e)throw TypeError("target should be an object");for(;i-- >0;)r=n[i],e&&r._target!==e||(r.unsubscribe(t),a=!0);return a},_.prototype.delimiter=".",_.prototype.setMaxListeners=function(e){e!==i&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},_.prototype.getMaxListeners=function(){return this._maxListeners},_.prototype.event="",_.prototype.once=function(e,t,n){return this._once(e,t,!1,n)},_.prototype.prependOnceListener=function(e,t,n){return this._once(e,t,!0,n)},_.prototype._once=function(e,t,n,r){return this._many(e,1,t,n,r)},_.prototype.many=function(e,t,n,r){return this._many(e,t,n,!1,r)},_.prototype.prependMany=function(e,t,n,r){return this._many(e,t,n,!0,r)},_.prototype._many=function(e,t,n,r,i){var a=this;if("function"!==typeof n)throw new Error("many only accepts instances of Function");function s(){return 0===--t&&a.off(e,s),n.apply(this,arguments)}return s._origin=n,this._on(e,s,r,i)},_.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||f.call(this);var e,t,n,r,i,a,s=arguments[0],o=this.wildcard;if("newListener"===s&&!this._newListener&&!this._events.newListener)return!1;if(o&&(e=s,"newListener"!==s&&"removeListener"!==s&&"object"===typeof s)){if(n=s.length,u)for(r=0;r<n;r++)if("symbol"===typeof s[r]){a=!0;break}a||(s=s.join(this.delimiter))}var c,l=arguments.length;if(this._all&&this._all.length)for(r=0,n=(c=this._all.slice()).length;r<n;r++)switch(this.event=s,l){case 1:c[r].call(this,s);break;case 2:c[r].call(this,s,arguments[1]);break;case 3:c[r].call(this,s,arguments[1],arguments[2]);break;default:c[r].apply(this,arguments)}if(o)c=[],x.call(this,c,e,this.listenerTree,0,n);else{if("function"===typeof(c=this._events[s])){switch(this.event=s,l){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(l-1),i=1;i<l;i++)t[i-1]=arguments[i];c.apply(this,t)}return!0}c&&(c=c.slice())}if(c&&c.length){if(l>3)for(t=new Array(l-1),i=1;i<l;i++)t[i-1]=arguments[i];for(r=0,n=c.length;r<n;r++)switch(this.event=s,l){case 1:c[r].call(this);break;case 2:c[r].call(this,arguments[1]);break;case 3:c[r].call(this,arguments[1],arguments[2]);break;default:c[r].apply(this,t)}return!0}if(!this.ignoreErrors&&!this._all&&"error"===s)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},_.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||f.call(this);var e,t,n,r,i,a,s=arguments[0],o=this.wildcard;if("newListener"===s&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(o&&(e=s,"newListener"!==s&&"removeListener"!==s&&"object"===typeof s)){if(r=s.length,u)for(i=0;i<r;i++)if("symbol"===typeof s[i]){t=!0;break}t||(s=s.join(this.delimiter))}var c,l=[],d=arguments.length;if(this._all)for(i=0,r=this._all.length;i<r;i++)switch(this.event=s,d){case 1:l.push(this._all[i].call(this,s));break;case 2:l.push(this._all[i].call(this,s,arguments[1]));break;case 3:l.push(this._all[i].call(this,s,arguments[1],arguments[2]));break;default:l.push(this._all[i].apply(this,arguments))}if(o?(c=[],x.call(this,c,e,this.listenerTree,0)):c=this._events[s],"function"===typeof c)switch(this.event=s,d){case 1:l.push(c.call(this));break;case 2:l.push(c.call(this,arguments[1]));break;case 3:l.push(c.call(this,arguments[1],arguments[2]));break;default:for(n=new Array(d-1),a=1;a<d;a++)n[a-1]=arguments[a];l.push(c.apply(this,n))}else if(c&&c.length){if(c=c.slice(),d>3)for(n=new Array(d-1),a=1;a<d;a++)n[a-1]=arguments[a];for(i=0,r=c.length;i<r;i++)switch(this.event=s,d){case 1:l.push(c[i].call(this));break;case 2:l.push(c[i].call(this,arguments[1]));break;case 3:l.push(c[i].call(this,arguments[1],arguments[2]));break;default:l.push(c[i].apply(this,n))}}else if(!this.ignoreErrors&&!this._all&&"error"===s)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(l)},_.prototype.on=function(e,t,n){return this._on(e,t,!1,n)},_.prototype.prependListener=function(e,t,n){return this._on(e,t,!0,n)},_.prototype.onAny=function(e){return this._onAny(e,!1)},_.prototype.prependAny=function(e){return this._onAny(e,!0)},_.prototype.addListener=_.prototype.on,_.prototype._onAny=function(e,t){if("function"!==typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},_.prototype._on=function(e,t,n,r){if("function"===typeof e)return this._onAny(e,t),this;if("function"!==typeof t)throw new Error("on only accepts instances of Function");this._events||f.call(this);var a,s=this;return r!==i&&(t=(a=P.call(this,e,t,r))[0],s=a[1]),this._newListener&&this.emit("newListener",e,t),this.wildcard?(R.call(this,e,t,n),s):(this._events[e]?("function"===typeof this._events[e]&&(this._events[e]=[this._events[e]]),n?this._events[e].unshift(t):this._events[e].push(t),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,p.call(this,this._events[e].length,e))):this._events[e]=t,s)},_.prototype.off=function(e,t){if("function"!==typeof t)throw new Error("removeListener only takes instances of Function");var n,r=[];if(this.wildcard){var i="string"===typeof e?e.split(this.delimiter):e.slice();if(!(r=x.call(this,null,i,this.listenerTree,0)))return this}else{if(!this._events[e])return this;n=this._events[e],r.push({_listeners:n})}for(var a=0;a<r.length;a++){var o=r[a];if(n=o._listeners,s(n)){for(var u=-1,c=0,l=n.length;c<l;c++)if(n[c]===t||n[c].listener&&n[c].listener===t||n[c]._origin&&n[c]._origin===t){u=c;break}if(u<0)continue;return this.wildcard?o._listeners.splice(u,1):this._events[e].splice(u,1),0===n.length&&(this.wildcard?delete o._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,t),this}(n===t||n.listener&&n.listener===t||n._origin&&n._origin===t)&&(this.wildcard?delete o._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return this.listenerTree&&A(this.listenerTree),this},_.prototype.offAny=function(e){var t,n=0,r=0;if(e&&this._all&&this._all.length>0){for(n=0,r=(t=this._all).length;n<r;n++)if(e===t[n])return t.splice(n,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(n=0,r=t.length;n<r;n++)this.emit("removeListenerAny",t[n]);this._all=[]}return this},_.prototype.removeListener=_.prototype.off,_.prototype.removeAllListeners=function(e){if(e===i)return!this._events||f.call(this),this;if(this.wildcard){var t,n=x.call(this,null,e,this.listenerTree,0);if(!n)return this;for(t=0;t<n.length;t++)n[t]._listeners=null;this.listenerTree&&A(this.listenerTree)}else this._events&&(this._events[e]=null);return this},_.prototype.listeners=function(e){var t,n,r,a,s,o=this._events;if(e===i){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!o)return[];for(a=(t=d(o)).length,r=[];a-- >0;)"function"===typeof(n=o[t[a]])?r.push(n):r.push.apply(r,n);return r}if(this.wildcard){if(!(s=this.listenerTree))return[];var u=[],c="string"===typeof e?e.split(this.delimiter):e.slice();return x.call(this,u,c,s,0),u}return o&&(n=o[e])?"function"===typeof n?[n]:n:[]},_.prototype.eventNames=function(e){var t=this._events;return this.wildcard?C.call(this,this.listenerTree,[],null,e):t?d(t):[]},_.prototype.listenerCount=function(e){return this.listeners(e).length},_.prototype.hasListeners=function(e){if(this.wildcard){var t=[],n="string"===typeof e?e.split(this.delimiter):e.slice();return x.call(this,t,n,this.listenerTree,0),t.length>0}var r=this._events,a=this._all;return!!(a&&a.length||r&&(e===i?d(r).length:r[e]))},_.prototype.listenersAny=function(){return this._all?this._all:[]},_.prototype.waitFor=function(e,t){var n=this,r=typeof t;return"number"===r?t={timeout:t}:"function"===r&&(t={filter:t}),S((t=y(t,{timeout:0,filter:i,handleError:!1,Promise:Promise,overload:!1},{filter:T,Promise:b})).Promise,(function(r,i,a){function s(){var a=t.filter;if(!a||a.apply(n,arguments))if(n.off(e,s),t.handleError){var o=arguments[0];o?i(o):r(v.apply(null,arguments).slice(1))}else r(v.apply(null,arguments))}a((function(){n.off(e,s)})),n._on(e,s,!1)}),{timeout:t.timeout,overload:t.overload})};var D=_.prototype;Object.defineProperties(_,{defaultMaxListeners:{get:function(){return D._maxListeners},set:function(e){if("number"!==typeof e||e<0||Number.isNaN(e))throw TypeError("n must be a non-negative number");D._maxListeners=e},enumerable:!0},once:{value:function(e,t,n){return S((n=y(n,{Promise:Promise,timeout:0,overload:!1},{Promise:b})).Promise,(function(n,r,i){var a;if("function"===typeof e.addEventListener)return a=function(){n(v.apply(null,arguments))},i((function(){e.removeEventListener(t,a)})),void e.addEventListener(t,a,{once:!0});var s,o=function(){s&&e.removeListener("error",s),n(v.apply(null,arguments))};"error"!==t&&(s=function(n){e.removeListener(t,o),r(n)},e.once("error",s)),i((function(){s&&e.removeListener("error",s),e.removeListener(t,o)})),e.once(t,o)}),{timeout:n.timeout,overload:n.overload})},writable:!0,configurable:!0}}),Object.defineProperties(D,{_maxListeners:{value:10,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),(r=function(){return _}.call(t,n,t,e))===i||(e.exports=r)}()},843:function(e){var t;"undefined"!==typeof window&&(t=function(){return function(){var e={"./src/config.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{enableStreamingMode:function(){return x},hlsDefaultConfig:function(){return S},mergeConfig:function(){return w}});var r=n("./src/controller/abr-controller.ts"),i=n("./src/controller/audio-stream-controller.ts"),a=n("./src/controller/audio-track-controller.ts"),s=n("./src/controller/subtitle-stream-controller.ts"),o=n("./src/controller/subtitle-track-controller.ts"),u=n("./src/controller/buffer-controller.ts"),c=n("./src/controller/timeline-controller.ts"),l=n("./src/controller/cap-level-controller.ts"),d=n("./src/controller/fps-controller.ts"),f=n("./src/controller/eme-controller.ts"),h=n("./src/controller/cmcd-controller.ts"),p=n("./src/utils/xhr-loader.ts"),v=n("./src/utils/fetch-loader.ts"),g=n("./src/utils/cues.ts"),m=n("./src/utils/mediakeys-helper.ts"),y=n("./src/utils/logger.ts");function b(){return b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},b.apply(this,arguments)}function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){E(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function E(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var S=T(T({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:p.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:r.default,bufferController:u.default,capLevelController:l.default,fpsController:d.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:m.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},{cueHandler:g.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:s.SubtitleStreamController,subtitleTrackController:o.default,timelineController:c.TimelineController,audioStreamController:i.default,audioTrackController:a.default,emeController:f.default,cmcdController:h.default});function w(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return b({},e,t)}function x(e){var t=e.loader;t!==v.default&&t!==p.default?(y.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1):(0,v.fetchSupported)()&&(e.loader=v.default,e.progressive=!0,e.enableSoftwareAES=!0,y.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var r=n("./src/polyfills/number.ts"),i=n("./src/utils/ewma-bandwidth-estimator.ts"),a=n("./src/events.ts"),s=n("./src/errors.ts"),o=n("./src/types/loader.ts"),u=n("./src/utils/logger.ts");function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,l(r.key),r)}}function l(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}var d=function(){function e(e){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;var t=e.config;this.bwEstimator=new i.default(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}var t,n,l,d=e.prototype;return d.registerListeners=function(){var e=this.hls;e.on(a.Events.FRAG_LOADING,this.onFragLoading,this),e.on(a.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(a.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(a.Events.ERROR,this.onError,this)},d.unregisterListeners=function(){var e=this.hls;e.off(a.Events.FRAG_LOADING,this.onFragLoading,this),e.off(a.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(a.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(a.Events.ERROR,this.onError,this)},d.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},d.onFragLoading=function(e,t){var n,r=t.frag;r.type===o.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=r,this.partCurrent=null!=(n=t.part)?n:null,this.timer=self.setInterval(this.onCheck,100)))},d.onLevelLoaded=function(e,t){var n=this.hls.config;t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD)},d._abandonRulesCheck=function(){var e=this.fragCurrent,t=this.partCurrent,n=this.hls,i=n.autoLevelEnabled,s=n.media;if(e&&s){var o=t?t.stats:e.stats,c=t?t.duration:e.duration;if(o.aborted||o.loaded&&o.loaded===o.total||0===e.level)return this.clearTimer(),void(this._nextAutoLevel=-1);if(i&&!s.paused&&s.playbackRate&&s.readyState){var l=n.mainForwardBufferInfo;if(null!==l){var d=performance.now()-o.loading.start,f=Math.abs(s.playbackRate);if(!(d<=500*c/f)){var h=o.loaded&&o.loading.first,p=this.bwEstimator.getEstimate(),v=n.levels,g=n.minAutoLevel,m=v[e.level],y=o.total||Math.max(o.loaded,Math.round(c*m.maxBitrate/8)),b=h?1e3*o.loaded/d:0,k=b?(y-o.loaded)/b:8*y/p,T=l.len/f;if(!(k<=T)){var E,S=Number.POSITIVE_INFINITY;for(E=e.level-1;E>g;E--){var w=v[E].maxBitrate;if((S=b?c*w/(6.4*b):c*w/p)<T)break}S>=k||(u.logger.warn("Fragment "+e.sn+(t?" part "+t.index:"")+" of level "+e.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+E+"\n      Current BW estimate: "+((0,r.isFiniteNumber)(p)?(p/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+k.toFixed(3)+" s\n      Estimated load time for the next fragment: "+S.toFixed(3)+" s\n      Time to underbuffer: "+T.toFixed(3)+" s"),n.nextLoadLevel=E,h&&this.bwEstimator.sample(d,o.loaded),this.clearTimer(),(e.loader||e.keyLoader)&&(this.fragCurrent=this.partCurrent=null,e.abortRequests()),n.trigger(a.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:o}))}}}}}},d.onFragLoaded=function(e,t){var n=t.frag,i=t.part;if(n.type===o.PlaylistLevelType.MAIN&&(0,r.isFiniteNumber)(n.sn)){var s=i?i.stats:n.stats,u=i?i.duration:n.duration;if(this.clearTimer(),this.lastLoadedFragLevel=n.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var c=this.hls.levels[n.level],l=(c.loaded?c.loaded.bytes:0)+s.loaded,d=(c.loaded?c.loaded.duration:0)+u;c.loaded={bytes:l,duration:d},c.realBitrate=Math.round(8*l/d)}if(n.bitrateTest){var f={stats:s,frag:n,part:i,id:n.type};this.onFragBuffered(a.Events.FRAG_BUFFERED,f)}}},d.onFragBuffered=function(e,t){var n=t.frag,r=t.part,i=r?r.stats:n.stats;if(!i.aborted&&n.type===o.PlaylistLevelType.MAIN&&"initSegment"!==n.sn){var a=i.parsing.end-i.loading.start;this.bwEstimator.sample(a,i.loaded),i.bwEstimate=this.bwEstimator.getEstimate(),n.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}},d.onError=function(e,t){var n;if((null===(n=t.frag)||void 0===n?void 0:n.type)===o.PlaylistLevelType.MAIN){if(t.type===s.ErrorTypes.KEY_SYSTEM_ERROR)return void this.clearTimer();switch(t.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:case s.ErrorDetails.KEY_LOAD_ERROR:case s.ErrorDetails.KEY_LOAD_TIMEOUT:this.clearTimer()}}},d.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},d.getNextABRAutoLevel=function(){var e=this.fragCurrent,t=this.partCurrent,n=this.hls,r=n.maxAutoLevel,i=n.config,a=n.minAutoLevel,s=n.media,o=t?t.duration:e?e.duration:0,c=s&&0!==s.playbackRate?Math.abs(s.playbackRate):1,l=this.bwEstimator?this.bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,d=n.mainForwardBufferInfo,f=(d?d.len:0)/c,h=this.findBestLevel(l,a,r,f,i.abrBandWidthFactor,i.abrBandWidthUpFactor);if(h>=0)return h;u.logger.trace((f?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var p=o?Math.min(o,i.maxStarvationDelay):i.maxStarvationDelay,v=i.abrBandWidthFactor,g=i.abrBandWidthUpFactor;if(!f){var m=this.bitrateTestDelay;m&&(p=(o?Math.min(o,i.maxLoadingDelay):i.maxLoadingDelay)-m,u.logger.trace("bitrate test took "+Math.round(1e3*m)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*p)+" ms"),v=g=1)}return h=this.findBestLevel(l,a,r,f+p,v,g),Math.max(h,0)},d.findBestLevel=function(e,t,n,i,a,s){for(var o,c=this.fragCurrent,l=this.partCurrent,d=this.lastLoadedFragLevel,f=this.hls.levels,h=f[d],p=!(null===h||void 0===h||null===(o=h.details)||void 0===o||!o.live),v=null===h||void 0===h?void 0:h.codecSet,g=l?l.duration:c?c.duration:0,m=n;m>=t;m--){var y=f[m];if(y&&(!v||y.codecSet===v)){var b=y.details,k=(l?null===b||void 0===b?void 0:b.partTarget:null===b||void 0===b?void 0:b.averagetargetduration)||g,T=void 0;T=m<=d?a*e:s*e;var E=f[m].maxBitrate,S=E*k/T;if(u.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+m+"/"+Math.round(T)+"/"+E+"/"+k+"/"+i+"/"+S),T>E&&(0===S||!(0,r.isFiniteNumber)(S)||p&&!this.bitrateTestDelay||S<i))return m}}return-1},t=e,(n=[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this.bwEstimator;if(-1!==e&&!t.canEstimate())return e;var n=this.getNextABRAutoLevel();return-1!==e&&this.hls.levels[n].loadError?e:(-1!==e&&(n=Math.min(e,n)),n)},set:function(e){this._nextAutoLevel=e}}])&&c(t.prototype,n),l&&c(t,l),Object.defineProperty(t,"prototype",{writable:!1}),e}()},"./src/controller/audio-stream-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return b}});var r=n("./src/polyfills/number.ts"),i=n("./src/controller/base-stream-controller.ts"),a=n("./src/events.ts"),s=n("./src/utils/buffer-helper.ts"),o=n("./src/controller/fragment-tracker.ts"),u=n("./src/types/level.ts"),c=n("./src/types/loader.ts"),l=n("./src/loader/fragment.ts"),d=n("./src/demux/chunk-cache.ts"),f=n("./src/demux/transmuxer-interface.ts"),h=n("./src/types/transmuxer.ts"),p=n("./src/controller/fragment-finders.ts"),v=n("./src/utils/discontinuities.ts"),g=n("./src/errors.ts");function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},m.apply(this,arguments)}function y(e,t){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},y(e,t)}var b=function(e){var t,n;function b(t,n,r){var i;return(i=e.call(this,t,n,r,"[audio-stream-controller]")||this).videoBuffer=null,i.videoTrackCC=-1,i.waitingVideoCC=-1,i.audioSwitch=!1,i.trackId=-1,i.waitingData=null,i.mainDetails=null,i.bufferFlushed=!1,i.cachedTrackLoadedData=null,i._registerListeners(),i}n=e,(t=b).prototype=Object.create(n.prototype),t.prototype.constructor=t,y(t,n);var k=b.prototype;return k.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},k._registerListeners=function(){var e=this.hls;e.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(a.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(a.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(a.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(a.Events.ERROR,this.onError,this),e.on(a.Events.BUFFER_RESET,this.onBufferReset,this),e.on(a.Events.BUFFER_CREATED,this.onBufferCreated,this),e.on(a.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(a.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(a.Events.FRAG_BUFFERED,this.onFragBuffered,this)},k._unregisterListeners=function(){var e=this.hls;e.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(a.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(a.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(a.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(a.Events.ERROR,this.onError,this),e.off(a.Events.BUFFER_RESET,this.onBufferReset,this),e.off(a.Events.BUFFER_CREATED,this.onBufferCreated,this),e.off(a.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(a.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(a.Events.FRAG_BUFFERED,this.onFragBuffered,this)},k.onInitPtsFound=function(e,t){var n=t.frag,r=t.id,a=t.initPTS;if("main"===r){var s=n.cc;this.initPTS[n.cc]=a,this.log("InitPTS for cc: "+s+" found from main: "+a),this.videoTrackCC=s,this.state===i.State.WAITING_INIT_PTS&&this.tick()}},k.startLoad=function(e){if(!this.levels)return this.startPosition=e,void(this.state=i.State.STOPPED);var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,t>0&&-1===e?(this.log("Override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t,this.state=i.State.IDLE):(this.loadedmetadata=!1,this.state=i.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()},k.doTick=function(){switch(this.state){case i.State.IDLE:this.doTickIdle();break;case i.State.WAITING_TRACK:var t,n=this.levels,r=this.trackId,a=null===n||void 0===n||null===(t=n[r])||void 0===t?void 0:t.details;if(a){if(this.waitForCdnTuneIn(a))break;this.state=i.State.WAITING_INIT_PTS}break;case i.State.FRAG_LOADING_WAITING_RETRY:var o,u=performance.now(),c=this.retryDate;(!c||u>=c||null!==(o=this.media)&&void 0!==o&&o.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=i.State.IDLE);break;case i.State.WAITING_INIT_PTS:var l=this.waitingData;if(l){var d=l.frag,f=l.part,h=l.cache,v=l.complete;if(void 0!==this.initPTS[d.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=i.State.FRAG_LOADING;var g={frag:d,part:f,payload:h.flush(),networkDetails:null};this._handleFragmentLoadProgress(g),v&&e.prototype._handleFragmentLoadComplete.call(this,g)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+d.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var m=this.getLoadPosition(),y=s.BufferHelper.bufferInfo(this.mediaBuffer,m,this.config.maxBufferHole);(0,p.fragmentWithinToleranceTest)(y.end,this.config.maxFragLookUpTolerance,d)<0&&(this.log("Waiting fragment cc ("+d.cc+") @ "+d.start+" cancelled because another fragment at "+y.end+" is needed"),this.clearWaitingFragment())}}else this.state=i.State.IDLE}this.onTickEnd()},k.clearWaitingFragment=function(){var e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=i.State.IDLE)},k.resetLoadingState=function(){this.clearWaitingFragment(),e.prototype.resetLoadingState.call(this)},k.onTickEnd=function(){var e=this.media;e&&e.readyState&&(this.lastCurrentTime=e.currentTime)},k.doTickIdle=function(){var e=this.hls,t=this.levels,n=this.media,r=this.trackId,s=e.config;if(t&&t[r]&&(n||!this.startFragRequested&&s.startFragPrefetch)){var o=t[r].details;if(!o||o.live&&this.levelLastLoaded!==r||this.waitForCdnTuneIn(o))this.state=i.State.WAITING_TRACK;else{var u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,l.ElementaryStreamTypes.AUDIO,c.PlaylistLevelType.AUDIO));var d=this.getFwdBufferInfo(u,c.PlaylistLevelType.AUDIO);if(null!==d){var f=this.audioSwitch;if(!f&&this._streamEnded(d,o))return e.trigger(a.Events.BUFFER_EOS,{type:"audio"}),void(this.state=i.State.ENDED);var h=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,c.PlaylistLevelType.MAIN);if(!(d.len>=this.getMaxBufferLength(null===h||void 0===h?void 0:h.len))||f){var p=o.fragments[0].start,v=d.end;if(f&&n){var g=this.getLoadPosition();v=g,o.PTSKnown&&g<p&&(d.end>p||d.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=p+.05)}if(!(h&&v>h.end+o.targetduration)&&(h&&h.len||!d.len)){var m=this.getNextFragment(v,o);m?this.loadFragment(m,o,v):this.bufferFlushed=!0}}}}}},k.getMaxBufferLength=function(t){var n=e.prototype.getMaxBufferLength.call(this);return t?Math.max(n,t):n},k.onMediaDetaching=function(){this.videoBuffer=null,e.prototype.onMediaDetaching.call(this)},k.onAudioTracksUpdated=function(e,t){var n=t.audioTracks;this.resetTransmuxer(),this.levels=n.map((function(e){return new u.Level(e)}))},k.onAudioTrackSwitching=function(e,t){var n=!!t.url;this.trackId=t.id;var r=this.fragCurrent;r&&r.abortRequests(),this.fragCurrent=null,this.clearWaitingFragment(),n?this.setInterval(100):this.resetTransmuxer(),n?(this.audioSwitch=!0,this.state=i.State.IDLE):this.state=i.State.STOPPED,this.tick()},k.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},k.onLevelLoaded=function(e,t){this.mainDetails=t.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(a.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},k.onAudioTrackLoaded=function(e,t){var n;if(null!=this.mainDetails){var r=this.levels,a=t.details,s=t.id;if(r){this.log("Track "+s+" loaded ["+a.startSN+","+a.endSN+"],duration:"+a.totalduration);var o=r[s],u=0;if(a.live||null!==(n=o.details)&&void 0!==n&&n.live){var c=this.mainDetails;if(a.fragments[0]||(a.deltaUpdateFailed=!0),a.deltaUpdateFailed||!c)return;!o.details&&a.hasProgramDateTime&&c.hasProgramDateTime?((0,v.alignMediaPlaylistByPDT)(a,c),u=a.fragments[0].start):u=this.alignPlaylists(a,o.details)}o.details=a,this.levelLastLoaded=s,this.startFragRequested||!this.mainDetails&&a.live||this.setStartPosition(o.details,u),this.state!==i.State.WAITING_TRACK||this.waitForCdnTuneIn(a)||(this.state=i.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+s)}else this.cachedTrackLoadedData=t},k._handleFragmentLoadProgress=function(e){var t,n=e.frag,r=e.part,a=e.payload,s=this.config,o=this.trackId,u=this.levels;if(u){var l=u[o];console.assert(l,"Audio track is defined on fragment load progress");var p=l.details;console.assert(p,"Audio track details are defined on fragment load progress");var v=s.defaultAudioCodec||l.audioCodec||"mp4a.40.2",g=this.transmuxer;g||(g=this.transmuxer=new f.default(this.hls,c.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var m=this.initPTS[n.cc],y=null===(t=n.initSegment)||void 0===t?void 0:t.data;if(void 0!==m){var b=r?r.index:-1,k=-1!==b,T=new h.ChunkMetadata(n.level,n.sn,n.stats.chunkCount,a.byteLength,b,k);g.push(a,y,v,"",n,r,p.totalduration,!1,T,m)}else this.log("Unknown video PTS for cc "+n.cc+", waiting for video PTS before demuxing audio frag "+n.sn+" of ["+p.startSN+" ,"+p.endSN+"],track "+o),(this.waitingData=this.waitingData||{frag:n,part:r,cache:new d.default,complete:!1}).cache.push(new Uint8Array(a)),this.waitingVideoCC=this.videoTrackCC,this.state=i.State.WAITING_INIT_PTS}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+n.sn+" of level "+n.level+" will not be buffered")},k._handleFragmentLoadComplete=function(t){this.waitingData?this.waitingData.complete=!0:e.prototype._handleFragmentLoadComplete.call(this,t)},k.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},k.onBufferCreated=function(e,t){var n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)},k.onFragBuffered=function(e,t){var n,r=t.frag,i=t.part;r.type===c.PlaylistLevelType.AUDIO?this.fragContextChanged(r)?this.warn("Fragment "+r.sn+(i?" p: "+i.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):("initSegment"!==r.sn&&(this.fragPrevious=r,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(a.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(r,i)):this.loadedmetadata||r.type!==c.PlaylistLevelType.MAIN||null!==(n=this.videoBuffer||this.media)&&void 0!==n&&n.buffered.length&&(this.loadedmetadata=!0)},k.onError=function(t,n){if(n.type!==g.ErrorTypes.KEY_SYSTEM_ERROR)switch(n.details){case g.ErrorDetails.FRAG_LOAD_ERROR:case g.ErrorDetails.FRAG_LOAD_TIMEOUT:case g.ErrorDetails.FRAG_PARSING_ERROR:case g.ErrorDetails.KEY_LOAD_ERROR:case g.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(c.PlaylistLevelType.AUDIO,n);break;case g.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case g.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==i.State.ERROR&&this.state!==i.State.STOPPED&&(this.state=n.fatal?i.State.ERROR:i.State.IDLE,this.warn(n.details+" while loading frag, switching to "+this.state+" state"));break;case g.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===n.parent&&(this.state===i.State.PARSING||this.state===i.State.PARSED)){var r=!0,a=this.getFwdBufferInfo(this.mediaBuffer,c.PlaylistLevelType.AUDIO);a&&a.len>.5&&(r=!this.reduceMaxBufferLength(a.len)),r&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,e.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}else this.onFragmentOrKeyLoadError(c.PlaylistLevelType.AUDIO,n)},k.onBufferFlushed=function(e,t){t.type===l.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0,this.state===i.State.ENDED&&(this.state=i.State.IDLE))},k._handleTransmuxComplete=function(e){var t,n="audio",r=this.hls,s=e.remuxResult,o=e.chunkMeta,u=this.getCurrentContext(o);if(!u)return this.warn("The loading context changed while buffering fragment "+o.sn+" of level "+o.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(o.level);var c=u.frag,d=u.part,f=u.level.details,h=s.audio,p=s.text,v=s.id3,g=s.initSegment;if(!this.fragContextChanged(c)&&f){if(this.state=i.State.PARSING,this.audioSwitch&&h&&this.completeAudioSwitch(),null!==g&&void 0!==g&&g.tracks&&(this._bufferInitSegment(g.tracks,c,o),r.trigger(a.Events.FRAG_PARSING_INIT_SEGMENT,{frag:c,id:n,tracks:g.tracks})),h){var y=h.startPTS,b=h.endPTS,k=h.startDTS,T=h.endDTS;d&&(d.elementaryStreams[l.ElementaryStreamTypes.AUDIO]={startPTS:y,endPTS:b,startDTS:k,endDTS:T}),c.setElementaryStreamInfo(l.ElementaryStreamTypes.AUDIO,y,b,k,T),this.bufferFragmentData(h,c,d,o)}if(null!==v&&void 0!==v&&null!==(t=v.samples)&&void 0!==t&&t.length){var E=m({id:n,frag:c,details:f},v);r.trigger(a.Events.FRAG_PARSING_METADATA,E)}if(p){var S=m({id:n,frag:c,details:f},p);r.trigger(a.Events.FRAG_PARSING_USERDATA,S)}}},k._bufferInitSegment=function(e,t,n){if(this.state===i.State.PARSING){e.video&&delete e.video;var r=e.audio;if(r){r.levelCodec=r.codec,r.id="audio",this.log("Init audio buffer, container:"+r.container+", codecs[parsed]=["+r.codec+"]"),this.hls.trigger(a.Events.BUFFER_CODECS,e);var s=r.initSegment;if(null!==s&&void 0!==s&&s.byteLength){var o={type:"audio",frag:t,part:null,chunkMeta:n,parent:t.type,data:s};this.hls.trigger(a.Events.BUFFER_APPENDING,o)}this.tick()}}},k.loadFragment=function(t,n,a){var s=this.fragmentTracker.getState(t);this.fragCurrent=t,(this.audioSwitch||s===o.FragmentState.NOT_LOADED||s===o.FragmentState.PARTIAL)&&("initSegment"===t.sn?this._loadInitSegment(t,n):n.live&&!(0,r.isFiniteNumber)(this.initPTS[t.cc])?(this.log("Waiting for video PTS in continuity counter "+t.cc+" of live stream before loading audio fragment "+t.sn+" of level "+this.trackId),this.state=i.State.WAITING_INIT_PTS):(this.startFragRequested=!0,e.prototype.loadFragment.call(this,t,n,a)))},k.completeAudioSwitch=function(){var t=this.hls,n=this.media,r=this.trackId;n&&(this.log("Switching audio track : flushing all audio"),e.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,t.trigger(a.Events.AUDIO_TRACK_SWITCHED,{id:r})},b}(i.default)},"./src/controller/audio-track-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});var r=n("./src/events.ts"),i=n("./src/errors.ts"),a=n("./src/controller/base-playlist-controller.ts"),s=n("./src/types/loader.ts");function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,u(r.key),r)}}function u(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}var l=function(e){var t,n;function a(t){var n;return(n=e.call(this,t,"[audio-track-controller]")||this).tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.trackName="",n.selectDefaultTrack=!0,n.registerListeners(),n}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,c(t,n);var u,l,d,f=a.prototype;return f.registerListeners=function(){var e=this.hls;e.on(r.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(r.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(r.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(r.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(r.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(r.Events.ERROR,this.onError,this)},f.unregisterListeners=function(){var e=this.hls;e.off(r.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(r.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(r.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(r.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(r.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(r.Events.ERROR,this.onError,this)},f.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,e.prototype.destroy.call(this)},f.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},f.onManifestParsed=function(e,t){this.tracks=t.audioTracks||[]},f.onAudioTrackLoaded=function(e,t){var n=t.id,r=t.details,i=this.tracksInGroup[n];if(i){var a=i.details;i.details=t.details,this.log("audioTrack "+n+" loaded ["+r.startSN+"-"+r.endSN+"]"),n===this.trackId&&(this.retryCount=0,this.playlistLoaded(n,t,a))}else this.warn("Invalid audio track id "+n)},f.onLevelLoading=function(e,t){this.switchLevel(t.level)},f.onLevelSwitching=function(e,t){this.switchLevel(t.level)},f.switchLevel=function(e){var t=this.hls.levels[e];if(null!==t&&void 0!==t&&t.audioGroupIds){var n=t.audioGroupIds[t.urlId];if(this.groupId!==n){this.groupId=n;var i=this.tracks.filter((function(e){return!n||e.groupId===n}));this.selectDefaultTrack&&!i.some((function(e){return e.default}))&&(this.selectDefaultTrack=!1),this.tracksInGroup=i;var a={audioTracks:i};this.log("Updating audio tracks, "+i.length+' track(s) found in "'+n+'" group-id'),this.hls.trigger(r.Events.AUDIO_TRACKS_UPDATED,a),this.selectInitialTrack()}}},f.onError=function(t,n){e.prototype.onError.call(this,t,n),!n.fatal&&n.context&&n.context.type===s.PlaylistContextType.AUDIO_TRACK&&n.context.id===this.trackId&&n.context.groupId===this.groupId&&this.retryLoadingOrFail(n)},f.setAudioTrack=function(e){var t=this.tracksInGroup;if(e<0||e>=t.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var n=t[this.trackId];this.log("Now switching to audio-track index "+e);var i=t[e],a=i.id,s=i.groupId,o=void 0===s?"":s,u=i.name,c=i.type,l=i.url;if(this.trackId=e,this.trackName=u,this.selectDefaultTrack=!1,this.hls.trigger(r.Events.AUDIO_TRACK_SWITCHING,{id:a,groupId:o,name:u,type:c,url:l}),!i.details||i.details.live){var d=this.switchParams(i.url,null===n||void 0===n?void 0:n.details);this.loadPlaylist(d)}}},f.selectInitialTrack=function(){var e=this.tracksInGroup;console.assert(e.length,"Initial audio track should be selected when tracks are known");var t=this.trackName,n=this.findTrackId(t)||this.findTrackId();-1!==n?this.setAudioTrack(n):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},f.findTrackId=function(e){for(var t=this.tracksInGroup,n=0;n<t.length;n++){var r=t[n];if((!this.selectDefaultTrack||r.default)&&(!e||e===r.name))return r.id}return-1},f.loadPlaylist=function(t){e.prototype.loadPlaylist.call(this);var n=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(n)){var i=n.id,a=n.groupId,s=n.url;if(t)try{s=t.addDirectives(s)}catch(o){this.warn("Could not construct new URL with HLS Delivery Directives: "+o)}this.log("loading audio-track playlist for id: "+i),this.clearTimer(),this.hls.trigger(r.Events.AUDIO_TRACK_LOADING,{url:s,id:i,groupId:a,deliveryDirectives:t||null})}},u=a,(l=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}}])&&o(u.prototype,l),d&&o(u,d),Object.defineProperty(u,"prototype",{writable:!1}),a}(a.default)},"./src/controller/base-playlist-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var r=n("./src/types/level.ts"),i=n("./src/controller/level-helper.ts"),a=n("./src/utils/logger.ts"),s=n("./src/errors.ts"),o=function(){function e(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=a.logger.log.bind(a.logger,t+":"),this.warn=a.logger.warn.bind(a.logger,t+":"),this.hls=e}var t=e.prototype;return t.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},t.onError=function(e,t){!t.fatal||t.type!==s.ErrorTypes.NETWORK_ERROR&&t.type!==s.ErrorTypes.KEY_SYSTEM_ERROR||this.stopLoad()},t.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},t.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.requestScheduled=-1,this.loadPlaylist()},t.stopLoad=function(){this.canLoad=!1,this.clearTimer()},t.switchParams=function(e,t){var n=null===t||void 0===t?void 0:t.renditionReports;if(n)for(var i=0;i<n.length;i++){var s=n[i],o=void 0;try{o=new self.URL(s.URI,t.url).href}catch(d){a.logger.warn("Could not construct new URL for Rendition Report: "+d),o=s.URI||""}if(o===e.slice(-o.length)){var u=parseInt(s["LAST-MSN"])||(null===t||void 0===t?void 0:t.lastPartSn),c=parseInt(s["LAST-PART"])||(null===t||void 0===t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){var l=Math.min(t.age-t.partTarget,t.targetduration);c>=0&&l>t.partTarget&&(c+=1)}return new r.HlsUrlParameters(u,c>=0?c:void 0,r.HlsSkip.No)}}},t.loadPlaylist=function(e){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())},t.shouldLoadTrack=function(e){return this.canLoad&&e&&!!e.url&&(!e.details||e.details.live)},t.playlistLoaded=function(e,t,n){var r=this,a=t.details,s=t.stats,o=self.performance.now(),u=s.loading.first?Math.max(0,o-s.loading.first):0;if(a.advancedDateTime=Date.now()-u,a.live||null!==n&&void 0!==n&&n.live){if(a.reloaded(n),n&&this.log("live playlist "+e+" "+(a.advanced?"REFRESHED "+a.lastPartSn+"-"+a.lastPartIndex:"MISSED")),n&&a.fragments.length>0&&(0,i.mergeDetails)(n,a),!this.canLoad||!a.live)return;var c,l=void 0,d=void 0;if(a.canBlockReload&&a.endSN&&a.advanced){var f=this.hls.config.lowLatencyMode,h=a.lastPartSn,p=a.endSN,v=a.lastPartIndex,g=h===p;-1!==v?(l=g?p+1:h,d=g?f?0:v:v+1):l=p+1;var m=a.age,y=m+a.ageHeader,b=Math.min(y-a.partTarget,1.5*a.targetduration);if(b>0){if(n&&b>n.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+n.tuneInGoal+" to: "+b+" with playlist age: "+a.age),b=0;else{var k=Math.floor(b/a.targetduration);l+=k,void 0!==d&&(d+=Math.round(b%a.targetduration/a.partTarget)),this.log("CDN Tune-in age: "+a.ageHeader+"s last advanced "+m.toFixed(2)+"s goal: "+b+" skip sn "+k+" to part "+d)}a.tuneInGoal=b}if(c=this.getDeliveryDirectives(a,t.deliveryDirectives,l,d),f||!g)return void this.loadPlaylist(c)}else c=this.getDeliveryDirectives(a,t.deliveryDirectives,l,d);var T=this.hls.mainForwardBufferInfo,E=T?T.end-T.len:0,S=1e3*(a.edge-E),w=(0,i.computeReloadInterval)(a,S);a.updated?o>this.requestScheduled+w&&(this.requestScheduled=s.loading.start):this.requestScheduled=-1,void 0!==l&&a.canBlockReload?this.requestScheduled=s.loading.first+w-(1e3*a.partTarget||1e3):this.requestScheduled=(-1===this.requestScheduled?o:this.requestScheduled)+w;var x=this.requestScheduled-o;x=Math.max(0,x),this.log("reload live playlist "+e+" in "+Math.round(x)+" ms"),this.timer=self.setTimeout((function(){return r.loadPlaylist(c)}),x)}else this.clearTimer()},t.getDeliveryDirectives=function(e,t,n,i){var a=(0,r.getSkipValue)(e,n);return null!==t&&void 0!==t&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,i=t.part,a=r.HlsSkip.No),new r.HlsUrlParameters(n,i,a)},t.retryLoadingOrFail=function(e){var t,n=this,r=this.hls.config,i=this.retryCount<r.levelLoadingMaxRetry;if(i)if(this.requestScheduled=-1,this.retryCount++,e.details.indexOf("LoadTimeOut")>-1&&null!==(t=e.context)&&void 0!==t&&t.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+e.details+'"'),this.loadPlaylist();else{var a=Math.min(Math.pow(2,this.retryCount)*r.levelLoadingRetryDelay,r.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout((function(){return n.loadPlaylist()}),a),this.warn("retry playlist loading #"+this.retryCount+" in "+a+' ms after "'+e.details+'"')}else this.warn('cannot recover from error "'+e.details+'"'),this.clearTimer(),e.fatal=!0;return i},e}()},"./src/controller/base-stream-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{State:function(){return E},default:function(){return S}});var r=n("./src/polyfills/number.ts"),i=n("./src/task-loop.ts"),a=n("./src/controller/fragment-tracker.ts"),s=n("./src/utils/buffer-helper.ts"),o=n("./src/utils/logger.ts"),u=n("./src/events.ts"),c=n("./src/errors.ts"),l=n("./src/types/transmuxer.ts"),d=n("./src/utils/mp4-tools.ts"),f=n("./src/utils/discontinuities.ts"),h=n("./src/controller/fragment-finders.ts"),p=n("./src/controller/level-helper.ts"),v=n("./src/loader/fragment-loader.ts"),g=n("./src/crypt/decrypter.ts"),m=n("./src/utils/time-ranges.ts"),y=n("./src/types/loader.ts");function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,k(r.key),r)}}function k(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}function T(e,t){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},T(e,t)}var E={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},S=function(e){var t,n;function i(t,n,r,i){var a;return(a=e.call(this)||this).hls=void 0,a.fragPrevious=null,a.fragCurrent=null,a.fragmentTracker=void 0,a.transmuxer=null,a._state=E.STOPPED,a.media=null,a.mediaBuffer=null,a.config=void 0,a.bitrateTest=!1,a.lastCurrentTime=0,a.nextLoadPosition=0,a.startPosition=0,a.loadedmetadata=!1,a.fragLoadError=0,a.retryDate=0,a.levels=null,a.fragmentLoader=void 0,a.keyLoader=void 0,a.levelLastLoaded=null,a.startFragRequested=!1,a.decrypter=void 0,a.initPTS=[],a.onvseeking=null,a.onvended=null,a.logPrefix="",a.log=void 0,a.warn=void 0,a.logPrefix=i,a.log=o.logger.log.bind(o.logger,i+":"),a.warn=o.logger.warn.bind(o.logger,i+":"),a.hls=t,a.fragmentLoader=new v.default(t.config),a.keyLoader=r,a.fragmentTracker=n,a.config=t.config,a.decrypter=new g.default(t.config),t.on(u.Events.LEVEL_SWITCHING,a.onLevelSwitching,function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(a)),a}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,T(t,n);var k,S,w,x=i.prototype;return x.doTick=function(){this.onTickEnd()},x.onTickEnd=function(){},x.startLoad=function(e){},x.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort();var e=this.fragCurrent;e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=E.STOPPED},x._streamEnded=function(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;var n=t.partList;if(null!==n&&void 0!==n&&n.length){var r=n[n.length-1];return s.BufferHelper.isBuffered(this.media,r.start+r.duration/2)}var i=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(i)},x.getLevelDetails=function(){var e;if(this.levels&&null!==this.levelLastLoaded)return null===(e=this.levels[this.levelLastLoaded])||void 0===e?void 0:e.details},x.onMediaAttached=function(e,t){var n=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),n.addEventListener("seeking",this.onvseeking),n.addEventListener("ended",this.onvended);var r=this.config;this.levels&&r.autoStartLoad&&this.state===E.STOPPED&&this.startLoad(r.startPosition)},x.onMediaDetaching=function(){var e=this.media;null!==e&&void 0!==e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},x.onMediaSeeking=function(){var e=this.config,t=this.fragCurrent,n=this.media,i=this.mediaBuffer,a=this.state,o=n?n.currentTime:0,u=s.BufferHelper.bufferInfo(i||n,o,e.maxBufferHole);if(this.log("media seeking to "+((0,r.isFiniteNumber)(o)?o.toFixed(3):o)+", state: "+a),this.state===E.ENDED)this.resetLoadingState();else if(t){var c=e.maxFragLookUpTolerance,l=t.start-c,d=t.start+t.duration+c;if(!u.len||d<u.start||l>u.end){var f=o>d;(o<l||f)&&(f&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests()),this.resetLoadingState())}}n&&(this.lastCurrentTime=o),this.loadedmetadata||u.len||(this.nextLoadPosition=this.startPosition=o),this.tickImmediate()},x.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},x.onLevelSwitching=function(e,t){this.fragLoadError=0},x.onHandlerDestroying=function(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},x.onHandlerDestroyed=function(){this.state=E.STOPPED,this.hls.off(u.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,e.prototype.onHandlerDestroyed.call(this)},x.loadFragment=function(e,t,n){this._loadFragForPlayback(e,t,n)},x._loadFragForPlayback=function(e,t,n){var r=this;this._doFragLoad(e,t,n,(function(t){if(r.fragContextChanged(e))return r.warn("Fragment "+e.sn+(t.part?" p: "+t.part.index:"")+" of level "+e.level+" was dropped during download."),void r.fragmentTracker.removeFragment(e);e.stats.chunkCount++,r._handleFragmentLoadProgress(t)})).then((function(t){if(t){r.fragLoadError=0;var n=r.state;r.fragContextChanged(e)?(n===E.FRAG_LOADING||!r.fragCurrent&&n===E.PARSING)&&(r.fragmentTracker.removeFragment(e),r.state=E.IDLE):("payload"in t&&(r.log("Loaded fragment "+e.sn+" of level "+e.level),r.hls.trigger(u.Events.FRAG_LOADED,t)),r._handleFragmentLoadComplete(t))}})).catch((function(t){r.state!==E.STOPPED&&r.state!==E.ERROR&&(r.warn(t),r.resetFragmentLoading(e))}))},x.flushMainBuffer=function(e,t,n){if(void 0===n&&(n=null),e-t){var r={startOffset:e,endOffset:t,type:n};this.fragLoadError=0,this.hls.trigger(u.Events.BUFFER_FLUSHING,r)}},x._loadInitSegment=function(e,t){var n=this;this._doFragLoad(e,t).then((function(t){if(!t||n.fragContextChanged(e)||!n.levels)throw new Error("init load aborted");return t})).then((function(t){var r=n.hls,i=t.payload,a=e.decryptdata;if(i&&i.byteLength>0&&a&&a.key&&a.iv&&"AES-128"===a.method){var s=self.performance.now();return n.decrypter.decrypt(new Uint8Array(i),a.key.buffer,a.iv.buffer).then((function(n){var i=self.performance.now();return r.trigger(u.Events.FRAG_DECRYPTED,{frag:e,payload:n,stats:{tstart:s,tdecrypt:i}}),t.payload=n,t}))}return t})).then((function(t){var r=n.fragCurrent,i=n.hls,a=n.levels;if(!a)throw new Error("init load aborted, missing levels");var s=a[e.level].details;console.assert(s,"Level details are defined when init segment is loaded");var o=e.stats;n.state=E.IDLE,n.fragLoadError=0,e.data=new Uint8Array(t.payload),o.parsing.start=o.buffering.start=self.performance.now(),o.parsing.end=o.buffering.end=self.performance.now(),t.frag===r&&i.trigger(u.Events.FRAG_BUFFERED,{stats:o,frag:r,part:null,id:e.type}),n.tick()})).catch((function(t){n.state!==E.STOPPED&&n.state!==E.ERROR&&(n.warn(t),n.resetFragmentLoading(e))}))},x.fragContextChanged=function(e){var t=this.fragCurrent;return!e||!t||e.level!==t.level||e.sn!==t.sn||e.urlId!==t.urlId},x.fragBufferedComplete=function(e,t){var n,r,i=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+e.type+" sn: "+e.sn+(t?" part: "+t.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+e.level+" (frag:["+(e.startPTS||NaN).toFixed(3)+"-"+(e.endPTS||NaN).toFixed(3)+"] > buffer:"+(i?m.default.toString(s.BufferHelper.getBuffered(i)):"(detached)")+")"),this.state=E.IDLE,i&&(!this.loadedmetadata&&e.type==y.PlaylistLevelType.MAIN&&i.buffered.length&&(null===(n=this.fragCurrent)||void 0===n?void 0:n.sn)===(null===(r=this.fragPrevious)||void 0===r?void 0:r.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},x.seekToStartPos=function(){},x._handleFragmentLoadComplete=function(e){var t=this.transmuxer;if(t){var n=e.frag,r=e.part,i=e.partsLoaded,a=!i||0===i.length||i.some((function(e){return!e})),s=new l.ChunkMetadata(n.level,n.sn,n.stats.chunkCount+1,0,r?r.index:-1,!a);t.flush(s)}},x._handleFragmentLoadProgress=function(e){},x._doFragLoad=function(e,t,n,i){var a,s=this;if(void 0===n&&(n=null),!this.levels)throw new Error("frag load aborted, missing levels");var o=null;if(!e.encrypted||null!==(a=e.decryptdata)&&void 0!==a&&a.key?!e.encrypted&&t.encryptedFragments.length&&this.keyLoader.loadClear(e,t.encryptedFragments):(this.log("Loading key for "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+e.level),this.state=E.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then((function(e){if(!s.fragContextChanged(e.frag))return s.hls.trigger(u.Events.KEY_LOADED,e),s.state===E.KEY_LOADING&&(s.state=E.IDLE),e})),this.hls.trigger(u.Events.KEY_LOADING,{frag:e}),this.throwIfFragContextChanged("KEY_LOADING")),n=Math.max(e.start,n||0),this.config.lowLatencyMode&&t){var c=t.partList;if(c&&i){n>e.end&&t.fragmentHint&&(e=t.fragmentHint);var l=this.getNextPart(c,e,n);if(l>-1){var d=c[l];return this.log("Loading part sn: "+e.sn+" p: "+d.index+" cc: "+e.cc+" of playlist ["+t.startSN+"-"+t.endSN+"] parts [0-"+l+"-"+(c.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+e.level+", target: "+parseFloat(n.toFixed(3))),this.nextLoadPosition=d.start+d.duration,this.state=E.FRAG_LOADING,this.hls.trigger(u.Events.FRAG_LOADING,{frag:e,part:c[l],targetBufferTime:n}),this.throwIfFragContextChanged("FRAG_LOADING parts"),o?o.then((function(t){return!t||s.fragContextChanged(t.frag)?null:s.doFragPartsLoad(e,c,l,i)})).catch((function(e){return s.handleFragLoadError(e)})):this.doFragPartsLoad(e,c,l,i).catch((function(e){return s.handleFragLoadError(e)}))}if(!e.url||this.loadedEndOfParts(c,n))return Promise.resolve(null)}}this.log("Loading fragment "+e.sn+" cc: "+e.cc+" "+(t?"of ["+t.startSN+"-"+t.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+e.level+", target: "+parseFloat(n.toFixed(3))),(0,r.isFiniteNumber)(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=E.FRAG_LOADING,this.hls.trigger(u.Events.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.throwIfFragContextChanged("FRAG_LOADING");var f=this.config.progressive;return f&&o?o.then((function(t){return!t||s.fragContextChanged(null===t||void 0===t?void 0:t.frag)?null:s.fragmentLoader.load(e,i)})).catch((function(e){return s.handleFragLoadError(e)})):Promise.all([this.fragmentLoader.load(e,f?i:void 0),o]).then((function(e){var t=e[0];return!f&&t&&i&&i(t),t})).catch((function(e){return s.handleFragLoadError(e)}))},x.throwIfFragContextChanged=function(e){if(null===this.fragCurrent)throw new Error("frag load aborted, context changed in "+e)},x.doFragPartsLoad=function(e,t,n,r){var i=this;return new Promise((function(a,s){var o=[];!function n(c){var l=t[c];i.fragmentLoader.loadPart(e,l,r).then((function(r){o[l.index]=r;var s=r.part;i.hls.trigger(u.Events.FRAG_LOADED,r);var d=t[c+1];if(!d||d.fragment!==e)return a({frag:e,part:s,partsLoaded:o});n(c+1)})).catch(s)}(n)}))},x.handleFragLoadError=function(e){if("data"in e){var t=e.data;e.data&&t.details===c.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(u.Events.ERROR,t)}else this.hls.trigger(u.Events.ERROR,{type:c.ErrorTypes.OTHER_ERROR,details:c.ErrorDetails.INTERNAL_EXCEPTION,err:e,fatal:!0});return null},x._handleTransmuxerFlush=function(e){var t=this.getCurrentContext(e);if(t&&this.state===E.PARSING){var n=t.frag,r=t.part,i=t.level,a=self.performance.now();n.stats.parsing.end=a,r&&(r.stats.parsing.end=a),this.updateLevelTiming(n,r,i,e.partial)}else this.fragCurrent||this.state===E.STOPPED||this.state===E.ERROR||(this.state=E.IDLE)},x.getCurrentContext=function(e){var t=this.levels,n=e.level,r=e.sn,i=e.part;if(!t||!t[n])return this.warn("Levels object was unset while buffering fragment "+r+" of level "+n+". The current chunk will not be buffered."),null;var a=t[n],s=i>-1?(0,p.getPartWith)(a,r,i):null,o=s?s.fragment:(0,p.getFragmentWithSN)(a,r,this.fragCurrent);return o?{frag:o,part:s,level:a}:null},x.bufferFragmentData=function(e,t,n,r){if(e&&this.state===E.PARSING){var i=e.data1,a=e.data2,s=i;if(i&&a&&(s=(0,d.appendUint8Array)(i,a)),s&&s.length){var o={type:e.type,frag:t,part:n,chunkMeta:r,parent:t.type,data:s};this.hls.trigger(u.Events.BUFFER_APPENDING,o),e.dropped&&e.independent&&!n&&this.flushBufferGap(t)}}},x.flushBufferGap=function(e){var t=this.media;if(t)if(s.BufferHelper.isBuffered(t,t.currentTime)){var n=t.currentTime,r=s.BufferHelper.bufferInfo(t,n,0),i=e.duration,a=Math.min(2*this.config.maxFragLookUpTolerance,.25*i),o=Math.max(Math.min(e.start-a,r.end-a),n+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}else this.flushMainBuffer(0,e.start)},x.getFwdBufferInfo=function(e,t){var n=this.config,i=this.getLoadPosition();if(!(0,r.isFiniteNumber)(i))return null;var a=s.BufferHelper.bufferInfo(e,i,n.maxBufferHole);if(0===a.len&&void 0!==a.nextStart){var o=this.fragmentTracker.getBufferedFrag(i,t);if(o&&a.nextStart<o.end)return s.BufferHelper.bufferInfo(e,i,Math.max(a.nextStart,n.maxBufferHole))}return a},x.getMaxBufferLength=function(e){var t,n=this.config;return t=e?Math.max(8*n.maxBufferSize/e,n.maxBufferLength):n.maxBufferLength,Math.min(t,n.maxMaxBufferLength)},x.reduceMaxBufferLength=function(e){var t=this.config,n=e||t.maxBufferLength;return t.maxMaxBufferLength>=n&&(t.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},x.getNextFragment=function(e,t){var n=t.fragments,r=n.length;if(!r)return null;var i,a=this.config,s=n[0].start;if(t.live){var o=a.initialLiveManifestSize;if(r<o)return this.warn("Not enough fragments to start playback (have: "+r+", need: "+o+")"),null;t.PTSKnown||this.startFragRequested||-1!==this.startPosition||(i=this.getInitialLiveFragment(t,n),this.startPosition=i?this.hls.liveSyncPosition||i.start:e)}else e<=s&&(i=n[0]);if(!i){var u=a.lowLatencyMode?t.partEnd:t.fragmentEnd;i=this.getFragmentAtPosition(e,u,t)}return this.mapToInitFragWhenRequired(i)},x.mapToInitFragWhenRequired=function(e){return null===e||void 0===e||!e.initSegment||null!==e&&void 0!==e&&e.initSegment.data||this.bitrateTest?e:e.initSegment},x.getNextPart=function(e,t,n){for(var r=-1,i=!1,a=!0,s=0,o=e.length;s<o;s++){var u=e[s];if(a=a&&!u.independent,r>-1&&n<u.start)break;var c=u.loaded;c?r=-1:(i||u.independent||a)&&u.fragment===t&&(r=s),i=c}return r},x.loadedEndOfParts=function(e,t){var n=e[e.length-1];return n&&t>n.start&&n.loaded},x.getInitialLiveFragment=function(e,t){var n=this.fragPrevious,r=null;if(n){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+n.programDateTime),r=(0,h.findFragmentByPDT)(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){var i=n.sn+1;if(i>=e.startSN&&i<=e.endSN){var a=t[i-e.startSN];n.cc===a.cc&&(r=a,this.log("Live playlist, switching playlist, load frag with next SN: "+r.sn))}r||(r=(0,h.findFragWithCC)(t,n.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+r.sn)}}else{var s=this.hls.liveSyncPosition;null!==s&&(r=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r},x.getFragmentAtPosition=function(e,t,n){var r,i=this.config,s=this.fragPrevious,o=n.fragments,u=n.endSN,c=n.fragmentHint,l=i.maxFragLookUpTolerance,d=!!(i.lowLatencyMode&&n.partList&&c);if(d&&c&&!this.bitrateTest&&(o=o.concat(c),u=c.sn),e<t){var f=e>t-l?0:l;r=(0,h.findFragmentByPTS)(s,o,e,f)}else r=o[o.length-1];if(r){var p=r.sn-n.startSN;if(this.fragmentTracker.getState(r)===a.FragmentState.OK&&(s=r),s&&r.sn===s.sn&&!d&&s&&r.level===s.level){var v=o[p+1];r.sn<u&&this.fragmentTracker.getState(v)!==a.FragmentState.OK?(this.log("SN "+r.sn+" just loaded, load next one: "+v.sn),r=v):r=null}}return r},x.synchronizeToLiveEdge=function(e){var t=this.config,n=this.media;if(n){var r=this.hls.liveSyncPosition,i=n.currentTime,a=e.fragments[0].start,s=e.edge,o=i>=a-t.maxFragLookUpTolerance&&i<=s;if(null!==r&&n.duration>r&&(i<r||!o)){var u=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!o&&n.readyState<4||i<s-u)&&(this.loadedmetadata||(this.nextLoadPosition=r),n.readyState&&(this.warn("Playback: "+i.toFixed(3)+" is located too far from the end of live sliding playlist: "+s+", reset currentTime to : "+r.toFixed(3)),n.currentTime=r))}}},x.alignPlaylists=function(e,t){var n=this.levels,i=this.levelLastLoaded,a=this.fragPrevious,s=null!==i?n[i]:null,o=e.fragments.length;if(!o)return this.warn("No fragments in live playlist"),0;var u=e.fragments[0].start,c=!t,l=e.alignedSliding&&(0,r.isFiniteNumber)(u);if(c||!l&&!u){(0,f.alignStream)(a,s,e);var d=e.fragments[0].start;return this.log("Live playlist sliding: "+d.toFixed(2)+" start-sn: "+(t?t.startSN:"na")+"->"+e.startSN+" prev-sn: "+(a?a.sn:"na")+" fragments: "+o),d}return u},x.waitForCdnTuneIn=function(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)},x.setStartPosition=function(e,t){var n=this.startPosition;if(n<t&&(n=-1),-1===n||-1===this.lastCurrentTime){var i=e.startTimeOffset;(0,r.isFiniteNumber)(i)?(n=t+i,i<0&&(n+=e.totalduration),n=Math.min(Math.max(t,n),t+e.totalduration),this.log("Start time offset "+i+" found in playlist, adjust startPosition to "+n),this.startPosition=n):e.live?n=this.hls.liveSyncPosition||t:this.startPosition=n=0,this.lastCurrentTime=n}this.nextLoadPosition=n},x.getLoadPosition=function(){var e=this.media,t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t},x.handleFragLoadAborted=function(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn("Fragment "+e.sn+(t?" part"+t.index:"")+" of level "+e.level+" was aborted"),this.resetFragmentLoading(e))},x.resetFragmentLoading=function(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===E.FRAG_LOADING_WAITING_RETRY)||(this.state=E.IDLE)},x.onFragmentOrKeyLoadError=function(e,t){if(t.fatal)return this.stopLoad(),void(this.state=E.ERROR);var n=this.config;if(t.chunkMeta){var r=this.getCurrentContext(t.chunkMeta);r&&(t.frag=r.frag,t.levelRetry=!0,this.fragLoadError=n.fragLoadingMaxRetry)}var i=t.frag;if(i&&i.type===e){var a=this.fragCurrent;if(console.assert(a&&i.sn===a.sn&&i.level===a.level&&i.urlId===a.urlId,"Frag load error must match current frag to retry"),this.fragLoadError+1<=n.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var s=Math.min(Math.pow(2,this.fragLoadError)*n.fragLoadingRetryDelay,n.fragLoadingMaxRetryTimeout);this.warn("Fragment "+i.sn+" of "+e+" "+i.level+" failed to load, retrying in "+s+"ms"),this.retryDate=self.performance.now()+s,this.fragLoadError++,this.state=E.FRAG_LOADING_WAITING_RETRY}else t.levelRetry?(e===y.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=E.IDLE):(o.logger.error(t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.hls.stopLoad(),this.state=E.ERROR)}},x.afterBufferFlushed=function(e,t,n){if(e){var r=s.BufferHelper.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,n),this.state===E.ENDED&&this.resetLoadingState()}},x.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=E.IDLE},x.resetStartWhenNotLoaded=function(e){if(!this.loadedmetadata){this.startFragRequested=!1;var t=this.levels?this.levels[e].details:null;null!==t&&void 0!==t&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},x.updateLevelTiming=function(e,t,n,r){var i=this,a=n.details;console.assert(!!a,"level.details must be defined"),Object.keys(e.elementaryStreams).reduce((function(t,s){var o=e.elementaryStreams[s];if(o){var c=o.endPTS-o.startPTS;if(c<=0)return i.warn("Could not parse fragment "+e.sn+" "+s+" duration reliably ("+c+")"),t||!1;var l=r?0:(0,p.updateFragPTSDTS)(a,e,o.startPTS,o.endPTS,o.startDTS,o.endDTS);return i.hls.trigger(u.Events.LEVEL_PTS_UPDATED,{details:a,level:n,drift:l,type:s,frag:e,start:o.startPTS,end:o.endPTS}),!0}return t}),!1)||(this.warn("Found no media in fragment "+e.sn+" of level "+n.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=E.PARSED,this.hls.trigger(u.Events.FRAG_PARSED,{frag:e,part:t})},x.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},k=i,(S=[{key:"state",get:function(){return this._state},set:function(e){var t=this._state;t!==e&&(this._state=e,this.log(t+"->"+e))}}])&&b(k.prototype,S),w&&b(k,w),Object.defineProperty(k,"prototype",{writable:!1}),i}(i.default)},"./src/controller/buffer-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return h}});var r=n("./src/polyfills/number.ts"),i=n("./src/events.ts"),a=n("./src/utils/logger.ts"),s=n("./src/errors.ts"),o=n("./src/utils/buffer-helper.ts"),u=n("./src/utils/mediasource-helper.ts"),c=n("./src/loader/fragment.ts"),l=n("./src/controller/buffer-operation-queue.ts"),d=(0,u.getMediaSource)(),f=/([ha]vc.)(?:\.[^.,]+)+/,h=function(){function e(e){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var e=t.media,n=t.mediaSource;a.logger.log("[buffer-controller]: Media source opened"),e&&(e.removeEventListener("emptied",t._onMediaEmptied),t.updateMediaElementDuration(),t.hls.trigger(i.Events.MEDIA_ATTACHED,{media:e})),n&&n.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){a.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){a.logger.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=function(){var e=t.media,n=t._objectUrl;e&&e.src!==n&&a.logger.error("Media element src was set while attaching MediaSource ("+n+" > "+e.src+")")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var t=e.prototype;return t.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},t.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},t.registerListeners=function(){var e=this.hls;e.on(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(i.Events.BUFFER_RESET,this.onBufferReset,this),e.on(i.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(i.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(i.Events.BUFFER_EOS,this.onBufferEos,this),e.on(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(i.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(i.Events.FRAG_PARSED,this.onFragParsed,this),e.on(i.Events.FRAG_CHANGED,this.onFragChanged,this)},t.unregisterListeners=function(){var e=this.hls;e.off(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(i.Events.BUFFER_RESET,this.onBufferReset,this),e.off(i.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(i.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(i.Events.BUFFER_EOS,this.onBufferEos,this),e.off(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(i.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(i.Events.FRAG_PARSED,this.onFragParsed,this),e.off(i.Events.FRAG_CHANGED,this.onFragChanged,this)},t._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new l.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},t.onManifestParsed=function(e,t){var n=2;(t.audio&&!t.video||!t.altAudio)&&(n=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=n,this.details=null,a.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},t.onMediaAttaching=function(e,t){var n=this.media=t.media;if(n&&d){var r=this.mediaSource=new d;r.addEventListener("sourceopen",this._onMediaSourceOpen),r.addEventListener("sourceended",this._onMediaSourceEnded),r.addEventListener("sourceclose",this._onMediaSourceClose),n.src=self.URL.createObjectURL(r),this._objectUrl=n.src,n.addEventListener("emptied",this._onMediaEmptied)}},t.onMediaDetaching=function(){var e=this.media,t=this.mediaSource,n=this._objectUrl;if(t){if(a.logger.log("[buffer-controller]: media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(r){a.logger.warn("[buffer-controller]: onMediaDetaching: "+r.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),n&&self.URL.revokeObjectURL(n),e.src===n?(e.removeAttribute("src"),e.load()):a.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(i.Events.MEDIA_DETACHED,void 0)},t.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach((function(t){var n=e.sourceBuffer[t];try{n&&(e.removeBufferListeners(t),e.mediaSource&&e.mediaSource.removeSourceBuffer(n),e.sourceBuffer[t]=void 0)}catch(r){a.logger.warn("[buffer-controller]: Failed to reset the "+t+" buffer",r)}})),this._initSourceBuffer()},t.onBufferCodecs=function(e,t){var n=this,r=this.getSourceBufferTypes().length;Object.keys(t).forEach((function(e){if(r){var i=n.tracks[e];if(i&&"function"===typeof i.buffer.changeType){var s=t[e],o=s.id,u=s.codec,c=s.levelCodec,l=s.container,d=s.metadata,h=(i.levelCodec||i.codec).replace(f,"$1"),p=(c||u).replace(f,"$1");if(h!==p){var v=l+";codecs="+(c||u);n.appendChangeType(e,v),a.logger.log("[buffer-controller]: switching codec "+h+" to "+p),n.tracks[e]={buffer:i.buffer,codec:u,container:l,levelCodec:c,metadata:d,id:o}}}}else n.pendingTracks[e]=t[e]})),r||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},t.appendChangeType=function(e,t){var n=this,r=this.operationQueue,i={execute:function(){var i=n.sourceBuffer[e];i&&(a.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+t),i.changeType(t)),r.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(t){a.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",t)}};r.append(i,e)},t.onBufferAppending=function(e,t){var n=this,r=this.hls,u=this.operationQueue,c=this.tracks,l=t.data,d=t.type,f=t.frag,h=t.part,p=t.chunkMeta,v=p.buffering[d],g=self.performance.now();v.start=g;var m=f.stats.buffering,y=h?h.stats.buffering:null;0===m.start&&(m.start=g),y&&0===y.start&&(y.start=g);var b=c.audio,k=!1;"audio"===d&&"audio/mpeg"===(null===b||void 0===b?void 0:b.container)&&(k=!this.lastMpegAudioChunk||1===p.id||this.lastMpegAudioChunk.sn!==p.sn,this.lastMpegAudioChunk=p);var T=f.start,E={execute:function(){if(v.executeStart=self.performance.now(),k){var e=n.sourceBuffer[d];if(e){var t=T-e.timestampOffset;Math.abs(t)>=.1&&(a.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+T+" (delta: "+t+") sn: "+f.sn+")"),e.timestampOffset=T)}}n.appendExecutor(l,d)},onStart:function(){},onComplete:function(){var e=self.performance.now();v.executeEnd=v.end=e,0===m.first&&(m.first=e),y&&0===y.first&&(y.first=e);var t=n.sourceBuffer,r={};for(var a in t)r[a]=o.BufferHelper.getBuffered(t[a]);n.appendError=0,n.hls.trigger(i.Events.BUFFER_APPENDED,{type:d,frag:f,part:h,chunkMeta:p,parent:f.type,timeRanges:r})},onError:function(e){a.logger.error("[buffer-controller]: Error encountered while trying to append to the "+d+" SourceBuffer",e);var t={type:s.ErrorTypes.MEDIA_ERROR,parent:f.type,details:s.ErrorDetails.BUFFER_APPEND_ERROR,err:e,fatal:!1};e.code===DOMException.QUOTA_EXCEEDED_ERR?t.details=s.ErrorDetails.BUFFER_FULL_ERROR:(n.appendError++,t.details=s.ErrorDetails.BUFFER_APPEND_ERROR,n.appendError>r.config.appendErrorMaxRetry&&(a.logger.error("[buffer-controller]: Failed "+r.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),t.fatal=!0,r.stopLoad())),r.trigger(i.Events.ERROR,t)}};u.append(E,d)},t.onBufferFlushing=function(e,t){var n=this,r=this.operationQueue,s=function(e){return{execute:n.removeExecutor.bind(n,e,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){n.hls.trigger(i.Events.BUFFER_FLUSHED,{type:e})},onError:function(t){a.logger.warn("[buffer-controller]: Failed to remove from "+e+" SourceBuffer",t)}}};t.type?r.append(s(t.type),t.type):this.getSourceBufferTypes().forEach((function(e){r.append(s(e),e)}))},t.onFragParsed=function(e,t){var n=this,r=t.frag,s=t.part,o=[],u=s?s.elementaryStreams:r.elementaryStreams;u[c.ElementaryStreamTypes.AUDIOVIDEO]?o.push("audiovideo"):(u[c.ElementaryStreamTypes.AUDIO]&&o.push("audio"),u[c.ElementaryStreamTypes.VIDEO]&&o.push("video")),0===o.length&&a.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+r.type+" level: "+r.level+" sn: "+r.sn),this.blockBuffers((function(){var e=self.performance.now();r.stats.buffering.end=e,s&&(s.stats.buffering.end=e);var t=s?s.stats:r.stats;n.hls.trigger(i.Events.FRAG_BUFFERED,{frag:r,part:s,stats:t,id:r.type})}),o)},t.onFragChanged=function(e,t){this.flushBackBuffer()},t.onBufferEos=function(e,t){var n=this;this.getSourceBufferTypes().reduce((function(e,r){var i=n.sourceBuffer[r];return!i||t.type&&t.type!==r||(i.ending=!0,i.ended||(i.ended=!0,a.logger.log("[buffer-controller]: "+r+" sourceBuffer now EOS"))),e&&!(i&&!i.ended)}),!0)&&(a.logger.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers((function(){n.getSourceBufferTypes().forEach((function(e){var t=n.sourceBuffer[e];t&&(t.ending=!1)}));var e=n.mediaSource;e&&"open"===e.readyState?(a.logger.log("[buffer-controller]: Calling mediaSource.endOfStream()"),e.endOfStream()):e&&a.logger.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+e.readyState)})))},t.onLevelUpdated=function(e,t){var n=t.details;n.fragments.length&&(this.details=n,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},t.flushBackBuffer=function(){var e=this.hls,t=this.details,n=this.media,s=this.sourceBuffer;if(n&&null!==t){var u=this.getSourceBufferTypes();if(u.length){var c=t.live&&null!==e.config.liveBackBufferLength?e.config.liveBackBufferLength:e.config.backBufferLength;if((0,r.isFiniteNumber)(c)&&!(c<0)){var l=n.currentTime,d=t.levelTargetDuration,f=Math.max(c,d),h=Math.floor(l/d)*d-f;u.forEach((function(n){var r=s[n];if(r){var u=o.BufferHelper.getBuffered(r);if(u.length>0&&h>u.start(0)){if(e.trigger(i.Events.BACK_BUFFER_REACHED,{bufferEnd:h}),t.live)e.trigger(i.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:h});else if(r.ended&&u.end(u.length-1)-l<2*d)return void a.logger.info("[buffer-controller]: Cannot flush "+n+" back buffer while SourceBuffer is in ended state");e.trigger(i.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:h,type:n})}}}))}}}},t.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var e=this.details,t=this.hls,n=this.media,i=this.mediaSource,s=e.fragments[0].start+e.totalduration,o=n.duration,u=(0,r.isFiniteNumber)(i.duration)?i.duration:0;e.live&&t.config.liveDurationInfinity?(a.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),i.duration=1/0,this.updateSeekableRange(e)):(s>u&&s>o||!(0,r.isFiniteNumber)(o))&&(a.logger.log("[buffer-controller]: Updating Media Source duration to "+s.toFixed(3)),i.duration=s)}},t.updateSeekableRange=function(e){var t=this.mediaSource,n=e.fragments;if(n.length&&e.live&&null!==t&&void 0!==t&&t.setLiveSeekableRange){var r=Math.max(0,n[0].start),i=Math.max(r,r+e.totalduration);t.setLiveSeekableRange(r,i)}},t.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,n=this.pendingTracks,r=Object.keys(n).length;if(r&&!e||2===r){this.createSourceBuffers(n),this.pendingTracks={};var a=this.getSourceBufferTypes();if(0===a.length)return void this.hls.trigger(i.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});a.forEach((function(e){t.executeNext(e)}))}},t.createSourceBuffers=function(e){var t=this.sourceBuffer,n=this.mediaSource;if(!n)throw Error("createSourceBuffers called when mediaSource was null");var r=0;for(var o in e)if(!t[o]){var u=e[o];if(!u)throw Error("source buffer exists for track "+o+", however track does not");var c=u.levelCodec||u.codec,l=u.container+";codecs="+c;a.logger.log("[buffer-controller]: creating sourceBuffer("+l+")");try{var d=t[o]=n.addSourceBuffer(l),f=o;this.addBufferListener(f,"updatestart",this._onSBUpdateStart),this.addBufferListener(f,"updateend",this._onSBUpdateEnd),this.addBufferListener(f,"error",this._onSBUpdateError),this.tracks[o]={buffer:d,codec:c,container:u.container,levelCodec:u.levelCodec,metadata:u.metadata,id:u.id},r++}catch(h){a.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+h.message),this.hls.trigger(i.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:h,mimeType:l})}}r&&this.hls.trigger(i.Events.BUFFER_CREATED,{tracks:this.tracks})},t._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},t._onSBUpdateEnd=function(e){var t=this.operationQueue;t.current(e).onComplete(),t.shiftAndExecuteNext(e)},t._onSBUpdateError=function(e,t){a.logger.error("[buffer-controller]: "+e+" SourceBuffer error",t),this.hls.trigger(i.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var n=this.operationQueue.current(e);n&&n.onError(t)},t.removeExecutor=function(e,t,n){var i=this.media,s=this.mediaSource,o=this.operationQueue,u=this.sourceBuffer[e];if(!i||!s||!u)return a.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void o.shiftAndExecuteNext(e);var c=(0,r.isFiniteNumber)(i.duration)?i.duration:1/0,l=(0,r.isFiniteNumber)(s.duration)?s.duration:1/0,d=Math.max(0,t),f=Math.min(n,c,l);f>d&&!u.ending?(u.ended=!1,a.logger.log("[buffer-controller]: Removing ["+d+","+f+"] from the "+e+" SourceBuffer"),console.assert(!u.updating,e+" sourceBuffer must not be updating"),u.remove(d,f)):o.shiftAndExecuteNext(e)},t.appendExecutor=function(e,t){var n=this.operationQueue,r=this.sourceBuffer[t];if(!r)return a.logger.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),void n.shiftAndExecuteNext(t);r.ended=!1,console.assert(!r.updating,t+" sourceBuffer must not be updating"),r.appendBuffer(e)},t.blockBuffers=function(e,t){var n=this;if(void 0===t&&(t=this.getSourceBufferTypes()),!t.length)return a.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);var r=this.operationQueue,i=t.map((function(e){return r.appendBlocker(e)}));Promise.all(i).then((function(){e(),t.forEach((function(e){var t=n.sourceBuffer[e];t&&t.updating||r.shiftAndExecuteNext(e)}))}))},t.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},t.addBufferListener=function(e,t,n){var r=this.sourceBuffer[e];if(r){var i=n.bind(this,e);this.listeners[e].push({event:t,listener:i}),r.addEventListener(t,i)}},t.removeBufferListeners=function(e){var t=this.sourceBuffer[e];t&&this.listeners[e].forEach((function(e){t.removeEventListener(e.event,e.listener)}))},e}()},"./src/controller/buffer-operation-queue.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return i}});var r=n("./src/utils/logger.ts"),i=function(){function e(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}var t=e.prototype;return t.append=function(e,t){var n=this.queues[t];n.push(e),1===n.length&&this.buffers[t]&&this.executeNext(t)},t.insertAbort=function(e,t){this.queues[t].unshift(e),this.executeNext(t)},t.appendBlocker=function(e){var t,n=new Promise((function(e){t=e})),r={execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(r,e),n},t.executeNext=function(e){var t=this.buffers,n=this.queues,i=t[e],a=n[e];if(a.length){var s=a[0];try{s.execute()}catch(o){r.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),s.onError(o),i&&i.updating||(a.shift(),this.executeNext(e))}}},t.shiftAndExecuteNext=function(e){this.queues[e].shift(),this.executeNext(e)},t.current=function(e){return this.queues[e][0]},e}()},"./src/controller/cap-level-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return s}});var r=n("./src/events.ts");function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,a(r.key),r)}}function a(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}var s=function(){function e(e){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var t,n,a,s=e.prototype;return s.setStreamController=function(e){this.streamController=e},s.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},s.registerListeners=function(){var e=this.hls;e.on(r.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(r.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(r.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(r.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},s.unregisterListener=function(){var e=this.hls;e.off(r.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(r.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(r.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(r.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},s.onFpsDropLevelCapping=function(t,n){e.isLevelAllowed(n.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(n.droppedLevel)},s.onMediaAttaching=function(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null},s.onManifestParsed=function(e,t){var n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()},s.onBufferCodecs=function(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()},s.onMediaDetaching=function(){this.stopCapping()},s.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var e=this.hls.levels;if(e.length){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},s.getMaxLevel=function(t){var n=this,r=this.hls.levels;if(!r.length)return-1;var i=r.filter((function(r,i){return e.isLevelAllowed(i,n.restrictedLevels)&&i<=t}));return this.clientRect=null,e.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)},s.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},s.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},s.getDimensions=function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,t.width||t.height||(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t},e.isLevelAllowed=function(e,t){return void 0===t&&(t=[]),-1===t.indexOf(e)},e.getMaxLevelByMediaSize=function(e,t,n){if(!e||!e.length)return-1;for(var r,i,a=e.length-1,s=0;s<e.length;s+=1){var o=e[s];if((o.width>=t||o.height>=n)&&(r=o,!(i=e[s+1])||r.width!==i.width||r.height!==i.height)){a=s;break}}return a},t=e,(n=[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(t){}return e}}])&&i(t.prototype,n),a&&i(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}()},"./src/controller/cmcd-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return h}});var r=n("./src/events.ts"),i=n("./src/types/cmcd.ts"),a=n("./src/utils/buffer-helper.ts"),s=n("./src/utils/logger.ts");function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,c(r.key),r)}}function u(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}function l(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"===typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function f(){return f=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},f.apply(this,arguments)}var h=function(){function e(t){var n=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){n.initialized&&(n.starved=!0),n.buffering=!0},this.onPlaying=function(){n.initialized||(n.initialized=!0),n.buffering=!1},this.applyPlaylistData=function(e){try{n.apply(e,{ot:i.CMCDObjectType.MANIFEST,su:!n.initialized})}catch(t){s.logger.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=function(e){try{var t=e.frag,r=n.hls.levels[t.level],a=n.getObjectType(t),o={d:1e3*t.duration,ot:a};a!==i.CMCDObjectType.VIDEO&&a!==i.CMCDObjectType.AUDIO&&a!=i.CMCDObjectType.MUXED||(o.br=r.bitrate/1e3,o.tb=n.getTopBandwidth(a)/1e3,o.bl=n.getBufferLength(a)),n.apply(e,o)}catch(u){s.logger.warn("Could not generate segment CMCD data.",u)}},this.hls=t;var r=this.config=t.config,a=r.cmcd;null!=a&&(r.pLoader=this.createPlaylistLoader(),r.fLoader=this.createFragmentLoader(),this.sid=a.sessionId||e.uuid(),this.cid=a.contentId,this.useHeaders=!0===a.useHeaders,this.registerListeners())}var t=e.prototype;return t.registerListeners=function(){var e=this.hls;e.on(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(r.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(r.Events.BUFFER_CREATED,this.onBufferCreated,this)},t.unregisterListeners=function(){var e=this.hls;e.off(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(r.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(r.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},t.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},t.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},t.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},t.onBufferCreated=function(e,t){var n,r;this.audioBuffer=null===(n=t.tracks.audio)||void 0===n?void 0:n.buffer,this.videoBuffer=null===(r=t.tracks.video)||void 0===r?void 0:r.buffer},t.createData=function(){var e;return{v:i.CMCDVersion,sf:i.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:null===(e=this.media)||void 0===e?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},t.apply=function(t,n){void 0===n&&(n={}),f(n,this.createData());var r=n.ot===i.CMCDObjectType.INIT||n.ot===i.CMCDObjectType.VIDEO||n.ot===i.CMCDObjectType.MUXED;if(this.starved&&r&&(n.bs=!0,n.su=!0,this.starved=!1),null==n.su&&(n.su=this.buffering),this.useHeaders){var a=e.toHeaders(n);if(!Object.keys(a).length)return;t.headers||(t.headers={}),f(t.headers,a)}else{var s=e.toQuery(n);if(!s)return;t.url=e.appendQueryToUri(t.url,s)}},t.getObjectType=function(e){var t=e.type;return"subtitle"===t?i.CMCDObjectType.TIMED_TEXT:"initSegment"===e.sn?i.CMCDObjectType.INIT:"audio"===t?i.CMCDObjectType.AUDIO:"main"===t?this.hls.audioTracks.length?i.CMCDObjectType.VIDEO:i.CMCDObjectType.MUXED:void 0},t.getTopBandwidth=function(e){var t,n=0,r=this.hls;if(e===i.CMCDObjectType.AUDIO)t=r.audioTracks;else{var a=r.maxAutoLevel,s=a>-1?a+1:r.levels.length;t=r.levels.slice(0,s)}for(var o,u=l(t);!(o=u()).done;){var c=o.value;c.bitrate>n&&(n=c.bitrate)}return n>0?n:NaN},t.getBufferLength=function(e){var t=this.hls.media,n=e===i.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return n&&t?1e3*a.BufferHelper.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len:NaN},t.createPlaylistLoader=function(){var e=this.config.pLoader,t=this.applyPlaylistData,n=e||this.config.loader;return function(){function e(e){this.loader=void 0,this.loader=new n(e)}var r=e.prototype;return r.destroy=function(){this.loader.destroy()},r.abort=function(){this.loader.abort()},r.load=function(e,n,r){t(e),this.loader.load(e,n,r)},u(e,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),e}()},t.createFragmentLoader=function(){var e=this.config.fLoader,t=this.applyFragmentData,n=e||this.config.loader;return function(){function e(e){this.loader=void 0,this.loader=new n(e)}var r=e.prototype;return r.destroy=function(){this.loader.destroy()},r.abort=function(){this.loader.abort()},r.load=function(e,n,r){t(e),this.loader.load(e,n,r)},u(e,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),e}()},e.uuid=function(){var e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)},e.serialize=function(e){for(var t,n=[],r=function(e){return!Number.isNaN(e)&&null!=e&&""!==e&&!1!==e},i=function(e){return Math.round(e)},a=function(e){return 100*i(e/100)},s={br:i,d:i,bl:a,dl:a,mtp:a,nor:function(e){return encodeURIComponent(e)},rtp:a,tb:i},o=l(Object.keys(e||{}).sort());!(t=o()).done;){var u=t.value,c=e[u];if(r(c)&&("v"!==u||1!==c)&&("pr"!=u||1!==c)){var d=s[u];d&&(c=d(c));var f=typeof c,h=void 0;h="ot"===u||"sf"===u||"st"===u?u+"="+c:"boolean"===f?u:"number"===f?u+"="+c:u+"="+JSON.stringify(c),n.push(h)}}return n.join(",")},e.toHeaders=function(t){for(var n={},r=["Object","Request","Session","Status"],i=[{},{},{},{}],a={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},s=0,o=Object.keys(t);s<o.length;s++){var u=o[s];i[null!=a[u]?a[u]:1][u]=t[u]}for(var c=0;c<i.length;c++){var l=e.serialize(i[c]);l&&(n["CMCD-"+r[c]]=l)}return n},e.toQuery=function(t){return"CMCD="+encodeURIComponent(e.serialize(t))},e.appendQueryToUri=function(e,t){if(!t)return e;var n=e.includes("?")?"&":"?";return""+e+n+t},e}()},"./src/controller/eme-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return E}});var r=n("./src/events.ts"),i=n("./src/errors.ts"),a=n("./src/utils/logger.ts"),s=n("./src/utils/mediakeys-helper.ts"),o=n("./src/utils/keysystem-util.ts"),u=n("./src/utils/numeric-encoding-utils.ts"),c=n("./src/loader/level-key.ts"),l=n("./src/utils/hex.ts"),d=n("./src/utils/mp4-tools.ts"),f=n("./node_modules/eventemitter3/index.js"),h=n.n(f);function p(e){var t="function"===typeof Map?new Map:void 0;return p=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return v(e,arguments,y(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),m(r,e)},p(e)}function v(e,t,n){return v=g()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&m(i,n.prototype),i},v.apply(null,arguments)}function g(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function m(e,t){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},m(e,t)}function y(e){return y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},y(e)}var b="[eme]",k=function(){function e(t){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=e.CDMCleanupPromise?[e.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=a.logger.debug.bind(a.logger,b),this.log=a.logger.log.bind(a.logger,b),this.warn=a.logger.warn.bind(a.logger,b),this.error=a.logger.error.bind(a.logger,b),this.hls=t,this.config=t.config,this.registerListeners()}var t=e.prototype;return t.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null},t.registerListeners=function(){this.hls.on(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(r.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(r.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},t.unregisterListeners=function(){this.hls.off(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(r.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(r.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},t.getLicenseServerUrl=function(e){var t=this.config,n=t.drmSystems,r=t.widevineLicenseUrl,i=n[e];if(i)return i.licenseUrl;if(e===s.KeySystems.WIDEVINE&&r)return r;throw new Error('no license server URL configured for key-system "'+e+'"')},t.getServerCertificateUrl=function(e){var t=this.config.drmSystems[e];if(t)return t.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+e+'"]')},t.attemptKeySystemAccess=function(e){var t=this,n=this.hls.levels,r=function(e,t,n){return!!e&&n.indexOf(e)===t},a=n.map((function(e){return e.audioCodec})).filter(r),s=n.map((function(e){return e.videoCodec})).filter(r);return a.length+s.length===0&&s.push("avc1.42e01e"),new Promise((function(n,r){!function e(o){var u=o.shift();t.getMediaKeysPromise(u,a,s).then((function(e){return n({keySystem:u,mediaKeys:e})})).catch((function(t){o.length?e(o):r(t instanceof T?t:new T({type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))}))}(e)}))},t.requestMediaKeySystemAccess=function(e,t){var n=this.config.requestMediaKeySystemAccessFunc;if("function"!==typeof n){var r="Configured requestMediaKeySystemAccess is not a function "+n;return null===s.requestMediaKeySystemAccess&&"http:"===self.location.protocol&&(r="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(r))}return n(e,t)},t.getMediaKeysPromise=function(e,t,n){var r=this,i=(0,s.getSupportedMediaKeySystemConfigurations)(e,t,n,this.config.drmSystemOptions),a=this.keySystemAccessPromises[e],o=null===a||void 0===a?void 0:a.keySystemAccess;if(!o){this.log('Requesting encrypted media "'+e+'" key-system access with config: '+JSON.stringify(i)),o=this.requestMediaKeySystemAccess(e,i);var u=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch((function(t){r.log('Failed to obtain access to key-system "'+e+'": '+t)})),o.then((function(t){r.log('Access for key-system "'+t.keySystem+'" obtained');var n=r.fetchServerCertificate(e);return r.log('Create media-keys for "'+e+'"'),u.mediaKeys=t.createMediaKeys().then((function(t){return r.log('Media-keys created for "'+e+'"'),n.then((function(n){return n?r.setMediaKeysServerCertificate(t,e,n):t}))})),u.mediaKeys.catch((function(t){r.error('Failed to create media-keys for "'+e+'"}: '+t)})),u.mediaKeys}))}return o.then((function(){return a.mediaKeys}))},t.createMediaKeySessionContext=function(e){var t=e.decryptdata,n=e.keySystem,r=e.mediaKeys;console.assert(!!r,"mediaKeys is defined"),this.log('Creating key-system session "'+n+'" keyId: '+l.default.hexDump(t.keyId||[]));var i=r.createSession(),a={decryptdata:t,keySystem:n,mediaKeys:r,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(a),a},t.renewKeySession=function(e){var t=e.decryptdata;if(t.pssh){var n=this.createMediaKeySessionContext(e),r=this.getKeyIdString(t);this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(n,"cenc",t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)},t.getKeyIdString=function(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return l.default.hexDump(e.keyId)},t.updateKeySession=function(e,t){var n,r=e.mediaKeysSession;return this.log('Updating key-session "'+r.sessionId+'" for keyID '+l.default.hexDump((null===(n=e.decryptdata)||void 0===n?void 0:n.keyId)||[])+"\n      } (data length: "+(t?t.byteLength:t)+")"),r.update(t)},t.selectKeySystemFormat=function(e){var t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+e.sn+" "+e.type+": "+e.level+") key formats "+t.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise},t.getKeyFormatPromise=function(e){var t=this;return new Promise((function(n,r){var i=(0,s.getKeySystemsForConfig)(t.config),a=e.map(s.keySystemFormatToKeySystemDomain).filter((function(e){return!!e&&-1!==i.indexOf(e)}));return t.getKeySystemSelectionPromise(a).then((function(e){var t=e.keySystem,i=(0,s.keySystemDomainToKeySystemFormat)(t);i?n(i):r(new Error('Unable to find format for key-system "'+t+'"'))})).catch(r)}))},t.loadKey=function(e){var t=this,n=e.keyInfo.decryptdata,r=this.getKeyIdString(n),i="(keyId: "+r+' format: "'+n.keyFormat+'" method: '+n.method+" uri: "+n.uri+")";this.log("Starting session for key "+i);var a=this.keyIdToKeySessionPromise[r];return a||(a=this.keyIdToKeySessionPromise[r]=this.getKeySystemForKeyPromise(n).then((function(r){var a=r.keySystem,s=r.mediaKeys;return t.throwIfDestroyed(),t.log("Handle encrypted media sn: "+e.frag.sn+" "+e.frag.type+": "+e.frag.level+" using key "+i),t.attemptSetMediaKeys(a,s).then((function(){t.throwIfDestroyed();var e=t.createMediaKeySessionContext({keySystem:a,mediaKeys:s,decryptdata:n});return t.generateRequestWithPreferredKeySession(e,"cenc",n.pssh,"playlist-key")}))}))).catch((function(e){return t.handleError(e)})),a},t.throwIfDestroyed=function(e){if(void 0===e&&(e="Invalid state"),!this.hls)throw new Error("invalid state")},t.handleError=function(e){this.hls&&(this.error(e.message),e instanceof T?this.hls.trigger(r.Events.ERROR,e.data):this.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))},t.getKeySystemForKeyPromise=function(e){var t=this.getKeyIdString(e),n=this.keyIdToKeySessionPromise[t];if(!n){var r=(0,s.keySystemFormatToKeySystemDomain)(e.keyFormat),i=r?[r]:(0,s.getKeySystemsForConfig)(this.config);return this.attemptKeySystemAccess(i)}return n},t.getKeySystemSelectionPromise=function(e){if(e.length||(e=(0,s.getKeySystemsForConfig)(this.config)),0===e.length)throw new T({type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(e)},t._onMediaEncrypted=function(e){var t=this,n=e.initDataType,r=e.initData;if(this.debug('"'+e.type+'" event: init data type: "'+n+'"'),null!==r){var i,a;if("sinf"===n&&this.config.drmSystems[s.KeySystems.FAIRPLAY]){var o=(0,d.bin2str)(new Uint8Array(r));try{var f=(0,u.base64Decode)(JSON.parse(o).sinf),h=(0,d.parseSinf)(new Uint8Array(f));if(!h)return;i=h.subarray(8,24),a=s.KeySystems.FAIRPLAY}catch(E){return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{var p=(0,d.parsePssh)(r);if(null===p)return;0===p.version&&p.systemId===s.KeySystemIds.WIDEVINE&&p.data&&(i=p.data.subarray(8,24)),a=(0,s.keySystemIdToKeySystemDomain)(p.systemId)}if(a&&i){for(var v=l.default.hexDump(i),g=this.keyIdToKeySessionPromise,m=this.mediaKeySessions,y=g[v],b=function(e){var a=m[e],s=a.decryptdata;if(s.pssh||!s.keyId)return"continue";var o=l.default.hexDump(s.keyId);return v===o||-1!==s.uri.replace(/-/g,"").indexOf(v)?(y=g[o],delete g[o],s.pssh=new Uint8Array(r),s.keyId=i,y=g[v]=y.then((function(){return t.generateRequestWithPreferredKeySession(a,n,r,"encrypted-event-key-match")})),"break"):void 0},k=0;k<m.length;k++){var T=b(k);if("continue"!==T&&"break"===T)break}y||(y=g[v]=this.getKeySystemSelectionPromise([a]).then((function(e){var a,o=e.keySystem,u=e.mediaKeys;t.throwIfDestroyed();var l=new c.LevelKey("ISO-23001-7",v,null!=(a=(0,s.keySystemDomainToKeySystemFormat)(o))?a:"");return l.pssh=new Uint8Array(r),l.keyId=i,t.attemptSetMediaKeys(o,u).then((function(){t.throwIfDestroyed();var e=t.createMediaKeySessionContext({decryptdata:l,keySystem:o,mediaKeys:u});return t.generateRequestWithPreferredKeySession(e,n,r,"encrypted-event-no-match")}))}))),y.catch((function(e){return t.handleError(e)}))}}},t._onWaitingForKey=function(e){this.log('"'+e.type+'" event')},t.attemptSetMediaKeys=function(e,t){var n=this,r=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+e+'"');var i=Promise.all(r).then((function(){if(!n.media)throw new Error("Attempted to set mediaKeys without media element attached");return n.media.setMediaKeys(t)}));return this.setMediaKeysQueue.push(i),i.then((function(){n.log('Media-keys set for "'+e+'"'),r.push(i),n.setMediaKeysQueue=n.setMediaKeysQueue.filter((function(e){return-1===r.indexOf(e)}))}))},t.generateRequestWithPreferredKeySession=function(e,t,n,r){var a,u,c=this,l=null===(a=this.config.drmSystems)||void 0===a||null===(u=a[e.keySystem])||void 0===u?void 0:u.generateRequest;if(l)try{var d=l.call(this.hls,t,n,e);if(!d)throw new Error("Invalid response from configured generateRequest filter");t=d.initDataType,n=e.decryptdata.pssh=d.initData?new Uint8Array(d.initData):null}catch(m){var f;if(this.warn(m.message),null!==(f=this.hls)&&void 0!==f&&f.config.debug)throw m}if(null===n)return this.log('Skipping key-session request for "'+r+'" (no initData)'),Promise.resolve(e);var p=this.getKeyIdString(e.decryptdata);this.log('Generating key-session request for "'+r+'": '+p+" (init data type: "+t+" length: "+(n?n.byteLength:null)+")");var v=new(h());e.mediaKeysSession.onmessage=function(t){var n=e.mediaKeysSession;if(n){var r=t.messageType,i=t.message;c.log('"'+r+'" message event for session "'+n.sessionId+'" message size: '+i.byteLength),"license-request"===r||"license-renewal"===r?c.renewLicense(e,i).catch((function(e){c.handleError(e),v.emit("error",e)})):"license-release"===r?e.keySystem===s.KeySystems.FAIRPLAY&&(c.updateKeySession(e,(0,o.strToUtf8array)("acknowledged")),c.removeSession(e)):c.warn('unhandled media key message type "'+r+'"')}else v.emit("error",new Error("invalid state"))},e.mediaKeysSession.onkeystatuseschange=function(t){if(e.mediaKeysSession){c.onKeyStatusChange(e);var n=e.keyStatus;v.emit("keyStatus",n),"expired"===n&&(c.warn(e.keySystem+" expired for key "+p),c.renewKeySession(e))}else v.emit("error",new Error("invalid state"))};var g=new Promise((function(e,t){v.on("error",t),v.on("keyStatus",(function(n){n.startsWith("usable")?e():"output-restricted"===n?t(new T({type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===n?t(new T({type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+n+'"')):"expired"===n?t(new Error("key expired while generating request")):c.warn('unhandled key status change "'+n+'"')}))}));return e.mediaKeysSession.generateRequest(t,n).then((function(){var t;c.log('Request generated for key-session "'+(null===(t=e.mediaKeysSession)||void 0===t?void 0:t.sessionId)+'" keyId: '+p)})).catch((function(e){throw new T({type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_SESSION,error:e,fatal:!1},"Error generating key-session request: "+e)})).then((function(){return g})).catch((function(t){throw v.removeAllListeners(),c.removeSession(e),t})).then((function(){return v.removeAllListeners(),e}))},t.onKeyStatusChange=function(e){var t=this;e.mediaKeysSession.keyStatuses.forEach((function(n,r){t.log('key status change "'+n+'" for keyStatuses keyId: '+l.default.hexDump("buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r))+" session keyId: "+l.default.hexDump(new Uint8Array(e.decryptdata.keyId||[]))+" uri: "+e.decryptdata.uri),e.keyStatus=n}))},t.fetchServerCertificate=function(e){var t=this;return new Promise((function(n,r){var a=t.getServerCertificateUrl(e);if(!a)return n();t.log('Fetching serverCertificate for "'+e+'"');var s=new XMLHttpRequest;s.open("GET",a,!0),s.responseType="arraybuffer",s.onreadystatechange=function(){s.readyState===XMLHttpRequest.DONE&&(200===s.status?n(s.response):r(new T({type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:s},'"'+e+'" certificate request XHR failed ('+a+"). Status: "+s.status+" ("+s.statusText+")")))},s.send()}))},t.setMediaKeysServerCertificate=function(e,t,n){var r=this;return new Promise((function(a,s){e.setServerCertificate(n).then((function(i){r.log("setServerCertificate "+(i?"success":"not supported by CDM")+" ("+(null===n||void 0===n?void 0:n.byteLength)+') on "'+t+'"'),a(e)})).catch((function(e){s(new T({type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))}))}))},t.renewLicense=function(e,t){var n=this;return this.requestLicense(e,new Uint8Array(t)).then((function(t){return n.updateKeySession(e,new Uint8Array(t)).catch((function(e){throw new T({type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:e,fatal:!0},e.message)}))}))},t.setupLicenseXHR=function(e,t,n,r){var i=this,a=this.config.licenseXhrSetup;return a?Promise.resolve().then((function(){if(!n.decryptdata)throw new Error("Key removed");return a.call(i.hls,e,t,n,r)})).catch((function(s){if(!n.decryptdata)throw s;return e.open("POST",t,!0),a.call(i.hls,e,t,n,r)})).then((function(n){return e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:n||r}})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))},t.requestLicense=function(e,t){var n=this;return new Promise((function(r,a){var s=n.getLicenseServerUrl(e.keySystem);n.log("Sending license request to URL: "+s);var o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=function(){if(!n.hls||!e.mediaKeysSession)return a(new Error("invalid state"));if(4===o.readyState)if(200===o.status){n._requestLicenseFailureCount=0;var u=o.response;n.log("License received "+(u instanceof ArrayBuffer?u.byteLength:u));var c=n.config.licenseResponseCallback;if(c)try{u=c.call(n.hls,o,s,e)}catch(d){n.error(d)}r(u)}else if(n._requestLicenseFailureCount++,n._requestLicenseFailureCount>3||o.status>=400&&o.status<500)a(new T({type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:o},"License Request XHR failed ("+s+"). Status: "+o.status+" ("+o.statusText+")"));else{var l=3-n._requestLicenseFailureCount+1;n.warn("Retrying license request, "+l+" attempts left"),n.requestLicense(e,t).then(r,a)}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,n.setupLicenseXHR(o,s,e,t).then((function(e){var t=e.xhr,n=e.licenseChallenge;t.send(n)}))}))},t.onMediaAttached=function(e,t){if(this.config.emeEnabled){var n=t.media;this.media=n,n.addEventListener("encrypted",this.onMediaEncrypted),n.addEventListener("waitingforkey",this.onWaitingForKey)}},t.onMediaDetached=function(){var t=this,n=this.media,r=this.mediaKeySessions;n&&(n.removeEventListener("encrypted",this.onMediaEncrypted),n.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},c.LevelKey.clearKeyUriToKeyIdMap();var i=r.length;e.CDMCleanupPromise=Promise.all(r.map((function(e){return t.removeSession(e)})).concat(null===n||void 0===n?void 0:n.setMediaKeys(null).catch((function(e){t.log("Could not clear media keys: "+e+". media.src: "+(null===n||void 0===n?void 0:n.src))})))).then((function(){i&&(t.log("finished closing key sessions and clearing media keys"),r.length=0)})).catch((function(e){t.log("Could not close sessions and clear media keys: "+e+". media.src: "+(null===n||void 0===n?void 0:n.src))}))},t.onManifestLoaded=function(e,t){var n=t.sessionKeys;if(n&&this.config.emeEnabled&&!this.keyFormatPromise){var r=n.reduce((function(e,t){return-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e}),[]);this.log("Selecting key-system from session-keys "+r.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(r)}},t.removeSession=function(e){var t=this,n=e.mediaKeysSession,r=e.licenseXhr;if(n){this.log("Remove licenses and keys and close session "+n.sessionId),n.onmessage=null,n.onkeystatuseschange=null,r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;var i=this.mediaKeySessions.indexOf(e);return i>-1&&this.mediaKeySessions.splice(i,1),n.remove().catch((function(e){t.log("Could not remove session: "+e)})).then((function(){return n.close()})).catch((function(e){t.log("Could not close session: "+e)}))}},e}();k.CDMCleanupPromise=void 0;var T=function(e){var t,n;function r(t,n){var r;return(r=e.call(this,n)||this).data=void 0,r.data=t,t.err=t.error,r}return n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,m(t,n),r}(p(Error)),E=k},"./src/controller/fps-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return a}});var r=n("./src/events.ts"),i=n("./src/utils/logger.ts"),a=function(){function e(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}var t=e.prototype;return t.setStreamController=function(e){this.streamController=e},t.registerListeners=function(){this.hls.on(r.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},t.unregisterListeners=function(){this.hls.off(r.Events.MEDIA_ATTACHING,this.onMediaAttaching)},t.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},t.onMediaAttaching=function(e,t){var n=this.hls.config;if(n.capLevelOnFPSDrop){var r=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=r,r&&"function"===typeof r.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}},t.checkFPS=function(e,t,n){var a=performance.now();if(t){if(this.lastTime){var s=a-this.lastTime,o=n-this.lastDroppedFrames,u=t-this.lastDecodedFrames,c=1e3*o/s,l=this.hls;if(l.trigger(r.Events.FPS_DROP,{currentDropped:o,currentDecoded:u,totalDroppedFrames:n}),c>0&&o>l.config.fpsDroppedMonitoringThreshold*u){var d=l.currentLevel;i.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(-1===l.autoLevelCapping||l.autoLevelCapping>=d)&&(d-=1,l.trigger(r.Events.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:l.currentLevel}),l.autoLevelCapping=d,this.streamController.nextLevelSwitch())}}this.lastTime=a,this.lastDroppedFrames=n,this.lastDecodedFrames=t}},t.checkFPSInterval=function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},e}()},"./src/controller/fragment-finders.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{findFragWithCC:function(){return c},findFragmentByPDT:function(){return a},findFragmentByPTS:function(){return s},fragmentWithinToleranceTest:function(){return o},pdtWithinToleranceTest:function(){return u}});var r=n("./src/polyfills/number.ts"),i=n("./src/utils/binary-search.ts");function a(e,t,n){if(null===t||!Array.isArray(e)||!e.length||!(0,r.isFiniteNumber)(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;n=n||0;for(var i=0;i<e.length;++i){var a=e[i];if(u(t,n,a))return a}return null}function s(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var a=null;if(e?a=t[e.sn-t[0].sn+1]||null:0===n&&0===t[0].start&&(a=t[0]),a&&0===o(n,r,a))return a;var s=i.default.search(t,o.bind(null,n,r));return!s||s===e&&a?a:s}function o(e,t,n){if(void 0===e&&(e=0),void 0===t&&(t=0),n.start<=e&&n.start+n.duration>e)return 0;var r=Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-r<=e?1:n.start-r>e&&n.start?-1:0}function u(e,t,n){var r=1e3*Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-r>e}function c(e,t){return i.default.search(e,(function(e){return e.cc<t?1:e.cc>t?-1:0}))}},"./src/controller/fragment-tracker.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{FragmentState:function(){return r},FragmentTracker:function(){return o}});var r,i,a=n("./src/events.ts"),s=n("./src/types/loader.ts");(i=r||(r={})).NOT_LOADED="NOT_LOADED",i.APPENDING="APPENDING",i.PARTIAL="PARTIAL",i.OK="OK";var o=function(){function e(e){this.activeFragment=null,this.activeParts=null,this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=e,this._registerListeners()}var t=e.prototype;return t._registerListeners=function(){var e=this.hls;e.on(a.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.on(a.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(a.Events.FRAG_LOADED,this.onFragLoaded,this)},t._unregisterListeners=function(){var e=this.hls;e.off(a.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.off(a.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(a.Events.FRAG_LOADED,this.onFragLoaded,this)},t.destroy=function(){this._unregisterListeners(),this.fragments=this.endListFragments=this.timeRanges=this.activeFragment=this.activeParts=null},t.getAppendedFrag=function(e,t){if(t===s.PlaylistLevelType.MAIN){var n=this.activeFragment,r=this.activeParts;if(!n)return null;if(r)for(var i=r.length;i--;){var a=r[i],o=a?a.end:n.appendedPTS;if(a.start<=e&&void 0!==o&&e<=o)return i>9&&(this.activeParts=r.slice(i-9)),a}else if(n.start<=e&&void 0!==n.appendedPTS&&e<=n.appendedPTS)return n}return this.getBufferedFrag(e,t)},t.getBufferedFrag=function(e,t){for(var n=this.fragments,r=Object.keys(n),i=r.length;i--;){var a=n[r[i]];if((null===a||void 0===a?void 0:a.body.type)===t&&a.buffered){var s=a.body;if(s.start<=e&&e<=s.end)return s}}return null},t.detectEvictedFragments=function(e,t,n){var r=this;this.timeRanges&&(this.timeRanges[e]=t),Object.keys(this.fragments).forEach((function(i){var a=r.fragments[i];if(a)if(a.buffered||a.loaded){var s=a.range[e];s&&s.time.some((function(e){var n=!r.isTimeBuffered(e.startPTS,e.endPTS,t);return n&&r.removeFragment(a.body),n}))}else a.body.type===n&&r.removeFragment(a.body)}))},t.detectPartialFragments=function(e){var t=this,n=this.timeRanges,r=e.frag,i=e.part;if(n&&"initSegment"!==r.sn){var a=c(r),s=this.fragments[a];s&&(Object.keys(n).forEach((function(e){var a=r.elementaryStreams[e];if(a){var o=n[e],u=null!==i||!0===a.partial;s.range[e]=t.getBufferedTimes(r,i,u,o)}})),s.loaded=null,Object.keys(s.range).length?(s.buffered=!0,s.body.endList&&(this.endListFragments[s.body.type]=s)):this.removeFragment(s.body))}},t.fragBuffered=function(e){var t=c(e),n=this.fragments[t];n&&(n.loaded=null,n.buffered=!0)},t.getBufferedTimes=function(e,t,n,r){for(var i={time:[],partial:n},a=t?t.start:e.start,s=t?t.end:e.end,o=e.minEndPTS||s,u=e.maxStartPTS||a,c=0;c<r.length;c++){var l=r.start(c)-this.bufferPadding,d=r.end(c)+this.bufferPadding;if(u>=l&&o<=d){i.time.push({startPTS:Math.max(a,r.start(c)),endPTS:Math.min(s,r.end(c))});break}if(a<d&&s>l)i.partial=!0,i.time.push({startPTS:Math.max(a,r.start(c)),endPTS:Math.min(s,r.end(c))});else if(s<=l)break}return i},t.getPartialFragment=function(e){var t,n,r,i=null,a=0,s=this.bufferPadding,o=this.fragments;return Object.keys(o).forEach((function(c){var l=o[c];l&&u(l)&&(n=l.body.start-s,r=l.body.end+s,e>=n&&e<=r&&(t=Math.min(e-n,r-e),a<=t&&(i=l.body,a=t)))})),i},t.isEndListAppended=function(e){var t=this.endListFragments[e];return void 0!==t&&(t.buffered||u(t))},t.getState=function(e){var t=c(e),n=this.fragments[t];return n?n.buffered?u(n)?r.PARTIAL:r.OK:r.APPENDING:r.NOT_LOADED},t.isTimeBuffered=function(e,t,n){for(var r,i,a=0;a<n.length;a++){if(r=n.start(a)-this.bufferPadding,i=n.end(a)+this.bufferPadding,e>=r&&t<=i)return!0;if(t<=r)return!1}return!1},t.onFragLoaded=function(e,t){var n=t.frag,r=t.part;if("initSegment"!==n.sn&&!n.bitrateTest&&!r){var i=c(n);this.fragments[i]={body:n,loaded:t,buffered:!1,range:Object.create(null)}}},t.onBufferAppended=function(e,t){var n=this,r=t.frag,i=t.part,a=t.timeRanges;if(r.type===s.PlaylistLevelType.MAIN)if(this.activeFragment!==r&&(this.activeFragment=r,r.appendedPTS=void 0),i){var o=this.activeParts;o||(this.activeParts=o=[]),o.push(i)}else this.activeParts=null;this.timeRanges=a,Object.keys(a).forEach((function(e){var t=a[e];if(n.detectEvictedFragments(e,t),!i&&r.type===s.PlaylistLevelType.MAIN){var o=r.elementaryStreams[e];if(!o)return;for(var u=0;u<t.length;u++){var c=t.end(u);c<=o.endPTS&&c>o.startPTS?r.appendedPTS=Math.max(c,r.appendedPTS||0):r.appendedPTS=o.endPTS}}}))},t.onFragBuffered=function(e,t){this.detectPartialFragments(t)},t.hasFragment=function(e){var t=c(e);return!!this.fragments[t]},t.removeFragmentsInRange=function(e,t,n){var r=this;Object.keys(this.fragments).forEach((function(i){var a=r.fragments[i];if(a&&a.buffered){var s=a.body;s.type===n&&s.start<t&&s.end>e&&r.removeFragment(s)}}))},t.removeFragment=function(e){var t=c(e);e.stats.loaded=0,e.clearElementaryStreamInfo(),e.appendedPTS=void 0,delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]},t.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activeFragment=null,this.activeParts=null},e}();function u(e){var t,n;return e.buffered&&((null===(t=e.range.video)||void 0===t?void 0:t.partial)||(null===(n=e.range.audio)||void 0===n?void 0:n.partial))}function c(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn}},"./src/controller/gap-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{MAX_START_GAP_JUMP:function(){return u},SKIP_BUFFER_HOLE_STEP_SECONDS:function(){return c},SKIP_BUFFER_RANGE_START:function(){return l},STALL_MINIMUM_DURATION_MS:function(){return o},default:function(){return d}});var r=n("./src/utils/buffer-helper.ts"),i=n("./src/errors.ts"),a=n("./src/events.ts"),s=n("./src/utils/logger.ts"),o=250,u=2,c=.1,l=.05,d=function(){function e(e,t,n,r){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=n,this.hls=r}var t=e.prototype;return t.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},t.poll=function(e,t){var n=this.config,i=this.media,a=this.stalled;if(null!==i){var c=i.currentTime,l=i.seeking,d=this.seeking&&!l,f=!this.seeking&&l;if(this.seeking=l,c===e){if((f||d)&&(this.stalled=null),!(i.paused&&!l||i.ended||0===i.playbackRate)&&r.BufferHelper.getBuffered(i).length){var h=r.BufferHelper.bufferInfo(i,c,0),p=h.len>0,v=h.nextStart||0;if(p||v){if(l){var g=h.len>u,m=!v||t&&t.start<=c||v-c>u&&!this.fragmentTracker.getPartialFragment(c);if(g||m)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var y,b=Math.max(v,h.start||0)-c,k=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,T=(null===k||void 0===k||null===(y=k.details)||void 0===y?void 0:y.live)?2*k.details.targetduration:u;if(b>0&&b<=T)return void this._trySkipBufferHole(null)}var E=self.performance.now();if(null!==a){var S=E-a;if(l||!(S>=o)||(this._reportStall(h),this.media)){var w=r.BufferHelper.bufferInfo(i,c,n.maxBufferHole);this._tryFixBufferStall(w,S)}}else this.stalled=E}}}else if(this.moved=!0,null!==a){if(this.stallReported){var x=self.performance.now()-a;s.logger.warn("playback not stuck anymore @"+c+", after "+Math.round(x)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}},t._tryFixBufferStall=function(e,t){var n=this.config,r=this.fragmentTracker,i=this.media;if(null!==i){var a=i.currentTime,o=r.getPartialFragment(a);if(o&&(this._trySkipBufferHole(o)||!this.media))return;e.len>n.maxBufferHole&&t>1e3*n.highBufferWatchdogPeriod&&(s.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},t._reportStall=function(e){var t=this.hls,n=this.media;!this.stallReported&&n&&(this.stallReported=!0,s.logger.warn("Playback stalling at @"+n.currentTime+" due to low buffer ("+JSON.stringify(e)+")"),t.trigger(a.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e.len}))},t._trySkipBufferHole=function(e){var t=this.config,n=this.hls,o=this.media;if(null===o)return 0;for(var u=o.currentTime,d=0,f=r.BufferHelper.getBuffered(o),h=0;h<f.length;h++){var p=f.start(h);if(u+t.maxBufferHole>=d&&u<p){var v=Math.max(p+l,o.currentTime+c);return s.logger.warn("skipping hole, adjusting currentTime from "+u+" to "+v),this.moved=!0,this.stalled=null,o.currentTime=v,e&&n.trigger(a.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+u+" to "+v,frag:e}),v}d=f.end(h)}return 0},t._tryNudgeBuffer=function(){var e=this.config,t=this.hls,n=this.media,r=this.nudgeRetry;if(null!==n){var o=n.currentTime;if(this.nudgeRetry++,r<e.nudgeMaxRetry){var u=o+(r+1)*e.nudgeOffset;s.logger.warn("Nudging 'currentTime' from "+o+" to "+u),n.currentTime=u,t.trigger(a.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else s.logger.error("Playhead still not moving while enough data buffered @"+o+" after "+e.nudgeMaxRetry+" nudges"),t.trigger(a.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},e}()},"./src/controller/id3-track-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return f}});var r=n("./src/polyfills/number.ts"),i=n("./src/events.ts"),a=n("./src/utils/texttrack-utils.ts"),s=n("./src/demux/id3.ts"),o=n("./src/loader/date-range.ts"),u=n("./src/types/demuxer.ts");function c(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var l=function(){var e=c();try{new e(0,Number.POSITIVE_INFINITY,"")}catch(t){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function d(e,t){return e.getTime()/1e3-t}var f=function(){function e(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}var t=e.prototype;return t.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},t._registerListeners=function(){var e=this.hls;e.on(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(i.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(i.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},t._unregisterListeners=function(){var e=this.hls;e.off(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(i.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(i.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},t.onMediaAttached=function(e,t){this.media=t.media},t.onMediaDetaching=function(){this.id3Track&&((0,a.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},t.onManifestLoading=function(){this.dateRangeCuesAppended={}},t.createTrack=function(e){var t=this.getID3Track(e.textTracks);return t.mode="hidden",t},t.getID3Track=function(e){if(this.media){for(var t=0;t<e.length;t++){var n=e[t];if("metadata"===n.kind&&"id3"===n.label)return(0,a.sendAddTrackEvent)(n,this.media),n}return this.media.addTextTrack("metadata","id3")}},t.onFragParsingMetadata=function(e,t){if(this.media){var n=this.hls.config,r=n.enableEmsgMetadataCues,i=n.enableID3MetadataCues;if(r||i){var a=t.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var o=c(),d=0;d<a.length;d++){var f=a[d].type;if((f!==u.MetadataSchema.emsg||r)&&i){var h=s.getID3Frames(a[d].data);if(h){var p=a[d].pts,v=p+a[d].duration;v>l&&(v=l),v-p<=0&&(v=p+.25);for(var g=0;g<h.length;g++){var m=h[g];if(!s.isTimeStampFrame(m)){this.updateId3CueEnds(p);var y=new o(p,v,"");y.value=m,f&&(y.type=f),this.id3Track.addCue(y)}}}}}}}},t.updateId3CueEnds=function(e){var t,n=null===(t=this.id3Track)||void 0===t?void 0:t.cues;if(n)for(var r=n.length;r--;){var i=n[r];i.startTime<e&&i.endTime===l&&(i.endTime=e)}},t.onBufferFlushing=function(e,t){var n=t.startOffset,r=t.endOffset,i=t.type,s=this.id3Track,o=this.hls;if(o){var c,l=o.config,d=l.enableEmsgMetadataCues,f=l.enableID3MetadataCues;s&&(d||f)&&(c="audio"===i?function(e){return e.type===u.MetadataSchema.audioId3&&f}:"video"===i?function(e){return e.type===u.MetadataSchema.emsg&&d}:function(e){return e.type===u.MetadataSchema.audioId3&&f||e.type===u.MetadataSchema.emsg&&d},(0,a.removeCuesInRange)(s,n,r,c))}},t.onLevelUpdated=function(e,t){var n=this,i=t.details;if(this.media&&i.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var a=this.dateRangeCuesAppended,s=this.id3Track,f=i.dateRanges,h=Object.keys(f);if(s)for(var p=Object.keys(a).filter((function(e){return!h.includes(e)})),v=function(e){var t=p[e];Object.keys(a[t].cues).forEach((function(e){s.removeCue(a[t].cues[e])})),delete a[t]},g=p.length;g--;)v(g);var m=i.fragments[i.fragments.length-1];if(0!==h.length&&(0,r.isFiniteNumber)(null===m||void 0===m?void 0:m.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var y=m.programDateTime/1e3-m.start,b=c(),k=function(e){var t=h[e],r=f[t],i=a[t],s=(null===i||void 0===i?void 0:i.cues)||{},c=(null===i||void 0===i?void 0:i.durationKnown)||!1,p=d(r.startDate,y),v=l,g=r.endDate;if(g)v=d(g,y),c=!0;else if(r.endOnNext&&!c){var m=h.reduce((function(e,t){var n=f[t];return n.class===r.class&&n.id!==t&&n.startDate>r.startDate&&e.push(n),e}),[]).sort((function(e,t){return e.startDate.getTime()-t.startDate.getTime()}))[0];m&&(v=d(m.startDate,y),c=!0)}for(var k,T=Object.keys(r.attr),E=0;E<T.length;E++){var S=T[E];if(S!==o.DateRangeAttribute.ID&&S!==o.DateRangeAttribute.CLASS&&S!==o.DateRangeAttribute.START_DATE&&S!==o.DateRangeAttribute.DURATION&&S!==o.DateRangeAttribute.END_DATE&&S!==o.DateRangeAttribute.END_ON_NEXT){var w=s[S];if(w)c&&!i.durationKnown&&(w.endTime=v);else{var x=r.attr[S];w=new b(p,v,""),S!==o.DateRangeAttribute.SCTE35_OUT&&S!==o.DateRangeAttribute.SCTE35_IN||(k=x,x=Uint8Array.from(k.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),w.value={key:S,data:x},w.type=u.MetadataSchema.dateRange,n.id3Track.addCue(w),s[S]=w}}}a[t]={cues:s,dateRange:r,durationKnown:c}},T=0;T<h.length;T++)k(T)}}},e}()},"./src/controller/latency-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return u}});var r=n("./src/errors.ts"),i=n("./src/events.ts"),a=n("./src/utils/logger.ts");function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function o(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}var u=function(){function e(e){var t=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return t.timeupdate()},this.hls=e,this.config=e.config,this.registerListeners()}var t,n,o,u=e.prototype;return u.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},u.registerListeners=function(){this.hls.on(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(i.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(i.Events.ERROR,this.onError,this)},u.unregisterListeners=function(){this.hls.off(i.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(i.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(i.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(i.Events.ERROR,this.onError)},u.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},u.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},u.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},u.onLevelUpdated=function(e,t){var n=t.details;this.levelDetails=n,n.advanced&&this.timeupdate(),!n.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},u.onError=function(e,t){t.details===r.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,a.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},u.timeupdate=function(){var e=this.media,t=this.levelDetails;if(e&&t){this.currentTime=e.currentTime;var n=this.computeLatency();if(null!==n){this._latency=n;var r=this.config,i=r.lowLatencyMode,a=r.maxLiveSyncPlaybackRate;if(i&&1!==a){var s=this.targetLatency;if(null!==s){var o=n-s,u=o<Math.min(this.maxLatency,s+t.targetduration);if(t.live&&u&&o>.05&&this.forwardBufferLength>1){var c=Math.min(2,Math.max(1,a)),l=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;e.playbackRate=Math.min(c,Math.max(1,l))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}}}}},u.estimateLiveEdge=function(){var e=this.levelDetails;return null===e?null:e.edge+e.age},u.computeLatency=function(){var e=this.estimateLiveEdge();return null===e?null:e-this.currentTime},t=e,(n=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var e=this.config,t=this.levelDetails;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}},{key:"targetLatency",get:function(){var e=this.levelDetails;if(null===e)return null;var t=e.holdBack,n=e.partHoldBack,r=e.targetduration,i=this.config,a=i.liveSyncDuration,s=i.liveSyncDurationCount,o=i.lowLatencyMode,u=this.hls.userConfig,c=o&&n||t;(u.liveSyncDuration||u.liveSyncDurationCount||0===c)&&(c=void 0!==a?a:s*r);var l=r;return c+Math.min(1*this.stallCount,l)}},{key:"liveSyncPosition",get:function(){var e=this.estimateLiveEdge(),t=this.targetLatency,n=this.levelDetails;if(null===e||null===t||null===n)return null;var r=n.edge,i=e-t-this.edgeStalled,a=r-n.totalduration,s=r-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(a,i),s)}},{key:"drift",get:function(){var e=this.levelDetails;return null===e?1:e.drift}},{key:"edgeStalled",get:function(){var e=this.levelDetails;if(null===e)return 0;var t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}},{key:"forwardBufferLength",get:function(){var e=this.media,t=this.levelDetails;if(!e||!t)return 0;var n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}}])&&s(t.prototype,n),o&&s(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}()},"./src/controller/level-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return v}});var r=n("./src/types/level.ts"),i=n("./src/events.ts"),a=n("./src/errors.ts"),s=n("./src/utils/codecs.ts"),o=n("./src/controller/level-helper.ts"),u=n("./src/controller/base-playlist-controller.ts"),c=n("./src/types/loader.ts");function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},l.apply(this,arguments)}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,f(r.key),r)}}function f(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}var p=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),v=function(e){var t,n;function u(t){var n;return(n=e.call(this,t,"[level-controller]")||this)._levels=[],n._firstLevel=-1,n._startLevel=void 0,n.currentLevelIndex=-1,n.manualLevelIndex=-1,n.onParsedComplete=void 0,n._registerListeners(),n}n=e,(t=u).prototype=Object.create(n.prototype),t.prototype.constructor=t,h(t,n);var f,v,g,m=u.prototype;return m._registerListeners=function(){var e=this.hls;e.on(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(i.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(i.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(i.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(i.Events.ERROR,this.onError,this)},m._unregisterListeners=function(){var e=this.hls;e.off(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(i.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(i.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(i.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(i.Events.ERROR,this.onError,this)},m.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,e.prototype.destroy.call(this)},m.startLoad=function(){this._levels.forEach((function(e){e.loadError=0})),e.prototype.startLoad.call(this)},m.onManifestLoaded=function(e,t){var n,u,c=[],l=[],d=[],f={},h=!1,v=!1,g=!1;if(t.levels.forEach((function(e){var t=e.attrs;h=h||!(!e.width||!e.height),v=v||!!e.videoCodec,g=g||!!e.audioCodec,p&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0);var n=e.bitrate+"-"+e.attrs.RESOLUTION+"-"+e.attrs.CODECS;(u=f[n])?u.url.push(e.url):(u=new r.Level(e),f[n]=u,c.push(u)),t&&(t.AUDIO&&(0,o.addGroupId)(u,"audio",t.AUDIO),t.SUBTITLES&&(0,o.addGroupId)(u,"text",t.SUBTITLES))})),(h||v)&&g&&(c=c.filter((function(e){var t=e.videoCodec,n=e.width,r=e.height;return!!t||!(!n||!r)}))),c=c.filter((function(e){var t=e.audioCodec,n=e.videoCodec;return(!t||(0,s.isCodecSupportedInMp4)(t,"audio"))&&(!n||(0,s.isCodecSupportedInMp4)(n,"video"))})),t.audioTracks&&(l=t.audioTracks.filter((function(e){return!e.audioCodec||(0,s.isCodecSupportedInMp4)(e.audioCodec,"audio")})),(0,o.assignTrackIdsByGroup)(l)),t.subtitles&&(d=t.subtitles,(0,o.assignTrackIdsByGroup)(d)),c.length>0){n=c[0].bitrate,c.sort((function(e,t){return e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"]?(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1:e.bitrate!==t.bitrate?e.bitrate-t.bitrate:e.attrs.SCORE!==t.attrs.SCORE?e.attrs.decimalFloatingPoint("SCORE")-t.attrs.decimalFloatingPoint("SCORE"):h&&e.height!==t.height?e.height-t.height:0})),this._levels=c;for(var m=0;m<c.length;m++)if(c[m].bitrate===n){this._firstLevel=m,this.log("manifest loaded, "+c.length+" level(s) found, first bitrate: "+n);break}var y=g&&!v,b={levels:c,audioTracks:l,subtitleTracks:d,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:g,video:v,altAudio:!y&&l.some((function(e){return!!e.url}))};this.hls.trigger(i.Events.MANIFEST_PARSED,b),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(i.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,reason:"no level with compatible codecs found in manifest"})},m.onError=function(t,n){var i,s;if(e.prototype.onError.call(this,t,n),!n.fatal){var o=n.context,u=this._levels[this.currentLevelIndex];if(o&&(o.type===c.PlaylistContextType.AUDIO_TRACK&&u.audioGroupIds&&o.groupId===u.audioGroupIds[u.urlId]||o.type===c.PlaylistContextType.SUBTITLE_TRACK&&u.textGroupIds&&o.groupId===u.textGroupIds[u.urlId]))this.redundantFailover(this.currentLevelIndex);else{var l,d=!1,f=!0;switch(n.details){case a.ErrorDetails.FRAG_LOAD_ERROR:case a.ErrorDetails.FRAG_LOAD_TIMEOUT:case a.ErrorDetails.KEY_LOAD_ERROR:case a.ErrorDetails.KEY_LOAD_TIMEOUT:if(n.frag){var h=n.frag.type===c.PlaylistLevelType.MAIN?n.frag.level:this.currentLevelIndex,p=this._levels[h];p?(p.fragmentError++,p.fragmentError>this.hls.config.fragLoadingMaxRetry&&(l=h)):l=h}break;case a.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var v=u.attrs["HDCP-LEVEL"];v&&(this.hls.maxHdcpLevel=r.HdcpLevels[r.HdcpLevels.indexOf(v)-1],this.warn('Restricting playback to HDCP-LEVEL of "'+this.hls.maxHdcpLevel+'" or lower'));case a.ErrorDetails.FRAG_PARSING_ERROR:case a.ErrorDetails.KEY_SYSTEM_NO_SESSION:l=(null===(i=n.frag)||void 0===i?void 0:i.type)===c.PlaylistLevelType.MAIN?n.frag.level:this.currentLevelIndex,n.levelRetry=!1;break;case a.ErrorDetails.LEVEL_LOAD_ERROR:case a.ErrorDetails.LEVEL_LOAD_TIMEOUT:o&&(o.deliveryDirectives&&(f=!1),l=o.level),d=!0;break;case a.ErrorDetails.REMUX_ALLOC_ERROR:l=null!=(s=n.level)?s:this.currentLevelIndex,d=!0}void 0!==l&&this.recoverLevel(n,l,d,f)}}},m.recoverLevel=function(e,t,n,r){var i=e.details,a=this._levels[t];if(a.loadError++,n){if(!this.retryLoadingOrFail(e))return void(this.currentLevelIndex=-1);e.levelRetry=!0}if(r){var s=a.url.length;if(s>1&&a.loadError<s)e.levelRetry=!0,this.redundantFailover(t);else if(-1===this.manualLevelIndex){for(var o=-1,u=this._levels,c=u.length;c--;){var l=(c+this.currentLevelIndex)%u.length;if(l!==this.currentLevelIndex&&0===u[l].loadError){o=l;break}}o>-1&&this.currentLevelIndex!==o?(this.warn(i+": switch to "+o),e.levelRetry=!0,this.hls.nextAutoLevel=o):!1===e.levelRetry&&(e.fatal=!0)}}},m.redundantFailover=function(e){var t=this._levels[e],n=t.url.length;if(n>1){var r=(t.urlId+1)%n;this.warn("Switching to redundant URL-id "+r),this._levels.forEach((function(e){e.urlId=r})),this.level=e}},m.onFragLoaded=function(e,t){var n=t.frag;if(void 0!==n&&n.type===c.PlaylistLevelType.MAIN){var r=this._levels[n.level];void 0!==r&&(r.fragmentError=0,r.loadError=0)}},m.onLevelLoaded=function(e,t){var n,r,i=t.level,a=t.details,s=this._levels[i];if(!s)return this.warn("Invalid level index "+i),void(null!==(r=t.deliveryDirectives)&&void 0!==r&&r.skip&&(a.deltaUpdateFailed=!0));i===this.currentLevelIndex?(0===s.fragmentError&&(s.loadError=0,this.retryCount=0),this.playlistLoaded(i,t,s.details)):null!==(n=t.deliveryDirectives)&&void 0!==n&&n.skip&&(a.deltaUpdateFailed=!0)},m.onAudioTrackSwitched=function(e,t){var n=this.hls.levels[this.currentLevelIndex];if(n&&n.audioGroupIds){for(var r=-1,i=this.hls.audioTracks[t.id].groupId,a=0;a<n.audioGroupIds.length;a++)if(n.audioGroupIds[a]===i){r=a;break}r!==n.urlId&&(n.urlId=r,this.startLoad())}},m.loadPlaylist=function(t){e.prototype.loadPlaylist.call(this);var n=this.currentLevelIndex,r=this._levels[n];if(this.canLoad&&r&&r.url.length>0){var a=r.urlId,s=r.url[a];if(t)try{s=t.addDirectives(s)}catch(o){this.warn("Could not construct new URL with HLS Delivery Directives: "+o)}this.log("Attempt loading level index "+n+(void 0!==(null===t||void 0===t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:"")+" with URL-id "+a+" "+s),this.clearTimer(),this.hls.trigger(i.Events.LEVEL_LOADING,{url:s,level:n,id:a,deliveryDirectives:t||null})}},m.removeLevel=function(e,t){var n=function(e,n){return n!==t},r=this._levels.filter((function(r,i){return i!==e||r.url.length>1&&void 0!==t&&(r.url=r.url.filter(n),r.audioGroupIds&&(r.audioGroupIds=r.audioGroupIds.filter(n)),r.textGroupIds&&(r.textGroupIds=r.textGroupIds.filter(n)),r.urlId=0,!0)})).map((function(e,t){var n=e.details;return null!==n&&void 0!==n&&n.fragments&&n.fragments.forEach((function(e){e.level=t})),e}));this._levels=r,this.hls.trigger(i.Events.LEVELS_UPDATED,{levels:r})},f=u,(v=[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t,n=this._levels;if(0!==n.length&&(this.currentLevelIndex!==e||null===(t=n[e])||void 0===t||!t.details)){if(e<0||e>=n.length){var r=e<0;if(this.hls.trigger(i.Events.ERROR,{type:a.ErrorTypes.OTHER_ERROR,details:a.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:r,reason:"invalid level idx"}),r)return;e=Math.min(e,n.length-1)}this.clearTimer();var s=this.currentLevelIndex,o=n[s],u=n[e];this.log("switching to level "+e+" from "+s),this.currentLevelIndex=e;var c=l({},u,{level:e,maxBitrate:u.maxBitrate,uri:u.uri,urlId:u.urlId});delete c._urlId,this.hls.trigger(i.Events.LEVEL_SWITCHING,c);var d=u.details;if(!d||d.live){var f=this.switchParams(u.uri,null===o||void 0===o?void 0:o.details);this.loadPlaylist(f)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}])&&d(f.prototype,v),g&&d(f,g),Object.defineProperty(f,"prototype",{writable:!1}),u}(u.default)},"./src/controller/level-helper.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{addGroupId:function(){return o},addSliding:function(){return g},adjustSliding:function(){return v},assignTrackIdsByGroup:function(){return u},computeReloadInterval:function(){return m},getFragmentWithSN:function(){return y},getPartWith:function(){return b},mapFragmentIntersection:function(){return p},mapPartIntersection:function(){return h},mergeDetails:function(){return f},updateFragPTSDTS:function(){return d},updatePTS:function(){return c}});var r=n("./src/polyfills/number.ts"),i=n("./src/utils/logger.ts"),a=n("./src/loader/date-range.ts");function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s.apply(this,arguments)}function o(e,t,n){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(n);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(n)}}function u(e){var t={};e.forEach((function(e){var n=e.groupId||"";e.id=t[n]=t[n]||0,t[n]++}))}function c(e,t,n){l(e[t],e[n])}function l(e,t){var n=t.startPTS;if((0,r.isFiniteNumber)(n)){var i,a=0;t.sn>e.sn?(a=n-e.start,i=e):(a=e.start-n,i=t),i.duration!==a&&(i.duration=a)}else t.sn>e.sn?e.cc===t.cc&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration:t.start=Math.max(e.start-t.duration,0)}function d(e,t,n,a,s,o){a-n<=0&&(i.logger.warn("Fragment should have a positive duration",t),a=n+t.duration,o=s+t.duration);var u=n,c=a,d=t.startPTS,f=t.endPTS;if((0,r.isFiniteNumber)(d)){var h=Math.abs(d-n);(0,r.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(h,t.deltaPTS):t.deltaPTS=h,u=Math.max(n,d),n=Math.min(n,d),s=Math.min(s,t.startDTS),c=Math.min(a,f),a=Math.max(a,f),o=Math.max(o,t.endDTS)}t.duration=a-n;var p=n-t.start;t.start=t.startPTS=n,t.maxStartPTS=u,t.startDTS=s,t.endPTS=a,t.minEndPTS=c,t.endDTS=o;var v,g=t.sn;if(!e||g<e.startSN||g>e.endSN)return 0;var m=g-e.startSN,y=e.fragments;for(y[m]=t,v=m;v>0;v--)l(y[v],y[v-1]);for(v=m;v<y.length-1;v++)l(y[v],y[v+1]);return e.fragmentHint&&l(y[y.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,p}function f(e,t){for(var n=null,o=e.fragments,u=o.length-1;u>=0;u--){var c=o[u].initSegment;if(c){n=c;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;var l,f=0;if(p(e,t,(function(e,i){e.relurl&&(f=e.cc-i.cc),(0,r.isFiniteNumber)(e.startPTS)&&(0,r.isFiniteNumber)(e.endPTS)&&(i.start=i.startPTS=e.startPTS,i.startDTS=e.startDTS,i.appendedPTS=e.appendedPTS,i.maxStartPTS=e.maxStartPTS,i.endPTS=e.endPTS,i.endDTS=e.endDTS,i.minEndPTS=e.minEndPTS,i.duration=e.endPTS-e.startPTS,i.duration&&(l=i),t.PTSKnown=t.alignedSliding=!0),i.elementaryStreams=e.elementaryStreams,i.loader=e.loader,i.stats=e.stats,i.urlId=e.urlId,e.initSegment&&(i.initSegment=e.initSegment,n=e.initSegment)})),n&&(t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments).forEach((function(e){var t;e.initSegment&&e.initSegment.relurl!==(null===(t=n)||void 0===t?void 0:t.relurl)||(e.initSegment=n)})),t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some((function(e){return!e})),t.deltaUpdateFailed){i.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var g=t.skippedSegments;g--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=function(e,t,n){var r=s({},e);return n&&n.forEach((function(e){delete r[e]})),Object.keys(t).forEach((function(e){var n=new a.DateRange(t[e].attr,r[e]);n.isValid?r[e]=n:i.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(t[e].attr)+'"')})),r}(e.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));var m=t.fragments;if(f){i.logger.warn("discontinuity sliding from playlist, take drift into account");for(var y=0;y<m.length;y++)m[y].cc+=f}t.skippedSegments&&(t.startCC=t.fragments[0].cc),h(e.partList,t.partList,(function(e,t){t.elementaryStreams=e.elementaryStreams,t.stats=e.stats})),l?d(t,l,l.startPTS,l.endPTS,l.startDTS,l.endDTS):v(e,t),m.length&&(t.totalduration=t.edge-m[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;var b=t.advancedDateTime;if(t.advanced&&b){var k=t.edge;t.driftStart||(t.driftStartTime=b,t.driftStart=k),t.driftEndTime=b,t.driftEnd=k}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}function h(e,t,n){if(e&&t)for(var r=0,i=0,a=e.length;i<=a;i++){var s=e[i],o=t[i+r];s&&o&&s.index===o.index&&s.fragment.sn===o.fragment.sn?n(s,o):r--}}function p(e,t,n){for(var r=t.skippedSegments,i=Math.max(e.startSN,t.startSN)-t.startSN,a=(e.fragmentHint?1:0)+(r?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,s=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,u=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,c=i;c<=a;c++){var l=u[s+c],d=o[c];r&&!d&&c<r&&(d=t.fragments[c]=l),l&&d&&n(l,d)}}function v(e,t){var n=t.startSN+t.skippedSegments-e.startSN,r=e.fragments;n<0||n>=r.length||g(t,r[n].start)}function g(e,t){if(t){for(var n=e.fragments,r=e.skippedSegments;r<n.length;r++)n[r].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function m(e,t){void 0===t&&(t=1/0);var n=1e3*e.targetduration;if(e.updated){var r=e.fragments;if(r.length&&4*n>t){var i=1e3*r[r.length-1].duration;i<n&&(n=i)}}else n/=2;return Math.round(n)}function y(e,t,n){if(!e||!e.details)return null;var r=e.details,i=r.fragments[t-r.startSN];return i||((i=r.fragmentHint)&&i.sn===t?i:t<r.startSN&&n&&n.sn===t?n:null)}function b(e,t,n){if(!e||!e.details)return null;var r=e.details.partList;if(r)for(var i=r.length;i--;){var a=r[i];if(a.index===n&&a.fragment.sn===t)return a}return null}},"./src/controller/stream-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return y}});var r=n("./src/polyfills/number.ts"),i=n("./src/controller/base-stream-controller.ts"),a=n("./src/is-supported.ts"),s=n("./src/events.ts"),o=n("./src/utils/buffer-helper.ts"),u=n("./src/controller/fragment-tracker.ts"),c=n("./src/types/loader.ts"),l=n("./src/loader/fragment.ts"),d=n("./src/demux/transmuxer-interface.ts"),f=n("./src/types/transmuxer.ts"),h=n("./src/controller/gap-controller.ts"),p=n("./src/errors.ts");function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,g(r.key),r)}}function g(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}function m(e,t){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},m(e,t)}var y=function(e){var t,n;function g(t,n,r){var i;return(i=e.call(this,t,n,r,"[stream-controller]")||this).audioCodecSwap=!1,i.gapController=null,i.level=-1,i._forceStartLoad=!1,i.altAudio=!1,i.audioOnly=!1,i.fragPlaying=null,i.onvplaying=null,i.onvseeked=null,i.fragLastKbps=0,i.couldBacktrack=!1,i.backtrackFragment=null,i.audioCodecSwitch=!1,i.videoBuffer=null,i._registerListeners(),i}n=e,(t=g).prototype=Object.create(n.prototype),t.prototype.constructor=t,m(t,n);var y,b,k,T=g.prototype;return T._registerListeners=function(){var e=this.hls;e.on(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(s.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(s.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(s.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(s.Events.ERROR,this.onError,this),e.on(s.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(s.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(s.Events.BUFFER_CREATED,this.onBufferCreated,this),e.on(s.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(s.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(s.Events.FRAG_BUFFERED,this.onFragBuffered,this)},T._unregisterListeners=function(){var e=this.hls;e.off(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(s.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(s.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(s.Events.ERROR,this.onError,this),e.off(s.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(s.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(s.Events.BUFFER_CREATED,this.onBufferCreated,this),e.off(s.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(s.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(s.Events.FRAG_BUFFERED,this.onFragBuffered,this)},T.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},T.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var r=n.startLevel;-1===r&&(n.config.testBandwidth&&this.levels.length>1?(r=0,this.bitrateTest=!0):r=n.nextAutoLevel),this.level=n.nextLoadLevel=r,this.loadedmetadata=!1}t>0&&-1===e&&(this.log("Override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=i.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=i.State.STOPPED},T.stopLoad=function(){this._forceStartLoad=!1,e.prototype.stopLoad.call(this)},T.doTick=function(){switch(this.state){case i.State.IDLE:this.doTickIdle();break;case i.State.WAITING_LEVEL:var e,t=this.levels,n=this.level,r=null===t||void 0===t||null===(e=t[n])||void 0===e?void 0:e.details;if(r&&(!r.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(r))break;this.state=i.State.IDLE;break}break;case i.State.FRAG_LOADING_WAITING_RETRY:var a,s=self.performance.now(),o=this.retryDate;(!o||s>=o||null!==(a=this.media)&&void 0!==a&&a.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=i.State.IDLE)}this.onTickEnd()},T.onTickEnd=function(){e.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},T.doTickIdle=function(){var e=this.hls,t=this.levelLastLoaded,n=this.levels,r=this.media,a=e.config,o=e.nextLoadLevel;if(null!==t&&(r||!this.startFragRequested&&a.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&n&&n[o]){var d=n[o],f=this.getMainFwdBufferInfo();if(null!==f){var h=this.getLevelDetails();if(h&&this._streamEnded(f,h)){var p={};return this.altAudio&&(p.type="video"),this.hls.trigger(s.Events.BUFFER_EOS,p),void(this.state=i.State.ENDED)}this.level=e.nextLoadLevel=o;var v=d.details;if(!v||this.state===i.State.WAITING_LEVEL||v.live&&this.levelLastLoaded!==o)return this.level=o,void(this.state=i.State.WAITING_LEVEL);if(!(f.len>=this.getMaxBufferLength(d.maxBitrate))){this.backtrackFragment&&this.backtrackFragment.start>f.end&&(this.backtrackFragment=null);var g=this.backtrackFragment?this.backtrackFragment.start:f.end,m=this.getNextFragment(g,v);if(this.couldBacktrack&&!this.fragPrevious&&m&&"initSegment"!==m.sn&&this.fragmentTracker.getState(m)!==u.FragmentState.OK){var y,b=(null!=(y=this.backtrackFragment)?y:m).sn-v.startSN,k=v.fragments[b-1];k&&m.cc===k.cc&&(m=k,this.fragmentTracker.removeFragment(k))}else this.backtrackFragment&&f.len&&(this.backtrackFragment=null);if(m&&this.fragmentTracker.getState(m)===u.FragmentState.OK&&this.nextLoadPosition>g){var T=this.audioOnly&&!this.altAudio?l.ElementaryStreamTypes.AUDIO:l.ElementaryStreamTypes.VIDEO,E=(T===l.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;E&&this.afterBufferFlushed(E,T,c.PlaylistLevelType.MAIN),m=this.getNextFragment(this.nextLoadPosition,v)}m&&(!m.initSegment||m.initSegment.data||this.bitrateTest||(m=m.initSegment),this.loadFragment(m,v,g))}}}},T.loadFragment=function(t,n,r){var i,a=this.fragmentTracker.getState(t);this.fragCurrent=t,a===u.FragmentState.NOT_LOADED?"initSegment"===t.sn?this._loadInitSegment(t,n):this.bitrateTest?(this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t,n)):(this.startFragRequested=!0,e.prototype.loadFragment.call(this,t,n,r)):a===u.FragmentState.APPENDING?this.reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t):0===(null===(i=this.media)||void 0===i?void 0:i.buffered.length)&&this.fragmentTracker.removeAllFragments()},T.getAppendedFrag=function(e){var t=this.fragmentTracker.getAppendedFrag(e,c.PlaylistLevelType.MAIN);return t&&"fragment"in t?t.fragment:t},T.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,c.PlaylistLevelType.MAIN)},T.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.end+.5):null},T.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},T.nextLevelSwitch=function(){var e=this.levels,t=this.media;if(null!==t&&void 0!==t&&t.readyState){var n,r=this.getAppendedFrag(t.currentTime);if(r&&r.start>1&&this.flushMainBuffer(0,r.start-1),!t.paused&&e){var i=e[this.hls.nextLoadLevel],a=this.fragLastKbps;n=a&&this.fragCurrent?this.fragCurrent.duration*i.maxBitrate/(1e3*a)+1:0}else n=0;var s=this.getBufferedFrag(t.currentTime+n);if(s){var o=this.followingBufferedFrag(s);if(o){this.abortCurrentFrag();var u=o.maxStartPTS?o.maxStartPTS:o.start,c=o.duration,l=Math.max(s.end,u+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,.5*c),.75*c));this.flushMainBuffer(l,Number.POSITIVE_INFINITY)}}}},T.abortCurrentFrag=function(){var e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&e.abortRequests(),this.state){case i.State.KEY_LOADING:case i.State.FRAG_LOADING:case i.State.FRAG_LOADING_WAITING_RETRY:case i.State.PARSING:case i.State.PARSED:this.state=i.State.IDLE}this.nextLoadPosition=this.getLoadPosition()},T.flushMainBuffer=function(t,n){e.prototype.flushMainBuffer.call(this,t,n,this.altAudio?"video":null)},T.onMediaAttached=function(t,n){e.prototype.onMediaAttached.call(this,t,n);var r=n.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),r.addEventListener("playing",this.onvplaying),r.addEventListener("seeked",this.onvseeked),this.gapController=new h.default(this.config,r,this.fragmentTracker,this.hls)},T.onMediaDetaching=function(){var t=this.media;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),e.prototype.onMediaDetaching.call(this)},T.onMediaPlaying=function(){this.tick()},T.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:null;(0,r.isFiniteNumber)(t)&&this.log("Media seeked to "+t.toFixed(3)),this.tick()},T.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(s.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},T.onManifestParsed=function(e,t){var n,r=!1,i=!1;t.levels.forEach((function(e){(n=e.audioCodec)&&(-1!==n.indexOf("mp4a.40.2")&&(r=!0),-1!==n.indexOf("mp4a.40.5")&&(i=!0))})),this.audioCodecSwitch=r&&i&&!(0,a.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1},T.onLevelLoading=function(e,t){var n=this.levels;if(n&&this.state===i.State.IDLE){var r=n[t.level];(!r.details||r.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(r.details))&&(this.state=i.State.WAITING_LEVEL)}},T.onLevelLoaded=function(e,t){var n,r=this.levels,a=t.level,o=t.details,u=o.totalduration;if(r){this.log("Level "+a+" loaded ["+o.startSN+","+o.endSN+"], cc ["+o.startCC+", "+o.endCC+"] duration:"+u);var c=this.fragCurrent;!c||this.state!==i.State.FRAG_LOADING&&this.state!==i.State.FRAG_LOADING_WAITING_RETRY||c.level!==t.level&&c.loader&&(this.state=i.State.IDLE,this.backtrackFragment=null,c.abortRequests());var l=r[a],d=0;if(o.live||null!==(n=l.details)&&void 0!==n&&n.live){if(o.fragments[0]||(o.deltaUpdateFailed=!0),o.deltaUpdateFailed)return;d=this.alignPlaylists(o,l.details)}if(l.details=o,this.levelLastLoaded=a,this.hls.trigger(s.Events.LEVEL_UPDATED,{details:o,level:a}),this.state===i.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=i.State.IDLE}this.startFragRequested?o.live&&this.synchronizeToLiveEdge(o):this.setStartPosition(o,d),this.tick()}else this.warn("Levels were reset while loading level "+a)},T._handleFragmentLoadProgress=function(e){var t,n=e.frag,r=e.part,i=e.payload,a=this.levels;if(a){var s=a[n.level],o=s.details;if(o){var u=s.videoCodec,l=o.PTSKnown||!o.live,h=null===(t=n.initSegment)||void 0===t?void 0:t.data,p=this._getAudioCodec(s),v=this.transmuxer=this.transmuxer||new d.default(this.hls,c.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),g=r?r.index:-1,m=-1!==g,y=new f.ChunkMetadata(n.level,n.sn,n.stats.chunkCount,i.byteLength,g,m),b=this.initPTS[n.cc];v.push(i,h,p,u,n,r,o.totalduration,l,y,b)}else this.warn("Dropping fragment "+n.sn+" of level "+n.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+n.sn+" of level "+n.level+" will not be buffered")},T.onAudioTrackSwitching=function(e,t){var n=this.altAudio,r=!!t.url,i=t.id;if(!r){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var o=this.hls;n&&o.trigger(s.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),o.trigger(s.Events.AUDIO_TRACK_SWITCHED,{id:i})}},T.onAudioTrackSwitched=function(e,t){var n=t.id,r=!!this.hls.audioTracks[n].url;if(r){var i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=r,this.tick()},T.onBufferCreated=function(e,t){var n,r,i=t.tracks,a=!1;for(var s in i){var o=i[s];if("main"===o.id){if(r=s,n=o,"video"===s){var u=i[s];u&&(this.videoBuffer=u.buffer)}}else a=!0}a&&n?(this.log("Alternate track found, use "+r+".buffered to schedule main fragment loading"),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media},T.onFragBuffered=function(e,t){var n=t.frag,r=t.part;if(!n||n.type===c.PlaylistLevelType.MAIN){if(this.fragContextChanged(n))return this.warn("Fragment "+n.sn+(r?" p: "+r.index:"")+" of level "+n.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===i.State.PARSED&&(this.state=i.State.IDLE));var a=r?r.stats:n.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),"initSegment"!==n.sn&&(this.fragPrevious=n),this.fragBufferedComplete(n,r)}},T.onError=function(e,t){if(t.type!==p.ErrorTypes.KEY_SYSTEM_ERROR)switch(t.details){case p.ErrorDetails.FRAG_LOAD_ERROR:case p.ErrorDetails.FRAG_LOAD_TIMEOUT:case p.ErrorDetails.FRAG_PARSING_ERROR:case p.ErrorDetails.KEY_LOAD_ERROR:case p.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(c.PlaylistLevelType.MAIN,t);break;case p.ErrorDetails.LEVEL_LOAD_ERROR:case p.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==i.State.ERROR&&(t.fatal?(this.warn(""+t.details),this.state=i.State.ERROR):t.levelRetry||this.state!==i.State.WAITING_LEVEL||(this.state=i.State.IDLE));break;case p.ErrorDetails.BUFFER_FULL_ERROR:if("main"===t.parent&&(this.state===i.State.PARSING||this.state===i.State.PARSED)){var n=!0,r=this.getFwdBufferInfo(this.media,c.PlaylistLevelType.MAIN);r&&r.len>.5&&(n=!this.reduceMaxBufferLength(r.len)),n&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}else this.onFragmentOrKeyLoadError(c.PlaylistLevelType.MAIN,t)},T.checkBuffer=function(){var e=this.media,t=this.gapController;if(e&&t&&e.readyState){if(this.loadedmetadata||!o.BufferHelper.getBuffered(e).length){var n=this.state!==i.State.IDLE?this.fragCurrent:null;t.poll(this.lastCurrentTime,n)}this.lastCurrentTime=e.currentTime}},T.onFragLoadEmergencyAborted=function(){this.state=i.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},T.onBufferFlushed=function(e,t){var n=t.type;if(n!==l.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var r=(n===l.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(r,n,c.PlaylistLevelType.MAIN)}},T.onLevelsUpdated=function(e,t){this.levels=t.levels},T.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},T.seekToStartPos=function(){var e=this.media;if(e){var t=e.currentTime,n=this.startPosition;if(n>=0&&t<n){if(e.seeking)return void this.log("could not seek to "+n+", already seeking at "+t);var r=o.BufferHelper.getBuffered(e),i=(r.length?r.start(0):0)-n;i>0&&(i<this.config.maxBufferHole||i<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+i+" to match buffer start"),n+=i,this.startPosition=n),this.log("seek to target start position "+n+" from current time "+t),e.currentTime=n}}},T._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t},T._loadBitrateTestFrag=function(e,t){var n=this;e.bitrateTest=!0,this._doFragLoad(e,t).then((function(t){var r=n.hls;if(t&&!n.fragContextChanged(e)){n.fragLoadError=0,n.state=i.State.IDLE,n.startFragRequested=!1,n.bitrateTest=!1;var a=e.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),r.trigger(s.Events.FRAG_LOADED,t),e.bitrateTest=!1}}))},T._handleTransmuxComplete=function(e){var t,n="main",a=this.hls,o=e.remuxResult,u=e.chunkMeta,c=this.getCurrentContext(u);if(!c)return this.warn("The loading context changed while buffering fragment "+u.sn+" of level "+u.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(u.level);var d=c.frag,f=c.part,h=c.level,p=o.video,v=o.text,g=o.id3,m=o.initSegment,y=h.details,b=this.altAudio?void 0:o.audio;if(!this.fragContextChanged(d)){if(this.state=i.State.PARSING,m){m.tracks&&(this._bufferInitSegment(h,m.tracks,d,u),a.trigger(s.Events.FRAG_PARSING_INIT_SEGMENT,{frag:d,id:n,tracks:m.tracks}));var k=m.initPTS,T=m.timescale;(0,r.isFiniteNumber)(k)&&(this.initPTS[d.cc]=k,a.trigger(s.Events.INIT_PTS_FOUND,{frag:d,id:n,initPTS:k,timescale:T}))}if(p&&!1!==o.independent){if(y){var E=p.startPTS,S=p.endPTS,w=p.startDTS,x=p.endDTS;if(f)f.elementaryStreams[p.type]={startPTS:E,endPTS:S,startDTS:w,endDTS:x};else if(p.firstKeyFrame&&p.independent&&1===u.id&&(this.couldBacktrack=!0),p.dropped&&p.independent){var R=this.getMainFwdBufferInfo();if((R?R.end:this.getLoadPosition())+this.config.maxBufferHole<(p.firstKeyFramePTS?p.firstKeyFramePTS:E)-this.config.maxBufferHole)return void this.backtrack(d);d.setElementaryStreamInfo(p.type,d.start,S,d.start,x,!0)}d.setElementaryStreamInfo(p.type,E,S,w,x),this.backtrackFragment&&(this.backtrackFragment=d),this.bufferFragmentData(p,d,f,u)}}else if(!1===o.independent)return void this.backtrack(d);if(b){var C=b.startPTS,A=b.endPTS,I=b.startDTS,P=b.endDTS;f&&(f.elementaryStreams[l.ElementaryStreamTypes.AUDIO]={startPTS:C,endPTS:A,startDTS:I,endDTS:P}),d.setElementaryStreamInfo(l.ElementaryStreamTypes.AUDIO,C,A,I,P),this.bufferFragmentData(b,d,f,u)}if(y&&null!==g&&void 0!==g&&null!==(t=g.samples)&&void 0!==t&&t.length){var _={id:n,frag:d,details:y,samples:g.samples};a.trigger(s.Events.FRAG_PARSING_METADATA,_)}if(y&&v){var D={id:n,frag:d,details:y,samples:v.samples};a.trigger(s.Events.FRAG_PARSING_USERDATA,D)}}},T._bufferInitSegment=function(e,t,n,r){var a=this;if(this.state===i.State.PARSING){this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;var o=t.audio,u=t.video,c=t.audiovideo;if(o){var l=e.audioCodec,d=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(l&&(l=-1!==l.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==o.metadata.channelCount&&-1===d.indexOf("firefox")&&(l="mp4a.40.5")),-1!==d.indexOf("android")&&"audio/mpeg"!==o.container&&(l="mp4a.40.2",this.log("Android: force audio codec to "+l)),e.audioCodec&&e.audioCodec!==l&&this.log('Swapping manifest audio codec "'+e.audioCodec+'" for "'+l+'"'),o.levelCodec=l,o.id="main",this.log("Init audio buffer, container:"+o.container+", codecs[selected/level/parsed]=["+(l||"")+"/"+(e.audioCodec||"")+"/"+o.codec+"]")}u&&(u.levelCodec=e.videoCodec,u.id="main",this.log("Init video buffer, container:"+u.container+", codecs[level/parsed]=["+(e.videoCodec||"")+"/"+u.codec+"]")),c&&this.log("Init audiovideo buffer, container:"+c.container+", codecs[level/parsed]=["+(e.attrs.CODECS||"")+"/"+c.codec+"]"),this.hls.trigger(s.Events.BUFFER_CODECS,t),Object.keys(t).forEach((function(e){var i=t[e].initSegment;null!==i&&void 0!==i&&i.byteLength&&a.hls.trigger(s.Events.BUFFER_APPENDING,{type:e,data:i,frag:n,part:null,chunkMeta:r,parent:n.type})})),this.tick()}},T.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,c.PlaylistLevelType.MAIN)},T.backtrack=function(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=i.State.IDLE},T.checkFragmentChanged=function(){var e=this.media,t=null;if(e&&e.readyState>1&&!1===e.seeking){var n=e.currentTime;if(o.BufferHelper.isBuffered(e,n)?t=this.getAppendedFrag(n):o.BufferHelper.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;var r=this.fragPlaying,i=t.level;r&&t.sn===r.sn&&r.level===i&&t.urlId===r.urlId||(this.fragPlaying=t,this.hls.trigger(s.Events.FRAG_CHANGED,{frag:t}),r&&r.level===i||this.hls.trigger(s.Events.LEVEL_SWITCHED,{level:i}))}}},y=g,(b=[{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"currentFrag",get:function(){var e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}},{key:"currentProgramDateTime",get:function(){var e=this.media;if(e){var t=e.currentTime,n=this.currentFrag;if(n&&(0,r.isFiniteNumber)(t)&&(0,r.isFiniteNumber)(n.programDateTime)){var i=n.programDateTime+1e3*(t-n.start);return new Date(i)}}return null}},{key:"currentLevel",get:function(){var e=this.currentFrag;return e?e.level:-1}},{key:"nextBufferedFrag",get:function(){var e=this.currentFrag;return e?this.followingBufferedFrag(e):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&v(y.prototype,b),k&&v(y,k),Object.defineProperty(y,"prototype",{writable:!1}),g}(i.default)},"./src/controller/subtitle-stream-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{SubtitleStreamController:function(){return v}});var r=n("./src/events.ts"),i=n("./src/utils/buffer-helper.ts"),a=n("./src/controller/fragment-finders.ts"),s=n("./src/utils/discontinuities.ts"),o=n("./src/controller/level-helper.ts"),u=n("./src/controller/fragment-tracker.ts"),c=n("./src/controller/base-stream-controller.ts"),l=n("./src/types/loader.ts"),d=n("./src/types/level.ts");function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,h(r.key),r)}}function h(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}function p(e,t){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},p(e,t)}var v=function(e){var t,n;function h(t,n,r){var i;return(i=e.call(this,t,n,r,"[subtitle-stream-controller]")||this).levels=[],i.currentTrackId=-1,i.tracksBuffered=[],i.mainDetails=null,i._registerListeners(),i}n=e,(t=h).prototype=Object.create(n.prototype),t.prototype.constructor=t,p(t,n);var v,m,y,b=h.prototype;return b.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},b._registerListeners=function(){var e=this.hls;e.on(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(r.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(r.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(r.Events.ERROR,this.onError,this),e.on(r.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(r.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(r.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(r.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(r.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(r.Events.FRAG_BUFFERED,this.onFragBuffered,this)},b._unregisterListeners=function(){var e=this.hls;e.off(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(r.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(r.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(r.Events.ERROR,this.onError,this),e.off(r.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(r.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(r.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(r.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(r.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(r.Events.FRAG_BUFFERED,this.onFragBuffered,this)},b.startLoad=function(e){this.stopLoad(),this.state=c.State.IDLE,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()},b.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},b.onLevelLoaded=function(e,t){this.mainDetails=t.details},b.onSubtitleFragProcessed=function(e,t){var n=t.frag,r=t.success;if(this.fragPrevious=n,this.state=c.State.IDLE,r){var i=this.tracksBuffered[this.currentTrackId];if(i){for(var a,s=n.start,o=0;o<i.length;o++)if(s>=i[o].start&&s<=i[o].end){a=i[o];break}var u=n.start+n.duration;a?a.end=u:(a={start:s,end:u},i.push(a)),this.fragmentTracker.fragBuffered(n)}}},b.onBufferFlushing=function(e,t){var n=t.startOffset,r=t.endOffset;if(0===n&&r!==Number.POSITIVE_INFINITY){var i=this.currentTrackId,a=this.levels;if(!a.length||!a[i]||!a[i].details)return;var s=r-a[i].details.targetduration;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach((function(e){for(var t=0;t<e.length;)if(e[t].end<=s)e.shift();else{if(!(e[t].start<s))break;e[t].start=s,t++}})),this.fragmentTracker.removeFragmentsInRange(n,s,l.PlaylistLevelType.SUBTITLE)}},b.onFragBuffered=function(e,t){var n;this.loadedmetadata||t.frag.type!==l.PlaylistLevelType.MAIN||null!==(n=this.media)&&void 0!==n&&n.buffered.length&&(this.loadedmetadata=!0)},b.onError=function(e,t){var n=t.frag;n&&n.type===l.PlaylistLevelType.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state=c.State.IDLE)},b.onSubtitleTracksUpdated=function(e,t){var n=this,r=t.subtitleTracks;this.tracksBuffered=[],this.levels=r.map((function(e){return new d.Level(e)})),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach((function(e){n.tracksBuffered[e.id]=[]})),this.mediaBuffer=null},b.onSubtitleTrackSwitch=function(e,t){if(this.currentTrackId=t.id,this.levels.length&&-1!==this.currentTrackId){var n=this.levels[this.currentTrackId];null!==n&&void 0!==n&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.setInterval(500)}else this.clearInterval()},b.onSubtitleTrackLoaded=function(e,t){var n,r=t.details,i=t.id,u=this.currentTrackId,l=this.levels;if(l.length){var d=l[u];if(!(i>=l.length||i!==u)&&d){this.mediaBuffer=this.mediaBufferTimeRanges;var f=0;if(r.live||null!==(n=d.details)&&void 0!==n&&n.live){var h=this.mainDetails;if(r.deltaUpdateFailed||!h)return;var p=h.fragments[0];d.details?0===(f=this.alignPlaylists(r,d.details))&&p&&(f=p.start,(0,o.addSliding)(r,f)):r.hasProgramDateTime&&h.hasProgramDateTime?((0,s.alignMediaPlaylistByPDT)(r,h),f=r.fragments[0].start):p&&(f=p.start,(0,o.addSliding)(r,f))}d.details=r,this.levelLastLoaded=i,this.startFragRequested||!this.mainDetails&&r.live||this.setStartPosition(d.details,f),this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===c.State.IDLE&&((0,a.findFragmentByPTS)(null,r.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),d.details=void 0))}}},b._handleFragmentLoadComplete=function(e){var t=this,n=e.frag,i=e.payload,a=n.decryptdata,s=this.hls;if(!this.fragContextChanged(n)&&i&&i.byteLength>0&&a&&a.key&&a.iv&&"AES-128"===a.method){var o=performance.now();this.decrypter.decrypt(new Uint8Array(i),a.key.buffer,a.iv.buffer).then((function(e){var t=performance.now();s.trigger(r.Events.FRAG_DECRYPTED,{frag:n,payload:e,stats:{tstart:o,tdecrypt:t}})})).catch((function(e){t.warn(e.name+": "+e.message),t.state=c.State.IDLE}))}},b.doTick=function(){if(this.media){if(this.state===c.State.IDLE){var e=this.currentTrackId,t=this.levels;if(!t.length||!t[e]||!t[e].details)return;var n=t[e].details,r=n.targetduration,s=this.config,o=this.getLoadPosition(),d=i.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],o-r,s.maxBufferHole),f=d.end,h=d.len,p=this.getFwdBufferInfo(this.media,l.PlaylistLevelType.MAIN);if(h>this.getMaxBufferLength(null===p||void 0===p?void 0:p.len)+r)return;console.assert(n,"Subtitle track details are defined on idle subtitle stream controller tick");var v=n.fragments,g=v.length,m=n.edge,y=null,b=this.fragPrevious;if(f<m){var k=s.maxFragLookUpTolerance;!(y=(0,a.findFragmentByPTS)(b,v,Math.max(v[0].start,f),k))&&b&&b.start<v[0].start&&(y=v[0])}else y=v[g-1];if(!y)return;y=this.mapToInitFragWhenRequired(y),this.fragmentTracker.getState(y)===u.FragmentState.NOT_LOADED&&this.loadFragment(y,n,f)}}else this.state=c.State.IDLE},b.getMaxBufferLength=function(t){var n=e.prototype.getMaxBufferLength.call(this);return t?Math.max(n,t):n},b.loadFragment=function(t,n,r){this.fragCurrent=t,"initSegment"===t.sn?this._loadInitSegment(t,n):(this.startFragRequested=!0,e.prototype.loadFragment.call(this,t,n,r))},v=h,(m=[{key:"mediaBufferTimeRanges",get:function(){return new g(this.tracksBuffered[this.currentTrackId]||[])}}])&&f(v.prototype,m),y&&f(v,y),Object.defineProperty(v,"prototype",{writable:!1}),h}(c.default),g=function(e){this.buffered=void 0;var t=function(t,n,r){if((n>>>=0)>r-1)throw new DOMException("Failed to execute '"+t+"' on 'TimeRanges': The index provided ("+n+") is greater than the maximum bound ("+r+")");return e[n][t]};this.buffered={get length(){return e.length},end:function(n){return t("end",n,e.length)},start:function(n){return t("start",n,e.length)}}}},"./src/controller/subtitle-track-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var r=n("./src/events.ts"),i=n("./src/utils/texttrack-utils.ts"),a=n("./src/controller/base-playlist-controller.ts"),s=n("./src/types/loader.ts");function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,u(r.key),r)}}function u(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function l(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];"subtitles"===r.kind&&r.label&&t.push(e[n])}return t}var d=function(e){var t,n;function a(t){var n;return(n=e.call(this,t,"[subtitle-track-controller]")||this).media=null,n.tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.selectDefaultTrack=!0,n.queuedDefaultTrack=-1,n.trackChangeListener=function(){return n.onTextTracksChanged()},n.asyncPollTrackChange=function(){return n.pollTrackChange(0)},n.useTextTrackPolling=!1,n.subtitlePollingInterval=-1,n._subtitleDisplay=!0,n.registerListeners(),n}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,c(t,n);var u,d,f,h=a.prototype;return h.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,e.prototype.destroy.call(this)},h.registerListeners=function(){var e=this.hls;e.on(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(r.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(r.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(r.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(r.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(r.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(r.Events.ERROR,this.onError,this)},h.unregisterListeners=function(){var e=this.hls;e.off(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(r.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(r.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(r.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(r.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(r.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(r.Events.ERROR,this.onError,this)},h.onMediaAttached=function(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},h.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},h.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),l(this.media.textTracks).forEach((function(e){(0,i.clearCurrentCues)(e)})),this.subtitleTrack=-1,this.media=null)},h.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},h.onManifestParsed=function(e,t){this.tracks=t.subtitleTracks},h.onSubtitleTrackLoaded=function(e,t){var n=t.id,r=t.details,i=this.trackId,a=this.tracksInGroup[i];if(a){var s=a.details;a.details=t.details,this.log("subtitle track "+n+" loaded ["+r.startSN+"-"+r.endSN+"]"),n===this.trackId&&(this.retryCount=0,this.playlistLoaded(n,t,s))}else this.warn("Invalid subtitle track id "+n)},h.onLevelLoading=function(e,t){this.switchLevel(t.level)},h.onLevelSwitching=function(e,t){this.switchLevel(t.level)},h.switchLevel=function(e){var t=this.hls.levels[e];if(null!==t&&void 0!==t&&t.textGroupIds){var n=t.textGroupIds[t.urlId];if(this.groupId!==n){var i=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,a=this.tracks.filter((function(e){return!n||e.groupId===n}));this.tracksInGroup=a;var s=this.findTrackId(null===i||void 0===i?void 0:i.name)||this.findTrackId();this.groupId=n;var o={subtitleTracks:a};this.log("Updating subtitle tracks, "+a.length+' track(s) found in "'+n+'" group-id'),this.hls.trigger(r.Events.SUBTITLE_TRACKS_UPDATED,o),-1!==s&&this.setSubtitleTrack(s,i)}}},h.findTrackId=function(e){for(var t=this.tracksInGroup,n=0;n<t.length;n++){var r=t[n];if((!this.selectDefaultTrack||r.default)&&(!e||e===r.name))return r.id}return-1},h.onError=function(t,n){e.prototype.onError.call(this,t,n),!n.fatal&&n.context&&n.context.type===s.PlaylistContextType.SUBTITLE_TRACK&&n.context.id===this.trackId&&n.context.groupId===this.groupId&&this.retryLoadingOrFail(n)},h.loadPlaylist=function(t){e.prototype.loadPlaylist.call(this);var n=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(n)){var i=n.id,a=n.groupId,s=n.url;if(t)try{s=t.addDirectives(s)}catch(o){this.warn("Could not construct new URL with HLS Delivery Directives: "+o)}this.log("Loading subtitle playlist for id "+i),this.hls.trigger(r.Events.SUBTITLE_TRACK_LOADING,{url:s,id:i,groupId:a,deliveryDirectives:t||null})}},h.toggleTrackModes=function(e){var t=this,n=this.media,r=this.trackId;if(n){var i=l(n.textTracks),a=i.filter((function(e){return e.groupId===t.groupId}));if(-1===e)[].slice.call(i).forEach((function(e){e.mode="disabled"}));else{var s=a[r];s&&(s.mode="disabled")}var o=a[e];o&&(o.mode=this.subtitleDisplay?"showing":"hidden")}},h.setSubtitleTrack=function(e,t){var n,i=this.tracksInGroup;if(this.media){if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(-1===e||null!==(n=i[e])&&void 0!==n&&n.details)||e<-1||e>=i.length)){this.clearTimer();var a=i[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,a){var s=a.id,o=a.groupId,u=void 0===o?"":o,c=a.name,l=a.type,d=a.url;this.hls.trigger(r.Events.SUBTITLE_TRACK_SWITCH,{id:s,groupId:u,name:c,type:l,url:d});var f=this.switchParams(a.url,null===t||void 0===t?void 0:t.details);this.loadPlaylist(f)}else this.hls.trigger(r.Events.SUBTITLE_TRACK_SWITCH,{id:e})}}else this.queuedDefaultTrack=e},h.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var e=-1,t=l(this.media.textTracks),n=0;n<t.length;n++)if("hidden"===t[n].mode)e=n;else if("showing"===t[n].mode){e=n;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},u=a,(d=[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var t=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,t)}}])&&o(u.prototype,d),f&&o(u,f),Object.defineProperty(u,"prototype",{writable:!1}),a}(a.default)},"./src/controller/timeline-controller.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{TimelineController:function(){return h}});var r=n("./src/polyfills/number.ts"),i=n("./src/events.ts"),a=n("./src/utils/cea-608-parser.ts"),s=n("./src/utils/output-filter.ts"),o=n("./src/utils/webvtt-parser.ts"),u=n("./src/utils/texttrack-utils.ts"),c=n("./src/utils/imsc1-ttml-parser.ts"),l=n("./src/utils/mp4-tools.ts"),d=n("./src/types/loader.ts"),f=n("./src/utils/logger.ts"),h=function(){function e(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var t=new s.default(this,"textTrack1"),n=new s.default(this,"textTrack2"),r=new s.default(this,"textTrack3"),o=new s.default(this,"textTrack4");this.cea608Parser1=new a.default(1,t,n),this.cea608Parser2=new a.default(3,r,o)}e.on(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(i.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(i.Events.FRAG_LOADING,this.onFragLoading,this),e.on(i.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(i.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(i.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(i.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(i.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var t=e.prototype;return t.destroy=function(){var e=this.hls;e.off(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(i.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(i.Events.FRAG_LOADING,this.onFragLoading,this),e.off(i.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(i.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(i.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(i.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(i.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},t.addCues=function(e,t,n,r,a){for(var s,o,u,c,l=!1,d=a.length;d--;){var f=a[d],h=(s=f[0],o=f[1],u=t,c=n,Math.min(o,c)-Math.max(s,u));if(h>=0&&(f[0]=Math.min(f[0],t),f[1]=Math.max(f[1],n),l=!0,h/(n-t)>.5))return}if(l||a.push([t,n]),this.config.renderTextTracksNatively){var p=this.captionsTracks[e];this.Cues.newCue(p,t,n,r)}else{var v=this.Cues.newCue(null,t,n,r);this.hls.trigger(i.Events.CUES_PARSED,{type:"captions",cues:v,track:e})}},t.onInitPtsFound=function(e,t){var n=this,r=t.frag,a=t.id,s=t.initPTS,o=t.timescale,u=this.unparsedVttFrags;"main"===a&&(this.initPTS[r.cc]=s,this.timescale[r.cc]=o),u.length&&(this.unparsedVttFrags=[],u.forEach((function(e){n.onFragLoaded(i.Events.FRAG_LOADED,e)})))},t.getExistingTrack=function(e){var t=this.media;if(t)for(var n=0;n<t.textTracks.length;n++){var r=t.textTracks[n];if(r[e])return r}return null},t.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},t.createNativeTrack=function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,n=this.captionsTracks,r=this.media,i=t[e],a=i.label,s=i.languageCode,o=this.getExistingTrack(e);if(o)n[e]=o,(0,u.clearCurrentCues)(n[e]),(0,u.sendAddTrackEvent)(n[e],r);else{var c=this.createTextTrack("captions",a,s);c&&(c[e]=!0,n[e]=c)}}},t.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var n={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(i.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}}},t.createTextTrack=function(e,t,n){var r=this.media;if(r)return r.addTextTrack(e,t,n)},t.onMediaAttaching=function(e,t){this.media=t.media,this._cleanTracks()},t.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach((function(t){(0,u.clearCurrentCues)(e[t]),delete e[t]})),this.nonNativeCaptionsTracks={}},t.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},t._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var n=0;n<t.length;n++)(0,u.clearCurrentCues)(t[n])}},t.onSubtitleTracksUpdated=function(e,t){var n=this;this.textTracks=[];var r=t.subtitleTracks||[],a=r.some((function(e){return e.textCodec===c.IMSC1_CODEC}));if(this.config.enableWebVTT||a&&this.config.enableIMSC1){var s=this.tracks&&r&&this.tracks.length===r.length;if(this.tracks=r||[],this.config.renderTextTracksNatively){var o=this.media?this.media.textTracks:[];this.tracks.forEach((function(e,t){var r;if(t<o.length){for(var i=null,a=0;a<o.length;a++)if(p(o[a],e)){i=o[a];break}i&&(r=i)}if(r)(0,u.clearCurrentCues)(r);else{var s=n._captionsOrSubtitlesFromCharacteristics(e);(r=n.createTextTrack(s,e.name,e.lang))&&(r.mode="disabled")}r&&(r.groupId=e.groupId,n.textTracks.push(r))}))}else if(!s&&this.tracks&&this.tracks.length){var l=this.tracks.map((function(e){return{label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}}));this.hls.trigger(i.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:l})}}},t._captionsOrSubtitlesFromCharacteristics=function(e){var t;if(null!==(t=e.attrs)&&void 0!==t&&t.CHARACTERISTICS){var n=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),r=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(n&&r)return"captions"}return"subtitles"},t.onManifestLoaded=function(e,t){var n=this;this.config.enableCEA708Captions&&t.captions&&t.captions.forEach((function(e){var t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(t){var r="textTrack"+t[1],i=n.captionsProperties[r];i&&(i.label=e.name,e.lang&&(i.languageCode=e.lang),i.media=e)}}))},t.closedCaptionsForLevel=function(e){var t=this.hls.levels[e.level];return null===t||void 0===t?void 0:t.attrs["CLOSED-CAPTIONS"]},t.onFragLoading=function(e,t){var n=this.cea608Parser1,r=this.cea608Parser2,i=this.lastSn,a=this.lastPartIndex;if(this.enabled&&n&&r&&t.frag.type===d.PlaylistLevelType.MAIN){var s,o,u=t.frag.sn,c=null!=(s=null===t||void 0===t||null===(o=t.part)||void 0===o?void 0:o.index)?s:-1;u===i+1||u===i&&c===a+1||(n.reset(),r.reset()),this.lastSn=u,this.lastPartIndex=c}},t.onFragLoaded=function(e,t){var n=t.frag,a=t.payload,s=this.initPTS,o=this.unparsedVttFrags;if(n.type===d.PlaylistLevelType.SUBTITLE)if(a.byteLength){if(!(0,r.isFiniteNumber)(s[n.cc]))return o.push(t),void(s.length&&this.hls.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Missing initial subtitle PTS")}));var u=n.decryptdata,l="stats"in t;if(null==u||!u.encrypted||l){var f=this.tracks[n.level],h=this.vttCCs;h[n.cc]||(h[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),f&&f.textCodec===c.IMSC1_CODEC?this._parseIMSC1(n,a):this._parseVTTs(n,a,h)}}else this.hls.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})},t._parseIMSC1=function(e,t){var n=this,r=this.hls;(0,c.parseIMSC1)(t,this.initPTS[e.cc],this.timescale[e.cc],(function(t){n._appendCues(t,e.level),r.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(function(t){f.logger.log("Failed to parse IMSC1: "+t),r.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})}))},t._parseVTTs=function(e,t,n){var r,a=this,s=this.hls,u=null!==(r=e.initSegment)&&void 0!==r&&r.data?(0,l.appendUint8Array)(e.initSegment.data,new Uint8Array(t)):t;(0,o.parseWebVTT)(u,this.initPTS[e.cc],this.timescale[e.cc],n,e.cc,e.start,(function(t){a._appendCues(t,e.level),s.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(function(n){a._fallbackToIMSC1(e,t),f.logger.log("Failed to parse VTT cue: "+n),s.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:n})}))},t._fallbackToIMSC1=function(e,t){var n=this,r=this.tracks[e.level];r.textCodec||(0,c.parseIMSC1)(t,this.initPTS[e.cc],this.timescale[e.cc],(function(){r.textCodec=c.IMSC1_CODEC,n._parseIMSC1(e,t)}),(function(){r.textCodec="wvtt"}))},t._appendCues=function(e,t){var n=this.hls;if(this.config.renderTextTracksNatively){var r=this.textTracks[t];if(!r||"disabled"===r.mode)return;e.forEach((function(e){return(0,u.addCueToTrack)(r,e)}))}else{var a=this.tracks[t];if(!a)return;var s=a.default?"default":"subtitles"+t;n.trigger(i.Events.CUES_PARSED,{type:"subtitles",cues:e,track:s})}},t.onFragDecrypted=function(e,t){var n=t.frag;if(n.type===d.PlaylistLevelType.SUBTITLE){if(!(0,r.isFiniteNumber)(this.initPTS[n.cc]))return void this.unparsedVttFrags.push(t);this.onFragLoaded(i.Events.FRAG_LOADED,t)}},t.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},t.onFragParsingUserdata=function(e,t){var n=this.cea608Parser1,r=this.cea608Parser2;if(this.enabled&&n&&r){var i=t.frag,a=t.samples;if(i.type!==d.PlaylistLevelType.MAIN||"NONE"!==this.closedCaptionsForLevel(i))for(var s=0;s<a.length;s++){var o=a[s].bytes;if(o){var u=this.extractCea608Data(o);n.addData(a[s].pts,u[0]),r.addData(a[s].pts,u[1])}}}},t.onBufferFlushing=function(e,t){var n=t.startOffset,r=t.endOffset,i=t.endOffsetSubtitles,a=t.type,s=this.media;if(s&&!(s.currentTime<r)){if(!a||"video"===a){var o=this.captionsTracks;Object.keys(o).forEach((function(e){return(0,u.removeCuesInRange)(o[e],n,r)}))}if(this.config.renderTextTracksNatively&&0===n&&void 0!==i){var c=this.textTracks;Object.keys(c).forEach((function(e){return(0,u.removeCuesInRange)(c[e],n,i)}))}}},t.extractCea608Data=function(e){for(var t=[[],[]],n=31&e[0],r=2,i=0;i<n;i++){var a=e[r++],s=127&e[r++],o=127&e[r++];if((0!==s||0!==o)&&0!==(4&a)){var u=3&a;0!==u&&1!==u||(t[u].push(s),t[u].push(o))}}return t},e}();function p(e,t){return e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}},"./src/crypt/aes-crypto.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return r}});var r=function(){function e(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}()},"./src/crypt/aes-decryptor.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return a},removePadding:function(){return i}});var r=n("./src/utils/typed-array.ts");function i(e){var t=e.byteLength,n=t&&new DataView(e.buffer).getUint8(t-1);return n?(0,r.sliceUint8)(e,0,t-n):e}var a=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var t=e.prototype;return t.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),n=new Uint32Array(4),r=0;r<4;r++)n[r]=t.getUint32(4*r);return n},t.initTable=function(){var e=this.sBox,t=this.invSBox,n=this.subMix,r=n[0],i=n[1],a=n[2],s=n[3],o=this.invSubMix,u=o[0],c=o[1],l=o[2],d=o[3],f=new Uint32Array(256),h=0,p=0,v=0;for(v=0;v<256;v++)f[v]=v<128?v<<1:v<<1^283;for(v=0;v<256;v++){var g=p^p<<1^p<<2^p<<3^p<<4;g=g>>>8^255&g^99,e[h]=g,t[g]=h;var m=f[h],y=f[m],b=f[y],k=257*f[g]^16843008*g;r[h]=k<<24|k>>>8,i[h]=k<<16|k>>>16,a[h]=k<<8|k>>>24,s[h]=k,k=16843009*b^65537*y^257*m^16843008*h,u[g]=k<<24|k>>>8,c[g]=k<<16|k>>>16,l[g]=k<<8|k>>>24,d[g]=k,h?(h=m^f[f[f[b^m]]],p^=f[f[p]]):h=p=1}},t.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),n=!0,r=0;r<t.length&&n;)n=t[r]===this.key[r],r++;if(!n){this.key=t;var i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);var a,s,o,u,c=this.ksRows=4*(i+6+1),l=this.keySchedule=new Uint32Array(c),d=this.invKeySchedule=new Uint32Array(c),f=this.sBox,h=this.rcon,p=this.invSubMix,v=p[0],g=p[1],m=p[2],y=p[3];for(a=0;a<c;a++)a<i?o=l[a]=t[a]:(u=o,a%i===0?(u=f[(u=u<<8|u>>>24)>>>24]<<24|f[u>>>16&255]<<16|f[u>>>8&255]<<8|f[255&u],u^=h[a/i|0]<<24):i>6&&a%i===4&&(u=f[u>>>24]<<24|f[u>>>16&255]<<16|f[u>>>8&255]<<8|f[255&u]),l[a]=o=(l[a-i]^u)>>>0);for(s=0;s<c;s++)a=c-s,u=3&s?l[a]:l[a-4],d[s]=s<4||a<=4?u:v[f[u>>>24]]^g[f[u>>>16&255]]^m[f[u>>>8&255]]^y[f[255&u]],d[s]=d[s]>>>0}},t.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},t.decrypt=function(e,t,n){for(var r,i,a,s,o,u,c,l,d,f,h,p,v,g,m=this.keySize+6,y=this.invKeySchedule,b=this.invSBox,k=this.invSubMix,T=k[0],E=k[1],S=k[2],w=k[3],x=this.uint8ArrayToUint32Array_(n),R=x[0],C=x[1],A=x[2],I=x[3],P=new Int32Array(e),_=new Int32Array(P.length),D=this.networkToHostOrderSwap;t<P.length;){for(d=D(P[t]),f=D(P[t+1]),h=D(P[t+2]),p=D(P[t+3]),o=d^y[0],u=p^y[1],c=h^y[2],l=f^y[3],v=4,g=1;g<m;g++)r=T[o>>>24]^E[u>>16&255]^S[c>>8&255]^w[255&l]^y[v],i=T[u>>>24]^E[c>>16&255]^S[l>>8&255]^w[255&o]^y[v+1],a=T[c>>>24]^E[l>>16&255]^S[o>>8&255]^w[255&u]^y[v+2],s=T[l>>>24]^E[o>>16&255]^S[u>>8&255]^w[255&c]^y[v+3],o=r,u=i,c=a,l=s,v+=4;r=b[o>>>24]<<24^b[u>>16&255]<<16^b[c>>8&255]<<8^b[255&l]^y[v],i=b[u>>>24]<<24^b[c>>16&255]<<16^b[l>>8&255]<<8^b[255&o]^y[v+1],a=b[c>>>24]<<24^b[l>>16&255]<<16^b[o>>8&255]<<8^b[255&u]^y[v+2],s=b[l>>>24]<<24^b[o>>16&255]<<16^b[u>>8&255]<<8^b[255&c]^y[v+3],_[t]=D(r^R),_[t+1]=D(s^C),_[t+2]=D(a^A),_[t+3]=D(i^I),R=d,C=f,A=h,I=p,t+=4}return _.buffer},e}()},"./src/crypt/decrypter.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var r=n("./src/crypt/aes-crypto.ts"),i=n("./src/crypt/fast-aes-key.ts"),a=n("./src/crypt/aes-decryptor.ts"),s=n("./src/utils/logger.ts"),o=n("./src/utils/mp4-tools.ts"),u=n("./src/utils/typed-array.ts"),c=function(){function e(e,t){var n=(void 0===t?{}:t).removePKCS7Padding,r=void 0===n||n;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=r,r)try{var i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch(a){}null===this.subtle&&(this.useSoftware=!0)}var t=e.prototype;return t.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},t.isSync=function(){return this.useSoftware},t.flush=function(){var e=this.currentResult,t=this.remainderData;if(!e||t)return this.reset(),null;var n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?(0,a.removePadding)(n):n},t.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},t.decrypt=function(e,t,n){var r=this;return this.useSoftware?new Promise((function(i,a){r.softwareDecrypt(new Uint8Array(e),t,n);var s=r.flush();s?i(s.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(e),t,n)},t.softwareDecrypt=function(e,t,n){var r=this.currentIV,i=this.currentResult,s=this.remainderData;this.logOnce("JS AES decrypt"),s&&(e=(0,o.appendUint8Array)(s,e),this.remainderData=null);var c=this.getValidChunk(e);if(!c.length)return null;r&&(n=r);var l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new a.default),l.expandKey(t);var d=i;return this.currentResult=l.decrypt(c.buffer,0,n),this.currentIV=(0,u.sliceUint8)(c,-16).buffer,d||null},t.webCryptoDecrypt=function(e,t,n){var a=this,o=this.subtle;return this.key===t&&this.fastAesKey||(this.key=t,this.fastAesKey=new i.default(o,t)),this.fastAesKey.expandKey().then((function(t){return o?(a.logOnce("WebCrypto AES decrypt"),new r.default(o,new Uint8Array(n)).decrypt(e.buffer,t)):Promise.reject(new Error("web crypto not initialized"))})).catch((function(r){return s.logger.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+r.name+": "+r.message),a.onWebCryptoError(e,t,n)}))},t.onWebCryptoError=function(e,t,n){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n);var r=this.flush();if(r)return r.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},t.getValidChunk=function(e){var t=e,n=e.length-e.length%16;return n!==e.length&&(t=(0,u.sliceUint8)(e,0,n),this.remainderData=(0,u.sliceUint8)(e,n)),t},t.logOnce=function(e){this.logEnabled&&(s.logger.log("[decrypter]: "+e),this.logEnabled=!1)},e}()},"./src/crypt/fast-aes-key.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return r}});var r=function(){function e(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}return e.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}()},"./src/demux/aacdemuxer.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return u}});var r=n("./src/demux/base-audio-demuxer.ts"),i=n("./src/demux/adts.ts"),a=n("./src/utils/logger.ts"),s=n("./src/demux/id3.ts");function o(e,t){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},o(e,t)}var u=function(e){var t,n;function r(t,n){var r;return(r=e.call(this)||this).observer=void 0,r.config=void 0,r.observer=t,r.config=n,r}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,o(t,n);var u=r.prototype;return u.resetInitSegment=function(t,n,r,i){e.prototype.resetInitSegment.call(this,t,n,r,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:n,duration:i,inputTimeScale:9e4,dropped:0}},r.probe=function(e){if(!e)return!1;for(var t=(s.getID3Data(e,0)||[]).length,n=e.length;t<n;t++)if(i.probe(e,t))return a.logger.log("ADTS sync word found !"),!0;return!1},u.canParse=function(e,t){return i.canParse(e,t)},u.appendFrame=function(e,t,n){i.initTrackConfig(e,this.observer,t,n,e.manifestCodec);var r=i.appendFrame(e,t,n,this.basePTS,this.frameIndex);if(r&&0===r.missing)return r},r}(r.default)},"./src/demux/adts.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{appendFrame:function(){return m},canGetFrameLength:function(){return l},canParse:function(){return f},getAudioConfig:function(){return s},getFrameDuration:function(){return v},getFullFrameLength:function(){return c},getHeaderLength:function(){return u},initTrackConfig:function(){return p},isHeader:function(){return d},isHeaderPattern:function(){return o},parseFrameHeader:function(){return g},probe:function(){return h}});var r=n("./src/utils/logger.ts"),i=n("./src/errors.ts"),a=n("./src/events.ts");function s(e,t,n,s){var o,u,c,l,d=navigator.userAgent.toLowerCase(),f=s,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];o=1+((192&t[n+2])>>>6);var p=(60&t[n+2])>>>2;if(!(p>h.length-1))return c=(1&t[n+2])<<2,c|=(192&t[n+3])>>>6,r.logger.log("manifest codec:"+s+", ADTS type:"+o+", samplingIndex:"+p),/firefox/i.test(d)?p>=6?(o=5,l=new Array(4),u=p-3):(o=2,l=new Array(2),u=p):-1!==d.indexOf("android")?(o=2,l=new Array(2),u=p):(o=5,l=new Array(4),s&&(-1!==s.indexOf("mp4a.40.29")||-1!==s.indexOf("mp4a.40.5"))||!s&&p>=6?u=p-3:((s&&-1!==s.indexOf("mp4a.40.2")&&(p>=6&&1===c||/vivaldi/i.test(d))||!s&&1===c)&&(o=2,l=new Array(2)),u=p)),l[0]=o<<3,l[0]|=(14&p)>>1,l[1]|=(1&p)<<7,l[1]|=c<<3,5===o&&(l[1]|=(14&u)>>1,l[2]=(1&u)<<7,l[2]|=8,l[3]=0),{config:l,samplerate:h[p],channelCount:c,codec:"mp4a.40."+o,manifestCodec:f};e.trigger(a.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+p})}function o(e,t){return 255===e[t]&&240===(246&e[t+1])}function u(e,t){return 1&e[t+1]?7:9}function c(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function l(e,t){return t+5<e.length}function d(e,t){return t+1<e.length&&o(e,t)}function f(e,t){return l(e,t)&&o(e,t)&&c(e,t)<=e.length-t}function h(e,t){if(d(e,t)){var n=u(e,t);if(t+n>=e.length)return!1;var r=c(e,t);if(r<=n)return!1;var i=t+r;return i===e.length||d(e,i)}return!1}function p(e,t,n,i,a){if(!e.samplerate){var o=s(t,n,i,a);if(!o)return;e.config=o.config,e.samplerate=o.samplerate,e.channelCount=o.channelCount,e.codec=o.codec,e.manifestCodec=o.manifestCodec,r.logger.log("parsed codec:"+e.codec+", rate:"+o.samplerate+", channels:"+o.channelCount)}}function v(e){return 9216e4/e}function g(e,t){var n=u(e,t);if(t+n<=e.length){var r=c(e,t)-n;if(r>0)return{headerLength:n,frameLength:r}}}function m(e,t,n,r,i){var a,s=r+i*v(e.samplerate),o=g(t,n);if(o){var u=o.frameLength,c=o.headerLength,l=c+u,d=Math.max(0,n+l-t.length);d?(a=new Uint8Array(l-c)).set(t.subarray(n+c,t.length),0):a=t.subarray(n+c,n+l);var f={unit:a,pts:s};return d||e.samples.push(f),{sample:f,length:l,missing:d}}var h=t.length-n;return(a=new Uint8Array(h)).set(t.subarray(n,t.length),0),{sample:{unit:a,pts:s},length:h,missing:-1}}},"./src/demux/base-audio-demuxer.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d},initPTSFn:function(){return l}});var r=n("./src/polyfills/number.ts"),i=n("./src/demux/id3.ts"),a=n("./src/types/demuxer.ts"),s=n("./src/demux/dummy-demuxed-track.ts"),o=n("./src/utils/mp4-tools.ts"),u=n("./src/utils/typed-array.ts"),c=function(){function e(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var t=e.prototype;return t.resetInitSegment=function(e,t,n,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},t.resetTimeStamp=function(e){this.initPTS=e,this.resetContiguity()},t.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},t.canParse=function(e,t){return!1},t.appendFrame=function(e,t,n){},t.demux=function(e,t){this.cachedData&&(e=(0,o.appendUint8Array)(this.cachedData,e),this.cachedData=null);var n,c=i.getID3Data(e,0),d=c?c.length:0,f=this._audioTrack,h=this._id3Track,p=c?i.getTimeStamp(c):void 0,v=e.length;for((null===this.basePTS||0===this.frameIndex&&(0,r.isFiniteNumber)(p))&&(this.basePTS=l(p,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),c&&c.length>0&&h.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:c,type:a.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});d<v;){if(this.canParse(e,d)){var g=this.appendFrame(f,e,d);g?(this.frameIndex++,this.lastPTS=g.sample.pts,n=d+=g.length):d=v}else i.canParse(e,d)?(c=i.getID3Data(e,d),h.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:c,type:a.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),n=d+=c.length):d++;if(d===v&&n!==v){var m=(0,u.sliceUint8)(e,n);this.cachedData?this.cachedData=(0,o.appendUint8Array)(this.cachedData,m):this.cachedData=m}}return{audioTrack:f,videoTrack:(0,s.dummyTrack)(),id3Track:h,textTrack:(0,s.dummyTrack)()}},t.demuxSampleAes=function(e,t,n){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},t.flush=function(e){var t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:(0,s.dummyTrack)(),id3Track:this._id3Track,textTrack:(0,s.dummyTrack)()}},t.destroy=function(){},e}(),l=function(e,t,n){return(0,r.isFiniteNumber)(e)?90*e:9e4*t+(n||0)},d=c},"./src/demux/chunk-cache.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return r}});var r=function(){function e(){this.chunks=[],this.dataLength=0}var t=e.prototype;return t.push=function(e){this.chunks.push(e),this.dataLength+=e.length},t.flush=function(){var e,t=this.chunks,n=this.dataLength;return t.length?(e=1===t.length?t[0]:function(e,t){for(var n=new Uint8Array(t),r=0,i=0;i<e.length;i++){var a=e[i];n.set(a,r),r+=a.length}return n}(t,n),this.reset(),e):new Uint8Array(0)},t.reset=function(){this.chunks.length=0,this.dataLength=0},e}()},"./src/demux/dummy-demuxed-track.ts":function(e,t,n){"use strict";function r(e,t){return void 0===e&&(e=""),void 0===t&&(t=9e4),{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}n.r(t),n.d(t,{dummyTrack:function(){return r}})},"./src/demux/exp-golomb.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return i}});var r=n("./src/utils/logger.ts"),i=function(){function e(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var t=e.prototype;return t.loadWord=function(){var e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");r.set(e.subarray(n,n+i)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i},t.skipBits=function(e){var t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},t.readBits=function(e){var t=Math.min(this.bitsAvailable,e),n=this.word>>>32-t;if(e>32&&r.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return(t=e-t)>0&&this.bitsAvailable?n<<t|this.readBits(t):n},t.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},t.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.skipEG=function(){this.skipBits(1+this.skipLZ())},t.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},t.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},t.readBoolean=function(){return 1===this.readBits(1)},t.readUByte=function(){return this.readBits(8)},t.readUShort=function(){return this.readBits(16)},t.readUInt=function(){return this.readBits(32)},t.skipScalingList=function(e){for(var t=8,n=8,r=0;r<e;r++)0!==n&&(n=(t+this.readEG()+256)%256),t=0===n?t:n},t.readSPS=function(){var e,t,n,r=0,i=0,a=0,s=0,o=this.readUByte.bind(this),u=this.readBits.bind(this),c=this.readUEG.bind(this),l=this.readBoolean.bind(this),d=this.skipBits.bind(this),f=this.skipEG.bind(this),h=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);o();var v=o();if(u(5),d(3),o(),h(),100===v||110===v||122===v||244===v||44===v||83===v||86===v||118===v||128===v){var g=c();if(3===g&&d(1),h(),h(),d(1),l())for(t=3!==g?8:12,n=0;n<t;n++)l()&&p(n<6?16:64)}h();var m=c();if(0===m)c();else if(1===m)for(d(1),f(),f(),e=c(),n=0;n<e;n++)f();h(),d(1);var y=c(),b=c(),k=u(1);0===k&&d(1),d(1),l()&&(r=c(),i=c(),a=c(),s=c());var T=[1,1];if(l()&&l())switch(o()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[o()<<8|o(),o()<<8|o()]}return{width:Math.ceil(16*(y+1)-2*r-2*i),height:(2-k)*(b+1)*16-(k?2:4)*(a+s),pixelRatio:T}},t.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}()},"./src/demux/id3.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{canParse:function(){return u},decodeFrame:function(){return h},getID3Data:function(){return s},getID3Frames:function(){return f},getTimeStamp:function(){return c},isFooter:function(){return a},isHeader:function(){return i},isTimeStampFrame:function(){return l},testables:function(){return b},utf8ArrayToStr:function(){return y}});var r,i=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},a=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},s=function(e,t){for(var n=t,r=0;i(e,t);)r+=10,r+=o(e,t+6),a(e,t+10)&&(r+=10),t+=r;if(r>0)return e.subarray(n,n+r)},o=function(e,t){var n=0;return n=(127&e[t])<<21,n|=(127&e[t+1])<<14,n|=(127&e[t+2])<<7,n|=127&e[t+3]},u=function(e,t){return i(e,t)&&o(e,t+6)+10<=e.length-t},c=function(e){for(var t=f(e),n=0;n<t.length;n++){var r=t[n];if(l(r))return m(r)}},l=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},d=function(e){var t=String.fromCharCode(e[0],e[1],e[2],e[3]),n=o(e,4);return{type:t,size:n,data:e.subarray(10,10+n)}},f=function(e){for(var t=0,n=[];i(e,t);){for(var r=o(e,t+6),s=(t+=10)+r;t+8<s;){var u=d(e.subarray(t)),c=h(u);c&&n.push(c),t+=u.size+10}a(e,t)&&(t+=10)}return n},h=function(e){return"PRIV"===e.type?p(e):"W"===e.type[0]?g(e):v(e)},p=function(e){if(!(e.size<2)){var t=y(e.data,!0),n=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:n.buffer}}},v=function(e){if(!(e.size<2)){if("TXXX"===e.type){var t=1,n=y(e.data.subarray(t),!0);t+=n.length+1;var r=y(e.data.subarray(t));return{key:e.type,info:n,data:r}}var i=y(e.data.subarray(1));return{key:e.type,data:i}}},g=function(e){if("WXXX"===e.type){if(e.size<2)return;var t=1,n=y(e.data.subarray(t),!0);t+=n.length+1;var r=y(e.data.subarray(t));return{key:e.type,info:n,data:r}}var i=y(e.data);return{key:e.type,data:i}},m=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),n=1&t[3],r=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return r/=45,n&&(r+=47721858.84),Math.round(r)}},y=function(e,t){void 0===t&&(t=!1);var n=k();if(n){var r=n.decode(e);if(t){var i=r.indexOf("\0");return-1!==i?r.substring(0,i):r}return r.replace(/\0/g,"")}for(var a,s,o,u=e.length,c="",l=0;l<u;){if(0===(a=e[l++])&&t)return c;if(0!==a&&3!==a)switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:c+=String.fromCharCode(a);break;case 12:case 13:s=e[l++],c+=String.fromCharCode((31&a)<<6|63&s);break;case 14:s=e[l++],o=e[l++],c+=String.fromCharCode((15&a)<<12|(63&s)<<6|(63&o)<<0)}}return c},b={decodeTextFrame:v};function k(){return r||"undefined"===typeof self.TextDecoder||(r=new self.TextDecoder("utf-8")),r}},"./src/demux/mp3demuxer.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var r=n("./src/demux/base-audio-demuxer.ts"),i=n("./src/demux/id3.ts"),a=n("./src/utils/logger.ts"),s=n("./src/demux/mpegaudio.ts");function o(e,t){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},o(e,t)}var u=function(e){var t,n;function r(){return e.apply(this,arguments)||this}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,o(t,n);var u=r.prototype;return u.resetInitSegment=function(t,n,r,i){e.prototype.resetInitSegment.call(this,t,n,r,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:n,duration:i,inputTimeScale:9e4,dropped:0}},r.probe=function(e){if(!e)return!1;for(var t=(i.getID3Data(e,0)||[]).length,n=e.length;t<n;t++)if(s.probe(e,t))return a.logger.log("MPEG Audio sync word found !"),!0;return!1},u.canParse=function(e,t){return s.canParse(e,t)},u.appendFrame=function(e,t,n){if(null!==this.basePTS)return s.appendFrame(e,t,n,this.basePTS,this.frameIndex)},r}(r.default),c=u},"./src/demux/mp4demuxer.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return u}});var r=n("./src/polyfills/number.ts"),i=n("./src/types/demuxer.ts"),a=n("./src/utils/mp4-tools.ts"),s=n("./src/demux/dummy-demuxed-track.ts"),o=/\/emsg[-/]ID3/i,u=function(){function e(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}var t=e.prototype;return t.resetTimeStamp=function(){},t.resetInitSegment=function(e,t,n,r){var i=this.videoTrack=(0,s.dummyTrack)("video",1),o=this.audioTrack=(0,s.dummyTrack)("audio",1),u=this.txtTrack=(0,s.dummyTrack)("text",1);if(this.id3Track=(0,s.dummyTrack)("id3",1),this.timeOffset=0,e&&e.byteLength){var c=(0,a.parseInitSegment)(e);if(c.video){var l=c.video,d=l.id,f=l.timescale,h=l.codec;i.id=d,i.timescale=u.timescale=f,i.codec=h}if(c.audio){var p=c.audio,v=p.id,g=p.timescale,m=p.codec;o.id=v,o.timescale=g,o.codec=m}u.id=a.RemuxerTrackIdConfig.text,i.sampleDuration=0,i.duration=o.duration=r}},t.resetContiguity=function(){},e.probe=function(e){return e=e.length>16384?e.subarray(0,16384):e,(0,a.findBox)(e,["moof"]).length>0},t.demux=function(e,t){this.timeOffset=t;var n=e,r=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=(0,a.appendUint8Array)(this.remainderData,e));var s=(0,a.segmentValidRange)(n);this.remainderData=s.remainder,r.samples=s.valid||new Uint8Array}else r.samples=n;var o=this.extractID3Track(r,t);return i.samples=(0,a.parseSamples)(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}},t.flush=function(){var e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;var r=this.extractID3Track(t,this.timeOffset);return n.samples=(0,a.parseSamples)(e,t),{videoTrack:t,audioTrack:(0,s.dummyTrack)(),id3Track:r,textTrack:(0,s.dummyTrack)()}},t.extractID3Track=function(e,t){var n=this.id3Track;if(e.samples.length){var s=(0,a.findBox)(e.samples,["emsg"]);s&&s.forEach((function(e){var s=(0,a.parseEmsg)(e);if(o.test(s.schemeIdUri)){var u=(0,r.isFiniteNumber)(s.presentationTime)?s.presentationTime/s.timeScale:t+s.presentationTimeDelta/s.timeScale,c=4294967295===s.eventDuration?Number.POSITIVE_INFINITY:s.eventDuration/s.timeScale;c<=.001&&(c=Number.POSITIVE_INFINITY);var l=s.payload;n.samples.push({data:l,len:l.byteLength,dts:u,pts:u,type:i.MetadataSchema.emsg,duration:c})}}))}return n},t.demuxSampleAes=function(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},t.destroy=function(){},e}()},"./src/demux/mpegaudio.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{appendFrame:function(){return u},canParse:function(){return f},isHeader:function(){return d},isHeaderPattern:function(){return l},parseHeader:function(){return c},probe:function(){return h}});var r=null,i=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],a=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],s=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],o=[0,1,1,4];function u(e,t,n,r,i){if(!(n+24>t.length)){var a=c(t,n);if(a&&n+a.frameLength<=t.length){var s=r+i*(9e4*a.samplesPerFrame/a.sampleRate),o={unit:t.subarray(n,n+a.frameLength),pts:s,dts:s};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(o),{sample:o,length:a.frameLength,missing:0}}}}function c(e,t){var n=e[t+1]>>3&3,u=e[t+1]>>1&3,c=e[t+2]>>4&15,l=e[t+2]>>2&3;if(1!==n&&0!==c&&15!==c&&3!==l){var d=e[t+2]>>1&1,f=e[t+3]>>6,h=1e3*i[14*(3===n?3-u:3===u?3:4)+c-1],p=a[3*(3===n?0:2===n?1:2)+l],v=3===f?1:2,g=s[n][u],m=o[u],y=8*g*m,b=Math.floor(g*h/p+d)*m;if(null===r){var k=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);r=k?parseInt(k[1]):0}return!!r&&r<=87&&2===u&&h>=224e3&&0===f&&(e[t+3]=128|e[t+3]),{sampleRate:p,channelCount:v,frameLength:b,samplesPerFrame:y}}}function l(e,t){return 255===e[t]&&224===(224&e[t+1])&&0!==(6&e[t+1])}function d(e,t){return t+1<e.length&&l(e,t)}function f(e,t){return l(e,t)&&4<=e.length-t}function h(e,t){if(t+1<e.length&&l(e,t)){var n=c(e,t),r=4;null!==n&&void 0!==n&&n.frameLength&&(r=n.frameLength);var i=t+r;return i===e.length||d(e,i)}return!1}},"./src/demux/sample-aes.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return a}});var r=n("./src/crypt/decrypter.ts"),i=n("./src/utils/mp4-tools.ts"),a=function(){function e(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new r.default(t,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptBuffer=function(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)},t.decryptAacSample=function(e,t,n){var r=this,i=e[t].unit;if(!(i.length<=16)){var a=i.subarray(16,i.length-i.length%16),s=a.buffer.slice(a.byteOffset,a.byteOffset+a.length);this.decryptBuffer(s).then((function(a){var s=new Uint8Array(a);i.set(s,16),r.decrypter.isSync()||r.decryptAacSamples(e,t+1,n)}))}},t.decryptAacSamples=function(e,t,n){for(;;t++){if(t>=e.length)return void n();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}},t.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,n=new Int8Array(t),r=0,i=32;i<e.length-16;i+=160,r+=16)n.set(e.subarray(i,i+16),r);return n},t.getAvcDecryptedUnit=function(e,t){for(var n=new Uint8Array(t),r=0,i=32;i<e.length-16;i+=160,r+=16)e.set(n.subarray(r,r+16),i);return e},t.decryptAvcSample=function(e,t,n,r,a){var s=this,o=(0,i.discardEPB)(a.data),u=this.getAvcEncryptedData(o);this.decryptBuffer(u.buffer).then((function(i){a.data=s.getAvcDecryptedUnit(o,i),s.decrypter.isSync()||s.decryptAvcSamples(e,t,n+1,r)}))},t.decryptAvcSamples=function(e,t,n,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length)return void r();for(var i=e[t].units;!(n>=i.length);n++){var a=i[n];if(!(a.data.length<=48||1!==a.type&&5!==a.type)&&(this.decryptAvcSample(e,t,n,r,a),!this.decrypter.isSync()))return}}},e}()},"./src/demux/transmuxer-interface.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var r=n("./src/demux/webworkify-webpack.js"),i=n("./src/events.ts"),a=n("./src/demux/transmuxer.ts"),s=n("./src/utils/logger.ts"),o=n("./src/errors.ts"),u=n("./src/utils/mediasource-helper.ts"),c=n("./node_modules/eventemitter3/index.js"),l=(0,u.getMediaSource)()||{isTypeSupported:function(){return!1}},d=function(){function e(e,t,n,u){var d=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var f=e.config;this.hls=e,this.id=t,this.useWorker=!!f.enableWorker,this.onTransmuxComplete=n,this.onFlush=u;var h=function(e,t){(t=t||{}).frag=d.frag,t.id=d.id,d.hls.trigger(e,t)};this.observer=new c.EventEmitter,this.observer.on(i.Events.FRAG_DECRYPTED,h),this.observer.on(i.Events.ERROR,h);var p={mp4:l.isTypeSupported("video/mp4"),mpeg:l.isTypeSupported("audio/mpeg"),mp3:l.isTypeSupported('audio/mp4; codecs="mp3"')},v=navigator.vendor;if(this.useWorker&&"undefined"!==typeof Worker){var g;s.logger.log("demuxing in webworker");try{g=this.worker=(0,r.default)("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),g.addEventListener("message",this.onwmsg),g.onerror=function(e){d.useWorker=!1,s.logger.warn("Exception in webworker, fallback to inline"),d.hls.trigger(i.Events.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(e.message+"  ("+e.filename+":"+e.lineno+")")})},g.postMessage({cmd:"init",typeSupported:p,vendor:v,id:t,config:JSON.stringify(f)})}catch(m){s.logger.warn("Error in worker:",m),s.logger.error("Error while initializing DemuxerWorker, fallback to inline"),g&&self.URL.revokeObjectURL(g.objectURL),this.transmuxer=new a.default(this.observer,p,f,v,t),this.worker=null}}else this.transmuxer=new a.default(this.observer,p,f,v,t)}var t=e.prototype;return t.destroy=function(){var e=this.worker;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.worker=null,this.onwmsg=void 0;else{var t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}var n=this.observer;n&&n.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},t.push=function(e,t,n,r,i,o,u,c,l,d){var f,h,p=this;l.transmuxing.start=self.performance.now();var v=this.transmuxer,g=this.worker,m=o?o.start:i.start,y=i.decryptdata,b=this.frag,k=!(b&&i.cc===b.cc),T=!(b&&l.level===b.level),E=b?l.sn-b.sn:-1,S=this.part?l.part-this.part.index:-1,w=0===E&&l.id>1&&l.id===(null===b||void 0===b?void 0:b.stats.chunkCount),x=!T&&(1===E||0===E&&(1===S||w&&S<=0)),R=self.performance.now();(T||E||0===i.stats.parsing.start)&&(i.stats.parsing.start=R),!o||!S&&x||(o.stats.parsing.start=R);var C=!(b&&(null===(f=i.initSegment)||void 0===f?void 0:f.url)===(null===(h=b.initSegment)||void 0===h?void 0:h.url)),A=new a.TransmuxState(k,x,c,T,m,C);if(!x||k||C){s.logger.log("[transmuxer-interface, "+i.type+"]: Starting new transmux session for sn: "+l.sn+" p: "+l.part+" level: "+l.level+" id: "+l.id+"\n        discontinuity: "+k+"\n        trackSwitch: "+T+"\n        contiguous: "+x+"\n        accurateTimeOffset: "+c+"\n        timeOffset: "+m+"\n        initSegmentChange: "+C);var I=new a.TransmuxConfig(n,r,t,u,d);this.configureTransmuxer(I)}if(this.frag=i,this.part=o,g)g.postMessage({cmd:"demux",data:e,decryptdata:y,chunkMeta:l,state:A},e instanceof ArrayBuffer?[e]:[]);else if(v){var P=v.push(e,y,l,A);(0,a.isPromise)(P)?(v.async=!0,P.then((function(e){p.handleTransmuxComplete(e)})).catch((function(e){p.transmuxerError(e,l,"transmuxer-interface push error")}))):(v.async=!1,this.handleTransmuxComplete(P))}},t.flush=function(e){var t=this;e.transmuxing.start=self.performance.now();var n=this.transmuxer,r=this.worker;if(r)r.postMessage({cmd:"flush",chunkMeta:e});else if(n){var i=n.flush(e);(0,a.isPromise)(i)||n.async?((0,a.isPromise)(i)||(i=Promise.resolve(i)),i.then((function(n){t.handleFlushResult(n,e)})).catch((function(n){t.transmuxerError(n,e,"transmuxer-interface flush error")}))):this.handleFlushResult(i,e)}},t.transmuxerError=function(e,t,n){this.hls&&this.hls.trigger(i.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:n})},t.handleFlushResult=function(e,t){var n=this;e.forEach((function(e){n.handleTransmuxComplete(e)})),this.onFlush(t)},t.onWorkerMessage=function(e){var t=e.data,n=this.hls;switch(t.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":s.logger[t.data.logType]&&s.logger[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,n.trigger(t.event,t.data)}},t.configureTransmuxer=function(e){var t=this.worker,n=this.transmuxer;t?t.postMessage({cmd:"configure",config:e}):n&&n.configure(e)},t.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},e}()},"./src/demux/transmuxer-worker.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return u}});var r=n("./src/demux/transmuxer.ts"),i=n("./src/events.ts"),a=n("./src/utils/logger.ts"),s=n("./node_modules/eventemitter3/index.js"),o=n("./src/errors.ts");function u(e){var t=new s.EventEmitter,n=function(t,n){e.postMessage({event:t,data:n})};t.on(i.Events.FRAG_DECRYPTED,n),t.on(i.Events.ERROR,n),e.addEventListener("message",(function(s){var u=s.data;switch(u.cmd){case"init":var l=JSON.parse(u.config);e.transmuxer=new r.default(t,u.typeSupported,l,u.vendor,u.id),(0,a.enableLogs)(l.debug,u.id),function(){var e=function(e){a.logger[e]=function(t){n("workerLog",{logType:e,message:t})}};for(var t in a.logger)e(t)}(),n("init",null);break;case"configure":e.transmuxer.configure(u.config);break;case"demux":var f=e.transmuxer.push(u.data,u.decryptdata,u.chunkMeta,u.state);(0,r.isPromise)(f)?(e.transmuxer.async=!0,f.then((function(t){c(e,t)})).catch((function(e){n(i.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:u.chunkMeta,fatal:!1,error:e,err:e,reason:"transmuxer-worker push error"})}))):(e.transmuxer.async=!1,c(e,f));break;case"flush":var h=u.chunkMeta,p=e.transmuxer.flush(h);(0,r.isPromise)(p)||e.transmuxer.async?((0,r.isPromise)(p)||(p=Promise.resolve(p)),p.then((function(t){d(e,t,h)})).catch((function(e){n(i.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:u.chunkMeta,fatal:!1,error:e,err:e,reason:"transmuxer-worker flush error"})}))):d(e,p,h)}}))}function c(e,t){if(!(n=t.remuxResult).audio&&!n.video&&!n.text&&!n.id3&&!n.initSegment)return!1;var n,r=[],i=t.remuxResult,a=i.audio,s=i.video;return a&&l(r,a),s&&l(r,s),e.postMessage({event:"transmuxComplete",data:t},r),!0}function l(e,t){t.data1&&e.push(t.data1.buffer),t.data2&&e.push(t.data2.buffer)}function d(e,t,n){t.reduce((function(t,n){return c(e,n)||t}),!1)||e.postMessage({event:"transmuxComplete",data:t[0]}),e.postMessage({event:"flush",data:n})}},"./src/demux/transmuxer.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{TransmuxConfig:function(){return y},TransmuxState:function(){return b},default:function(){return v},isPromise:function(){return m}});var r,i=n("./src/events.ts"),a=n("./src/errors.ts"),s=n("./src/crypt/decrypter.ts"),o=n("./src/demux/aacdemuxer.ts"),u=n("./src/demux/mp4demuxer.ts"),c=n("./src/demux/tsdemuxer.ts"),l=n("./src/demux/mp3demuxer.ts"),d=n("./src/remux/mp4-remuxer.ts"),f=n("./src/remux/passthrough-remuxer.ts"),h=n("./src/utils/logger.ts");try{r=self.performance.now.bind(self.performance)}catch(k){h.logger.debug("Unable to use Performance API on this environment"),r=self.Date.now}var p=[{demux:u.default,remux:f.default},{demux:c.default,remux:d.default},{demux:o.default,remux:d.default},{demux:l.default,remux:d.default}],v=function(){function e(e,t,n,r,i){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.vendor=r,this.id=i}var t=e.prototype;return t.configure=function(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()},t.push=function(e,t,n,i){var a=this,s=n.transmuxing;s.executeStart=r();var o=new Uint8Array(e),u=this.currentTransmuxState,c=this.transmuxConfig;i&&(this.currentTransmuxState=i);var l=i||u,d=l.contiguous,f=l.discontinuity,h=l.trackSwitch,p=l.accurateTimeOffset,v=l.timeOffset,m=l.initSegmentChange,y=c.audioCodec,b=c.videoCodec,k=c.defaultInitPts,T=c.duration,E=c.initSegmentData,S=function(e,t){var n=null;return e.byteLength>0&&null!=t&&null!=t.key&&null!==t.iv&&null!=t.method&&(n=t),n}(o,t);if(S&&"AES-128"===S.method){var w=this.getDecrypter();if(!w.isSync())return this.decryptionPromise=w.webCryptoDecrypt(o,S.key.buffer,S.iv.buffer).then((function(e){var t=a.push(e,null,n);return a.decryptionPromise=null,t})),this.decryptionPromise;var x=w.softwareDecrypt(o,S.key.buffer,S.iv.buffer);if(n.part>-1&&(x=w.flush()),!x)return s.executeEnd=r(),g(n);o=new Uint8Array(x)}var R=this.needsProbing(f,h);R&&this.configureTransmuxer(o),(f||h||m||R)&&this.resetInitSegment(E,y,b,T,t),(f||m||R)&&this.resetInitialTimestamp(k),d||this.resetContiguity();var C=this.transmux(o,S,v,p,n),A=this.currentTransmuxState;return A.contiguous=!0,A.discontinuity=!1,A.trackSwitch=!1,s.executeEnd=r(),C},t.flush=function(e){var t=this,n=e.transmuxing;n.executeStart=r();var s=this.decrypter,o=this.currentTransmuxState,u=this.decryptionPromise;if(u)return u.then((function(){return t.flush(e)}));var c=[],l=o.timeOffset;if(s){var d=s.flush();d&&c.push(this.push(d,null,e))}var f=this.demuxer,h=this.remuxer;if(!f||!h)return this.observer.emit(i.Events.ERROR,i.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),n.executeEnd=r(),[g(e)];var p=f.flush(l);return m(p)?p.then((function(n){return t.flushRemux(c,n,e),c})):(this.flushRemux(c,p,e),c)},t.flushRemux=function(e,t,n){var i=t.audioTrack,a=t.videoTrack,s=t.id3Track,o=t.textTrack,u=this.currentTransmuxState,c=u.accurateTimeOffset,l=u.timeOffset;h.logger.log("[transmuxer.ts]: Flushed fragment "+n.sn+(n.part>-1?" p: "+n.part:"")+" of level "+n.level);var d=this.remuxer.remux(i,a,s,o,l,c,!0,this.id);e.push({remuxResult:d,chunkMeta:n}),n.transmuxing.executeEnd=r()},t.resetInitialTimestamp=function(e){var t=this.demuxer,n=this.remuxer;t&&n&&(t.resetTimeStamp(e),n.resetTimeStamp(e))},t.resetContiguity=function(){var e=this.demuxer,t=this.remuxer;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())},t.resetInitSegment=function(e,t,n,r,i){var a=this.demuxer,s=this.remuxer;a&&s&&(a.resetInitSegment(e,t,n,r),s.resetInitSegment(e,t,n,i))},t.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},t.transmux=function(e,t,n,r,i){return t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,n,r,i):this.transmuxUnencrypted(e,n,r,i)},t.transmuxUnencrypted=function(e,t,n,r){var i=this.demuxer.demux(e,t,!1,!this.config.progressive),a=i.audioTrack,s=i.videoTrack,o=i.id3Track,u=i.textTrack;return{remuxResult:this.remuxer.remux(a,s,o,u,t,n,!1,this.id),chunkMeta:r}},t.transmuxSampleAes=function(e,t,n,r,i){var a=this;return this.demuxer.demuxSampleAes(e,t,n).then((function(e){return{remuxResult:a.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,n,r,!1,a.id),chunkMeta:i}}))},t.configureTransmuxer=function(e){for(var t,n=this.config,r=this.observer,i=this.typeSupported,a=this.vendor,s=0,o=p.length;s<o;s++)if(p[s].demux.probe(e)){t=p[s];break}t||(h.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),t={demux:u.default,remux:f.default});var c=this.demuxer,l=this.remuxer,d=t.remux,v=t.demux;l&&l instanceof d||(this.remuxer=new d(r,n,i,a)),c&&c instanceof v||(this.demuxer=new v(r,n,i),this.probe=v.probe)},t.needsProbing=function(e,t){return!this.demuxer||!this.remuxer||e||t},t.getDecrypter=function(){var e=this.decrypter;return e||(e=this.decrypter=new s.default(this.config)),e},e}(),g=function(e){return{remuxResult:{},chunkMeta:e}};function m(e){return"then"in e&&e.then instanceof Function}var y=function(e,t,n,r,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=r,this.defaultInitPts=i},b=function(e,t,n,r,i,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=r,this.timeOffset=i,this.initSegmentChange=a}},"./src/demux/tsdemuxer.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return k}});var r=n("./src/demux/adts.ts"),i=n("./src/demux/mpegaudio.ts"),a=n("./src/demux/exp-golomb.ts"),s=n("./src/demux/sample-aes.ts"),o=n("./src/events.ts"),u=n("./src/utils/mp4-tools.ts"),c=n("./src/utils/logger.ts"),l=n("./src/errors.ts"),d=n("./src/types/demuxer.ts");function f(){return f=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},f.apply(this,arguments)}var h=188;function p(e,t,n,r){return{key:e,frame:!1,pts:t,dts:n,units:[],debug:r,length:0}}function v(e,t){return((31&e[t+1])<<8)+e[t+2]}function g(e,t){return(31&e[t+10])<<8|e[t+11]}function m(e,t,n,r){var i={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},a=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<a;){var s=v(e,t);switch(e[t]){case 207:if(!r){c.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===i.audio&&(i.audio=s);break;case 21:-1===i.id3&&(i.id3=s);break;case 219:if(!r){c.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===i.avc&&(i.avc=s);break;case 3:case 4:!0!==n.mpeg&&!0!==n.mp3?c.logger.log("MPEG audio found, not supported in this browser"):-1===i.audio&&(i.audio=s,i.segmentCodec="mp3");break;case 36:c.logger.warn("Unsupported HEVC stream type found")}t+=5+((15&e[t+3])<<8|e[t+4])}return i}function y(e){var t,n,r,i,a,s=0,o=e.data;if(!e||0===e.size)return null;for(;o[0].length<19&&o.length>1;){var u=new Uint8Array(o[0].length+o[1].length);u.set(o[0]),u.set(o[1],o[0].length),o[0]=u,o.splice(1,1)}if(1===((t=o[0])[0]<<16)+(t[1]<<8)+t[2]){if((n=(t[4]<<8)+t[5])&&n>e.size-6)return null;var l=t[7];192&l&&(i=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&l?i-(a=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2)>54e5&&(c.logger.warn(Math.round((i-a)/9e4)+"s delta between PTS and DTS, align them"),i=a):a=i);var d=(r=t[8])+9;if(e.size<=d)return null;e.size-=d;for(var f=new Uint8Array(e.size),h=0,p=o.length;h<p;h++){var v=(t=o[h]).byteLength;if(d){if(d>v){d-=v;continue}t=t.subarray(d),v-=d,d=0}f.set(t,s),s+=v}return n&&(n-=r+3),{data:f,pts:i,dts:a,len:n}}return null}function b(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){var n=t.samples,r=n.length;if(!r)return void t.dropped++;var i=n[r-1];e.pts=i.pts,e.dts=i.dts}t.samples.push(e)}e.debug.length&&c.logger.log(e.pts+"/"+e.dts+":"+e.debug)}var k=function(){function e(e,t,n){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=n}e.probe=function(t){var n=e.syncOffset(t);return n>0&&c.logger.warn("MPEG2-TS detected but first sync word found @ offset "+n),-1!==n},e.syncOffset=function(e){for(var t=Math.min(940,e.length-h)+1,n=0;n<t;){for(var r=!1,i=0;i<t&&71===e[i];i+=h)if(r||0!==v(e,i)||(r=!0),r&&i+h>t)return n;n++}return-1},e.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:u.RemuxerTrackIdConfig[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}};var t=e.prototype;return t.resetInitSegment=function(t,n,r,i){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video"),this._audioTrack=e.createTrack("audio",i),this._id3Track=e.createTrack("id3"),this._txtTrack=e.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=n,this.videoCodec=r,this._duration=i},t.resetTimeStamp=function(){},t.resetContiguity=function(){var e=this._audioTrack,t=this._avcTrack,n=this._id3Track;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},t.demux=function(t,n,r,i){var a;void 0===r&&(r=!1),void 0===i&&(i=!1),r||(this.sampleAes=null);var s=this._avcTrack,d=this._audioTrack,f=this._id3Track,p=this._txtTrack,b=s.pid,k=s.pesData,T=d.pid,E=f.pid,S=d.pesData,w=f.pesData,x=null,R=this.pmtParsed,C=this._pmtId,A=t.length;if(this.remainderData&&(A=(t=(0,u.appendUint8Array)(this.remainderData,t)).length,this.remainderData=null),A<h&&!i)return this.remainderData=t,{audioTrack:d,videoTrack:s,id3Track:f,textTrack:p};var I=Math.max(0,e.syncOffset(t));(A-=(A-I)%h)<t.byteLength&&!i&&(this.remainderData=new Uint8Array(t.buffer,A,t.buffer.byteLength-A));for(var P=0,_=I;_<A;_+=h)if(71===t[_]){var D=!!(64&t[_+1]),L=v(t,_),O=void 0;if((48&t[_+3])>>4>1){if((O=_+5+t[_+4])===_+h)continue}else O=_+4;switch(L){case b:D&&(k&&(a=y(k))&&this.parseAVCPES(s,p,a,!1),k={data:[],size:0}),k&&(k.data.push(t.subarray(O,_+h)),k.size+=_+h-O);break;case T:if(D){if(S&&(a=y(S)))switch(d.segmentCodec){case"aac":this.parseAACPES(d,a);break;case"mp3":this.parseMPEGPES(d,a)}S={data:[],size:0}}S&&(S.data.push(t.subarray(O,_+h)),S.size+=_+h-O);break;case E:D&&(w&&(a=y(w))&&this.parseID3PES(f,a),w={data:[],size:0}),w&&(w.data.push(t.subarray(O,_+h)),w.size+=_+h-O);break;case 0:D&&(O+=t[O]+1),C=this._pmtId=g(t,O);break;case C:D&&(O+=t[O]+1);var M=m(t,O,this.typeSupported,r);(b=M.avc)>0&&(s.pid=b),(T=M.audio)>0&&(d.pid=T,d.segmentCodec=M.segmentCodec),(E=M.id3)>0&&(f.pid=E),null===x||R||(c.logger.log("unknown PID '"+x+"' in TS found"),x=null,_=I-188),R=this.pmtParsed=!0;break;case 17:case 8191:break;default:x=L}}else P++;P>0&&this.observer.emit(o.Events.ERROR,o.Events.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+P+" TS packet/s that do not start with 0x47"}),s.pesData=k,d.pesData=S,f.pesData=w;var N={audioTrack:d,videoTrack:s,id3Track:f,textTrack:p};return i&&this.extractRemainingSamples(N),N},t.flush=function(){var e,t=this.remainderData;return this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e},t.extractRemainingSamples=function(e){var t,n=e.audioTrack,r=e.videoTrack,i=e.id3Track,a=e.textTrack,s=r.pesData,o=n.pesData,u=i.pesData;if(s&&(t=y(s))?(this.parseAVCPES(r,a,t,!0),r.pesData=null):r.pesData=s,o&&(t=y(o))){switch(n.segmentCodec){case"aac":this.parseAACPES(n,t);break;case"mp3":this.parseMPEGPES(n,t)}n.pesData=null}else null!==o&&void 0!==o&&o.size&&c.logger.log("last AAC PES packet truncated,might overlap between fragments"),n.pesData=o;u&&(t=y(u))?(this.parseID3PES(i,t),i.pesData=null):i.pesData=u},t.demuxSampleAes=function(e,t,n){var r=this.demux(e,n,!0,!this.config.progressive),i=this.sampleAes=new s.default(this.observer,this.config,t);return this.decrypt(r,i)},t.decrypt=function(e,t){return new Promise((function(n){var r=e.audioTrack,i=e.videoTrack;r.samples&&"aac"===r.segmentCodec?t.decryptAacSamples(r.samples,0,(function(){i.samples?t.decryptAvcSamples(i.samples,0,0,(function(){n(e)})):n(e)})):i.samples&&t.decryptAvcSamples(i.samples,0,0,(function(){n(e)}))}))},t.destroy=function(){this._duration=0},t.parseAVCPES=function(e,t,n,r){var i,s=this,o=this.parseAVCNALu(e,n.data),c=this.avcSample,l=!1;n.data=null,c&&o.length&&!e.audFound&&(b(c,e),c=this.avcSample=p(!1,n.pts,n.dts,"")),o.forEach((function(r){switch(r.type){case 1:i=!0,c||(c=s.avcSample=p(!0,n.pts,n.dts,"")),c.frame=!0;var o=r.data;if(l&&o.length>4){var d=new a.default(o).readSliceType();2!==d&&4!==d&&7!==d&&9!==d||(c.key=!0)}break;case 5:i=!0,c||(c=s.avcSample=p(!0,n.pts,n.dts,"")),c.key=!0,c.frame=!0;break;case 6:i=!0,(0,u.parseSEIMessageFromNALu)(r.data,1,n.pts,t.samples);break;case 7:if(i=!0,l=!0,!e.sps){var f=new a.default(r.data).readSPS();e.width=f.width,e.height=f.height,e.pixelRatio=f.pixelRatio,e.sps=[r.data],e.duration=s._duration;for(var h=r.data.subarray(1,4),v="avc1.",g=0;g<3;g++){var m=h[g].toString(16);m.length<2&&(m="0"+m),v+=m}e.codec=v}break;case 8:i=!0,e.pps||(e.pps=[r.data]);break;case 9:i=!1,e.audFound=!0,c&&b(c,e),c=s.avcSample=p(!1,n.pts,n.dts,"");break;case 12:i=!0;break;default:i=!1,c&&(c.debug+="unknown NAL "+r.type+" ")}c&&i&&c.units.push(r)})),r&&c&&(b(c,e),this.avcSample=null)},t.getLastNalUnit=function(e){var t,n,r=this.avcSample;if(r&&0!==r.units.length||(r=e[e.length-1]),null!==(t=r)&&void 0!==t&&t.units){var i=r.units;n=i[i.length-1]}return n},t.parseAVCNALu=function(e,t){var n,r,i=t.byteLength,a=e.naluState||0,s=a,o=[],u=0,c=-1,l=0;for(-1===a&&(c=0,l=31&t[0],a=0,u=1);u<i;)if(n=t[u++],a)if(1!==a)if(n)if(1===n){if(c>=0){var d={data:t.subarray(c,u-a-1),type:l};o.push(d)}else{var f=this.getLastNalUnit(e.samples);if(f&&(s&&u<=4-s&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-s)),(r=u-a-1)>0)){var h=new Uint8Array(f.data.byteLength+r);h.set(f.data,0),h.set(t.subarray(0,r),f.data.byteLength),f.data=h,f.state=0}}u<i?(c=u,l=31&t[u],a=0):a=-1}else a=0;else a=3;else a=n?0:2;else a=n?0:1;if(c>=0&&a>=0){var p={data:t.subarray(c,i),type:l,state:a};o.push(p)}if(0===o.length){var v=this.getLastNalUnit(e.samples);if(v){var g=new Uint8Array(v.data.byteLength+t.byteLength);g.set(v.data,0),g.set(t,v.data.byteLength),v.data=g}}return e.naluState=a,o},t.parseAACPES=function(e,t){var n,i,a,s,u,d=0,f=this.aacOverFlow,h=t.data;if(f){this.aacOverFlow=null;var p=f.missing,v=f.sample.unit.byteLength;if(-1===p){var g=new Uint8Array(v+h.byteLength);g.set(f.sample.unit,0),g.set(h,v),h=g}else{var m=v-p;f.sample.unit.set(h.subarray(0,p),m),e.samples.push(f.sample),d=f.missing}}for(n=d,i=h.length;n<i-1&&!r.isHeader(h,n);n++);if(n===d||(n<i-1?(a="AAC PES did not start with ADTS header,offset:"+n,s=!1):(a="no ADTS header found in AAC PES",s=!0),c.logger.warn("parsing error:"+a),this.observer.emit(o.Events.ERROR,o.Events.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.FRAG_PARSING_ERROR,fatal:s,reason:a}),!s)){if(r.initTrackConfig(e,this.observer,h,n,this.audioCodec),void 0!==t.pts)u=t.pts;else{if(!f)return void c.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var y=r.getFrameDuration(e.samplerate);u=f.sample.pts+y}for(var b,k=0;n<i;){if(n+=(b=r.appendFrame(e,h,n,u,k)).length,b.missing){this.aacOverFlow=b;break}for(k++;n<i-1&&!r.isHeader(h,n);n++);}}},t.parseMPEGPES=function(e,t){var n=t.data,r=n.length,a=0,s=0,o=t.pts;if(void 0!==o)for(;s<r;)if(i.isHeader(n,s)){var u=i.appendFrame(e,n,s,o,a);if(!u)break;s+=u.length,a++}else s++;else c.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},t.parseID3PES=function(e,t){if(void 0!==t.pts){var n=f({},t,{type:this._avcTrack?d.MetadataSchema.emsg:d.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}else c.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},e}()},"./src/demux/webworkify-webpack.js":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});var r=function(){var e=ENTRY_MODULE,t={},n=function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports};n.m=e,n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r=n(ENTRY_MODULE);return r.default||r}.toString().split("ENTRY_MODULE"),i="[\\.|\\-|\\+|\\w|/|@]+",a="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function s(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(e,t,r){var o={};o[r]=[];var u=t.toString().replace(/^"[^"]+"/,"function"),c=u.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||u.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!c)return o;for(var l,d=c[1],f=new RegExp("(\\\\n|\\W)"+s(d)+a,"g");l=f.exec(u);)"dll-reference"!==l[3]&&o[r].push(l[3]);for(f=new RegExp("\\("+s(d)+'\\("(dll-reference\\s('+i+'))"\\)\\)'+a,"g");l=f.exec(u);)e[l[2]]||(o[r].push(l[1]),e[l[2]]=n(l[1]).m),o[l[2]]=o[l[2]]||[],o[l[2]].push(l[4]);for(var h,p=Object.keys(o),v=0;v<p.length;v++)for(var g=0;g<o[p[v]].length;g++)h=o[p[v]][g],isNaN(1*h)||(o[p[v]][g]=1*o[p[v]][g]);return o}function u(e){return Object.keys(e).reduce((function(t,n){return t||e[n].length>0}),!1)}function c(e,t,n,i){var a=e[i].map((function(e){return'"'+e+'": '+t[i][e].toString().replace(/^"[^"]+"/,"function")})).join(",");return r[0]+"{"+a+"}"+r[1]+'"'+n+'"'+r[2]}function l(e,t){t=t||{};var r={main:n.m},i=t.all?{main:Object.keys(r.main)}:function(e,t){for(var n={main:[t]},r={main:[]},i={main:{}};u(n);)for(var a=Object.keys(n),s=0;s<a.length;s++){var c=a[s],l=n[c].pop();if(i[c]=i[c]||{},!i[c][l]&&e[c][l]){i[c][l]=!0,r[c]=r[c]||[],r[c].push(l);for(var d=o(e,e[c][l],c),f=Object.keys(d),h=0;h<f.length;h++)n[f[h]]=n[f[h]]||[],n[f[h]]=n[f[h]].concat(d[f[h]])}}return r}(r,e),a="";Object.keys(i).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;i[e][t];)t++;i[e].push(t),r[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",a=a+"var "+e+" = ("+c(i,r,t,modules)+")();\n"})),a=a+"new (("+c(i,r,e,"main")+")())(self);";var s=new window.Blob([a],{type:"text/javascript"}),l=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(s),d=new window.Worker(l);return d.objectURL=l,d}},"./src/errors.ts":function(e,t,n){"use strict";var r,i,a,s;n.r(t),n.d(t,{ErrorDetails:function(){return a},ErrorTypes:function(){return r}}),(i=r||(r={})).NETWORK_ERROR="networkError",i.MEDIA_ERROR="mediaError",i.KEY_SYSTEM_ERROR="keySystemError",i.MUX_ERROR="muxError",i.OTHER_ERROR="otherError",(s=a||(a={})).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",s.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",s.KEY_SYSTEM_NO_SESSION="keySystemNoSession",s.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",s.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",s.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",s.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",s.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",s.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",s.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",s.MANIFEST_LOAD_ERROR="manifestLoadError",s.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",s.MANIFEST_PARSING_ERROR="manifestParsingError",s.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",s.LEVEL_EMPTY_ERROR="levelEmptyError",s.LEVEL_LOAD_ERROR="levelLoadError",s.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",s.LEVEL_SWITCH_ERROR="levelSwitchError",s.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",s.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",s.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",s.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",s.FRAG_LOAD_ERROR="fragLoadError",s.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",s.FRAG_DECRYPT_ERROR="fragDecryptError",s.FRAG_PARSING_ERROR="fragParsingError",s.REMUX_ALLOC_ERROR="remuxAllocError",s.KEY_LOAD_ERROR="keyLoadError",s.KEY_LOAD_TIMEOUT="keyLoadTimeOut",s.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",s.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",s.BUFFER_APPEND_ERROR="bufferAppendError",s.BUFFER_APPENDING_ERROR="bufferAppendingError",s.BUFFER_STALLED_ERROR="bufferStalledError",s.BUFFER_FULL_ERROR="bufferFullError",s.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",s.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",s.INTERNAL_EXCEPTION="internalException",s.INTERNAL_ABORTED="aborted",s.UNKNOWN="unknown"},"./src/events.ts":function(e,t,n){"use strict";var r,i;n.r(t),n.d(t,{Events:function(){return r}}),(i=r||(r={})).MEDIA_ATTACHING="hlsMediaAttaching",i.MEDIA_ATTACHED="hlsMediaAttached",i.MEDIA_DETACHING="hlsMediaDetaching",i.MEDIA_DETACHED="hlsMediaDetached",i.BUFFER_RESET="hlsBufferReset",i.BUFFER_CODECS="hlsBufferCodecs",i.BUFFER_CREATED="hlsBufferCreated",i.BUFFER_APPENDING="hlsBufferAppending",i.BUFFER_APPENDED="hlsBufferAppended",i.BUFFER_EOS="hlsBufferEos",i.BUFFER_FLUSHING="hlsBufferFlushing",i.BUFFER_FLUSHED="hlsBufferFlushed",i.MANIFEST_LOADING="hlsManifestLoading",i.MANIFEST_LOADED="hlsManifestLoaded",i.MANIFEST_PARSED="hlsManifestParsed",i.LEVEL_SWITCHING="hlsLevelSwitching",i.LEVEL_SWITCHED="hlsLevelSwitched",i.LEVEL_LOADING="hlsLevelLoading",i.LEVEL_LOADED="hlsLevelLoaded",i.LEVEL_UPDATED="hlsLevelUpdated",i.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",i.LEVELS_UPDATED="hlsLevelsUpdated",i.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",i.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",i.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",i.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",i.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",i.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",i.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",i.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",i.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",i.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",i.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",i.CUES_PARSED="hlsCuesParsed",i.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",i.INIT_PTS_FOUND="hlsInitPtsFound",i.FRAG_LOADING="hlsFragLoading",i.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",i.FRAG_LOADED="hlsFragLoaded",i.FRAG_DECRYPTED="hlsFragDecrypted",i.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",i.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",i.FRAG_PARSING_METADATA="hlsFragParsingMetadata",i.FRAG_PARSED="hlsFragParsed",i.FRAG_BUFFERED="hlsFragBuffered",i.FRAG_CHANGED="hlsFragChanged",i.FPS_DROP="hlsFpsDrop",i.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",i.ERROR="hlsError",i.DESTROYING="hlsDestroying",i.KEY_LOADING="hlsKeyLoading",i.KEY_LOADED="hlsKeyLoaded",i.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",i.BACK_BUFFER_REACHED="hlsBackBufferReached"},"./src/hls.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return k}});var r=n("./node_modules/url-toolkit/src/url-toolkit.js"),i=n("./src/loader/playlist-loader.ts"),a=n("./src/controller/id3-track-controller.ts"),s=n("./src/controller/latency-controller.ts"),o=n("./src/controller/level-controller.ts"),u=n("./src/controller/fragment-tracker.ts"),c=n("./src/loader/key-loader.ts"),l=n("./src/controller/stream-controller.ts"),d=n("./src/is-supported.ts"),f=n("./src/utils/logger.ts"),h=n("./src/config.ts"),p=n("./node_modules/eventemitter3/index.js"),v=n("./src/events.ts"),g=n("./src/errors.ts"),m=n("./src/types/level.ts");function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,b(r.key),r)}}function b(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}var k=function(){function e(t){void 0===t&&(t={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new p.EventEmitter,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var n=this.config=(0,h.mergeConfig)(e.DefaultConfig,t);this.userConfig=t,(0,f.enableLogs)(n.debug,"Hls instance"),this._autoLevelCapping=-1,n.progressive&&(0,h.enableStreamingMode)(n);var r=n.abrController,d=n.bufferController,v=n.capLevelController,g=n.fpsController,m=this.abrController=new r(this),y=this.bufferController=new d(this),b=this.capLevelController=new v(this),k=new g(this),T=new i.default(this),E=new a.default(this),S=this.levelController=new o.default(this),w=new u.FragmentTracker(this),x=new c.default(this.config),R=this.streamController=new l.default(this,w,x);b.setStreamController(R),k.setStreamController(R);var C=[T,S,R];this.networkControllers=C;var A=[m,y,b,k,E,w];this.audioTrackController=this.createController(n.audioTrackController,C);var I=n.audioStreamController;I&&C.push(new I(this,w,x)),this.subtitleTrackController=this.createController(n.subtitleTrackController,C);var P=n.subtitleStreamController;P&&C.push(new P(this,w,x)),this.createController(n.timelineController,A),x.emeController=this.emeController=this.createController(n.emeController,A),this.cmcdController=this.createController(n.cmcdController,A),this.latencyController=this.createController(s.default,A),this.coreComponents=A}e.isSupported=function(){return(0,d.isSupported)()};var t,n,b,k=e.prototype;return k.createController=function(e,t){if(e){var n=new e(this);return t&&t.push(n),n}return null},k.on=function(e,t,n){void 0===n&&(n=this),this._emitter.on(e,t,n)},k.once=function(e,t,n){void 0===n&&(n=this),this._emitter.once(e,t,n)},k.removeAllListeners=function(e){this._emitter.removeAllListeners(e)},k.off=function(e,t,n,r){void 0===n&&(n=this),this._emitter.off(e,t,n,r)},k.listeners=function(e){return this._emitter.listeners(e)},k.emit=function(e,t,n){return this._emitter.emit(e,t,n)},k.trigger=function(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){f.logger.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),this.trigger(v.Events.ERROR,{type:g.ErrorTypes.OTHER_ERROR,details:g.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,error:n})}return!1},k.listenerCount=function(e){return this._emitter.listenerCount(e)},k.destroy=function(){f.logger.log("destroy"),this.trigger(v.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((function(e){return e.destroy()})),this.networkControllers.length=0,this.coreComponents.forEach((function(e){return e.destroy()})),this.coreComponents.length=0},k.attachMedia=function(e){f.logger.log("attachMedia"),this._media=e,this.trigger(v.Events.MEDIA_ATTACHING,{media:e})},k.detachMedia=function(){f.logger.log("detachMedia"),this.trigger(v.Events.MEDIA_DETACHING,void 0),this._media=null},k.loadSource=function(e){this.stopLoad();var t=this.media,n=this.url,i=this.url=r.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});f.logger.log("loadSource:"+i),t&&n&&n!==i&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(t)),this.trigger(v.Events.MANIFEST_LOADING,{url:e})},k.startLoad=function(e){void 0===e&&(e=-1),f.logger.log("startLoad("+e+")"),this.networkControllers.forEach((function(t){t.startLoad(e)}))},k.stopLoad=function(){f.logger.log("stopLoad"),this.networkControllers.forEach((function(e){e.stopLoad()}))},k.swapAudioCodec=function(){f.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},k.recoverMediaError=function(){f.logger.log("recoverMediaError");var e=this._media;this.detachMedia(),e&&this.attachMedia(e)},k.removeLevel=function(e,t){void 0===t&&(t=0),this.levelController.removeLevel(e,t)},t=e,b=[{key:"version",get:function(){return"1.3.3"}},{key:"Events",get:function(){return v.Events}},{key:"ErrorTypes",get:function(){return g.ErrorTypes}},{key:"ErrorDetails",get:function(){return g.ErrorDetails}},{key:"DefaultConfig",get:function(){return e.defaultConfig?e.defaultConfig:h.hlsDefaultConfig},set:function(t){e.defaultConfig=t}}],(n=[{key:"levels",get:function(){var e=this.levelController.levels;return e||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){f.logger.log("set currentLevel:"+e),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){f.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){f.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){f.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){f.logger.log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping!==e&&(f.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e)}},{key:"bandwidthEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimate():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(e){m.HdcpLevels.indexOf(e)>-1&&(this._maxHdcpLevel=e)}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var e=this.levels,t=this.config.minAutoBitrate;if(!e)return 0;for(var n=e.length,r=0;r<n;r++)if(e[r].maxBitrate>=t)return r;return 0}},{key:"maxAutoLevel",get:function(){var e,t=this.levels,n=this.autoLevelCapping,r=this.maxHdcpLevel;if(e=-1===n&&t&&t.length?t.length-1:n,r)for(var i=e;i--;){var a=t[i].attrs["HDCP-LEVEL"];if(a&&a<=r)return i}return e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(e){this.config.lowLatencyMode=e}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&y(t.prototype,n),b&&y(t,b),Object.defineProperty(t,"prototype",{writable:!1}),e}();k.defaultConfig=void 0},"./src/is-supported.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{changeTypeSupported:function(){return s},isSupported:function(){return a}});var r=n("./src/utils/mediasource-helper.ts");function i(){return self.SourceBuffer||self.WebKitSourceBuffer}function a(){var e=(0,r.getMediaSource)();if(!e)return!1;var t=i(),n=e&&"function"===typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),a=!t||t.prototype&&"function"===typeof t.prototype.appendBuffer&&"function"===typeof t.prototype.remove;return!!n&&!!a}function s(){var e,t=i();return"function"===typeof(null===t||void 0===t||null===(e=t.prototype)||void 0===e?void 0:e.changeType)}},"./src/loader/date-range.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{DateRange:function(){return d},DateRangeAttribute:function(){return r}});var r,i,a=n("./src/polyfills/number.ts"),s=n("./src/utils/attr-list.ts"),o=n("./src/utils/logger.ts");function u(){return u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u.apply(this,arguments)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,l(r.key),r)}}function l(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}(i=r||(r={})).ID="ID",i.CLASS="CLASS",i.START_DATE="START-DATE",i.DURATION="DURATION",i.END_DATE="END-DATE",i.END_ON_NEXT="END-ON-NEXT",i.PLANNED_DURATION="PLANNED-DURATION",i.SCTE35_OUT="SCTE35-OUT",i.SCTE35_IN="SCTE35-IN";var d=function(){function e(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){var n=t.attr;for(var i in n)if(Object.prototype.hasOwnProperty.call(e,i)&&e[i]!==n[i]){o.logger.warn('DATERANGE tag attribute: "'+i+'" does not match for tags with ID: "'+e.ID+'"'),this._badValueForSameId=i;break}e=u(new s.AttrList({}),n,e)}if(this.attr=e,this._startDate=new Date(e[r.START_DATE]),r.END_DATE in this.attr){var c=new Date(this.attr[r.END_DATE]);(0,a.isFiniteNumber)(c.getTime())&&(this._endDate=c)}}var t,n,i;return t=e,(n=[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var e=this.duration;return null!==e?new Date(this._startDate.getTime()+1e3*e):null}},{key:"duration",get:function(){if(r.DURATION in this.attr){var e=this.attr.decimalFloatingPoint(r.DURATION);if((0,a.isFiniteNumber)(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return r.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(r.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(r.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,a.isFiniteNumber)(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}])&&c(t.prototype,n),i&&c(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}()},"./src/loader/fragment-loader.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{LoadError:function(){return h},default:function(){return d}});var r=n("./src/polyfills/number.ts"),i=n("./src/errors.ts");function a(e){var t="function"===typeof Map?new Map:void 0;return a=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return s(e,arguments,c(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),u(r,e)},a(e)}function s(e,t,n){return s=o()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&u(i,n.prototype),i},s.apply(null,arguments)}function o(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function u(e,t){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},u(e,t)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}var l=Math.pow(2,17),d=function(){function e(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var t=e.prototype;return t.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t.abort=function(){this.loader&&this.loader.abort()},t.load=function(e,t){var n=this,r=e.url;if(!r)return Promise.reject(new h({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,networkDetails:null},"Fragment does not have a "+(r?"part list":"url")));this.abort();var a=this.config,s=a.fLoader,o=a.loader;return new Promise((function(r,u){n.loader&&n.loader.destroy();var c=n.loader=e.loader=s?new s(a):new o(a),d=f(e),p={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout,highWaterMark:"initSegment"===e.sn?1/0:l};e.stats=c.stats,c.load(d,p,{onSuccess:function(t,i,a,s){n.resetLoader(e,c);var o=t.data;a.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(o.slice(0,16)),o=o.slice(16)),r({frag:e,part:null,payload:o,networkDetails:s})},onError:function(t,r,a){n.resetLoader(e,c),u(new h({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:t,networkDetails:a}))},onAbort:function(t,r,a){n.resetLoader(e,c),u(new h({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,networkDetails:a}))},onTimeout:function(t,r,a){n.resetLoader(e,c),u(new h({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,networkDetails:a}))},onProgress:function(n,r,i,a){t&&t({frag:e,part:null,payload:i,networkDetails:a})}})}))},t.loadPart=function(e,t,n){var r=this;this.abort();var a=this.config,s=a.fLoader,o=a.loader;return new Promise((function(u,c){r.loader&&r.loader.destroy();var d=r.loader=e.loader=s?new s(a):new o(a),p=f(e,t),v={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout,highWaterMark:l};t.stats=d.stats,d.load(p,v,{onSuccess:function(i,a,s,o){r.resetLoader(e,d),r.updateStatsFromPart(e,t);var c={frag:e,part:t,payload:i.data,networkDetails:o};n(c),u(c)},onError:function(n,a,s){r.resetLoader(e,d),c(new h({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:n,networkDetails:s}))},onAbort:function(n,a,s){e.stats.aborted=t.stats.aborted,r.resetLoader(e,d),c(new h({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,networkDetails:s}))},onTimeout:function(n,a,s){r.resetLoader(e,d),c(new h({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,networkDetails:s}))}})}))},t.updateStatsFromPart=function(e,t){var n=e.stats,r=t.stats,i=r.total;if(n.loaded+=r.loaded,i){var a=Math.round(e.duration/t.duration),s=Math.min(Math.round(n.loaded/i),a),o=(a-s)*Math.round(n.loaded/s);n.total=n.loaded+o}else n.total=Math.max(n.loaded,n.total);var u=n.loading,c=r.loading;u.start?u.first+=c.first-c.start:(u.start=c.start,u.first=c.first),u.end=c.end},t.resetLoader=function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()},e}();function f(e,t){void 0===t&&(t=null);var n=t||e,i={frag:e,part:t,responseType:"arraybuffer",url:n.url,headers:{},rangeStart:0,rangeEnd:0},a=n.byteRangeStartOffset,s=n.byteRangeEndOffset;if((0,r.isFiniteNumber)(a)&&(0,r.isFiniteNumber)(s)){var o,u=a,c=s;if("initSegment"===e.sn&&"AES-128"===(null===(o=e.decryptdata)||void 0===o?void 0:o.method)){var l=s-a;l%16&&(c=s+(16-l%16)),0!==a&&(i.resetIV=!0,u=a-16)}i.rangeStart=u,i.rangeEnd=c}return i}var h=function(e){var t,n;function r(t){for(var n,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return(n=e.call.apply(e,[this].concat(i))||this).data=void 0,n.data=t,n}return n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,u(t,n),r}(a(Error))},"./src/loader/fragment.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{BaseSegment:function(){return h},ElementaryStreamTypes:function(){return r},Fragment:function(){return p},Part:function(){return v}});var r,i,a=n("./src/polyfills/number.ts"),s=n("./node_modules/url-toolkit/src/url-toolkit.js"),o=n("./src/loader/load-stats.ts");function u(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,c(e,t)}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,f(r.key),r)}}function d(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function f(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}(i=r||(r={})).AUDIO="audio",i.VIDEO="video",i.AUDIOVIDEO="audiovideo";var h=function(){function e(e){var t;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((t={})[r.AUDIO]=null,t[r.VIDEO]=null,t[r.AUDIOVIDEO]=null,t),this.baseurl=e}return e.prototype.setByteRange=function(e,t){var n=e.split("@",2),r=[];1===n.length?r[0]=t?t.byteRangeEndOffset:0:r[0]=parseInt(n[1]),r[1]=parseInt(n[0])+r[0],this._byteRange=r},d(e,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,s.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(e){this._url=e}}]),e}(),p=function(e){function t(t,n){var r;return(r=e.call(this,n)||this)._decryptdata=null,r.rawProgramDateTime=null,r.programDateTime=null,r.tagList=[],r.duration=0,r.sn=0,r.levelkeys=void 0,r.type=void 0,r.loader=null,r.keyLoader=null,r.level=-1,r.cc=0,r.startPTS=void 0,r.endPTS=void 0,r.appendedPTS=void 0,r.startDTS=void 0,r.endDTS=void 0,r.start=0,r.deltaPTS=void 0,r.maxStartPTS=void 0,r.minEndPTS=void 0,r.stats=new o.LoadStats,r.urlId=0,r.data=void 0,r.bitrateTest=!1,r.title=null,r.initSegment=null,r.endList=void 0,r.type=t,r}u(t,e);var n=t.prototype;return n.setKeyFormat=function(e){if(this.levelkeys){var t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}},n.abortRequests=function(){var e,t;null===(e=this.loader)||void 0===e||e.abort(),null===(t=this.keyLoader)||void 0===t||t.abort()},n.setElementaryStreamInfo=function(e,t,n,r,i,a){void 0===a&&(a=!1);var s=this.elementaryStreams,o=s[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,n),o.startDTS=Math.min(o.startDTS,r),o.endDTS=Math.max(o.endDTS,i)):s[e]={startPTS:t,endPTS:n,startDTS:r,endDTS:i,partial:a}},n.clearElementaryStreamInfo=function(){var e=this.elementaryStreams;e[r.AUDIO]=null,e[r.VIDEO]=null,e[r.AUDIOVIDEO]=null},d(t,[{key:"decryptdata",get:function(){if(!this.levelkeys&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{var t=Object.keys(this.levelkeys);if(1===t.length)return this._decryptdata=this.levelkeys[t[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!(0,a.isFiniteNumber)(this.programDateTime))return null;var e=(0,a.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){var e;if(null!==(e=this._decryptdata)&&void 0!==e&&e.encrypted)return!0;if(this.levelkeys){var t=Object.keys(this.levelkeys),n=t.length;if(n>1||1===n&&this.levelkeys[t[0]].encrypted)return!0}return!1}}]),t}(h),v=function(e){function t(t,n,r,i,a){var s;(s=e.call(this,r)||this).fragOffset=0,s.duration=0,s.gap=!1,s.independent=!1,s.relurl=void 0,s.fragment=void 0,s.index=void 0,s.stats=new o.LoadStats,s.duration=t.decimalFloatingPoint("DURATION"),s.gap=t.bool("GAP"),s.independent=t.bool("INDEPENDENT"),s.relurl=t.enumeratedString("URI"),s.fragment=n,s.index=i;var u=t.enumeratedString("BYTERANGE");return u&&s.setByteRange(u,a),a&&(s.fragOffset=a.fragOffset+a.duration),s}return u(t,e),d(t,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var e=this.elementaryStreams;return!!(e.audio||e.video||e.audiovideo)}}]),t}(h)},"./src/loader/key-loader.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return a}});var r=n("./src/errors.ts"),i=n("./src/loader/fragment-loader.ts"),a=function(){function e(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}var t=e.prototype;return t.abort=function(){for(var e in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e].loader;t&&t.abort()}},t.detach=function(){for(var e in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}},t.destroy=function(){for(var e in this.detach(),this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}},t.createKeyLoadError=function(e,t,n,a){return void 0===t&&(t=r.ErrorDetails.KEY_LOAD_ERROR),new i.LoadError({type:r.ErrorTypes.NETWORK_ERROR,details:t,fatal:!1,frag:e,networkDetails:n})},t.loadClear=function(e,t){var n=this;if(this.emeController&&this.config.emeEnabled)for(var r=e.sn,i=e.cc,a=function(e){var a=t[e];if(i<=a.cc&&("initSegment"===r||r<a.sn))return n.emeController.selectKeySystemFormat(a).then((function(e){a.setKeyFormat(e)})),"break"},s=0;s<t.length&&"break"!==a(s);s++);},t.load=function(e){var t=this;return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then((function(n){return t.loadInternal(e,n)})):this.loadInternal(e)},t.loadInternal=function(e,t){var n,i;t&&e.setKeyFormat(t);var a=e.decryptdata;if(!a){var s=t?"Expected frag.decryptdata to be defined after setting format "+t:"Missing decryption data on fragment in onKeyLoading";return Promise.reject(this.createKeyLoadError(e,r.ErrorDetails.KEY_LOAD_ERROR,null,s))}var o=a.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,r.ErrorDetails.KEY_LOAD_ERROR,null,'Invalid key URI: "'+o+'"'));var u,c=this.keyUriToKeyInfo[o];if(null!==(n=c)&&void 0!==n&&n.decryptdata.key)return a.key=c.decryptdata.key,Promise.resolve({frag:e,keyInfo:c});if(null!==(i=c)&&void 0!==i&&i.keyLoadPromise)switch(null===(u=c.mediaKeySessionContext)||void 0===u?void 0:u.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return c.keyLoadPromise}switch(c=this.keyUriToKeyInfo[o]={decryptdata:a,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},a.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===a.keyFormat?this.loadKeyHTTP(c,e):this.loadKeyEME(c,e);case"AES-128":return this.loadKeyHTTP(c,e);default:return Promise.reject(this.createKeyLoadError(e,r.ErrorDetails.KEY_LOAD_ERROR,null,'Key supplied with unsupported METHOD: "'+a.method+'"'))}},t.loadKeyEME=function(e,t){var n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var r=this.emeController.loadKey(n);if(r)return(e.keyLoadPromise=r.then((function(t){return e.mediaKeySessionContext=t,n}))).catch((function(t){throw e.keyLoadPromise=null,t}))}return Promise.resolve(n)},t.loadKeyHTTP=function(e,t){var n=this,i=this.config,a=new(0,i.loader)(i);return t.keyLoader=e.loader=a,e.keyLoadPromise=new Promise((function(s,o){var u={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:i.fragLoadingRetryDelay,maxRetryDelay:i.fragLoadingMaxRetryTimeout,highWaterMark:0},l={onSuccess:function(e,t,i,a){var u=i.frag,c=i.keyInfo,l=i.url;if(!u.decryptdata||c!==n.keyUriToKeyInfo[l])return o(n.createKeyLoadError(u,r.ErrorDetails.KEY_LOAD_ERROR,a,"after key load, decryptdata unset or changed"));c.decryptdata.key=u.decryptdata.key=new Uint8Array(e.data),u.keyLoader=null,c.loader=null,s({frag:u,keyInfo:c})},onError:function(e,i,a){n.resetLoader(i),o(n.createKeyLoadError(t,r.ErrorDetails.KEY_LOAD_ERROR,a))},onTimeout:function(e,i,a){n.resetLoader(i),o(n.createKeyLoadError(t,r.ErrorDetails.KEY_LOAD_TIMEOUT,a))},onAbort:function(e,i,a){n.resetLoader(i),o(n.createKeyLoadError(t,r.ErrorDetails.INTERNAL_ABORTED,a))}};a.load(u,c,l)}))},t.resetLoader=function(e){var t=e.frag,n=e.keyInfo,r=e.url,i=n.loader;t.keyLoader===i&&(t.keyLoader=null,n.loader=null),delete this.keyUriToKeyInfo[r],i&&i.destroy()},e}()},"./src/loader/level-details.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{LevelDetails:function(){return s}});var r=n("./src/polyfills/number.ts");function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,a(r.key),r)}}function a(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}var s=function(){function e(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}var t,n,a;return e.prototype.reloaded=function(e){if(!e)return this.advanced=!0,void(this.updated=!0);var t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t,this.advanced=this.endSN>e.endSN||t>0||0===t&&n>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay},t=e,(n=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&(0,r.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var e=this.driftEndTime-this.driftStartTime;return e>0?1e3*(this.driftEnd-this.driftStart)/e:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var e;return null!==(e=this.partList)&&void 0!==e&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var e;return null!==(e=this.fragments)&&void 0!==e&&e.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var e;return null!==(e=this.partList)&&void 0!==e&&e.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var e;return null!==(e=this.partList)&&void 0!==e&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&i(t.prototype,n),a&&i(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}()},"./src/loader/level-key.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{LevelKey:function(){return c}});var r=n("./src/utils/keysystem-util.ts"),i=n("./src/utils/mediakeys-helper.ts"),a=n("./src/utils/mp4-tools.ts"),s=n("./src/utils/logger.ts"),o=n("./src/utils/numeric-encoding-utils.ts"),u={},c=function(){function e(e,t,n,r,i){void 0===r&&(r=[1]),void 0===i&&(i=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=r,this.iv=i,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&"AES-128"!==e}e.clearKeyUriToKeyIdMap=function(){u={}};var t=e.prototype;return t.isSupported=function(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;switch(this.keyFormat){case"identity":return"SAMPLE-AES"===this.method;case i.KeySystemFormats.FAIRPLAY:case i.KeySystemFormats.WIDEVINE:case i.KeySystemFormats.PLAYREADY:case i.KeySystemFormats.CLEARKEY:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1},t.getDecryptData=function(t){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!==typeof t&&("AES-128"!==this.method||this.iv||s.logger.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),t=0);var n=function(e){for(var t=new Uint8Array(16),n=12;n<16;n++)t[n]=e>>8*(15-n)&255;return t}(t);return new e(this.method,this.uri,"identity",this.keyFormatVersions,n)}var c=(0,r.convertDataUriToArrayBytes)(this.uri);if(c)switch(this.keyFormat){case i.KeySystemFormats.WIDEVINE:this.pssh=c,c.length>=22&&(this.keyId=c.subarray(c.length-22,c.length-6));break;case i.KeySystemFormats.PLAYREADY:var l=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=(0,a.mp4pssh)(l,null,c);var d=new Uint16Array(c.buffer,c.byteOffset,c.byteLength/2),f=String.fromCharCode.apply(null,Array.from(d)),h=f.substring(f.indexOf("<"),f.length),p=(new DOMParser).parseFromString(h,"text/xml").getElementsByTagName("KID")[0];if(p){var v=p.childNodes[0]?p.childNodes[0].nodeValue:p.getAttribute("VALUE");if(v){var g=(0,o.base64Decode)(v).subarray(0,16);(0,r.changeEndianness)(g),this.keyId=g}}break;default:var m=c.subarray(0,16);if(16!==m.length){var y=new Uint8Array(16);y.set(m,16-m.length),m=y}this.keyId=m}if(!this.keyId||16!==this.keyId.byteLength){var b=u[this.uri];if(!b){var k=Object.keys(u).length%Number.MAX_SAFE_INTEGER;b=new Uint8Array(16),new DataView(b.buffer,12,4).setUint32(0,k),u[this.uri]=b}this.keyId=b}return this},e}()},"./src/loader/load-stats.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{LoadStats:function(){return r}});var r=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return m}});var r=n("./src/polyfills/number.ts"),i=n("./node_modules/url-toolkit/src/url-toolkit.js"),a=n("./src/loader/date-range.ts"),s=n("./src/loader/fragment.ts"),o=n("./src/loader/level-details.ts"),u=n("./src/loader/level-key.ts"),c=n("./src/utils/attr-list.ts"),l=n("./src/utils/logger.ts"),d=n("./src/utils/codecs.ts");function f(){return f=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},f.apply(this,arguments)}var h=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+|#EXT-X-SESSION-KEY:([^\n\r]*)[\r\n]+/g,p=/#EXT-X-MEDIA:(.*)/g,v=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),g=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),m=function(){function e(){}return e.findGroup=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.id===t)return r}},e.convertAVC1ToAVCOTI=function(e){var t=e.split(".");if(t.length>2){var n=t.shift()+".";return n+=parseInt(t.shift()).toString(16),n+=("000"+parseInt(t.shift()).toString(16)).slice(-4)}return e},e.resolve=function(e,t){return(0,i.buildAbsoluteURL)(t,e,{alwaysNormalize:!0})},e.parseMasterPlaylist=function(t,n){var r,i=[],a=[],s={},o=[],u=!1;for(h.lastIndex=0;null!=(r=h.exec(t));)if(r[1]){var d,f=new c.AttrList(r[1]),p={attrs:f,bitrate:f.decimalInteger("AVERAGE-BANDWIDTH")||f.decimalInteger("BANDWIDTH"),name:f.NAME,url:e.resolve(r[2],n)},v=f.decimalResolution("RESOLUTION");v&&(p.width=v.width,p.height=v.height),b((f.CODECS||"").split(/[ ,]+/).filter((function(e){return e})),p),p.videoCodec&&-1!==p.videoCodec.indexOf("avc1")&&(p.videoCodec=e.convertAVC1ToAVCOTI(p.videoCodec)),null!==(d=p.unknownCodecs)&&void 0!==d&&d.length||a.push(p),i.push(p)}else if(r[3]){var g=new c.AttrList(r[3]);g["DATA-ID"]&&(u=!0,s[g["DATA-ID"]]=g)}else if(r[4]){var m=r[4],k=y(m,n);k.encrypted&&k.isSupported()?o.push(k):l.logger.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+m+'"')}return{levels:a.length>0&&a.length<i.length?a:i,sessionData:u?s:null,sessionKeys:o.length?o:null}},e.parseMasterPlaylistMedia=function(t,n,r,i){var a;void 0===i&&(i=[]);var s=[],o=0;for(p.lastIndex=0;null!==(a=p.exec(t));){var u=new c.AttrList(a[1]);if(u.TYPE===r){var l={attrs:u,bitrate:0,id:o++,groupId:u["GROUP-ID"],instreamId:u["INSTREAM-ID"],name:u.NAME||u.LANGUAGE||"",type:r,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:u.LANGUAGE,url:u.URI?e.resolve(u.URI,n):""};if(i.length){var d=e.findGroup(i,l.groupId)||i[0];k(l,d,"audioCodec"),k(l,d,"textCodec")}s.push(l)}}return s},e.parseLevelPlaylist=function(e,t,n,i,u){var d,h,p,m=new o.LevelDetails(t),b=m.fragments,k=null,w=0,x=0,R=0,C=0,A=null,I=new s.Fragment(i,t),P=-1,_=!1;for(v.lastIndex=0,m.m3u8=e;null!==(d=v.exec(e));){_&&(_=!1,(I=new s.Fragment(i,t)).start=R,I.sn=w,I.cc=C,I.level=n,k&&(I.initSegment=k,I.rawProgramDateTime=k.rawProgramDateTime,k.rawProgramDateTime=null));var D=d[1];if(D){I.duration=parseFloat(D);var L=(" "+d[2]).slice(1);I.title=L||null,I.tagList.push(L?["INF",D,L]:["INF",D])}else if(d[3])(0,r.isFiniteNumber)(I.duration)&&(I.start=R,p&&S(I,p,m),I.sn=w,I.level=n,I.cc=C,I.urlId=u,b.push(I),I.relurl=(" "+d[3]).slice(1),T(I,A),A=I,R+=I.duration,w++,x=0,_=!0);else if(d[4]){var O=(" "+d[4]).slice(1);A?I.setByteRange(O,A):I.setByteRange(O)}else if(d[5])I.rawProgramDateTime=(" "+d[5]).slice(1),I.tagList.push(["PROGRAM-DATE-TIME",I.rawProgramDateTime]),-1===P&&(P=b.length);else{if(!(d=d[0].match(g))){l.logger.warn("No matches on slow regex match for level playlist!");continue}for(h=1;h<d.length&&"undefined"===typeof d[h];h++);var M=(" "+d[h]).slice(1),N=(" "+d[h+1]).slice(1),F=d[h+2]?(" "+d[h+2]).slice(1):"";switch(M){case"PLAYLIST-TYPE":m.type=N.toUpperCase();break;case"MEDIA-SEQUENCE":w=m.startSN=parseInt(N);break;case"SKIP":var U=new c.AttrList(N),B=U.decimalInteger("SKIPPED-SEGMENTS");if((0,r.isFiniteNumber)(B)){m.skippedSegments=B;for(var j=B;j--;)b.unshift(null);w+=B}var G=U.enumeratedString("RECENTLY-REMOVED-DATERANGES");G&&(m.recentlyRemovedDateranges=G.split("\t"));break;case"TARGETDURATION":m.targetduration=parseFloat(N);break;case"VERSION":m.version=parseInt(N);break;case"EXTM3U":break;case"ENDLIST":m.live=!1;break;case"#":(N||F)&&I.tagList.push(F?[N,F]:[N]);break;case"DISCONTINUITY":C++,I.tagList.push(["DIS"]);break;case"GAP":I.tagList.push([M]);break;case"BITRATE":I.tagList.push([M,N]);break;case"DATERANGE":var V=new c.AttrList(N),K=new a.DateRange(V,m.dateRanges[V.ID]);K.isValid||m.skippedSegments?m.dateRanges[K.id]=K:l.logger.warn('Ignoring invalid DATERANGE tag: "'+N+'"'),I.tagList.push(["EXT-X-DATERANGE",N]);break;case"DISCONTINUITY-SEQUENCE":C=parseInt(N);break;case"KEY":var H=y(N,t);if(H.isSupported()){if("NONE"===H.method){p=void 0;break}p||(p={}),p[H.keyFormat]&&(p=f({},p)),p[H.keyFormat]=H}else l.logger.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+N+'"');break;case"START":var z=new c.AttrList(N).decimalFloatingPoint("TIME-OFFSET");(0,r.isFiniteNumber)(z)&&(m.startTimeOffset=z);break;case"MAP":var W=new c.AttrList(N);if(I.duration){var q=new s.Fragment(i,t);E(q,W,n,p),k=q,I.initSegment=k,k.rawProgramDateTime&&!I.rawProgramDateTime&&(I.rawProgramDateTime=k.rawProgramDateTime)}else E(I,W,n,p),k=I,_=!0;break;case"SERVER-CONTROL":var Y=new c.AttrList(N);m.canBlockReload=Y.bool("CAN-BLOCK-RELOAD"),m.canSkipUntil=Y.optionalFloat("CAN-SKIP-UNTIL",0),m.canSkipDateRanges=m.canSkipUntil>0&&Y.bool("CAN-SKIP-DATERANGES"),m.partHoldBack=Y.optionalFloat("PART-HOLD-BACK",0),m.holdBack=Y.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var Q=new c.AttrList(N);m.partTarget=Q.decimalFloatingPoint("PART-TARGET");break;case"PART":var J=m.partList;J||(J=m.partList=[]);var $=x>0?J[J.length-1]:void 0,X=x++,Z=new s.Part(new c.AttrList(N),I,t,X,$);J.push(Z),I.duration+=Z.duration;break;case"PRELOAD-HINT":var ee=new c.AttrList(N);m.preloadHint=ee;break;case"RENDITION-REPORT":var te=new c.AttrList(N);m.renditionReports=m.renditionReports||[],m.renditionReports.push(te);break;default:l.logger.warn("line parsed but not handled: "+d)}}}A&&!A.relurl?(b.pop(),R-=A.duration,m.partList&&(m.fragmentHint=A)):m.partList&&(T(I,A),I.cc=C,m.fragmentHint=I,p&&S(I,p,m));var ne=b.length,re=b[0],ie=b[ne-1];if((R+=m.skippedSegments*m.targetduration)>0&&ne&&ie){m.averagetargetduration=R/ne;var ae=ie.sn;m.endSN="initSegment"!==ae?ae:0,m.live||(ie.endList=!0),re&&(m.startCC=re.cc)}else m.endSN=0,m.startCC=0;return m.fragmentHint&&(R+=m.fragmentHint.duration),m.totalduration=R,m.endCC=C,P>0&&function(e,t){for(var n=e[t],r=t;r--;){var i=e[r];if(!i)return;i.programDateTime=n.programDateTime-1e3*i.duration,n=i}}(b,P),m},e}();function y(e,t){var n,r,i=new c.AttrList(e),a=null!=(n=i.enumeratedString("METHOD"))?n:"",s=i.URI,o=i.hexadecimalInteger("IV"),d=i.enumeratedString("KEYFORMATVERSIONS"),f=null!=(r=i.enumeratedString("KEYFORMAT"))?r:"identity";s&&i.IV&&!o&&l.logger.error("Invalid IV: "+i.IV);var h=s?m.resolve(s,t):"",p=(d||"1").split("/").map(Number).filter(Number.isFinite);return new u.LevelKey(a,h,f,p,o)}function b(e,t){["video","audio","text"].forEach((function(n){var r=e.filter((function(e){return(0,d.isCodecType)(e,n)}));if(r.length){var i=r.filter((function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)}));t[n+"Codec"]=i.length>0?i[0]:r[0],e=e.filter((function(e){return-1===r.indexOf(e)}))}})),t.unknownCodecs=e}function k(e,t,n){var r=t[n];r&&(e[n]=r)}function T(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!==t&&void 0!==t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),(0,r.isFiniteNumber)(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function E(e,t,n,r){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=n,e.sn="initSegment",r&&(e.levelkeys=r),e.initSegment=null}function S(e,t,n){e.levelkeys=t;var r=n.encryptedFragments;r.length&&r[r.length-1].levelkeys===t||!Object.keys(t).some((function(e){return t[e].isCommonEncryption}))||r.push(e)}},"./src/loader/playlist-loader.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var r=n("./src/polyfills/number.ts"),i=n("./src/events.ts"),a=n("./src/errors.ts"),s=n("./src/utils/logger.ts"),o=n("./src/loader/m3u8-parser.ts"),u=n("./src/types/loader.ts"),c=n("./src/utils/attr-list.ts");function l(e,t){var n=e.url;return void 0!==n&&0!==n.indexOf("data:")||(n=t.url),n}var d=function(){function e(e){this.hls=void 0,this.loaders=Object.create(null),this.hls=e,this.registerListeners()}var t=e.prototype;return t.startLoad=function(e){},t.stopLoad=function(){this.destroyInternalLoaders()},t.registerListeners=function(){var e=this.hls;e.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(i.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(i.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(i.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},t.unregisterListeners=function(){var e=this.hls;e.off(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(i.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(i.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(i.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},t.createInternalLoader=function(e){var t=this.hls.config,n=t.pLoader,r=t.loader,i=new(n||r)(t);return e.loader=i,this.loaders[e.type]=i,i},t.getInternalLoader=function(e){return this.loaders[e.type]},t.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},t.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},t.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},t.onManifestLoading=function(e,t){var n=t.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:u.PlaylistContextType.MANIFEST,url:n,deliveryDirectives:null})},t.onLevelLoading=function(e,t){var n=t.id,r=t.level,i=t.url,a=t.deliveryDirectives;this.load({id:n,groupId:null,level:r,responseType:"text",type:u.PlaylistContextType.LEVEL,url:i,deliveryDirectives:a})},t.onAudioTrackLoading=function(e,t){var n=t.id,r=t.groupId,i=t.url,a=t.deliveryDirectives;this.load({id:n,groupId:r,level:null,responseType:"text",type:u.PlaylistContextType.AUDIO_TRACK,url:i,deliveryDirectives:a})},t.onSubtitleTrackLoading=function(e,t){var n=t.id,r=t.groupId,i=t.url,a=t.deliveryDirectives;this.load({id:n,groupId:r,level:null,responseType:"text",type:u.PlaylistContextType.SUBTITLE_TRACK,url:i,deliveryDirectives:a})},t.load=function(e){var t,n,r,i,a,o,c=this.hls.config,l=this.getInternalLoader(e);if(l){var d=l.context;if(d&&d.url===e.url)return void s.logger.trace("[playlist-loader]: playlist request ongoing");s.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),l.abort()}switch(e.type){case u.PlaylistContextType.MANIFEST:n=c.manifestLoadingMaxRetry,r=c.manifestLoadingTimeOut,i=c.manifestLoadingRetryDelay,a=c.manifestLoadingMaxRetryTimeout;break;case u.PlaylistContextType.LEVEL:case u.PlaylistContextType.AUDIO_TRACK:case u.PlaylistContextType.SUBTITLE_TRACK:n=0,r=c.levelLoadingTimeOut;break;default:n=c.levelLoadingMaxRetry,r=c.levelLoadingTimeOut,i=c.levelLoadingRetryDelay,a=c.levelLoadingMaxRetryTimeout}if(l=this.createInternalLoader(e),null!==(t=e.deliveryDirectives)&&void 0!==t&&t.part&&(e.type===u.PlaylistContextType.LEVEL&&null!==e.level?o=this.hls.levels[e.level].details:e.type===u.PlaylistContextType.AUDIO_TRACK&&null!==e.id?o=this.hls.audioTracks[e.id].details:e.type===u.PlaylistContextType.SUBTITLE_TRACK&&null!==e.id&&(o=this.hls.subtitleTracks[e.id].details),o)){var f=o.partTarget,h=o.targetduration;f&&h&&(r=Math.min(1e3*Math.max(3*f,.8*h),r))}var p={timeout:r,maxRetry:n,retryDelay:i,maxRetryDelay:a,highWaterMark:0},v={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};l.load(e,p,v)},t.loadsuccess=function(e,t,n,r){void 0===r&&(r=null),this.resetInternalLoader(n.type);var i=e.data;0===i.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),i.indexOf("#EXTINF:")>0||i.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,t,n,r):this.handleMasterPlaylist(e,t,n,r)):this.handleManifestParsingError(e,n,"no EXTM3U delimiter",r)},t.loaderror=function(e,t,n){void 0===n&&(n=null),this.handleNetworkError(t,n,!1,e)},t.loadtimeout=function(e,t,n){void 0===n&&(n=null),this.handleNetworkError(t,n,!0)},t.handleMasterPlaylist=function(e,t,n,r){var a=this.hls,u=e.data,d=l(e,n),f=o.default.parseMasterPlaylist(u,d),h=f.levels,p=f.sessionData,v=f.sessionKeys;if(h.length){var g=h.map((function(e){return{id:e.attrs.AUDIO,audioCodec:e.audioCodec}})),m=h.map((function(e){return{id:e.attrs.SUBTITLES,textCodec:e.textCodec}})),y=o.default.parseMasterPlaylistMedia(u,d,"AUDIO",g),b=o.default.parseMasterPlaylistMedia(u,d,"SUBTITLES",m),k=o.default.parseMasterPlaylistMedia(u,d,"CLOSED-CAPTIONS");y.length&&(y.some((function(e){return!e.url}))||!h[0].audioCodec||h[0].attrs.AUDIO||(s.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),y.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new c.AttrList({}),bitrate:0,url:""}))),a.trigger(i.Events.MANIFEST_LOADED,{levels:h,audioTracks:y,subtitles:b,captions:k,url:d,stats:t,networkDetails:r,sessionData:p,sessionKeys:v})}else this.handleManifestParsingError(e,n,"no level found in manifest",r)},t.handleTrackOrLevelPlaylist=function(e,t,n,s){var d=this.hls,f=n.id,h=n.level,p=n.type,v=l(e,n),g=(0,r.isFiniteNumber)(f)?f:0,m=(0,r.isFiniteNumber)(h)?h:g,y=function(e){switch(e.type){case u.PlaylistContextType.AUDIO_TRACK:return u.PlaylistLevelType.AUDIO;case u.PlaylistContextType.SUBTITLE_TRACK:return u.PlaylistLevelType.SUBTITLE;default:return u.PlaylistLevelType.MAIN}}(n),b=o.default.parseLevelPlaylist(e.data,v,m,y,g);if(b.fragments.length){if(p===u.PlaylistContextType.MANIFEST){var k={attrs:new c.AttrList({}),bitrate:0,details:b,name:"",url:v};d.trigger(i.Events.MANIFEST_LOADED,{levels:[k],audioTracks:[],url:v,stats:t,networkDetails:s,sessionData:null,sessionKeys:null})}t.parsing.end=performance.now(),n.levelDetails=b,this.handlePlaylistLoaded(e,t,n,s)}else d.trigger(i.Events.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:v,reason:"no fragments found in level",level:"number"===typeof n.level?n.level:void 0})},t.handleManifestParsingError=function(e,t,n,r){this.hls.trigger(i.Events.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:t.type===u.PlaylistContextType.MANIFEST,url:e.url,reason:n,response:e,context:t,networkDetails:r})},t.handleNetworkError=function(e,t,n,r){void 0===n&&(n=!1),s.logger.warn("[playlist-loader]: A network "+(n?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var o=a.ErrorDetails.UNKNOWN,c=!1,l=this.getInternalLoader(e);switch(e.type){case u.PlaylistContextType.MANIFEST:o=n?a.ErrorDetails.MANIFEST_LOAD_TIMEOUT:a.ErrorDetails.MANIFEST_LOAD_ERROR,c=!0;break;case u.PlaylistContextType.LEVEL:o=n?a.ErrorDetails.LEVEL_LOAD_TIMEOUT:a.ErrorDetails.LEVEL_LOAD_ERROR,c=!1;break;case u.PlaylistContextType.AUDIO_TRACK:o=n?a.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:a.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case u.PlaylistContextType.SUBTITLE_TRACK:o=n?a.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:a.ErrorDetails.SUBTITLE_LOAD_ERROR,c=!1}l&&this.resetInternalLoader(e.type);var d={type:a.ErrorTypes.NETWORK_ERROR,details:o,fatal:c,url:e.url,loader:l,context:e,networkDetails:t};r&&(d.response=r),this.hls.trigger(i.Events.ERROR,d)},t.handlePlaylistLoaded=function(e,t,n,r){var a=n.type,s=n.level,o=n.id,c=n.groupId,l=n.loader,d=n.levelDetails,f=n.deliveryDirectives;if(null!==d&&void 0!==d&&d.targetduration){if(l)switch(d.live&&(l.getCacheAge&&(d.ageHeader=l.getCacheAge()||0),l.getCacheAge&&!isNaN(d.ageHeader)||(d.ageHeader=0)),a){case u.PlaylistContextType.MANIFEST:case u.PlaylistContextType.LEVEL:this.hls.trigger(i.Events.LEVEL_LOADED,{details:d,level:s||0,id:o||0,stats:t,networkDetails:r,deliveryDirectives:f});break;case u.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(i.Events.AUDIO_TRACK_LOADED,{details:d,id:o||0,groupId:c||"",stats:t,networkDetails:r,deliveryDirectives:f});break;case u.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(i.Events.SUBTITLE_TRACK_LOADED,{details:d,id:o||0,groupId:c||"",stats:t,networkDetails:r,deliveryDirectives:f})}}else this.handleManifestParsingError(e,n,"invalid target duration",r)},e}()},"./src/polyfills/number.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{MAX_SAFE_INTEGER:function(){return i},isFiniteNumber:function(){return r}});var r=Number.isFinite||function(e){return"number"===typeof e&&isFinite(e)},i=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return r}});var r=function(){function e(){}return e.getSilentFrame=function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},e}()},"./src/remux/mp4-generator.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return a}});var r=Math.pow(2,32)-1,i=function(){function e(){}return e.init=function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:n,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=a,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,s,u,s,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,i))},e.box=function(e){for(var t=8,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var a=r.length,s=a;a--;)t+=r[a].byteLength;var o=new Uint8Array(t);for(o[0]=t>>24&255,o[1]=t>>16&255,o[2]=t>>8&255,o[3]=255&t,o.set(e,4),a=0,t=8;a<s;a++)o.set(r[a],t),t+=r[a].byteLength;return o},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,n){n*=t;var i=Math.floor(n/(r+1)),a=Math.floor(n%(r+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,n,r){return e.box(e.types.moof,e.mfhd(t),e.traf(r,n))},e.moov=function(t){for(var n=t.length,r=[];n--;)r[n]=e.trak(t[n]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(e.mvex(t)))},e.mvex=function(t){for(var n=t.length,r=[];n--;)r[n]=e.trex(t[n]);return e.box.apply(null,[e.types.mvex].concat(r))},e.mvhd=function(t,n){n*=t;var i=Math.floor(n/(r+1)),a=Math.floor(n%(r+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,s)},e.sdtp=function(t){var n,r,i=t.samples||[],a=new Uint8Array(4+i.length);for(n=0;n<i.length;n++)r=i[n].flags,a[n+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return e.box(e.types.sdtp,a)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var n,r,i,a=[],s=[];for(n=0;n<t.sps.length;n++)i=(r=t.sps[n]).byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(r));for(n=0;n<t.pps.length;n++)i=(r=t.pps[n]).byteLength,s.push(i>>>8&255),s.push(255&i),s=s.concat(Array.prototype.slice.call(r));var o=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|t.sps.length].concat(a).concat([t.pps.length]).concat(s))),u=t.width,c=t.height,l=t.pixelRatio[0],d=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,c>>8&255,255&c,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([l>>24,l>>16&255,l>>8&255,255&l,d>>24,d>>16&255,d>>8&255,255&d])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var n=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var n=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]))},e.stsd=function(t){return"audio"===t.type?"mp3"===t.segmentCodec&&"mp3"===t.codec?e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var n=t.id,i=t.duration*t.timescale,a=t.width,s=t.height,o=Math.floor(i/(r+1)),u=Math.floor(i%(r+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,u>>24,u>>16&255,u>>8&255,255&u,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,s>>8&255,255&s,0,0]))},e.traf=function(t,n){var i=e.sdtp(t),a=t.id,s=Math.floor(n/(r+1)),o=Math.floor(n%(r+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o])),e.trun(t,i.length+16+20+8+16+8+8),i)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var n=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,n){var r,i,a,s,o,u,c=t.samples||[],l=c.length,d=12+16*l,f=new Uint8Array(d);for(n+=8+d,f.set(["video"===t.type?1:0,0,15,1,l>>>24&255,l>>>16&255,l>>>8&255,255&l,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),r=0;r<l;r++)a=(i=c[r]).duration,s=i.size,o=i.flags,u=i.cts,f.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*r);return e.box(e.types.trun,f)},e.initSegment=function(t){e.types||e.init();var n=e.moov(t),r=new Uint8Array(e.FTYP.byteLength+n.byteLength);return r.set(e.FTYP),r.set(n,e.FTYP.byteLength),r},e}();i.types=void 0,i.HDLR_TYPES=void 0,i.STTS=void 0,i.STSC=void 0,i.STCO=void 0,i.STSZ=void 0,i.VMHD=void 0,i.SMHD=void 0,i.STSD=void 0,i.FTYP=void 0,i.DINF=void 0;var a=i},"./src/remux/mp4-remuxer.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return p},flushTextTrackMetadataCueSamples:function(){return g},flushTextTrackUserdataCueSamples:function(){return m},normalizePts:function(){return v}});var r=n("./src/polyfills/number.ts"),i=n("./src/remux/aac-helper.ts"),a=n("./src/remux/mp4-generator.ts"),s=n("./src/events.ts"),o=n("./src/errors.ts"),u=n("./src/utils/logger.ts"),c=n("./src/types/loader.ts"),l=n("./src/utils/timescale-conversion.ts");function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},d.apply(this,arguments)}var f=null,h=null,p=function(){function e(e,t,n,r){if(void 0===r&&(r=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,null===f){var i=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);f=i?parseInt(i[1]):0}if(null===h){var a=navigator.userAgent.match(/Safari\/(\d+)/i);h=a?parseInt(a[1]):0}}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){u.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e},t.resetNextTimestamp=function(){u.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},t.resetInitSegment=function(){u.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},t.getVideoStartPts=function(e){var t=!1,n=e.reduce((function(e,n){var r=n.pts-e;return r<-4294967296?(t=!0,v(e,n.pts)):r>0?e:n.pts}),e[0].pts);return t&&u.logger.debug("PTS rollover detected"),n},t.remux=function(e,t,n,r,i,a,s,o){var l,d,f,h,p,y,b=i,k=i,T=e.pid>-1,E=t.pid>-1,S=t.samples.length,w=e.samples.length>0,x=s&&S>0||S>1;if((!T||w)&&(!E||x)||this.ISGenerated||s){this.ISGenerated||(f=this.generateIS(e,t,i));var R,C=this.isVideoContiguous,A=-1;if(x&&(A=function(e){for(var t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!C&&this.config.forceKeyFrameOnDiscontinuity))if(y=!0,A>0){u.logger.warn("[mp4-remuxer]: Dropped "+A+" out of "+S+" video samples due to a missing keyframe");var I=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(A),t.dropped+=A,R=k+=(t.samples[0].pts-I)/t.inputTimeScale}else-1===A&&(u.logger.warn("[mp4-remuxer]: No keyframe found out of "+S+" video samples"),y=!1);if(this.ISGenerated){if(w&&x){var P=this.getVideoStartPts(t.samples),_=(v(e.samples[0].pts,P)-P)/t.inputTimeScale;b+=Math.max(0,_),k+=Math.max(0,-_)}if(w){if(e.samplerate||(u.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),f=this.generateIS(e,t,i)),d=this.remuxAudio(e,b,this.isAudioContiguous,a,E||x||o===c.PlaylistLevelType.AUDIO?k:void 0),x){var D=d?d.endPTS-d.startPTS:0;t.inputTimeScale||(u.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),f=this.generateIS(e,t,i)),l=this.remuxVideo(t,k,C,D)}}else x&&(l=this.remuxVideo(t,k,C,0));l&&(l.firstKeyFrame=A,l.independent=-1!==A,l.firstKeyFramePTS=R)}}return this.ISGenerated&&(n.samples.length&&(p=g(n,i,this._initPTS,this._initDTS)),r.samples.length&&(h=m(r,i,this._initPTS))),{audio:d,video:l,initSegment:f,independent:y,text:h,id3:p}},t.generateIS=function(e,t,n){var i,s,o,u=e.samples,c=t.samples,l=this.typeSupported,d={},f=!(0,r.isFiniteNumber)(this._initPTS),h="audio/mp4";if(f&&(i=s=1/0),e.config&&u.length&&(e.timescale=e.samplerate,"mp3"===e.segmentCodec&&(l.mpeg?(h="audio/mpeg",e.codec=""):l.mp3&&(e.codec="mp3")),d.audio={id:"audio",container:h,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&l.mpeg?new Uint8Array(0):a.default.initSegment([e]),metadata:{channelCount:e.channelCount}},f&&(o=e.inputTimeScale,i=s=u[0].pts-Math.round(o*n))),t.sps&&t.pps&&c.length&&(t.timescale=t.inputTimeScale,d.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:a.default.initSegment([t]),metadata:{width:t.width,height:t.height}},f)){o=t.inputTimeScale;var p=this.getVideoStartPts(c),g=Math.round(o*n);s=Math.min(s,v(c[0].dts,p)-g),i=Math.min(i,p-g)}if(Object.keys(d).length)return this.ISGenerated=!0,f&&(this._initPTS=i,this._initDTS=s),{tracks:d,initPTS:i,timescale:o}},t.remuxVideo=function(e,t,n,r){var i,c,p=e.inputTimeScale,g=e.samples,m=[],b=g.length,k=this._initPTS,T=this.nextAvcDts,E=8,S=this.videoSampleDuration,w=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,R=!1;n&&null!==T||(T=t*p-(g[0].pts-v(g[0].dts,g[0].pts)));for(var C=0;C<b;C++){var A=g[C];A.pts=v(A.pts-k,T),A.dts=v(A.dts-k,T),A.dts<g[C>0?C-1:C].dts&&(R=!0)}R&&g.sort((function(e,t){var n=e.dts-t.dts,r=e.pts-t.pts;return n||r})),i=g[0].dts;var I=(c=g[g.length-1].dts)-i,P=I?Math.round(I/(b-1)):S||e.inputTimeScale/30;if(n){var _=i-T,D=_>P,L=_<-1;if((D||L)&&(D?u.logger.warn("AVC: "+(0,l.toMsFromMpegTsClock)(_,!0)+" ms ("+_+"dts) hole between fragments detected, filling it"):u.logger.warn("AVC: "+(0,l.toMsFromMpegTsClock)(-_,!0)+" ms ("+_+"dts) overlapping between fragments detected"),!L||T>g[0].pts)){i=T;var O=g[0].pts-_;g[0].dts=i,g[0].pts=O,u.logger.log("Video: First PTS/DTS adjusted: "+(0,l.toMsFromMpegTsClock)(O,!0)+"/"+(0,l.toMsFromMpegTsClock)(i,!0)+", delta: "+(0,l.toMsFromMpegTsClock)(_,!0)+" ms")}}i=Math.max(0,i);for(var M=0,N=0,F=0;F<b;F++){for(var U=g[F],B=U.units,j=B.length,G=0,V=0;V<j;V++)G+=B[V].data.length;N+=G,M+=j,U.length=G,U.dts=Math.max(U.dts,i),w=Math.min(U.pts,w),x=Math.max(U.pts,x)}c=g[b-1].dts;var K,H=N+4*M+8;try{K=new Uint8Array(H)}catch(ke){return void this.observer.emit(s.Events.ERROR,s.Events.ERROR,{type:o.ErrorTypes.MUX_ERROR,details:o.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:H,reason:"fail allocating video mdat "+H})}var z=new DataView(K.buffer);z.setUint32(0,H),K.set(a.default.types.mdat,4);for(var W=!1,q=Number.POSITIVE_INFINITY,Y=Number.POSITIVE_INFINITY,Q=Number.NEGATIVE_INFINITY,J=Number.NEGATIVE_INFINITY,$=0;$<b;$++){for(var X=g[$],Z=X.units,ee=0,te=0,ne=Z.length;te<ne;te++){var re=Z[te],ie=re.data,ae=re.data.byteLength;z.setUint32(E,ae),E+=4,K.set(ie,E),E+=ae,ee+=4+ae}var se=void 0;if($<b-1)S=g[$+1].dts-X.dts,se=g[$+1].pts-X.pts;else{var oe=this.config,ue=$>0?X.dts-g[$-1].dts:P;if(se=$>0?X.pts-g[$-1].pts:P,oe.stretchShortVideoTrack&&null!==this.nextAudioPts){var ce=Math.floor(oe.maxBufferHole*p),le=(r?w+r*p:this.nextAudioPts)-X.pts;le>ce?((S=le-ue)<0?S=ue:W=!0,u.logger.log("[mp4-remuxer]: It is approximately "+le/90+" ms to the next segment; using duration "+S/90+" ms for the last video frame.")):S=ue}else S=ue}var de=Math.round(X.pts-X.dts);q=Math.min(q,S),Q=Math.max(Q,S),Y=Math.min(Y,se),J=Math.max(J,se),m.push(new y(X.key,S,ee,de))}if(m.length)if(f){if(f<70){var fe=m[0].flags;fe.dependsOn=2,fe.isNonSync=0}}else if(h&&J-Y<Q-q&&P/Q<.025&&0===m[0].cts){u.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var he=i,pe=0,ve=m.length;pe<ve;pe++){var ge=he+m[pe].duration,me=he+m[pe].cts;if(pe<ve-1){var ye=ge+m[pe+1].cts;m[pe].duration=ye-me}else m[pe].duration=pe?m[pe-1].duration:P;m[pe].cts=0,he=ge}}console.assert(null!==S,"mp4SampleDuration must be computed"),S=W||!S?P:S,this.nextAvcDts=T=c+S,this.videoSampleDuration=S,this.isVideoContiguous=!0;var be={data1:a.default.moof(e.sequenceNumber++,i,d({},e,{samples:m})),data2:K,startPTS:w/p,endPTS:(x+S)/p,startDTS:i/p,endDTS:T/p,type:"video",hasAudio:!1,hasVideo:!0,nb:m.length,dropped:e.dropped};return e.samples=[],e.dropped=0,console.assert(K.length,"MDAT length must not be zero"),be},t.remuxAudio=function(e,t,n,r,c){var l=e.inputTimeScale,f=l/(e.samplerate?e.samplerate:l),h="aac"===e.segmentCodec?1024:1152,p=h*f,g=this._initPTS,m="mp3"===e.segmentCodec&&this.typeSupported.mpeg,b=[],k=void 0!==c,T=e.samples,E=m?0:8,S=this.nextAudioPts||-1,w=t*l;if(this.isAudioContiguous=n=n||T.length&&S>0&&(r&&Math.abs(w-S)<9e3||Math.abs(v(T[0].pts-g,w)-S)<20*p),T.forEach((function(e){e.pts=v(e.pts-g,w)})),!n||S<0){if(T=T.filter((function(e){return e.pts>=0})),!T.length)return;S=0===c?0:r&&!k?Math.max(0,w):T[0].pts}if("aac"===e.segmentCodec)for(var x=this.config.maxAudioFramesDrift,R=0,C=S;R<T.length;R++){var A=T[R],I=A.pts,P=I-C,_=Math.abs(1e3*P/l);if(P<=-x*p&&k)0===R&&(u.logger.warn("Audio frame @ "+(I/l).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*P/l)+" ms."),this.nextAudioPts=S=C=I);else if(P>=x*p&&_<1e4&&k){var D=Math.round(P/p);(C=I-D*p)<0&&(D--,C+=p),0===R&&(this.nextAudioPts=S=C),u.logger.warn("[mp4-remuxer]: Injecting "+D+" audio frame @ "+(C/l).toFixed(3)+"s due to "+Math.round(1e3*P/l)+" ms gap.");for(var L=0;L<D;L++){var O=Math.max(C,0),M=i.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);M||(u.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),M=A.unit.subarray()),T.splice(R,0,{unit:M,pts:O}),C+=p,R++}}A.pts=C,C+=p}for(var N,F=null,U=null,B=0,j=T.length;j--;)B+=T[j].unit.byteLength;for(var G=0,V=T.length;G<V;G++){var K=T[G],H=K.unit,z=K.pts;if(null!==U)b[G-1].duration=Math.round((z-U)/f);else{if(n&&"aac"===e.segmentCodec&&(z=S),F=z,!(B>0))return;B+=E;try{N=new Uint8Array(B)}catch(Z){return void this.observer.emit(s.Events.ERROR,s.Events.ERROR,{type:o.ErrorTypes.MUX_ERROR,details:o.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:B,reason:"fail allocating audio mdat "+B})}m||(new DataView(N.buffer).setUint32(0,B),N.set(a.default.types.mdat,4))}N.set(H,E);var W=H.byteLength;E+=W,b.push(new y(!0,h,W,0)),U=z}var q=b.length;if(q){var Y=b[b.length-1];this.nextAudioPts=S=U+f*Y.duration;var Q=m?new Uint8Array(0):a.default.moof(e.sequenceNumber++,F/f,d({},e,{samples:b}));e.samples=[];var J=F/l,$=S/l,X={data1:Q,data2:N,startPTS:J,endPTS:$,startDTS:J,endDTS:$,type:"audio",hasAudio:!0,hasVideo:!1,nb:q};return this.isAudioContiguous=!0,console.assert(N.length,"MDAT length must not be zero"),X}},t.remuxEmptyAudio=function(e,t,n,r){var a=e.inputTimeScale,s=a/(e.samplerate?e.samplerate:a),o=this.nextAudioPts,c=(null!==o?o:r.startDTS*a)+this._initDTS,l=r.endDTS*a+this._initDTS,d=1024*s,f=Math.ceil((l-c)/d),h=i.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(u.logger.warn("[mp4-remuxer]: remux empty Audio"),h){for(var p=[],v=0;v<f;v++){var g=c+v*d;p.push({unit:h,pts:g,dts:g})}return e.samples=p,this.remuxAudio(e,t,n,!1)}u.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},e}();function v(e,t){var n;if(null===t)return e;for(n=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=n;return e}function g(e,t,n,r){var i=e.samples.length;if(i){for(var a=e.inputTimeScale,s=0;s<i;s++){var o=e.samples[s];o.pts=v(o.pts-n,t*a)/a,o.dts=v(o.dts-r,t*a)/a}var u=e.samples;return e.samples=[],{samples:u}}}function m(e,t,n){var r=e.samples.length;if(r){for(var i=e.inputTimeScale,a=0;a<r;a++){var s=e.samples[a];s.pts=v(s.pts-n,t*i)/i}e.samples.sort((function(e,t){return e.pts-t.pts}));var o=e.samples;return e.samples=[],{samples:o}}}var y=function(e,t,n,r){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=n,this.cts=r,this.flags=new b(e)},b=function(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1}},"./src/remux/passthrough-remuxer.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var r=n("./src/polyfills/number.ts"),i=n("./src/remux/mp4-remuxer.ts"),a=n("./src/utils/mp4-tools.ts"),s=n("./src/loader/fragment.ts"),o=n("./src/utils/logger.ts");function u(e,t){var n=null===e||void 0===e?void 0:e.codec;return n&&n.length>4?n:"hvc1"===n||"hev1"===n?"hvc1.1.c.L120.90":"av01"===n?"av01.0.04M.08":"avc1"===n||t===s.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}var c=function(){function e(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){this.initPTS=e,this.lastEndTime=null},t.resetNextTimestamp=function(){this.lastEndTime=null},t.resetInitSegment=function(e,t,n,r){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment((0,a.patchEncyptionData)(e,r)),this.emitInitSegment=!0},t.generateInitSegment=function(e){var t=this.audioCodec,n=this.videoCodec;if(!e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var r=this.initData=(0,a.parseInitSegment)(e);t||(t=u(r.audio,s.ElementaryStreamTypes.AUDIO)),n||(n=u(r.video,s.ElementaryStreamTypes.VIDEO));var i={};r.audio&&r.video?i.audiovideo={container:"video/mp4",codec:t+","+n,initSegment:e,id:"main"}:r.audio?i.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:r.video?i.video={container:"video/mp4",codec:n,initSegment:e,id:"main"}:o.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=i},t.remux=function(e,t,n,s,u){var c,l=this.initPTS,d=this.lastEndTime,f={audio:void 0,video:void 0,text:s,id3:n,initSegment:void 0};(0,r.isFiniteNumber)(d)||(d=this.lastEndTime=u||0);var h=t.samples;if(!h||!h.length)return f;var p={initPTS:void 0,timescale:1},v=this.initData;if(v&&v.length||(this.generateInitSegment(h),v=this.initData),!v||!v.length)return o.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),f;this.emitInitSegment&&(p.tracks=this.initTracks,this.emitInitSegment=!1);var g=(0,a.getStartDTS)(v,h);(0,r.isFiniteNumber)(l)||(this.initPTS=p.initPTS=l=g-u);var m=(0,a.getDuration)(h,v),y=e?g-l:d,b=y+m;(0,a.offsetStartDTS)(v,h,l),m>0?this.lastEndTime=b:(o.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var k=!!v.audio,T=!!v.video,E="";k&&(E+="audio"),T&&(E+="video");var S={data1:h,startPTS:y,startDTS:y,endPTS:b,endDTS:b,type:E,hasAudio:k,hasVideo:T,nb:1,dropped:0};f.audio="audio"===S.type?S:void 0,f.video="audio"!==S.type?S:void 0,f.initSegment=p;var w=null!=(c=this.initPTS)?c:0;return f.id3=(0,i.flushTextTrackMetadataCueSamples)(n,u,w,w),s.samples.length&&(f.text=(0,i.flushTextTrackUserdataCueSamples)(s,u,w)),f},e}()},"./src/task-loop.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return r}});var r=function(){function e(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var t=e.prototype;return t.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},t.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},t.onHandlerDestroyed=function(){},t.hasInterval=function(){return!!this._tickInterval},t.hasNextTick=function(){return!!this._tickTimer},t.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,e),!0)},t.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},t.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},t.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},t.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},t.doTick=function(){},e}()},"./src/types/cmcd.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{CMCDObjectType:function(){return r},CMCDStreamType:function(){return o},CMCDStreamingFormat:function(){return a},CMCDVersion:function(){return c}});var r,i,a,s,o,u,c=1;(i=r||(r={})).MANIFEST="m",i.AUDIO="a",i.VIDEO="v",i.MUXED="av",i.INIT="i",i.CAPTION="c",i.TIMED_TEXT="tt",i.KEY="k",i.OTHER="o",(s=a||(a={})).DASH="d",s.HLS="h",s.SMOOTH="s",s.OTHER="o",(u=o||(o={})).VOD="v",u.LIVE="l"},"./src/types/demuxer.ts":function(e,t,n){"use strict";var r,i;n.r(t),n.d(t,{MetadataSchema:function(){return r}}),(i=r||(r={})).audioId3="org.id3",i.dateRange="com.apple.quicktime.HLS",i.emsg="https://aomedia.org/emsg/ID3"},"./src/types/level.ts":function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function i(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}n.r(t),n.d(t,{HdcpLevels:function(){return o},HlsSkip:function(){return a},HlsUrlParameters:function(){return c},Level:function(){return l},getSkipValue:function(){return u}});var a,s,o=["NONE","TYPE-0","TYPE-1","TYPE-2",null];function u(e,t){var n=e.canSkipUntil,r=e.canSkipDateRanges,i=e.endSN;return n&&(void 0!==t?t-i:0)<n?r?a.v2:a.Yes:a.No}(s=a||(a={})).No="",s.Yes="YES",s.v2="v2";var c=function(){function e(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}return e.prototype.addDirectives=function(e){var t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href},e}(),l=function(){function e(e){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this.attrs=e.attrs,this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter((function(e){return e})).join(",").replace(/\.[^.,]+/g,"")}var t,n,i;return t=e,(n=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(e){var t=e%this.url.length;this._urlId!==t&&(this.details=void 0,this._urlId=t)}}])&&r(t.prototype,n),i&&r(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}()},"./src/types/loader.ts":function(e,t,n){"use strict";var r,i,a,s;n.r(t),n.d(t,{PlaylistContextType:function(){return r},PlaylistLevelType:function(){return a}}),(i=r||(r={})).MANIFEST="manifest",i.LEVEL="level",i.AUDIO_TRACK="audioTrack",i.SUBTITLE_TRACK="subtitleTrack",(s=a||(a={})).MAIN="main",s.AUDIO="audio",s.SUBTITLE="subtitle"},"./src/types/transmuxer.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{ChunkMetadata:function(){return r}});var r=function(e,t,n,r,i,a){void 0===r&&(r=0),void 0===i&&(i=-1),void 0===a&&(a=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=n,this.size=r,this.part=i,this.partial=a}},"./src/utils/attr-list.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{AttrList:function(){return a}});var r=/^(\d+)x(\d+)$/,i=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,a=function(){function e(t){for(var n in"string"===typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(n)&&(this[n]=t[n])}var t=e.prototype;return t.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var n=new Uint8Array(t.length/2),r=0;r<t.length/2;r++)n[r]=parseInt(t.slice(2*r,2*r+2),16);return n}return null},t.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.decimalFloatingPoint=function(e){return parseFloat(this[e])},t.optionalFloat=function(e,t){var n=this[e];return n?parseFloat(n):t},t.enumeratedString=function(e){return this[e]},t.bool=function(e){return"YES"===this[e]},t.decimalResolution=function(e){var t=r.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t,n={};for(i.lastIndex=0;null!==(t=i.exec(e));){var r=t[2];0===r.indexOf('"')&&r.lastIndexOf('"')===r.length-1&&(r=r.slice(1,-1)),n[t[1]]=r}return n},e}()},"./src/utils/binary-search.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return r}});var r={search:function(e,t){for(var n=0,r=e.length-1,i=null,a=null;n<=r;){var s=t(a=e[i=(n+r)/2|0]);if(s>0)n=i+1;else{if(!(s<0))return a;r=i-1}}return null}}},"./src/utils/buffer-helper.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{BufferHelper:function(){return a}});var r=n("./src/utils/logger.ts"),i={length:0,start:function(){return 0},end:function(){return 0}},a=function(){function e(){}return e.isBuffered=function(t,n){try{if(t)for(var r=e.getBuffered(t),i=0;i<r.length;i++)if(n>=r.start(i)&&n<=r.end(i))return!0}catch(a){}return!1},e.bufferInfo=function(t,n,r){try{if(t){var i,a=e.getBuffered(t),s=[];for(i=0;i<a.length;i++)s.push({start:a.start(i),end:a.end(i)});return this.bufferedInfo(s,n,r)}}catch(o){}return{len:0,start:n,end:n,nextStart:void 0}},e.bufferedInfo=function(e,t,n){t=Math.max(0,t),e.sort((function(e,t){var n=e.start-t.start;return n||t.end-e.end}));var r=[];if(n)for(var i=0;i<e.length;i++){var a=r.length;if(a){var s=r[a-1].end;e[i].start-s<n?e[i].end>s&&(r[a-1].end=e[i].end):r.push(e[i])}else r.push(e[i])}else r=e;for(var o,u=0,c=t,l=t,d=0;d<r.length;d++){var f=r[d].start,h=r[d].end;if(t+n>=f&&t<h)c=f,u=(l=h)-t;else if(t+n<f){o=f;break}}return{len:u,start:c||0,end:l||0,nextStart:o}},e.getBuffered=function(e){try{return e.buffered}catch(t){return r.logger.log("failed to get media.buffered",t),i}},e}()},"./src/utils/cea-608-parser.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{CaptionScreen:function(){return b},Row:function(){return y},default:function(){return S}});var r,i=n("./src/utils/logger.ts"),a={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},s=function(e){var t=e;return a.hasOwnProperty(e)&&(t=a[e]),String.fromCharCode(t)},o=15,u=100,c={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},l={17:2,18:4,21:6,22:8,23:10,19:13,20:15},d={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},f={25:2,26:4,29:6,30:8,31:10,27:13,28:15},h=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];!function(e){e[e.ERROR=0]="ERROR",e[e.TEXT=1]="TEXT",e[e.WARNING=2]="WARNING",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG",e[e.DATA=3]="DATA"}(r||(r={}));var p=function(){function e(){this.time=null,this.verboseLevel=r.ERROR}return e.prototype.log=function(e,t){if(this.verboseLevel>=e){var n="function"===typeof t?t():t;i.logger.log(this.time+" ["+e+"] "+n)}},e}(),v=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].toString(16));return t},g=function(){function e(e,t,n,r,i){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=n||!1,this.background=r||"black",this.flash=i||!1}var t=e.prototype;return t.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],n=0;n<t.length;n++){var r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}},t.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},t.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},t.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},t.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),m=function(){function e(e,t,n,r,i,a){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new g(t,n,r,i,a)}var t=e.prototype;return t.reset=function(){this.uchar=" ",this.penState.reset()},t.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},t.setPenState=function(e){this.penState.copy(e)},t.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},t.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},t.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},e}(),y=function(){function e(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var t=0;t<u;t++)this.chars.push(new m);this.logger=e,this.pos=0,this.currPenState=new g}var t=e.prototype;return t.equals=function(e){for(var t=!0,n=0;n<u;n++)if(!this.chars[n].equals(e.chars[n])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<u;t++)this.chars[t].copy(e.chars[t])},t.isEmpty=function(){for(var e=!0,t=0;t<u;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},t.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(r.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>u&&(this.logger.log(r.DEBUG,"Too large cursor position "+this.pos),this.pos=u)},t.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)},t.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.insertChar=function(e){var t=this;e>=144&&this.backSpace();var n=s(e);this.pos>=u?this.logger.log(r.ERROR,(function(){return"Cannot insert "+e.toString(16)+" ("+n+") at position "+t.pos+". Skipping it!"})):(this.chars[this.pos].setChar(n,this.currPenState),this.moveCursor(1))},t.clearFromPos=function(e){var t;for(t=e;t<u;t++)this.chars[t].reset()},t.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.getTextString=function(){for(var e=[],t=!0,n=0;n<u;n++){var r=this.chars[n].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")},t.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},e}(),b=function(){function e(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var t=0;t<o;t++)this.rows.push(new y(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var t=e.prototype;return t.reset=function(){for(var e=0;e<o;e++)this.rows[e].clear();this.currRow=14},t.equals=function(e){for(var t=!0,n=0;n<o;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<o;t++)this.rows[t].copy(e.rows[t])},t.isEmpty=function(){for(var e=!0,t=0;t<o;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},t.backSpace=function(){this.rows[this.currRow].backSpace()},t.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},t.insertChar=function(e){this.rows[this.currRow].insertChar(e)},t.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},t.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},t.setCursor=function(e){this.logger.log(r.INFO,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},t.setPAC=function(e){this.logger.log(r.INFO,(function(){return"pacData = "+JSON.stringify(e)}));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var n=0;n<o;n++)this.rows[n].clear();var i=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){var s=a.rows[i].cueStartTime,u=this.logger.time;if(s&&null!==u&&s<u)for(var c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(a.rows[i+c])}}this.currRow=t;var l=this.rows[this.currRow];if(null!==e.indent){var d=e.indent,f=Math.max(d-1,0);l.setCursor(e.indent),e.color=l.chars[f].penState.foreground}var h={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(h)},t.setBkgData=function(e){this.logger.log(r.INFO,(function(){return"bkgData = "+JSON.stringify(e)})),this.backSpace(),this.setPen(e),this.insertChar(32)},t.setRollUpRows=function(e){this.nrRollUpRows=e},t.rollUp=function(){var e=this;if(null!==this.nrRollUpRows){this.logger.log(r.TEXT,(function(){return e.getDisplayText()}));var t=this.currRow+1-this.nrRollUpRows,n=this.rows.splice(t,1)[0];n.clear(),this.rows.splice(this.currRow,0,n),this.logger.log(r.INFO,"Rolling up")}else this.logger.log(r.DEBUG,"roll_up but nrRollUpRows not set yet")},t.getDisplayText=function(e){e=e||!1;for(var t=[],n="",r=-1,i=0;i<o;i++){var a=this.rows[i].getTextString();a&&(r=i+1,e?t.push("Row "+r+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n},t.getTextAndFormat=function(){return this.rows},e}(),k=function(){function e(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new b(n),this.nonDisplayedMemory=new b(n),this.lastOutputScreen=new b(n),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}var t=e.prototype;return t.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},t.getHandler=function(){return this.outputFilter},t.setHandler=function(e){this.outputFilter=e},t.setPAC=function(e){this.writeScreen.setPAC(e)},t.setBkgData=function(e){this.writeScreen.setBkgData(e)},t.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(r.INFO,(function(){return"MODE="+e})),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},t.insertChars=function(e){for(var t=this,n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(r.INFO,(function(){return i+": "+t.writeScreen.getDisplayText(!0)})),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(r.TEXT,(function(){return"DISPLAYED: "+t.displayedMemory.getDisplayText(!0)})),this.outputDataUpdate())},t.ccRCL=function(){this.logger.log(r.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.ccBS=function(){this.logger.log(r.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.ccAOF=function(){},t.ccAON=function(){},t.ccDER=function(){this.logger.log(r.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.ccRU=function(e){this.logger.log(r.INFO,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},t.ccFON=function(){this.logger.log(r.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.ccRDC=function(){this.logger.log(r.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.ccTR=function(){this.logger.log(r.INFO,"TR"),this.setMode("MODE_TEXT")},t.ccRTD=function(){this.logger.log(r.INFO,"RTD"),this.setMode("MODE_TEXT")},t.ccEDM=function(){this.logger.log(r.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.ccCR=function(){this.logger.log(r.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.ccENM=function(){this.logger.log(r.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.ccEOC=function(){var e=this;if(this.logger.log(r.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(r.TEXT,(function(){return"DISP: "+e.displayedMemory.getDisplayText()}))}this.outputDataUpdate(!0)},t.ccTO=function(e){this.logger.log(r.INFO,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},t.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{var n=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][n]}this.logger.log(r.INFO,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},t.outputDataUpdate=function(e){void 0===e&&(e=!1);var t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},t.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},e}();function T(e,t,n){n.a=e,n.b=t}function E(e,t,n){return n.a===e&&n.b===t}var S=function(){function e(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var r=new p;this.channels=[null,new k(e,t,r),new k(e+1,n,r)],this.cmdHistory={a:null,b:null},this.logger=r}var t=e.prototype;return t.getHandler=function(e){return this.channels[e].getHandler()},t.setHandler=function(e,t){this.channels[e].setHandler(t)},t.addData=function(e,t){var n,i,a,s=!1;this.logger.time=e;for(var o=0;o<t.length;o+=2)if(i=127&t[o],a=127&t[o+1],0!==i||0!==a){if(this.logger.log(r.DATA,"["+v([t[o],t[o+1]])+"] -> ("+v([i,a])+")"),(n=this.parseCmd(i,a))||(n=this.parseMidrow(i,a)),n||(n=this.parsePAC(i,a)),n||(n=this.parseBackgroundAttributes(i,a)),!n&&(s=this.parseChars(i,a))){var u=this.currentChannel;u&&u>0?this.channels[u].insertChars(s):this.logger.log(r.WARNING,"No channel found yet. TEXT-MODE?")}n||s||this.logger.log(r.WARNING,"Couldn't parse cleaned data "+v([i,a])+" orig: "+v([t[o],t[o+1]]))}},t.parseCmd=function(e,t){var n=this.cmdHistory;if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;if(E(e,t,n))return T(null,null,n),this.logger.log(r.DEBUG,"Repeated command ("+v([e,t])+") is dropped"),!0;var i=20===e||21===e||23===e?1:2,a=this.channels[i];return 20===e||21===e||28===e||29===e?32===t?a.ccRCL():33===t?a.ccBS():34===t?a.ccAOF():35===t?a.ccAON():36===t?a.ccDER():37===t?a.ccRU(2):38===t?a.ccRU(3):39===t?a.ccRU(4):40===t?a.ccFON():41===t?a.ccRDC():42===t?a.ccTR():43===t?a.ccRTD():44===t?a.ccEDM():45===t?a.ccCR():46===t?a.ccENM():47===t&&a.ccEOC():a.ccTO(t-32),T(e,t,n),this.currentChannel=i,!0},t.parseMidrow=function(e,t){var n=0;if((17===e||25===e)&&t>=32&&t<=47){if((n=17===e?1:2)!==this.currentChannel)return this.logger.log(r.ERROR,"Mismatch channel in midrow parsing"),!1;var i=this.channels[n];return!!i&&(i.ccMIDROW(t),this.logger.log(r.DEBUG,"MIDROW ("+v([e,t])+")"),!0)}return!1},t.parsePAC=function(e,t){var n,r=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;if(E(e,t,r))return T(null,null,r),!0;var i=e<=23?1:2;n=t>=64&&t<=95?1===i?c[e]:d[e]:1===i?l[e]:f[e];var a=this.channels[i];return!!a&&(a.setPAC(this.interpretPAC(n,t)),T(e,t,r),this.currentChannel=i,!0)},t.interpretPAC=function(e,t){var n,r={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,r.underline=1===(1&n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r},t.parseChars=function(e,t){var n,i,a=null,o=null;if(e>=25?(n=2,o=e-8):(n=1,o=e),o>=17&&o<=19?(i=17===o?t+80:18===o?t+112:t+144,this.logger.log(r.INFO,"Special char '"+s(i)+"' in channel "+n),a=[i]):e>=32&&e<=127&&(a=0===t?[e]:[e,t]),a){var u=v(a);this.logger.log(r.DEBUG,"Char codes =  "+u.join(",")),T(e,t,this.cmdHistory)}return a},t.parseBackgroundAttributes=function(e,t){var n;if(!((16===e||24===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=45&&t<=47))return!1;var r={};16===e||24===e?(n=Math.floor((t-32)/2),r.background=h[n],t%2===1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0));var i=e<=23?1:2;return this.channels[i].setBkgData(r),T(e,t,this.cmdHistory),!0},t.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}},t.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++){var n=this.channels[t];n&&n.cueSplitAtTime(e)}},e}()},"./src/utils/codecs.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{isCodecSupportedInMp4:function(){return a},isCodecType:function(){return i}});var r={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function i(e,t){var n=r[t];return!!n&&!0===n[e.slice(0,4)]}function a(e,t){return MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}},"./src/utils/cues.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var r=n("./src/utils/vttparser.ts"),i=n("./src/utils/webvtt-parser.ts"),a=n("./src/utils/texttrack-utils.ts"),s=/\s/,o={newCue:function(e,t,n,o){for(var u,c,l,d,f,h=[],p=self.VTTCue||self.TextTrackCue,v=0;v<o.rows.length;v++)if(l=!0,d=0,f="",!(u=o.rows[v]).isEmpty()){for(var g=0;g<u.chars.length;g++)s.test(u.chars[g].uchar)&&l?d++:(f+=u.chars[g].uchar,l=!1);u.cueStartTime=t,t===n&&(n+=1e-4),d>=16?d--:d++;var m=(0,r.fixLineBreaks)(f.trim()),y=(0,i.generateCueId)(t,n,m);e&&e.cues&&e.cues.getCueById(y)||((c=new p(t,n,m)).id=y,c.line=v+1,c.align="left",c.position=10+Math.min(80,10*Math.floor(8*d/32)),h.push(c))}return e&&h.length&&(h.sort((function(e,t){return"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line})),h.forEach((function(t){return(0,a.addCueToTrack)(e,t)}))),h}}},"./src/utils/discontinuities.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{adjustSlidingStart:function(){return l},alignMediaPlaylistByPDT:function(){return h},alignPDT:function(){return f},alignStream:function(){return d},findDiscontinuousReferenceFrag:function(){return u},findFirstFragWithCC:function(){return s},shouldAlignOnDiscontinuities:function(){return o}});var r=n("./src/polyfills/number.ts"),i=n("./src/utils/logger.ts"),a=n("./src/controller/level-helper.ts");function s(e,t){for(var n=null,r=0,i=e.length;r<i;r++){var a=e[r];if(a&&a.cc===t){n=a;break}}return n}function o(e,t,n){return!(!t.details||!(n.endCC>n.startCC||e&&e.cc<n.startCC))}function u(e,t,n){void 0===n&&(n=0);var r=e.fragments,a=t.fragments;if(a.length&&r.length){var o=s(r,a[0].cc);if(o&&(!o||o.startPTS))return o;i.logger.log("No frag in previous level to align on")}else i.logger.log("No fragments to align")}function c(e,t){if(e){var n=e.start+t;e.start=e.startPTS=n,e.endPTS=n+e.duration}}function l(e,t){for(var n=t.fragments,r=0,i=n.length;r<i;r++)c(n[r],e);t.fragmentHint&&c(t.fragmentHint,e),t.alignedSliding=!0}function d(e,t,n){t&&(function(e,t,n){if(o(e,n,t)){var a=u(n.details,t);a&&(0,r.isFiniteNumber)(a.start)&&(i.logger.log("Adjusting PTS using last level due to CC increase within current level "+t.url),l(a.start,t))}}(e,n,t),!n.alignedSliding&&t.details&&f(n,t.details),n.alignedSliding||!t.details||n.skippedSegments||(0,a.adjustSliding)(t.details,n))}function f(e,t){if(t.fragments.length&&e.hasProgramDateTime&&t.hasProgramDateTime){var n=t.fragments[0].programDateTime,a=e.fragments[0].programDateTime,s=(a-n)/1e3+t.fragments[0].start;s&&(0,r.isFiniteNumber)(s)&&(i.logger.log("Adjusting PTS using programDateTime delta "+(a-n)+"ms, sliding:"+s.toFixed(3)+" "+e.url+" "),l(s,e))}}function h(e,t){if(e.hasProgramDateTime&&t.hasProgramDateTime){var n=e.fragments,r=t.fragments;if(n.length&&r.length){var i=r[Math.round(r.length/2)-1],a=s(n,i.cc)||n[Math.round(n.length/2)-1],o=i.programDateTime,u=a.programDateTime;null!==o&&null!==u&&l((u-o)/1e3-(a.start-i.start),e)}}}},"./src/utils/ewma-bandwidth-estimator.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return i}});var r=n("./src/utils/ewma.ts"),i=function(){function e(e,t,n){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new r.default(e),this.fast_=new r.default(t)}var t=e.prototype;return t.update=function(e,t){var n=this.slow_,i=this.fast_;this.slow_.halfLife!==e&&(this.slow_=new r.default(e,n.getEstimate(),n.getTotalWeight())),this.fast_.halfLife!==t&&(this.fast_=new r.default(t,i.getEstimate(),i.getTotalWeight()))},t.sample=function(e,t){var n=(e=Math.max(e,this.minDelayMs_))/1e3,r=8*t/n;this.fast_.sample(n,r),this.slow_.sample(n,r)},t.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},t.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.destroy=function(){},e}()},"./src/utils/ewma.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return r}});var r=function(){function e(e,t,n){void 0===t&&(t=0),void 0===n&&(n=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}var t=e.prototype;return t.sample=function(e,t){var n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e},t.getTotalWeight=function(){return this.totalWeight_},t.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_},e}()},"./src/utils/fetch-loader.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return g},fetchSupported:function(){return f}});var r=n("./src/polyfills/number.ts"),i=n("./src/loader/load-stats.ts"),a=n("./src/demux/chunk-cache.ts");function s(e){var t="function"===typeof Map?new Map:void 0;return s=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return o(e,arguments,l(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),c(r,e)},s(e)}function o(e,t,n){return o=u()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&c(i,n.prototype),i},o.apply(null,arguments)}function u(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},d.apply(this,arguments)}function f(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}var h=function(){function e(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||p,this.controller=new self.AbortController,this.stats=new i.LoadStats}var t=e.prototype;return t.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},t.abortInternal=function(){var e=this.response;e&&e.ok||(this.stats.aborted=!0,this.controller.abort())},t.abort=function(){var e;this.abortInternal(),null!==(e=this.callbacks)&&void 0!==e&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},t.load=function(e,t,n){var i=this,a=this.stats;if(a.loading.start)throw new Error("Loader can only be used once.");a.loading.start=self.performance.now();var s=function(e,t){var n={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(d({},e.headers))};return e.rangeEnd&&n.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1)),n}(e,this.controller.signal),o=n.onProgress,u="arraybuffer"===e.responseType,c=u?"byteLength":"length";this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout((function(){i.abortInternal(),n.onTimeout(a,e,i.response)}),t.timeout),self.fetch(this.request).then((function(n){if(i.response=i.loader=n,!n.ok){var s=n.status,c=n.statusText;throw new v(c||"fetch, bad network response",s,n)}return a.loading.first=Math.max(self.performance.now(),a.loading.start),a.total=parseInt(n.headers.get("Content-Length")||"0"),o&&(0,r.isFiniteNumber)(t.highWaterMark)?i.loadProgressively(n,a,e,t.highWaterMark,o):u?n.arrayBuffer():n.text()})).then((function(s){var u=i.response;self.clearTimeout(i.requestTimeout),a.loading.end=Math.max(self.performance.now(),a.loading.first);var l=s[c];l&&(a.loaded=a.total=l);var d={url:u.url,data:s};o&&!(0,r.isFiniteNumber)(t.highWaterMark)&&o(a,e,s,u),n.onSuccess(d,a,e,u)})).catch((function(t){if(self.clearTimeout(i.requestTimeout),!a.aborted){var r=t&&t.code||0,s=t?t.message:null;n.onError({code:r,text:s},e,t?t.details:null)}}))},t.getCacheAge=function(){var e=null;if(this.response){var t=this.response.headers.get("age");e=t?parseFloat(t):null}return e},t.loadProgressively=function(e,t,n,r,i){void 0===r&&(r=0);var s=new a.default,o=e.body.getReader();return function a(){return o.read().then((function(o){if(o.done)return s.dataLength&&i(t,n,s.flush(),e),Promise.resolve(new ArrayBuffer(0));var u=o.value,c=u.length;return t.loaded+=c,c<r||s.dataLength?(s.push(u),s.dataLength>=r&&i(t,n,s.flush(),e)):i(t,n,u,e),a()})).catch((function(){return Promise.reject()}))}()},e}();function p(e,t){return new self.Request(e.url,t)}var v=function(e){var t,n;function r(t,n,r){var i;return(i=e.call(this,t)||this).code=void 0,i.details=void 0,i.code=n,i.details=r,i}return n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,c(t,n),r}(s(Error)),g=h},"./src/utils/hex.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return r}});var r={hexDump:function(e){for(var t="",n=0;n<e.length;n++){var r=e[n].toString(16);r.length<2&&(r="0"+r),t+=r}return t}}},"./src/utils/imsc1-ttml-parser.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{IMSC1_CODEC:function(){return l},parseIMSC1:function(){return p}});var r=n("./src/utils/mp4-tools.ts"),i=n("./src/utils/vttparser.ts"),a=n("./src/utils/vttcue.ts"),s=n("./src/demux/id3.ts"),o=n("./src/utils/timescale-conversion.ts"),u=n("./src/utils/webvtt-parser.ts");function c(){return c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c.apply(this,arguments)}var l="stpp.ttml.im1t",d=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,f=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,h={left:"start",center:"center",right:"end",start:"start",end:"end"};function p(e,t,n,i,l){var d=(0,r.findBox)(new Uint8Array(e),["mdat"]);if(0!==d.length){var f=d.map((function(e){return(0,s.utf8ArrayToStr)(e)})),p=(0,o.toTimescaleFromScale)(t,1,n);try{f.forEach((function(e){return i(function(e,t){var n=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");var r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},i=Object.keys(r).reduce((function(e,t){return e[t]=n.getAttribute("ttp:"+t)||r[t],e}),{}),s="preserve"!==n.getAttribute("xml:space"),o=g(v(n,"styling","style")),l=g(v(n,"layout","region")),d=v(n,"body","[begin]");return[].map.call(d,(function(e){var n=m(e,s);if(!n||!e.hasAttribute("begin"))return null;var r=k(e.getAttribute("begin"),i),d=k(e.getAttribute("dur"),i),f=k(e.getAttribute("end"),i);if(null===r)throw b(e);if(null===f){if(null===d)throw b(e);f=r+d}var p=new a.default(r-t,f-t,n);p.id=(0,u.generateCueId)(p.startTime,p.endTime,p.text);var v=function(e,t,n){var r="http://www.w3.org/ns/ttml#styling",i=null,a=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],s=null!==e&&void 0!==e&&e.hasAttribute("style")?e.getAttribute("style"):null;return s&&n.hasOwnProperty(s)&&(i=n[s]),a.reduce((function(n,a){var s=y(t,r,a)||y(e,r,a)||y(i,r,a);return s&&(n[a]=s),n}),{})}(l[e.getAttribute("region")],o[e.getAttribute("style")],o),g=v.textAlign;if(g){var T=h[g];T&&(p.lineAlign=T),p.align=g}return c(p,v),p})).filter((function(e){return null!==e}))}(e,p))}))}catch(T){l(T)}}else l(new Error("Could not parse IMSC1 mdat"))}function v(e,t,n){var r=e.getElementsByTagName(t)[0];return r?[].slice.call(r.querySelectorAll(n)):[]}function g(e){return e.reduce((function(e,t){var n=t.getAttribute("xml:id");return n&&(e[n]=t),e}),{})}function m(e,t){return[].slice.call(e.childNodes).reduce((function(e,n,r){var i;return"br"===n.nodeName&&r?e+"\n":null!==(i=n.childNodes)&&void 0!==i&&i.length?m(n,t):t?e+n.textContent.trim().replace(/\s+/g," "):e+n.textContent}),"")}function y(e,t,n){return e&&e.hasAttributeNS(t,n)?e.getAttributeNS(t,n):null}function b(e){return new Error("Could not parse ttml timestamp "+e)}function k(e,t){if(!e)return null;var n=(0,i.parseTimeStamp)(e);return null===n&&(d.test(e)?n=function(e,t){var n=d.exec(e),r=(0|n[4])+(0|n[5])/t.subFrameRate;return 3600*(0|n[1])+60*(0|n[2])+(0|n[3])+r/t.frameRate}(e,t):f.test(e)&&(n=function(e,t){var n=f.exec(e),r=Number(n[1]);switch(n[2]){case"h":return 3600*r;case"m":return 60*r;case"ms":return 1e3*r;case"f":return r/t.frameRate;case"t":return r/t.tickRate}return r}(e,t))),n}},"./src/utils/keysystem-util.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{changeEndianness:function(){return i},convertDataUriToArrayBytes:function(){return a},strToUtf8array:function(){return s}});var r=n("./src/utils/numeric-encoding-utils.ts");function i(e){var t=function(e,t,n){var r=e[t];e[t]=e[n],e[n]=r};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}function a(e){var t=e.split(":"),n=null;if("data"===t[0]&&2===t.length){var i=t[1].split(";"),a=i[i.length-1].split(",");if(2===a.length){var o="base64"===a[0],u=a[1];o?(i.splice(-1,1),n=(0,r.base64Decode)(u)):n=function(e){var t=s(e).subarray(0,16),n=new Uint8Array(16);return n.set(t,16-t.length),n}(u)}}return n}function s(e){return Uint8Array.from(unescape(encodeURIComponent(e)),(function(e){return e.charCodeAt(0)}))}},"./src/utils/logger.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{enableLogs:function(){return o},logger:function(){return u}});var r=function(){},i={trace:r,debug:r,log:r,warn:r,info:r,error:r},a=i;function s(e){var t=self.console[e];return t?t.bind(self.console,"["+e+"] >"):r}function o(e,t){if(self.console&&!0===e||"object"===typeof e){!function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.forEach((function(t){a[t]=e[t]?e[t].bind(e):s(t)}))}(e,"debug","log","info","warn","error");try{a.log('Debug logs enabled for "'+t+'"')}catch(n){a=i}}else a=i}var u=i},"./src/utils/mediakeys-helper.ts":function(e,t,n){"use strict";var r,i,a,s,o;function u(e){switch(e){case a.FAIRPLAY:return r.FAIRPLAY;case a.PLAYREADY:return r.PLAYREADY;case a.WIDEVINE:return r.WIDEVINE;case a.CLEARKEY:return r.CLEARKEY}}function c(e){if(e===o.WIDEVINE)return r.WIDEVINE}function l(e){switch(e){case r.FAIRPLAY:return a.FAIRPLAY;case r.PLAYREADY:return a.PLAYREADY;case r.WIDEVINE:return a.WIDEVINE;case r.CLEARKEY:return a.CLEARKEY}}function d(e){var t=e.drmSystems,n=e.widevineLicenseUrl,i=t?[r.FAIRPLAY,r.WIDEVINE,r.PLAYREADY,r.CLEARKEY].filter((function(e){return!!t[e]})):[];return!i[r.WIDEVINE]&&n&&i.push(r.WIDEVINE),i}n.r(t),n.d(t,{KeySystemFormats:function(){return a},KeySystemIds:function(){return o},KeySystems:function(){return r},getKeySystemsForConfig:function(){return d},getSupportedMediaKeySystemConfigurations:function(){return h},keySystemDomainToKeySystemFormat:function(){return l},keySystemFormatToKeySystemDomain:function(){return u},keySystemIdToKeySystemDomain:function(){return c},requestMediaKeySystemAccess:function(){return f}}),(i=r||(r={})).CLEARKEY="org.w3.clearkey",i.FAIRPLAY="com.apple.fps",i.PLAYREADY="com.microsoft.playready",i.WIDEVINE="com.widevine.alpha",(s=a||(a={})).CLEARKEY="org.w3.clearkey",s.FAIRPLAY="com.apple.streamingkeydelivery",s.PLAYREADY="com.microsoft.playready",s.WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",(o||(o={})).WIDEVINE="edef8ba979d64acea3c827dcd51d21ed";var f="undefined"!==typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function h(e,t,n,i){var a;switch(e){case r.FAIRPLAY:a=["cenc","sinf"];break;case r.WIDEVINE:case r.PLAYREADY:a=["cenc"];break;case r.CLEARKEY:a=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+e)}return function(e,t,n,r){return[{initDataTypes:e,persistentState:r.persistentState||"not-allowed",distinctiveIdentifier:r.distinctiveIdentifier||"not-allowed",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:t.map((function(e){return{contentType:'audio/mp4; codecs="'+e+'"',robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null}})),videoCapabilities:n.map((function(e){return{contentType:'video/mp4; codecs="'+e+'"',robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}}))}]}(a,t,n,i)}},"./src/utils/mediasource-helper.ts":function(e,t,n){"use strict";function r(){return self.MediaSource||self.WebKitMediaSource}n.r(t),n.d(t,{getMediaSource:function(){return r}})},"./src/utils/mp4-tools.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{RemuxerTrackIdConfig:function(){return l},appendUint8Array:function(){return R},bin2str:function(){return d},computeRawDurationFromSamples:function(){return S},discardEPB:function(){return P},findBox:function(){return g},getDuration:function(){return E},getStartDTS:function(){return T},mp4Box:function(){return D},mp4pssh:function(){return L},offsetStartDTS:function(){return w},parseEmsg:function(){return _},parseInitSegment:function(){return y},parsePssh:function(){return O},parseSEIMessageFromNALu:function(){return I},parseSamples:function(){return C},parseSegmentIndex:function(){return m},parseSinf:function(){return k},patchEncyptionData:function(){return b},readSint32:function(){return p},readUint16:function(){return f},readUint32:function(){return h},segmentValidRange:function(){return x},writeUint32:function(){return v}});var r=n("./src/loader/fragment.ts"),i=n("./src/utils/typed-array.ts"),a=n("./src/demux/id3.ts"),s=n("./src/utils/logger.ts"),o=n("./src/utils/hex.ts"),u=Math.pow(2,32)-1,c=[].push,l={video:1,audio:2,id3:3,text:4};function d(e){return String.fromCharCode.apply(null,e)}function f(e,t){var n=e[t]<<8|e[t+1];return n<0?65536+n:n}function h(e,t){var n=p(e,t);return n<0?4294967296+n:n}function p(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function v(e,t,n){e[t]=n>>24,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n}function g(e,t){var n=[];if(!t.length)return n;for(var r=e.byteLength,i=0;i<r;){var a=h(e,i),s=a>1?i+a:r;if(d(e.subarray(i+4,i+8))===t[0])if(1===t.length)n.push(e.subarray(i+8,s));else{var o=g(e.subarray(i+8,s),t.slice(1));o.length&&c.apply(n,o)}i=s}return n}function m(e){var t=[],n=e[0],r=8,i=h(e,r);r+=4,r+=0===n?8:16,r+=2;var a=e.length+0,s=f(e,r);r+=2;for(var o=0;o<s;o++){var u=r,c=h(e,u);u+=4;var l=2147483647&c;if(1===(2147483648&c)>>>31)return console.warn("SIDX has hierarchical references (not supported)"),null;var d=h(e,u);u+=4,t.push({referenceSize:l,subsegmentDuration:d,info:{duration:d/i,start:a,end:a+l-1}}),a+=l,r=u+=4}return{earliestPresentationTime:0,timescale:i,version:n,referencesCount:s,references:t}}function y(e){for(var t=[],n=g(e,["moov","trak"]),i=0;i<n.length;i++){var a=n[i],s=g(a,["tkhd"])[0];if(s){var o=s[0],u=0===o?12:20,c=h(s,u),l=g(a,["mdia","mdhd"])[0];if(l){var f=h(l,u=0===(o=l[0])?12:20),p=g(a,["mdia","hdlr"])[0];if(p){var v=d(p.subarray(8,12)),m={soun:r.ElementaryStreamTypes.AUDIO,vide:r.ElementaryStreamTypes.VIDEO}[v];if(m){var y=g(a,["mdia","minf","stbl","stsd"])[0],b=void 0;y&&(b=d(y.subarray(12,16))),t[c]={timescale:f,type:m},t[m]={timescale:f,id:c,codec:b}}}}}}return g(e,["moov","mvex","trex"]).forEach((function(e){var n=h(e,4),r=t[n];r&&(r.default={duration:h(e,12),flags:h(e,20)})})),t}function b(e,t){if(!e||!t)return e;var n=t.keyId;return n&&t.isCommonEncryption&&g(e,["moov","trak"]).forEach((function(e){var t=g(e,["mdia","minf","stbl","stsd"])[0].subarray(8),r=g(t,["enca"]),i=r.length>0;i||(r=g(t,["encv"])),r.forEach((function(e){g(i?e.subarray(28):e.subarray(78),["sinf"]).forEach((function(e){var t=k(e);if(t){var r=t.subarray(8,24);r.some((function(e){return 0!==e}))||(s.logger.log("[eme] Patching keyId in 'enc"+(i?"a":"v")+">sinf>>tenc' box: "+o.default.hexDump(r)+" -> "+o.default.hexDump(n)),t.set(n,8))}}))}))})),e}function k(e){var t=g(e,["schm"])[0];if(t){var n=d(t.subarray(4,8));if("cbcs"===n||"cenc"===n)return g(e,["schi","tenc"])[0]}return s.logger.error("[eme] missing 'schm' box"),null}function T(e,t){return g(t,["moof","traf"]).reduce((function(t,n){var r=g(n,["tfdt"])[0],i=r[0],a=g(n,["tfhd"]).reduce((function(t,n){var a=h(n,4),s=e[a];if(s){var o=h(r,4);1===i&&(o*=Math.pow(2,32),o+=h(r,8));var u=o/(s.timescale||9e4);if(isFinite(u)&&(null===t||u<t))return u}return t}),null);return null!==a&&isFinite(a)&&(null===t||a<t)?a:t}),null)||0}function E(e,t){for(var n=0,i=0,a=0,s=g(e,["moof","traf"]),o=0;o<s.length;o++){var u=s[o],c=g(u,["tfhd"])[0],l=t[h(c,4)];if(l){var d=l.default,f=h(c,0)|(null===d||void 0===d?void 0:d.flags),p=null===d||void 0===d?void 0:d.duration;8&f&&(p=h(c,2&f?12:8));for(var v=l.timescale||9e4,y=g(u,["trun"]),b=0;b<y.length;b++)!(n=S(y[b]))&&p&&(n=p*h(y[b],4)),l.type===r.ElementaryStreamTypes.VIDEO?i+=n/v:l.type===r.ElementaryStreamTypes.AUDIO&&(a+=n/v)}}if(0===i&&0===a){for(var k=0,T=g(e,["sidx"]),E=0;E<T.length;E++){var w=m(T[E]);null!==w&&void 0!==w&&w.references&&(k+=w.references.reduce((function(e,t){return e+t.info.duration||0}),0))}return k}return i||a}function S(e){var t=h(e,0),n=8;1&t&&(n+=4),4&t&&(n+=4);for(var r=0,i=h(e,4),a=0;a<i;a++)256&t&&(r+=h(e,n),n+=4),512&t&&(n+=4),1024&t&&(n+=4),2048&t&&(n+=4);return r}function w(e,t,n){g(t,["moof","traf"]).forEach((function(t){g(t,["tfhd"]).forEach((function(r){var i=h(r,4),a=e[i];if(a){var s=a.timescale||9e4;g(t,["tfdt"]).forEach((function(e){var t=e[0],r=h(e,4);if(0===t)r-=n*s,v(e,4,r=Math.max(r,0));else{r*=Math.pow(2,32),r+=h(e,8),r-=n*s,r=Math.max(r,0);var i=Math.floor(r/(u+1)),a=Math.floor(r%(u+1));v(e,4,i),v(e,8,a)}}))}}))}))}function x(e){var t={valid:null,remainder:null},n=g(e,["moof"]);if(!n)return t;if(n.length<2)return t.remainder=e,t;var r=n[n.length-1];return t.valid=(0,i.sliceUint8)(e,0,r.byteOffset-8),t.remainder=(0,i.sliceUint8)(e,r.byteOffset-8),t}function R(e,t){var n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function C(e,t){var n=[],i=t.samples,a=t.timescale,s=t.id,o=!1;return g(i,["moof"]).map((function(u){var c=u.byteOffset-8;g(u,["traf"]).map((function(u){var l=g(u,["tfdt"]).map((function(e){var t=e[0],n=h(e,4);return 1===t&&(n*=Math.pow(2,32),n+=h(e,8)),n/a}))[0];return void 0!==l&&(e=l),g(u,["tfhd"]).map((function(l){var d=h(l,4),f=16777215&h(l,0),v=0,m=0!==(16&f),y=0,b=0!==(32&f),k=8;d===s&&(0!==(1&f)&&(k+=8),0!==(2&f)&&(k+=4),0!==(8&f)&&(v=h(l,k),k+=4),m&&(y=h(l,k),k+=4),b&&(k+=4),"video"===t.type&&(o=function(e){if(!e)return!1;var t=e.indexOf("."),n=t<0?e:e.substring(0,t);return"hvc1"===n||"hev1"===n||"dvh1"===n||"dvhe"===n}(t.codec)),g(u,["trun"]).map((function(s){var u=s[0],l=16777215&h(s,0),d=0!==(1&l),f=0,g=0!==(4&l),m=0!==(256&l),b=0,k=0!==(512&l),T=0,E=0!==(1024&l),S=0!==(2048&l),w=0,x=h(s,4),R=8;d&&(f=h(s,R),R+=4),g&&(R+=4);for(var C=f+c,P=0;P<x;P++){if(m?(b=h(s,R),R+=4):b=v,k?(T=h(s,R),R+=4):T=y,E&&(R+=4),S&&(w=0===u?h(s,R):p(s,R),R+=4),t.type===r.ElementaryStreamTypes.VIDEO)for(var _=0;_<T;){var D=h(i,C);A(o,i[C+=4])&&I(i.subarray(C,C+D),o?2:1,e+w/a,n),C+=D,_+=D+4}e+=b/a}})))}))}))})),n}function A(e,t){if(e){var n=t>>1&63;return 39===n||40===n}return 6===(31&t)}function I(e,t,n,r){var i=P(e),s=0;s+=t;for(var o=0,u=0,c=!1,l=0;s<i.length;){o=0;do{if(s>=i.length)break;o+=l=i[s++]}while(255===l);u=0;do{if(s>=i.length)break;u+=l=i[s++]}while(255===l);var d=i.length-s;if(!c&&4===o&&s<i.length){if(c=!0,181===i[s++]){var p=f(i,s);if(s+=2,49===p){var v=h(i,s);if(s+=4,1195456820===v){var g=i[s++];if(3===g){var m=i[s++],y=64&m,b=y?2+3*(31&m):0,k=new Uint8Array(b);if(y){k[0]=m;for(var T=1;T<b;T++)k[T]=i[s++]}r.push({type:g,payloadType:o,pts:n,bytes:k})}}}}}else if(5===o&&u<d){if(c=!0,u>16){for(var E=[],S=0;S<16;S++){var w=i[s++].toString(16);E.push(1==w.length?"0"+w:w),3!==S&&5!==S&&7!==S&&9!==S||E.push("-")}for(var x=u-16,R=new Uint8Array(x),C=0;C<x;C++)R[C]=i[s++];r.push({payloadType:o,pts:n,uuid:E.join(""),userData:(0,a.utf8ArrayToStr)(R),userDataBytes:R})}}else if(u<d)s+=u;else if(u>d)break}}function P(e){for(var t=e.byteLength,n=[],r=1;r<t-2;)0===e[r]&&0===e[r+1]&&3===e[r+2]?(n.push(r+2),r+=2):r++;if(0===n.length)return e;var i=t-n.length,a=new Uint8Array(i),s=0;for(r=0;r<i;s++,r++)s===n[0]&&(s++,n.shift()),a[r]=e[s];return a}function _(e){var t=e[0],n="",r="",i=0,a=0,s=0,o=0,u=0,c=0;if(0===t){for(;"\0"!==d(e.subarray(c,c+1));)n+=d(e.subarray(c,c+1)),c+=1;for(n+=d(e.subarray(c,c+1)),c+=1;"\0"!==d(e.subarray(c,c+1));)r+=d(e.subarray(c,c+1)),c+=1;r+=d(e.subarray(c,c+1)),c+=1,i=h(e,12),a=h(e,16),o=h(e,20),u=h(e,24),c=28}else if(1===t){i=h(e,c+=4);var l=h(e,c+=4),f=h(e,c+=4);for(c+=4,s=Math.pow(2,32)*l+f,Number.isSafeInteger(s)||(s=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=h(e,c),u=h(e,c+=4),c+=4;"\0"!==d(e.subarray(c,c+1));)n+=d(e.subarray(c,c+1)),c+=1;for(n+=d(e.subarray(c,c+1)),c+=1;"\0"!==d(e.subarray(c,c+1));)r+=d(e.subarray(c,c+1)),c+=1;r+=d(e.subarray(c,c+1)),c+=1}return{schemeIdUri:n,value:r,timeScale:i,presentationTime:s,presentationTimeDelta:a,eventDuration:o,id:u,payload:e.subarray(c,e.byteLength)}}function D(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=n.length,a=8,s=i;s--;)a+=n[s].byteLength;var o=new Uint8Array(a);for(o[0]=a>>24&255,o[1]=a>>16&255,o[2]=a>>8&255,o[3]=255&a,o.set(e,4),s=0,a=8;s<i;s++)o.set(n[s],a),a+=n[s].byteLength;return o}function L(e,t,n){if(16!==e.byteLength)throw new RangeError("Invalid system id");var r,i,a;if(t){r=1,i=new Uint8Array(16*t.length);for(var s=0;s<t.length;s++){var o=t[s];if(16!==o.byteLength)throw new RangeError("Invalid key");i.set(o,16*s)}}else r=0,i=new Uint8Array;r>0?(a=new Uint8Array(4),t.length>0&&new DataView(a.buffer).setUint32(0,t.length,!1)):a=new Uint8Array;var u=new Uint8Array(4);return n&&n.byteLength>0&&new DataView(u.buffer).setUint32(0,n.byteLength,!1),D([112,115,115,104],new Uint8Array([r,0,0,0]),e,a,i,u,n||new Uint8Array)}function O(e){if(!(e instanceof ArrayBuffer)||e.byteLength<32)return null;var t={version:0,systemId:"",kids:null,data:null},n=new DataView(e),r=n.getUint32(0);if(e.byteLength!==r&&r>44)return null;if(1886614376!==n.getUint32(4))return null;if(t.version=n.getUint32(8)>>>24,t.version>1)return null;t.systemId=o.default.hexDump(new Uint8Array(e,12,16));var i=n.getUint32(28);if(0===t.version){if(r-32<i)return null;t.data=new Uint8Array(e,32,i)}else if(1===t.version){t.kids=[];for(var a=0;a<i;a++)t.kids.push(new Uint8Array(e,32+16*a,16))}return t}},"./src/utils/numeric-encoding-utils.ts":function(e,t,n){"use strict";function r(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function i(e){return btoa(e)}function a(e){return atob(e)}function s(e){return btoa(String.fromCharCode.apply(String,e))}function o(e){return r(s(e))}function u(e){return Uint8Array.from(atob(e),(function(e){return e.charCodeAt(0)}))}n.r(t),n.d(t,{base64Decode:function(){return u},base64DecodeToStr:function(){return a},base64Encode:function(){return s},base64ToBase64Url:function(){return r},base64UrlEncode:function(){return o},strToBase64Encode:function(){return i}})},"./src/utils/output-filter.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return r}});var r=function(){function e(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}var t=e.prototype;return t.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},t.newCue=function(e,t,n){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)},t.reset=function(){this.cueRanges=[],this.startTime=null},e}()},"./src/utils/texttrack-utils.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{addCueToTrack:function(){return a},clearCurrentCues:function(){return s},getCuesInRange:function(){return u},removeCuesInRange:function(){return o},sendAddTrackEvent:function(){return i}});var r=n("./src/utils/logger.ts");function i(e,t){var n;try{n=new Event("addtrack")}catch(r){(n=document.createEvent("Event")).initEvent("addtrack",!1,!1)}n.track=e,t.dispatchEvent(n)}function a(e,t){var n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error("addCue is failed for: "+t)}catch(a){r.logger.debug("[texttrack-utils]: "+a);var i=new self.TextTrackCue(t.startTime,t.endTime,t.text);i.id=t.id,e.addCue(i)}"disabled"===n&&(e.mode=n)}function s(e){var t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues)for(var n=e.cues.length;n--;)e.removeCue(e.cues[n]);"disabled"===t&&(e.mode=t)}function o(e,t,n,r){var i=e.mode;if("disabled"===i&&(e.mode="hidden"),e.cues&&e.cues.length>0)for(var a=u(e.cues,t,n),s=0;s<a.length;s++)r&&!r(a[s])||e.removeCue(a[s]);"disabled"===i&&(e.mode=i)}function u(e,t,n){var r=[],i=function(e,t){if(t<e[0].startTime)return 0;var n=e.length-1;if(t>e[n].endTime)return-1;for(var r=0,i=n;r<=i;){var a=Math.floor((i+r)/2);if(t<e[a].startTime)i=a-1;else{if(!(t>e[a].startTime&&r<n))return a;r=a+1}}return e[r].startTime-t<t-e[i].startTime?r:i}(e,t);if(i>-1)for(var a=i,s=e.length;a<s;a++){var o=e[a];if(o.startTime>=t&&o.endTime<=n)r.push(o);else if(o.startTime>n)return r}return r}},"./src/utils/time-ranges.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return r}});var r={toString:function(e){for(var t="",n=e.length,r=0;r<n;r++)t+="["+e.start(r).toFixed(3)+"-"+e.end(r).toFixed(3)+"]";return t}}},"./src/utils/timescale-conversion.ts":function(e,t,n){"use strict";function r(e,t,n,r){void 0===n&&(n=1),void 0===r&&(r=!1);var i=e*t*n;return r?Math.round(i):i}function i(e,t,n,i){return void 0===n&&(n=1),void 0===i&&(i=!1),r(e,t,1/n,i)}function a(e,t){return void 0===t&&(t=!1),r(e,1e3,1/9e4,t)}function s(e,t){return void 0===t&&(t=1),r(e,9e4,1/t)}n.r(t),n.d(t,{toMpegTsClockFromTimescale:function(){return s},toMsFromMpegTsClock:function(){return a},toTimescaleFromBase:function(){return r},toTimescaleFromScale:function(){return i}})},"./src/utils/typed-array.ts":function(e,t,n){"use strict";function r(e,t,n){return Uint8Array.prototype.slice?e.slice(t,n):new Uint8Array(Array.prototype.slice.call(e,t,n))}n.r(t),n.d(t,{sliceUint8:function(){return r}})},"./src/utils/vttcue.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return r}});var r=function(){if("undefined"!==typeof self&&self.VTTCue)return self.VTTCue;var e=["","lr","rl"],t=["start","middle","end","left","right"];function n(e,t){if("string"!==typeof t)return!1;if(!Array.isArray(e))return!1;var n=t.toLowerCase();return!!~e.indexOf(n)&&n}function r(e){return n(t,e)}function i(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var s in a)e[s]=a[s]}return e}function a(t,a,s){var o=this,u={enumerable:!0};o.hasBeenReset=!1;var c="",l=!1,d=t,f=a,h=s,p=null,v="",g=!0,m="auto",y="start",b=50,k="middle",T=50,E="middle";Object.defineProperty(o,"id",i({},u,{get:function(){return c},set:function(e){c=""+e}})),Object.defineProperty(o,"pauseOnExit",i({},u,{get:function(){return l},set:function(e){l=!!e}})),Object.defineProperty(o,"startTime",i({},u,{get:function(){return d},set:function(e){if("number"!==typeof e)throw new TypeError("Start time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",i({},u,{get:function(){return f},set:function(e){if("number"!==typeof e)throw new TypeError("End time must be set to a number.");f=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",i({},u,{get:function(){return h},set:function(e){h=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",i({},u,{get:function(){return p},set:function(e){p=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",i({},u,{get:function(){return v},set:function(t){var r=function(t){return n(e,t)}(t);if(!1===r)throw new SyntaxError("An invalid or illegal string was specified.");v=r,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",i({},u,{get:function(){return g},set:function(e){g=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",i({},u,{get:function(){return m},set:function(e){if("number"!==typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");m=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",i({},u,{get:function(){return y},set:function(e){var t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",i({},u,{get:function(){return b},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",i({},u,{get:function(){return k},set:function(e){var t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");k=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",i({},u,{get:function(){return T},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");T=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",i({},u,{get:function(){return E},set:function(e){var t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");E=t,this.hasBeenReset=!0}})),o.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}()},"./src/utils/vttparser.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{VTTParser:function(){return f},fixLineBreaks:function(){return d},parseTimeStamp:function(){return a}});var r=n("./src/utils/vttcue.ts"),i=function(){function e(){}return e.prototype.decode=function(e,t){if(!e)return"";if("string"!==typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))},e}();function a(e){function t(e,t,n,r){return 3600*(0|e)+60*(0|t)+(0|n)+parseFloat(r||0)}var n=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return n?parseFloat(n[2])>59?t(n[2],n[3],0,n[4]):t(n[1],n[2],n[3],n[4]):null}var s=function(){function e(){this.values=Object.create(null)}var t=e.prototype;return t.set=function(e,t){this.get(e)||""===t||(this.values[e]=t)},t.get=function(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t},t.has=function(e){return e in this.values},t.alt=function(e,t,n){for(var r=0;r<n.length;++r)if(t===n[r]){this.set(e,t);break}},t.integer=function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},t.percent=function(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1},e}();function o(e,t,n,r){var i=r?e.split(r):[e];for(var a in i)if("string"===typeof i[a]){var s=i[a].split(n);2===s.length&&t(s[0],s[1])}}var u=new r.default(0,0,""),c="middle"===u.align?"middle":"center";function l(e,t,n){var r=e;function i(){var t=a(e);if(null===t)throw new Error("Malformed timestamp: "+r);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function l(){e=e.replace(/^\s+/,"")}if(l(),t.startTime=i(),l(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);e=e.slice(3),l(),t.endTime=i(),l(),function(e,t){var r=new s;o(e,(function(e,t){var i;switch(e){case"region":for(var a=n.length-1;a>=0;a--)if(n[a].id===t){r.set(e,n[a].region);break}break;case"vertical":r.alt(e,t,["rl","lr"]);break;case"line":i=t.split(","),r.integer(e,i[0]),r.percent(e,i[0])&&r.set("snapToLines",!1),r.alt(e,i[0],["auto"]),2===i.length&&r.alt("lineAlign",i[1],["start",c,"end"]);break;case"position":i=t.split(","),r.percent(e,i[0]),2===i.length&&r.alt("positionAlign",i[1],["start",c,"end","line-left","line-right","auto"]);break;case"size":r.percent(e,t);break;case"align":r.alt(e,t,["start",c,"end","left","right"])}}),/:/,/\s/),t.region=r.get("region",null),t.vertical=r.get("vertical","");var i=r.get("line","auto");"auto"===i&&-1===u.line&&(i=-1),t.line=i,t.lineAlign=r.get("lineAlign","start"),t.snapToLines=r.get("snapToLines",!0),t.size=r.get("size",100),t.align=r.get("align",c);var a=r.get("position","auto");"auto"===a&&50===u.position&&(a="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=a}(e,t)}function d(e){return e.replace(/<br(?: \/)?>/gi,"\n")}var f=function(){function e(){this.state="INITIAL",this.buffer="",this.decoder=new i,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var t=e.prototype;return t.parse=function(e){var t=this;function n(){var e=t.buffer,n=0;for(e=d(e);n<e.length&&"\r"!==e[n]&&"\n"!==e[n];)++n;var r=e.slice(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.slice(n),r}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var i="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var a=(i=n()).match(/^(\xef\xbb\xbf)?WEBVTT([ \t].*)?$/);if(!a||!a[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var s=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(s?s=!1:i=n(),t.state){case"HEADER":/:/.test(i)?o(i,(function(e,t){}),/:/):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new r.default(0,0,""),t.state="CUE",-1===i.indexOf("--\x3e")){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{l(i,t.cue,t.regionList)}catch(c){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var u=-1!==i.indexOf("--\x3e");if(!i||u&&(s=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=i;continue;case"BADCUE":i||(t.state="ID")}}}catch(c){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},t.flush=function(){var e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this},e}()},"./src/utils/webvtt-parser.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{generateCueId:function(){return d},parseWebVTT:function(){return f}});var r=n("./src/polyfills/number.ts"),i=n("./src/utils/vttparser.ts"),a=n("./src/demux/id3.ts"),s=n("./src/utils/timescale-conversion.ts"),o=n("./src/remux/mp4-remuxer.ts"),u=/\r\n|\n\r|\n|\r/g,c=function(e,t,n){return void 0===n&&(n=0),e.slice(n,n+t.length)===t},l=function(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return(t>>>0).toString()};function d(e,t,n){return l(e.toString())+l(t.toString())+l(n)}function f(e,t,n,l,f,h,p,v){var g,m=new i.VTTParser,y=(0,a.utf8ArrayToStr)(new Uint8Array(e)).trim().replace(u,"\n").split("\n"),b=[],k=(0,s.toMpegTsClockFromTimescale)(t,n),T="00:00.000",E=0,S=0,w=!0;m.oncue=function(e){var t=l[f],n=l.ccOffset,r=(E-k)/9e4;null!==t&&void 0!==t&&t.new&&(void 0!==S?n=l.ccOffset=t.start:function(e,t,n){var r=e[t],i=e[r.prevCC];if(!i||!i.new&&r.new)return e.ccOffset=e.presentationOffset=r.start,void(r.new=!1);for(;null!==(a=i)&&void 0!==a&&a.new;){var a;e.ccOffset+=r.start-i.start,r.new=!1,i=e[(r=i).prevCC]}e.presentationOffset=n}(l,f,r)),r&&(n=r-l.presentationOffset);var i=e.endTime-e.startTime,a=(0,o.normalizePts)(9e4*(e.startTime+n-S),9e4*h)/9e4;e.startTime=Math.max(a,0),e.endTime=Math.max(a+i,0);var s=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(s)),e.id||(e.id=d(e.startTime,e.endTime,s)),e.endTime>0&&b.push(e)},m.onparsingerror=function(e){g=e},m.onflush=function(){g?v(g):p(b)},y.forEach((function(e){if(w){if(c(e,"X-TIMESTAMP-MAP=")){w=!1,e.slice(16).split(",").forEach((function(e){c(e,"LOCAL:")?T=e.slice(6):c(e,"MPEGTS:")&&(E=parseInt(e.slice(7)))}));try{S=function(e){var t=parseInt(e.slice(-3)),n=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),a=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!(0,r.isFiniteNumber)(t)||!(0,r.isFiniteNumber)(n)||!(0,r.isFiniteNumber)(i)||!(0,r.isFiniteNumber)(a))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+e);return t+=1e3*n,(t+=6e4*i)+36e5*a}(T)/1e3}catch(t){g=t}return}""===e&&(w=!1)}m.parse(e+"\n")})),m.flush()}},"./src/utils/xhr-loader.ts":function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return s}});var r=n("./src/utils/logger.ts"),i=n("./src/loader/load-stats.ts"),a=/^age:\s*[\d.]+\s*$/m,s=function(){function e(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e?e.xhrSetup:null,this.stats=new i.LoadStats,this.retryDelay=0}var t=e.prototype;return t.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},t.abortInternal=function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))},t.abort=function(){var e;this.abortInternal(),null!==(e=this.callbacks)&&void 0!==e&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},t.load=function(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.retryDelay=t.retryDelay,this.loadInternal()},t.loadInternal=function(){var e=this.config,t=this.context;if(e){var n=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0;var i=this.xhrSetup;try{if(i)try{i(n,t.url)}catch(o){n.open("GET",t.url,!0),i(n,t.url)}n.readyState||n.open("GET",t.url,!0);var a=this.context.headers;if(a)for(var s in a)n.setRequestHeader(s,a[s])}catch(o){return void this.callbacks.onError({code:n.status,text:o.message},t,n)}t.rangeEnd&&n.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),n.onreadystatechange=this.readystatechange.bind(this),n.onprogress=this.loadprogress.bind(this),n.responseType=t.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),e.timeout),n.send()}},t.readystatechange=function(){var e=this.context,t=this.loader,n=this.stats;if(e&&t){var i=t.readyState,a=this.config;if(!n.aborted&&i>=2)if(self.clearTimeout(this.requestTimeout),0===n.loading.first&&(n.loading.first=Math.max(self.performance.now(),n.loading.start)),4===i){t.onreadystatechange=null,t.onprogress=null;var s=t.status,o="arraybuffer"===t.responseType;if(s>=200&&s<300&&(o&&t.response||null!==t.responseText)){var u,c;if(n.loading.end=Math.max(self.performance.now(),n.loading.first),c=o?(u=t.response).byteLength:(u=t.responseText).length,n.loaded=n.total=c,!this.callbacks)return;var l=this.callbacks.onProgress;if(l&&l(n,e,u,t),!this.callbacks)return;var d={url:t.responseURL,data:u};this.callbacks.onSuccess(d,n,e,t)}else n.retry>=a.maxRetry||s>=400&&s<499?(r.logger.error(s+" while loading "+e.url),this.callbacks.onError({code:s,text:t.statusText},e,t)):(r.logger.warn(s+" while loading "+e.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,a.maxRetryDelay),n.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.timeout)}},t.loadtimeout=function(){r.logger.warn("timeout while loading "+this.context.url);var e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))},t.loadprogress=function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)},t.getCacheAge=function(){var e=null;if(this.loader&&a.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e},e}()},"./node_modules/eventemitter3/index.js":function(e){"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,r,a,s){if("function"!==typeof r)throw new TypeError("The listener must be a function");var o=new i(r,a||e,s),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],o]:e._events[u].push(o):(e._events[u]=o,e._eventsCount++),e}function s(e,t){0===--e._eventsCount?e._events=new r:delete e._events[t]}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),o.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},o.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,s=new Array(a);i<a;i++)s[i]=r[i].fn;return s},o.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},o.prototype.emit=function(e,t,r,i,a,s){var o=n?n+e:e;if(!this._events[o])return!1;var u,c,l=this._events[o],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,i),!0;case 5:return l.fn.call(l.context,t,r,i,a),!0;case 6:return l.fn.call(l.context,t,r,i,a,s),!0}for(c=1,u=new Array(d-1);c<d;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var f,h=l.length;for(c=0;c<h;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),d){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,r);break;case 4:l[c].fn.call(l[c].context,t,r,i);break;default:if(!u)for(f=1,u=new Array(d-1);f<d;f++)u[f-1]=arguments[f];l[c].fn.apply(l[c].context,u)}}return!0},o.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},o.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},o.prototype.removeListener=function(e,t,r,i){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return s(this,a),this;var o=this._events[a];if(o.fn)o.fn!==t||i&&!o.once||r&&o.context!==r||s(this,a);else{for(var u=0,c=[],l=o.length;u<l;u++)(o[u].fn!==t||i&&!o[u].once||r&&o[u].context!==r)&&c.push(o[u]);c.length?this._events[a]=1===c.length?c[0]:c:s(this,a)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&s(this,t)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,e.exports=o},"./node_modules/url-toolkit/src/url-toolkit.js":function(e){!function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,s={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),!(t=t.trim())){if(!n.alwaysNormalize)return e;var i=s.parseURL(e);if(!i)throw new Error("Error trying to parse base URL.");return i.path=s.normalizePath(i.path),s.buildURLFromParts(i)}var a=s.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return n.alwaysNormalize?(a.path=s.normalizePath(a.path),s.buildURLFromParts(a)):t;var o=s.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var u=r.exec(o.path);o.netLoc=u[1],o.path=u[2]}o.netLoc&&!o.path&&(o.path="/");var c={scheme:o.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(c.netLoc=o.netLoc,"/"!==a.path[0]))if(a.path){var l=o.path,d=l.substring(0,l.lastIndexOf("/")+1)+a.path;c.path=s.normalizePath(d)}else c.path=o.path,a.params||(c.params=o.params,a.query||(c.query=o.query));return null===c.path&&(c.path=n.alwaysNormalize?s.normalizePath(a.path):a.path),s.buildURLFromParts(c)},parseURL:function(e){var t=n.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(i,"");e.length!==(e=e.replace(a,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=s}()}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}n.m=e,n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r=n("./src/hls.ts");return r=r.default}()},e.exports=t())},110:function(e,t,n){"use strict";var r=n(441),i={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},a={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},s={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},o={};function u(e){return r.isMemo(e)?s:o[e.$$typeof]||i}o[r.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},o[r.Memo]=s;var c=Object.defineProperty,l=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,f=Object.getOwnPropertyDescriptor,h=Object.getPrototypeOf,p=Object.prototype;e.exports=function e(t,n,r){if("string"!==typeof n){if(p){var i=h(n);i&&i!==p&&e(t,i,r)}var s=l(n);d&&(s=s.concat(d(n)));for(var o=u(t),v=u(n),g=0;g<s.length;++g){var m=s[g];if(!a[m]&&(!r||!r[m])&&(!v||!v[m])&&(!o||!o[m])){var y=f(n,m);try{c(t,m,y)}catch(b){}}}}return t}},463:function(e,t,n){"use strict";var r=n(791),i=n(296);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,o={};function u(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)s.add(t[e])}var l=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h={},p={};function v(e,t,n,r,i,a,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=s}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new v(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new v(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new v(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new v(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new v(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new v(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new v(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new v(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new v(e,5,!1,e.toLowerCase(),null,!1,!1)}));var m=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,n,r){var i=g.hasOwnProperty(t)?g[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!d.call(p,e)||!d.call(h,e)&&(f.test(e)?p[e]=!0:(h[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(m,y);g[t]=new v(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(m,y);g[t]=new v(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(m,y);g[t]=new v(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new v(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new v(e,1,!1,e.toLowerCase(),null,!0,!0)}));var k=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,T=Symbol.for("react.element"),E=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),x=Symbol.for("react.profiler"),R=Symbol.for("react.provider"),C=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),_=Symbol.for("react.memo"),D=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var L=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var O=Symbol.iterator;function M(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=O&&e[O]||e["@@iterator"])?e:null}var N,F=Object.assign;function U(e){if(void 0===N)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);N=t&&t[1]||""}return"\n"+N+e}var B=!1;function j(e,t){if(!e||B)return"";B=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var i=c.stack.split("\n"),a=r.stack.split("\n"),s=i.length-1,o=a.length-1;1<=s&&0<=o&&i[s]!==a[o];)o--;for(;1<=s&&0<=o;s--,o--)if(i[s]!==a[o]){if(1!==s||1!==o)do{if(s--,0>--o||i[s]!==a[o]){var u="\n"+i[s].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=s&&0<=o);break}}}finally{B=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?U(e):""}function G(e){switch(e.tag){case 5:return U(e.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return e=j(e.type,!1);case 11:return e=j(e.type.render,!1);case 1:return e=j(e.type,!0);default:return""}}function V(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case E:return"Portal";case x:return"Profiler";case w:return"StrictMode";case I:return"Suspense";case P:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case R:return(e._context.displayName||"Context")+".Provider";case A:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case _:return null!==(t=e.displayName||null)?t:V(e.type)||"Memo";case D:t=e._payload,e=e._init;try{return V(e(t))}catch(n){}}return null}function K(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(t);case 8:return t===w?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function z(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function W(e){e._valueTracker||(e._valueTracker=function(e){var t=z(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=z(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function Y(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Q(e,t){var n=t.checked;return F({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function J(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=H(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function $(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function X(e,t){$(e,t);var n=H(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&Y(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+H(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return F({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(te(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:H(n)}}function ae(e,t){var n=H(t.value),r=H(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function se(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ue(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,le,de=(le=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return le(e,t)}))}:le);function fe(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var he={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function ve(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||he.hasOwnProperty(e)&&he[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=ve(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(he).forEach((function(e){pe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),he[t]=he[e]}))}));var me=F({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(me[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ke=null;function Te(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ee=null,Se=null,we=null;function xe(e){if(e=bi(e)){if("function"!==typeof Ee)throw Error(a(280));var t=e.stateNode;t&&(t=Ti(t),Ee(e.stateNode,e.type,t))}}function Re(e){Se?we?we.push(e):we=[e]:Se=e}function Ce(){if(Se){var e=Se,t=we;if(we=Se=null,xe(e),t)for(e=0;e<t.length;e++)xe(t[e])}}function Ae(e,t){return e(t)}function Ie(){}var Pe=!1;function _e(e,t,n){if(Pe)return e(t,n);Pe=!0;try{return Ae(e,t,n)}finally{Pe=!1,(null!==Se||null!==we)&&(Ie(),Ce())}}function De(e,t){var n=e.stateNode;if(null===n)return null;var r=Ti(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var Le=!1;if(l)try{var Oe={};Object.defineProperty(Oe,"passive",{get:function(){Le=!0}}),window.addEventListener("test",Oe,Oe),window.removeEventListener("test",Oe,Oe)}catch(le){Le=!1}function Me(e,t,n,r,i,a,s,o,u){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(l){this.onError(l)}}var Ne=!1,Fe=null,Ue=!1,Be=null,je={onError:function(e){Ne=!0,Fe=e}};function Ge(e,t,n,r,i,a,s,o,u){Ne=!1,Fe=null,Me.apply(je,arguments)}function Ve(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ke(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(Ve(e)!==e)throw Error(a(188))}function ze(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ve(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var s=i.alternate;if(null===s){if(null!==(r=i.return)){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return He(i),e;if(s===r)return He(i),t;s=s.sibling}throw Error(a(188))}if(n.return!==r.return)n=i,r=s;else{for(var o=!1,u=i.child;u;){if(u===n){o=!0,n=i,r=s;break}if(u===r){o=!0,r=i,n=s;break}u=u.sibling}if(!o){for(u=s.child;u;){if(u===n){o=!0,n=s,r=i;break}if(u===r){o=!0,r=s,n=i;break}u=u.sibling}if(!o)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e))?We(e):null}function We(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=We(e);if(null!==t)return t;e=e.sibling}return null}var qe=i.unstable_scheduleCallback,Ye=i.unstable_cancelCallback,Qe=i.unstable_shouldYield,Je=i.unstable_requestPaint,$e=i.unstable_now,Xe=i.unstable_getCurrentPriorityLevel,Ze=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,at=null;var st=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(ot(e)/ut|0)|0},ot=Math.log,ut=Math.LN2;var ct=64,lt=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ft(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,a=e.pingedLanes,s=268435455&n;if(0!==s){var o=s&~i;0!==o?r=dt(o):0!==(a&=s)&&(r=dt(a))}else 0!==(s=n&~i)?r=dt(s):0!==a&&(r=dt(a));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(a=t&-t)||16===i&&0!==(4194240&a)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-st(t)),r|=e[n],t&=~i;return r}function ht(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function vt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function mt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-st(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-st(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var bt=0;function kt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var Tt,Et,St,wt,xt,Rt=!1,Ct=[],At=null,It=null,Pt=null,_t=new Map,Dt=new Map,Lt=[],Ot="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Mt(e,t){switch(e){case"focusin":case"focusout":At=null;break;case"dragenter":case"dragleave":It=null;break;case"mouseover":case"mouseout":Pt=null;break;case"pointerover":case"pointerout":_t.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dt.delete(t.pointerId)}}function Nt(e,t,n,r,i,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},null!==t&&(null!==(t=bi(t))&&Et(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Ft(e){var t=yi(e.target);if(null!==t){var n=Ve(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ke(n)))return e.blockedOn=t,void xt(e.priority,(function(){St(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ut(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=bi(n))&&Et(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);ke=r,n.target.dispatchEvent(r),ke=null,t.shift()}return!0}function Bt(e,t,n){Ut(e)&&n.delete(t)}function jt(){Rt=!1,null!==At&&Ut(At)&&(At=null),null!==It&&Ut(It)&&(It=null),null!==Pt&&Ut(Pt)&&(Pt=null),_t.forEach(Bt),Dt.forEach(Bt)}function Gt(e,t){e.blockedOn===t&&(e.blockedOn=null,Rt||(Rt=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,jt)))}function Vt(e){function t(t){return Gt(t,e)}if(0<Ct.length){Gt(Ct[0],e);for(var n=1;n<Ct.length;n++){var r=Ct[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==At&&Gt(At,e),null!==It&&Gt(It,e),null!==Pt&&Gt(Pt,e),_t.forEach(t),Dt.forEach(t),n=0;n<Lt.length;n++)(r=Lt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Lt.length&&null===(n=Lt[0]).blockedOn;)Ft(n),null===n.blockedOn&&Lt.shift()}var Kt=k.ReactCurrentBatchConfig,Ht=!0;function zt(e,t,n,r){var i=bt,a=Kt.transition;Kt.transition=null;try{bt=1,qt(e,t,n,r)}finally{bt=i,Kt.transition=a}}function Wt(e,t,n,r){var i=bt,a=Kt.transition;Kt.transition=null;try{bt=4,qt(e,t,n,r)}finally{bt=i,Kt.transition=a}}function qt(e,t,n,r){if(Ht){var i=Qt(e,t,n,r);if(null===i)Hr(e,t,r,Yt,n),Mt(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return At=Nt(At,e,t,n,r,i),!0;case"dragenter":return It=Nt(It,e,t,n,r,i),!0;case"mouseover":return Pt=Nt(Pt,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return _t.set(a,Nt(_t.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,Dt.set(a,Nt(Dt.get(a)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Mt(e,r),4&t&&-1<Ot.indexOf(e)){for(;null!==i;){var a=bi(i);if(null!==a&&Tt(a),null===(a=Qt(e,t,n,r))&&Hr(e,t,r,Yt,n),a===i)break;i=a}null!==i&&r.stopPropagation()}else Hr(e,t,r,null,n)}}var Yt=null;function Qt(e,t,n,r){if(Yt=null,null!==(e=yi(e=Te(r))))if(null===(t=Ve(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ke(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Yt=e,null}function Jt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xe()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var $t=null,Xt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Xt,r=n.length,i="value"in $t?$t.value:$t.textContent,a=i.length;for(e=0;e<r&&n[e]===i[e];e++);var s=r-e;for(t=1;t<=s&&n[r-t]===i[a-t];t++);return Zt=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,r,i,a){for(var s in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(i):i[s]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return F(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var sn,on,un,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ln=an(cn),dn=F({},cn,{view:0,detail:0}),fn=an(dn),hn=F({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==un&&(un&&"mousemove"===e.type?(sn=e.screenX-un.screenX,on=e.screenY-un.screenY):on=sn=0,un=e),sn)},movementY:function(e){return"movementY"in e?e.movementY:on}}),pn=an(hn),vn=an(F({},hn,{dataTransfer:0})),gn=an(F({},dn,{relatedTarget:0})),mn=an(F({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=F({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=an(yn),kn=an(F({},cn,{data:0})),Tn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},En={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sn[e])&&!!t[e]}function xn(){return wn}var Rn=F({},dn,{key:function(e){if(e.key){var t=Tn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?En[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Cn=an(Rn),An=an(F({},hn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),In=an(F({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xn})),Pn=an(F({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),_n=F({},hn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Dn=an(_n),Ln=[9,13,27,32],On=l&&"CompositionEvent"in window,Mn=null;l&&"documentMode"in document&&(Mn=document.documentMode);var Nn=l&&"TextEvent"in window&&!Mn,Fn=l&&(!On||Mn&&8<Mn&&11>=Mn),Un=String.fromCharCode(32),Bn=!1;function jn(e,t){switch(e){case"keyup":return-1!==Ln.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Gn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Vn=!1;var Kn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Kn[e.type]:"textarea"===t}function zn(e,t,n,r){Re(r),0<(t=Wr(t,"onChange")).length&&(n=new ln("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Wn=null,qn=null;function Yn(e){Ur(e,0)}function Qn(e){if(q(ki(e)))return e}function Jn(e,t){if("change"===e)return t}var $n=!1;if(l){var Xn;if(l){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"===typeof er.oninput}Xn=Zn}else Xn=!1;$n=Xn&&(!document.documentMode||9<document.documentMode)}function tr(){Wn&&(Wn.detachEvent("onpropertychange",nr),qn=Wn=null)}function nr(e){if("value"===e.propertyName&&Qn(qn)){var t=[];zn(t,qn,e,Te(e)),_e(Yn,t)}}function rr(e,t,n){"focusin"===e?(tr(),qn=n,(Wn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Qn(qn)}function ar(e,t){if("click"===e)return Qn(t)}function sr(e,t){if("input"===e||"change"===e)return Qn(t)}var or="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ur(e,t){if(or(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!d.call(t,i)||!or(e[i],t[i]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function lr(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function dr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function fr(){for(var e=window,t=Y();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=Y((e=t.contentWindow).document)}return t}function hr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pr(e){var t=fr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dr(n.ownerDocument.documentElement,n)){if(null!==r&&hr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,a=Math.min(r.start,i);r=void 0===r.end?a:Math.min(r.end,i),!e.extend&&a>r&&(i=r,r=a,a=i),i=lr(n,a);var s=lr(n,r);i&&s&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var vr=l&&"documentMode"in document&&11>=document.documentMode,gr=null,mr=null,yr=null,br=!1;function kr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==gr||gr!==Y(r)||("selectionStart"in(r=gr)&&hr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&ur(yr,r)||(yr=r,0<(r=Wr(mr,"onSelect")).length&&(t=new ln("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}function Tr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Er={animationend:Tr("Animation","AnimationEnd"),animationiteration:Tr("Animation","AnimationIteration"),animationstart:Tr("Animation","AnimationStart"),transitionend:Tr("Transition","TransitionEnd")},Sr={},wr={};function xr(e){if(Sr[e])return Sr[e];if(!Er[e])return e;var t,n=Er[e];for(t in n)if(n.hasOwnProperty(t)&&t in wr)return Sr[e]=n[t];return e}l&&(wr=document.createElement("div").style,"AnimationEvent"in window||(delete Er.animationend.animation,delete Er.animationiteration.animation,delete Er.animationstart.animation),"TransitionEvent"in window||delete Er.transitionend.transition);var Rr=xr("animationend"),Cr=xr("animationiteration"),Ar=xr("animationstart"),Ir=xr("transitionend"),Pr=new Map,_r="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Dr(e,t){Pr.set(e,t),u(t,[e])}for(var Lr=0;Lr<_r.length;Lr++){var Or=_r[Lr];Dr(Or.toLowerCase(),"on"+(Or[0].toUpperCase()+Or.slice(1)))}Dr(Rr,"onAnimationEnd"),Dr(Cr,"onAnimationIteration"),Dr(Ar,"onAnimationStart"),Dr("dblclick","onDoubleClick"),Dr("focusin","onFocus"),Dr("focusout","onBlur"),Dr(Ir,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Mr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Nr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Mr));function Fr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,s,o,u,c){if(Ge.apply(this,arguments),Ne){if(!Ne)throw Error(a(198));var l=Fe;Ne=!1,Fe=null,Ue||(Ue=!0,Be=l)}}(r,t,void 0,e),e.currentTarget=null}function Ur(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var s=r.length-1;0<=s;s--){var o=r[s],u=o.instance,c=o.currentTarget;if(o=o.listener,u!==a&&i.isPropagationStopped())break e;Fr(i,o,c),a=u}else for(s=0;s<r.length;s++){if(u=(o=r[s]).instance,c=o.currentTarget,o=o.listener,u!==a&&i.isPropagationStopped())break e;Fr(i,o,c),a=u}}}if(Ue)throw e=Be,Ue=!1,Be=null,e}function Br(e,t){var n=t[vi];void 0===n&&(n=t[vi]=new Set);var r=e+"__bubble";n.has(r)||(Kr(t,e,2,!1),n.add(r))}function jr(e,t,n){var r=0;t&&(r|=4),Kr(n,e,r,t)}var Gr="_reactListening"+Math.random().toString(36).slice(2);function Vr(e){if(!e[Gr]){e[Gr]=!0,s.forEach((function(t){"selectionchange"!==t&&(Nr.has(t)||jr(t,!1,e),jr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Gr]||(t[Gr]=!0,jr("selectionchange",!1,t))}}function Kr(e,t,n,r){switch(Jt(t)){case 1:var i=zt;break;case 4:i=Wt;break;default:i=qt}n=i.bind(null,t,n,e),i=void 0,!Le||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Hr(e,t,n,r,i){var a=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var s=r.tag;if(3===s||4===s){var o=r.stateNode.containerInfo;if(o===i||8===o.nodeType&&o.parentNode===i)break;if(4===s)for(s=r.return;null!==s;){var u=s.tag;if((3===u||4===u)&&((u=s.stateNode.containerInfo)===i||8===u.nodeType&&u.parentNode===i))return;s=s.return}for(;null!==o;){if(null===(s=yi(o)))return;if(5===(u=s.tag)||6===u){r=a=s;continue e}o=o.parentNode}}r=r.return}_e((function(){var r=a,i=Te(n),s=[];e:{var o=Pr.get(e);if(void 0!==o){var u=ln,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":u=Cn;break;case"focusin":c="focus",u=gn;break;case"focusout":c="blur",u=gn;break;case"beforeblur":case"afterblur":u=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=vn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=In;break;case Rr:case Cr:case Ar:u=mn;break;case Ir:u=Pn;break;case"scroll":u=fn;break;case"wheel":u=Dn;break;case"copy":case"cut":case"paste":u=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=An}var l=0!==(4&t),d=!l&&"scroll"===e,f=l?null!==o?o+"Capture":null:o;l=[];for(var h,p=r;null!==p;){var v=(h=p).stateNode;if(5===h.tag&&null!==v&&(h=v,null!==f&&(null!=(v=De(p,f))&&l.push(zr(p,v,h)))),d)break;p=p.return}0<l.length&&(o=new u(o,c,null,n,i),s.push({event:o,listeners:l}))}}if(0===(7&t)){if(u="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===ke||!(c=n.relatedTarget||n.fromElement)||!yi(c)&&!c[pi])&&(u||o)&&(o=i.window===i?i:(o=i.ownerDocument)?o.defaultView||o.parentWindow:window,u?(u=r,null!==(c=(c=n.relatedTarget||n.toElement)?yi(c):null)&&(c!==(d=Ve(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(u=null,c=r),u!==c)){if(l=pn,v="onMouseLeave",f="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(l=An,v="onPointerLeave",f="onPointerEnter",p="pointer"),d=null==u?o:ki(u),h=null==c?o:ki(c),(o=new l(v,p+"leave",u,n,i)).target=d,o.relatedTarget=h,v=null,yi(i)===r&&((l=new l(f,p+"enter",c,n,i)).target=h,l.relatedTarget=d,v=l),d=v,u&&c)e:{for(f=c,p=0,h=l=u;h;h=qr(h))p++;for(h=0,v=f;v;v=qr(v))h++;for(;0<p-h;)l=qr(l),p--;for(;0<h-p;)f=qr(f),h--;for(;p--;){if(l===f||null!==f&&l===f.alternate)break e;l=qr(l),f=qr(f)}l=null}else l=null;null!==u&&Yr(s,o,u,l,!1),null!==c&&null!==d&&Yr(s,d,c,l,!0)}if("select"===(u=(o=r?ki(r):window).nodeName&&o.nodeName.toLowerCase())||"input"===u&&"file"===o.type)var g=Jn;else if(Hn(o))if($n)g=sr;else{g=ir;var m=rr}else(u=o.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(g=ar);switch(g&&(g=g(e,r))?zn(s,g,n,i):(m&&m(e,o,r),"focusout"===e&&(m=o._wrapperState)&&m.controlled&&"number"===o.type&&ee(o,"number",o.value)),m=r?ki(r):window,e){case"focusin":(Hn(m)||"true"===m.contentEditable)&&(gr=m,mr=r,yr=null);break;case"focusout":yr=mr=gr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,kr(s,n,i);break;case"selectionchange":if(vr)break;case"keydown":case"keyup":kr(s,n,i)}var y;if(On)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Vn?jn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Fn&&"ko"!==n.locale&&(Vn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Vn&&(y=en()):(Xt="value"in($t=i)?$t.value:$t.textContent,Vn=!0)),0<(m=Wr(r,b)).length&&(b=new kn(b,e,null,n,i),s.push({event:b,listeners:m}),y?b.data=y:null!==(y=Gn(n))&&(b.data=y))),(y=Nn?function(e,t){switch(e){case"compositionend":return Gn(t);case"keypress":return 32!==t.which?null:(Bn=!0,Un);case"textInput":return(e=t.data)===Un&&Bn?null:e;default:return null}}(e,n):function(e,t){if(Vn)return"compositionend"===e||!On&&jn(e,t)?(e=en(),Zt=Xt=$t=null,Vn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Wr(r,"onBeforeInput")).length&&(i=new kn("onBeforeInput","beforeinput",null,n,i),s.push({event:i,listeners:r}),i.data=y))}Ur(s,t)}))}function zr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Wr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,a=i.stateNode;5===i.tag&&null!==a&&(i=a,null!=(a=De(e,n))&&r.unshift(zr(e,a,i)),null!=(a=De(e,t))&&r.push(zr(e,a,i))),e=e.return}return r}function qr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Yr(e,t,n,r,i){for(var a=t._reactName,s=[];null!==n&&n!==r;){var o=n,u=o.alternate,c=o.stateNode;if(null!==u&&u===r)break;5===o.tag&&null!==c&&(o=c,i?null!=(u=De(n,a))&&s.unshift(zr(n,u,o)):i||null!=(u=De(n,a))&&s.push(zr(n,u,o))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var Qr=/\r\n?/g,Jr=/\u0000|\uFFFD/g;function $r(e){return("string"===typeof e?e:""+e).replace(Qr,"\n").replace(Jr,"")}function Xr(e,t,n){if(t=$r(t),$r(e)!==t&&n)throw Error(a(425))}function Zr(){}var ei=null,ti=null;function ni(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ri="function"===typeof setTimeout?setTimeout:void 0,ii="function"===typeof clearTimeout?clearTimeout:void 0,ai="function"===typeof Promise?Promise:void 0,si="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ai?function(e){return ai.resolve(null).then(e).catch(oi)}:ri;function oi(e){setTimeout((function(){throw e}))}function ui(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void Vt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Vt(t)}function ci(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function li(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var di=Math.random().toString(36).slice(2),fi="__reactFiber$"+di,hi="__reactProps$"+di,pi="__reactContainer$"+di,vi="__reactEvents$"+di,gi="__reactListeners$"+di,mi="__reactHandles$"+di;function yi(e){var t=e[fi];if(t)return t;for(var n=e.parentNode;n;){if(t=n[pi]||n[fi]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=li(e);null!==e;){if(n=e[fi])return n;e=li(e)}return t}n=(e=n).parentNode}return null}function bi(e){return!(e=e[fi]||e[pi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function ki(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function Ti(e){return e[hi]||null}var Ei=[],Si=-1;function wi(e){return{current:e}}function xi(e){0>Si||(e.current=Ei[Si],Ei[Si]=null,Si--)}function Ri(e,t){Si++,Ei[Si]=e.current,e.current=t}var Ci={},Ai=wi(Ci),Ii=wi(!1),Pi=Ci;function _i(e,t){var n=e.type.contextTypes;if(!n)return Ci;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,a={};for(i in n)a[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Di(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Li(){xi(Ii),xi(Ai)}function Oi(e,t,n){if(Ai.current!==Ci)throw Error(a(168));Ri(Ai,t),Ri(Ii,n)}function Mi(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(a(108,K(e)||"Unknown",i));return F({},n,r)}function Ni(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ci,Pi=Ai.current,Ri(Ai,e),Ri(Ii,Ii.current),!0}function Fi(e,t,n){var r=e.stateNode;if(!r)throw Error(a(169));n?(e=Mi(e,t,Pi),r.__reactInternalMemoizedMergedChildContext=e,xi(Ii),xi(Ai),Ri(Ai,e)):xi(Ii),Ri(Ii,n)}var Ui=null,Bi=!1,ji=!1;function Gi(e){null===Ui?Ui=[e]:Ui.push(e)}function Vi(){if(!ji&&null!==Ui){ji=!0;var e=0,t=bt;try{var n=Ui;for(bt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Ui=null,Bi=!1}catch(i){throw null!==Ui&&(Ui=Ui.slice(e+1)),qe(Ze,Vi),i}finally{bt=t,ji=!1}}return null}var Ki=[],Hi=0,zi=null,Wi=0,qi=[],Yi=0,Qi=null,Ji=1,$i="";function Xi(e,t){Ki[Hi++]=Wi,Ki[Hi++]=zi,zi=e,Wi=t}function Zi(e,t,n){qi[Yi++]=Ji,qi[Yi++]=$i,qi[Yi++]=Qi,Qi=e;var r=Ji;e=$i;var i=32-st(r)-1;r&=~(1<<i),n+=1;var a=32-st(t)+i;if(30<a){var s=i-i%5;a=(r&(1<<s)-1).toString(32),r>>=s,i-=s,Ji=1<<32-st(t)+i|n<<i|r,$i=a+e}else Ji=1<<a|n<<i|r,$i=e}function ea(e){null!==e.return&&(Xi(e,1),Zi(e,1,0))}function ta(e){for(;e===zi;)zi=Ki[--Hi],Ki[Hi]=null,Wi=Ki[--Hi],Ki[Hi]=null;for(;e===Qi;)Qi=qi[--Yi],qi[Yi]=null,$i=qi[--Yi],qi[Yi]=null,Ji=qi[--Yi],qi[Yi]=null}var na=null,ra=null,ia=!1,aa=null;function sa(e,t){var n=_c(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function oa(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,na=e,ra=ci(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,na=e,ra=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Qi?{id:Ji,overflow:$i}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=_c(18,null,null,0)).stateNode=t,n.return=e,e.child=n,na=e,ra=null,!0);default:return!1}}function ua(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ca(e){if(ia){var t=ra;if(t){var n=t;if(!oa(e,t)){if(ua(e))throw Error(a(418));t=ci(n.nextSibling);var r=na;t&&oa(e,t)?sa(r,n):(e.flags=-4097&e.flags|2,ia=!1,na=e)}}else{if(ua(e))throw Error(a(418));e.flags=-4097&e.flags|2,ia=!1,na=e}}}function la(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;na=e}function da(e){if(e!==na)return!1;if(!ia)return la(e),ia=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),t&&(t=ra)){if(ua(e))throw fa(),Error(a(418));for(;t;)sa(e,t),t=ci(t.nextSibling)}if(la(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ra=ci(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ra=null}}else ra=na?ci(e.stateNode.nextSibling):null;return!0}function fa(){for(var e=ra;e;)e=ci(e.nextSibling)}function ha(){ra=na=null,ia=!1}function pa(e){null===aa?aa=[e]:aa.push(e)}var va=k.ReactCurrentBatchConfig;function ga(e,t){if(e&&e.defaultProps){for(var n in t=F({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var ma=wi(null),ya=null,ba=null,ka=null;function Ta(){ka=ba=ya=null}function Ea(e){var t=ma.current;xi(ma),e._currentValue=t}function Sa(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function wa(e,t){ya=e,ka=ba=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(ko=!0),e.firstContext=null)}function xa(e){var t=e._currentValue;if(ka!==e)if(e={context:e,memoizedValue:t,next:null},null===ba){if(null===ya)throw Error(a(308));ba=e,ya.dependencies={lanes:0,firstContext:e}}else ba=ba.next=e;return t}var Ra=null;function Ca(e){null===Ra?Ra=[e]:Ra.push(e)}function Aa(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Ca(t)):(n.next=i.next,i.next=n),t.interleaved=n,Ia(e,r)}function Ia(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Pa=!1;function _a(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Da(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function La(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Oa(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Au)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Ia(e,n)}return null===(i=r.interleaved)?(t.next=t,Ca(r)):(t.next=i.next,i.next=t),r.interleaved=t,Ia(e,n)}function Ma(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Na(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?i=a=s:a=a.next=s,n=n.next}while(null!==n);null===a?i=a=t:a=a.next=t}else i=a=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Fa(e,t,n,r){var i=e.updateQueue;Pa=!1;var a=i.firstBaseUpdate,s=i.lastBaseUpdate,o=i.shared.pending;if(null!==o){i.shared.pending=null;var u=o,c=u.next;u.next=null,null===s?a=c:s.next=c,s=u;var l=e.alternate;null!==l&&((o=(l=l.updateQueue).lastBaseUpdate)!==s&&(null===o?l.firstBaseUpdate=c:o.next=c,l.lastBaseUpdate=u))}if(null!==a){var d=i.baseState;for(s=0,l=c=u=null,o=a;;){var f=o.lane,h=o.eventTime;if((r&f)===f){null!==l&&(l=l.next={eventTime:h,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=e,v=o;switch(f=t,h=n,v.tag){case 1:if("function"===typeof(p=v.payload)){d=p.call(h,d,f);break e}d=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(f="function"===typeof(p=v.payload)?p.call(h,d,f):p)||void 0===f)break e;d=F({},d,f);break e;case 2:Pa=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(f=i.effects)?i.effects=[o]:f.push(o))}else h={eventTime:h,lane:f,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===l?(c=l=h,u=d):l=l.next=h,s|=f;if(null===(o=o.next)){if(null===(o=i.shared.pending))break;o=(f=o).next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}if(null===l&&(u=d),i.baseState=u,i.firstBaseUpdate=c,i.lastBaseUpdate=l,null!==(t=i.shared.interleaved)){i=t;do{s|=i.lane,i=i.next}while(i!==t)}else null===a&&(i.shared.lanes=0);Nu|=s,e.lanes=s,e.memoizedState=d}}function Ua(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(a(191,i));i.call(r)}}}var Ba=(new r.Component).refs;function ja(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:F({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Ga={isMounted:function(e){return!!(e=e._reactInternals)&&Ve(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ec(),i=tc(e),a=La(r,i);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Oa(e,a,i))&&(nc(t,e,i,r),Ma(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ec(),i=tc(e),a=La(r,i);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Oa(e,a,i))&&(nc(t,e,i,r),Ma(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),r=tc(e),i=La(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=Oa(e,i,r))&&(nc(t,e,r,n),Ma(t,e,r))}};function Va(e,t,n,r,i,a,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,s):!t.prototype||!t.prototype.isPureReactComponent||(!ur(n,r)||!ur(i,a))}function Ka(e,t,n){var r=!1,i=Ci,a=t.contextType;return"object"===typeof a&&null!==a?a=xa(a):(i=Di(t)?Pi:Ai.current,a=(r=null!==(r=t.contextTypes)&&void 0!==r)?_i(e,i):Ci),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Ga,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function Ha(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Ga.enqueueReplaceState(t,t.state,null)}function za(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=Ba,_a(e);var a=t.contextType;"object"===typeof a&&null!==a?i.context=xa(a):(a=Di(t)?Pi:Ai.current,i.context=_i(e,a)),i.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(ja(e,t,a,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&Ga.enqueueReplaceState(i,i.state,null),Fa(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}function Wa(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,e));var i=r,s=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===s?t.ref:(t=function(e){var t=i.refs;t===Ba&&(t=i.refs={}),null===e?delete t[s]:t[s]=e},t._stringRef=s,t)}if("string"!==typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function qa(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Ya(e){return(0,e._init)(e._payload)}function Qa(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Lc(e,t)).index=0,e.sibling=null,e}function s(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Fc(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){var a=n.type;return a===S?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===D&&Ya(a)===t.type)?((r=i(t,n.props)).ref=Wa(e,t,n),r.return=e,r):((r=Oc(n.type,n.key,n.props,null,e.mode,r)).ref=Wa(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Uc(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function d(e,t,n,r,a){return null===t||7!==t.tag?((t=Mc(n,e.mode,r,a)).return=e,t):((t=i(t,n)).return=e,t)}function f(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Fc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case T:return(n=Oc(t.type,t.key,t.props,null,e.mode,n)).ref=Wa(e,null,t),n.return=e,n;case E:return(t=Uc(t,e.mode,n)).return=e,t;case D:return f(e,(0,t._init)(t._payload),n)}if(te(t)||M(t))return(t=Mc(t,e.mode,n,null)).return=e,t;qa(e,t)}return null}function h(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case T:return n.key===i?c(e,t,n,r):null;case E:return n.key===i?l(e,t,n,r):null;case D:return h(e,t,(i=n._init)(n._payload),r)}if(te(n)||M(n))return null!==i?null:d(e,t,n,r,null);qa(e,n)}return null}function p(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r)return u(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case T:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case E:return l(t,e=e.get(null===r.key?n:r.key)||null,r,i);case D:return p(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||M(r))return d(t,e=e.get(n)||null,r,i,null);qa(t,r)}return null}function v(i,a,o,u){for(var c=null,l=null,d=a,v=a=0,g=null;null!==d&&v<o.length;v++){d.index>v?(g=d,d=null):g=d.sibling;var m=h(i,d,o[v],u);if(null===m){null===d&&(d=g);break}e&&d&&null===m.alternate&&t(i,d),a=s(m,a,v),null===l?c=m:l.sibling=m,l=m,d=g}if(v===o.length)return n(i,d),ia&&Xi(i,v),c;if(null===d){for(;v<o.length;v++)null!==(d=f(i,o[v],u))&&(a=s(d,a,v),null===l?c=d:l.sibling=d,l=d);return ia&&Xi(i,v),c}for(d=r(i,d);v<o.length;v++)null!==(g=p(d,i,v,o[v],u))&&(e&&null!==g.alternate&&d.delete(null===g.key?v:g.key),a=s(g,a,v),null===l?c=g:l.sibling=g,l=g);return e&&d.forEach((function(e){return t(i,e)})),ia&&Xi(i,v),c}function g(i,o,u,c){var l=M(u);if("function"!==typeof l)throw Error(a(150));if(null==(u=l.call(u)))throw Error(a(151));for(var d=l=null,v=o,g=o=0,m=null,y=u.next();null!==v&&!y.done;g++,y=u.next()){v.index>g?(m=v,v=null):m=v.sibling;var b=h(i,v,y.value,c);if(null===b){null===v&&(v=m);break}e&&v&&null===b.alternate&&t(i,v),o=s(b,o,g),null===d?l=b:d.sibling=b,d=b,v=m}if(y.done)return n(i,v),ia&&Xi(i,g),l;if(null===v){for(;!y.done;g++,y=u.next())null!==(y=f(i,y.value,c))&&(o=s(y,o,g),null===d?l=y:d.sibling=y,d=y);return ia&&Xi(i,g),l}for(v=r(i,v);!y.done;g++,y=u.next())null!==(y=p(v,i,g,y.value,c))&&(e&&null!==y.alternate&&v.delete(null===y.key?g:y.key),o=s(y,o,g),null===d?l=y:d.sibling=y,d=y);return e&&v.forEach((function(e){return t(i,e)})),ia&&Xi(i,g),l}return function e(r,a,s,u){if("object"===typeof s&&null!==s&&s.type===S&&null===s.key&&(s=s.props.children),"object"===typeof s&&null!==s){switch(s.$$typeof){case T:e:{for(var c=s.key,l=a;null!==l;){if(l.key===c){if((c=s.type)===S){if(7===l.tag){n(r,l.sibling),(a=i(l,s.props.children)).return=r,r=a;break e}}else if(l.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===D&&Ya(c)===l.type){n(r,l.sibling),(a=i(l,s.props)).ref=Wa(r,l,s),a.return=r,r=a;break e}n(r,l);break}t(r,l),l=l.sibling}s.type===S?((a=Mc(s.props.children,r.mode,u,s.key)).return=r,r=a):((u=Oc(s.type,s.key,s.props,null,r.mode,u)).ref=Wa(r,a,s),u.return=r,r=u)}return o(r);case E:e:{for(l=s.key;null!==a;){if(a.key===l){if(4===a.tag&&a.stateNode.containerInfo===s.containerInfo&&a.stateNode.implementation===s.implementation){n(r,a.sibling),(a=i(a,s.children||[])).return=r,r=a;break e}n(r,a);break}t(r,a),a=a.sibling}(a=Uc(s,r.mode,u)).return=r,r=a}return o(r);case D:return e(r,a,(l=s._init)(s._payload),u)}if(te(s))return v(r,a,s,u);if(M(s))return g(r,a,s,u);qa(r,s)}return"string"===typeof s&&""!==s||"number"===typeof s?(s=""+s,null!==a&&6===a.tag?(n(r,a.sibling),(a=i(a,s)).return=r,r=a):(n(r,a),(a=Fc(s,r.mode,u)).return=r,r=a),o(r)):n(r,a)}}var Ja=Qa(!0),$a=Qa(!1),Xa={},Za=wi(Xa),es=wi(Xa),ts=wi(Xa);function ns(e){if(e===Xa)throw Error(a(174));return e}function rs(e,t){switch(Ri(ts,t),Ri(es,e),Ri(Za,Xa),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ue(null,"");break;default:t=ue(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}xi(Za),Ri(Za,t)}function is(){xi(Za),xi(es),xi(ts)}function as(e){ns(ts.current);var t=ns(Za.current),n=ue(t,e.type);t!==n&&(Ri(es,e),Ri(Za,n))}function ss(e){es.current===e&&(xi(Za),xi(es))}var os=wi(0);function us(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var cs=[];function ls(){for(var e=0;e<cs.length;e++)cs[e]._workInProgressVersionPrimary=null;cs.length=0}var ds=k.ReactCurrentDispatcher,fs=k.ReactCurrentBatchConfig,hs=0,ps=null,vs=null,gs=null,ms=!1,ys=!1,bs=0,ks=0;function Ts(){throw Error(a(321))}function Es(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!or(e[n],t[n]))return!1;return!0}function Ss(e,t,n,r,i,s){if(hs=s,ps=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ds.current=null===e||null===e.memoizedState?so:oo,e=n(r,i),ys){s=0;do{if(ys=!1,bs=0,25<=s)throw Error(a(301));s+=1,gs=vs=null,t.updateQueue=null,ds.current=uo,e=n(r,i)}while(ys)}if(ds.current=ao,t=null!==vs&&null!==vs.next,hs=0,gs=vs=ps=null,ms=!1,t)throw Error(a(300));return e}function ws(){var e=0!==bs;return bs=0,e}function xs(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===gs?ps.memoizedState=gs=e:gs=gs.next=e,gs}function Rs(){if(null===vs){var e=ps.alternate;e=null!==e?e.memoizedState:null}else e=vs.next;var t=null===gs?ps.memoizedState:gs.next;if(null!==t)gs=t,vs=e;else{if(null===e)throw Error(a(310));e={memoizedState:(vs=e).memoizedState,baseState:vs.baseState,baseQueue:vs.baseQueue,queue:vs.queue,next:null},null===gs?ps.memoizedState=gs=e:gs=gs.next=e}return gs}function Cs(e,t){return"function"===typeof t?t(e):t}function As(e){var t=Rs(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=vs,i=r.baseQueue,s=n.pending;if(null!==s){if(null!==i){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,n.pending=null}if(null!==i){s=i.next,r=r.baseState;var u=o=null,c=null,l=s;do{var d=l.lane;if((hs&d)===d)null!==c&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:e(r,l.action);else{var f={lane:d,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};null===c?(u=c=f,o=r):c=c.next=f,ps.lanes|=d,Nu|=d}l=l.next}while(null!==l&&l!==s);null===c?o=r:c.next=u,or(r,t.memoizedState)||(ko=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{s=i.lane,ps.lanes|=s,Nu|=s,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Is(e){var t=Rs(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,s=t.memoizedState;if(null!==i){n.pending=null;var o=i=i.next;do{s=e(s,o.action),o=o.next}while(o!==i);or(s,t.memoizedState)||(ko=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,r]}function Ps(){}function _s(e,t){var n=ps,r=Rs(),i=t(),s=!or(r.memoizedState,i);if(s&&(r.memoizedState=i,ko=!0),r=r.queue,Ks(Os.bind(null,n,r,e),[e]),r.getSnapshot!==t||s||null!==gs&&1&gs.memoizedState.tag){if(n.flags|=2048,Us(9,Ls.bind(null,n,r,i,t),void 0,null),null===Iu)throw Error(a(349));0!==(30&hs)||Ds(n,t,i)}return i}function Ds(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ps.updateQueue)?(t={lastEffect:null,stores:null},ps.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ls(e,t,n,r){t.value=n,t.getSnapshot=r,Ms(t)&&Ns(e)}function Os(e,t,n){return n((function(){Ms(t)&&Ns(e)}))}function Ms(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!or(e,n)}catch(r){return!0}}function Ns(e){var t=Ia(e,1);null!==t&&nc(t,e,1,-1)}function Fs(e){var t=xs();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Cs,lastRenderedState:e},t.queue=e,e=e.dispatch=to.bind(null,ps,e),[t.memoizedState,e]}function Us(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=ps.updateQueue)?(t={lastEffect:null,stores:null},ps.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Bs(){return Rs().memoizedState}function js(e,t,n,r){var i=xs();ps.flags|=e,i.memoizedState=Us(1|t,n,void 0,void 0===r?null:r)}function Gs(e,t,n,r){var i=Rs();r=void 0===r?null:r;var a=void 0;if(null!==vs){var s=vs.memoizedState;if(a=s.destroy,null!==r&&Es(r,s.deps))return void(i.memoizedState=Us(t,n,a,r))}ps.flags|=e,i.memoizedState=Us(1|t,n,a,r)}function Vs(e,t){return js(8390656,8,e,t)}function Ks(e,t){return Gs(2048,8,e,t)}function Hs(e,t){return Gs(4,2,e,t)}function zs(e,t){return Gs(4,4,e,t)}function Ws(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function qs(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Gs(4,4,Ws.bind(null,t,e),n)}function Ys(){}function Qs(e,t){var n=Rs();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Es(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Js(e,t){var n=Rs();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Es(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function $s(e,t,n){return 0===(21&hs)?(e.baseState&&(e.baseState=!1,ko=!0),e.memoizedState=n):(or(n,t)||(n=vt(),ps.lanes|=n,Nu|=n,e.baseState=!0),t)}function Xs(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var r=fs.transition;fs.transition={};try{e(!1),t()}finally{bt=n,fs.transition=r}}function Zs(){return Rs().memoizedState}function eo(e,t,n){var r=tc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},no(e))ro(t,n);else if(null!==(n=Aa(e,t,n,r))){nc(n,e,r,ec()),io(n,t,r)}}function to(e,t,n){var r=tc(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(no(e))ro(t,i);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var s=t.lastRenderedState,o=a(s,n);if(i.hasEagerState=!0,i.eagerState=o,or(o,s)){var u=t.interleaved;return null===u?(i.next=i,Ca(t)):(i.next=u.next,u.next=i),void(t.interleaved=i)}}catch(c){}null!==(n=Aa(e,t,i,r))&&(nc(n,e,r,i=ec()),io(n,t,r))}}function no(e){var t=e.alternate;return e===ps||null!==t&&t===ps}function ro(e,t){ys=ms=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function io(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var ao={readContext:xa,useCallback:Ts,useContext:Ts,useEffect:Ts,useImperativeHandle:Ts,useInsertionEffect:Ts,useLayoutEffect:Ts,useMemo:Ts,useReducer:Ts,useRef:Ts,useState:Ts,useDebugValue:Ts,useDeferredValue:Ts,useTransition:Ts,useMutableSource:Ts,useSyncExternalStore:Ts,useId:Ts,unstable_isNewReconciler:!1},so={readContext:xa,useCallback:function(e,t){return xs().memoizedState=[e,void 0===t?null:t],e},useContext:xa,useEffect:Vs,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,js(4194308,4,Ws.bind(null,t,e),n)},useLayoutEffect:function(e,t){return js(4194308,4,e,t)},useInsertionEffect:function(e,t){return js(4,2,e,t)},useMemo:function(e,t){var n=xs();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=xs();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=eo.bind(null,ps,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},xs().memoizedState=e},useState:Fs,useDebugValue:Ys,useDeferredValue:function(e){return xs().memoizedState=e},useTransition:function(){var e=Fs(!1),t=e[0];return e=Xs.bind(null,e[1]),xs().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=ps,i=xs();if(ia){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===Iu)throw Error(a(349));0!==(30&hs)||Ds(r,t,n)}i.memoizedState=n;var s={value:n,getSnapshot:t};return i.queue=s,Vs(Os.bind(null,r,s,e),[e]),r.flags|=2048,Us(9,Ls.bind(null,r,s,n,t),void 0,null),n},useId:function(){var e=xs(),t=Iu.identifierPrefix;if(ia){var n=$i;t=":"+t+"R"+(n=(Ji&~(1<<32-st(Ji)-1)).toString(32)+n),0<(n=bs++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ks++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},oo={readContext:xa,useCallback:Qs,useContext:xa,useEffect:Ks,useImperativeHandle:qs,useInsertionEffect:Hs,useLayoutEffect:zs,useMemo:Js,useReducer:As,useRef:Bs,useState:function(){return As(Cs)},useDebugValue:Ys,useDeferredValue:function(e){return $s(Rs(),vs.memoizedState,e)},useTransition:function(){return[As(Cs)[0],Rs().memoizedState]},useMutableSource:Ps,useSyncExternalStore:_s,useId:Zs,unstable_isNewReconciler:!1},uo={readContext:xa,useCallback:Qs,useContext:xa,useEffect:Ks,useImperativeHandle:qs,useInsertionEffect:Hs,useLayoutEffect:zs,useMemo:Js,useReducer:Is,useRef:Bs,useState:function(){return Is(Cs)},useDebugValue:Ys,useDeferredValue:function(e){var t=Rs();return null===vs?t.memoizedState=e:$s(t,vs.memoizedState,e)},useTransition:function(){return[Is(Cs)[0],Rs().memoizedState]},useMutableSource:Ps,useSyncExternalStore:_s,useId:Zs,unstable_isNewReconciler:!1};function co(e,t){try{var n="",r=t;do{n+=G(r),r=r.return}while(r);var i=n}catch(a){i="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:i,digest:null}}function lo(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function fo(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var ho="function"===typeof WeakMap?WeakMap:Map;function po(e,t,n){(n=La(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Hu||(Hu=!0,zu=r),fo(0,t)},n}function vo(e,t,n){(n=La(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){fo(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){fo(0,t),"function"!==typeof r&&(null===Wu?Wu=new Set([this]):Wu.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function go(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ho;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=xc.bind(null,e,t,n),t.then(e,e))}function mo(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function yo(e,t,n,r,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=La(-1,1)).tag=2,Oa(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var bo=k.ReactCurrentOwner,ko=!1;function To(e,t,n,r){t.child=null===e?$a(t,null,n,r):Ja(t,e.child,n,r)}function Eo(e,t,n,r,i){n=n.render;var a=t.ref;return wa(t,i),r=Ss(e,t,n,r,a,i),n=ws(),null===e||ko?(ia&&n&&ea(t),t.flags|=1,To(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Ho(e,t,i))}function So(e,t,n,r,i){if(null===e){var a=n.type;return"function"!==typeof a||Dc(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Oc(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,wo(e,t,a,r,i))}if(a=e.child,0===(e.lanes&i)){var s=a.memoizedProps;if((n=null!==(n=n.compare)?n:ur)(s,r)&&e.ref===t.ref)return Ho(e,t,i)}return t.flags|=1,(e=Lc(a,r)).ref=t.ref,e.return=t,t.child=e}function wo(e,t,n,r,i){if(null!==e){var a=e.memoizedProps;if(ur(a,r)&&e.ref===t.ref){if(ko=!1,t.pendingProps=r=a,0===(e.lanes&i))return t.lanes=e.lanes,Ho(e,t,i);0!==(131072&e.flags)&&(ko=!0)}}return Co(e,t,n,r,i)}function xo(e,t,n){var r=t.pendingProps,i=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ri(Lu,Du),Du|=n;else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ri(Lu,Du),Du|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==a?a.baseLanes:n,Ri(Lu,Du),Du|=r}else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,Ri(Lu,Du),Du|=r;return To(e,t,i,n),t.child}function Ro(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Co(e,t,n,r,i){var a=Di(n)?Pi:Ai.current;return a=_i(t,a),wa(t,i),n=Ss(e,t,n,r,a,i),r=ws(),null===e||ko?(ia&&r&&ea(t),t.flags|=1,To(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Ho(e,t,i))}function Ao(e,t,n,r,i){if(Di(n)){var a=!0;Ni(t)}else a=!1;if(wa(t,i),null===t.stateNode)Ko(e,t),Ka(t,n,r),za(t,n,r,i),r=!0;else if(null===e){var s=t.stateNode,o=t.memoizedProps;s.props=o;var u=s.context,c=n.contextType;"object"===typeof c&&null!==c?c=xa(c):c=_i(t,c=Di(n)?Pi:Ai.current);var l=n.getDerivedStateFromProps,d="function"===typeof l||"function"===typeof s.getSnapshotBeforeUpdate;d||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(o!==r||u!==c)&&Ha(t,s,r,c),Pa=!1;var f=t.memoizedState;s.state=f,Fa(t,r,s,i),u=t.memoizedState,o!==r||f!==u||Ii.current||Pa?("function"===typeof l&&(ja(t,n,l,r),u=t.memoizedState),(o=Pa||Va(t,n,o,r,f,u,c))?(d||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.flags|=4194308)):("function"===typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),s.props=r,s.state=u,s.context=c,r=o):("function"===typeof s.componentDidMount&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,Da(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:ga(t.type,o),s.props=c,d=t.pendingProps,f=s.context,"object"===typeof(u=n.contextType)&&null!==u?u=xa(u):u=_i(t,u=Di(n)?Pi:Ai.current);var h=n.getDerivedStateFromProps;(l="function"===typeof h||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(o!==d||f!==u)&&Ha(t,s,r,u),Pa=!1,f=t.memoizedState,s.state=f,Fa(t,r,s,i);var p=t.memoizedState;o!==d||f!==p||Ii.current||Pa?("function"===typeof h&&(ja(t,n,h,r),p=t.memoizedState),(c=Pa||Va(t,n,c,r,f,p,u)||!1)?(l||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(r,p,u),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,p,u)),"function"===typeof s.componentDidUpdate&&(t.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof s.componentDidUpdate||o===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),s.props=r,s.state=p,s.context=u,r=c):("function"!==typeof s.componentDidUpdate||o===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),r=!1)}return Io(e,t,n,r,a,i)}function Io(e,t,n,r,i,a){Ro(e,t);var s=0!==(128&t.flags);if(!r&&!s)return i&&Fi(t,n,!1),Ho(e,t,a);r=t.stateNode,bo.current=t;var o=s&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&s?(t.child=Ja(t,e.child,null,a),t.child=Ja(t,null,o,a)):To(e,t,o,a),t.memoizedState=r.state,i&&Fi(t,n,!0),t.child}function Po(e){var t=e.stateNode;t.pendingContext?Oi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Oi(0,t.context,!1),rs(e,t.containerInfo)}function _o(e,t,n,r,i){return ha(),pa(i),t.flags|=256,To(e,t,n,r),t.child}var Do,Lo,Oo,Mo={dehydrated:null,treeContext:null,retryLane:0};function No(e){return{baseLanes:e,cachePool:null,transitions:null}}function Fo(e,t,n){var r,i=t.pendingProps,s=os.current,o=!1,u=0!==(128&t.flags);if((r=u)||(r=(null===e||null!==e.memoizedState)&&0!==(2&s)),r?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(s|=1),Ri(os,1&s),null===e)return ca(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(u=i.children,e=i.fallback,o?(i=t.mode,o=t.child,u={mode:"hidden",children:u},0===(1&i)&&null!==o?(o.childLanes=0,o.pendingProps=u):o=Nc(u,i,0,null),e=Mc(e,i,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=No(n),t.memoizedState=Mo,e):Uo(t,u));if(null!==(s=e.memoizedState)&&null!==(r=s.dehydrated))return function(e,t,n,r,i,s,o){if(n)return 256&t.flags?(t.flags&=-257,Bo(e,t,o,r=lo(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=r.fallback,i=t.mode,r=Nc({mode:"visible",children:r.children},i,0,null),(s=Mc(s,i,o,null)).flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,0!==(1&t.mode)&&Ja(t,e.child,null,o),t.child.memoizedState=No(o),t.memoizedState=Mo,s);if(0===(1&t.mode))return Bo(e,t,o,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var u=r.dgst;return r=u,Bo(e,t,o,r=lo(s=Error(a(419)),r,void 0))}if(u=0!==(o&e.childLanes),ko||u){if(null!==(r=Iu)){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|o))?0:i)&&i!==s.retryLane&&(s.retryLane=i,Ia(e,i),nc(r,e,i,-1))}return vc(),Bo(e,t,o,r=lo(Error(a(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Cc.bind(null,e),i._reactRetry=t,null):(e=s.treeContext,ra=ci(i.nextSibling),na=t,ia=!0,aa=null,null!==e&&(qi[Yi++]=Ji,qi[Yi++]=$i,qi[Yi++]=Qi,Ji=e.id,$i=e.overflow,Qi=t),(t=Uo(t,r.children)).flags|=4096,t)}(e,t,u,i,r,s,n);if(o){o=i.fallback,u=t.mode,r=(s=e.child).sibling;var c={mode:"hidden",children:i.children};return 0===(1&u)&&t.child!==s?((i=t.child).childLanes=0,i.pendingProps=c,t.deletions=null):(i=Lc(s,c)).subtreeFlags=14680064&s.subtreeFlags,null!==r?o=Lc(r,o):(o=Mc(o,u,n,null)).flags|=2,o.return=t,i.return=t,i.sibling=o,t.child=i,i=o,o=t.child,u=null===(u=e.child.memoizedState)?No(n):{baseLanes:u.baseLanes|n,cachePool:null,transitions:u.transitions},o.memoizedState=u,o.childLanes=e.childLanes&~n,t.memoizedState=Mo,i}return e=(o=e.child).sibling,i=Lc(o,{mode:"visible",children:i.children}),0===(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Uo(e,t){return(t=Nc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Bo(e,t,n,r){return null!==r&&pa(r),Ja(t,e.child,null,n),(e=Uo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function jo(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Sa(e.return,t,n)}function Go(e,t,n,r,i){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function Vo(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(To(e,t,r.children,n),0!==(2&(r=os.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&jo(e,n,t);else if(19===e.tag)jo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ri(os,r),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===us(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Go(t,!1,i,n,a);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===us(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Go(t,!0,n,null,a);break;case"together":Go(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ko(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ho(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Nu|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Lc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Lc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function zo(e,t){if(!ia)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Wo(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function qo(e,t,n){var r=t.pendingProps;switch(ta(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wo(t),null;case 1:case 17:return Di(t.type)&&Li(),Wo(t),null;case 3:return r=t.stateNode,is(),xi(Ii),xi(Ai),ls(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(da(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==aa&&(sc(aa),aa=null))),Wo(t),null;case 5:ss(t);var i=ns(ts.current);if(n=t.type,null!==e&&null!=t.stateNode)Lo(e,t,n,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(a(166));return Wo(t),null}if(e=ns(Za.current),da(t)){r=t.stateNode,n=t.type;var s=t.memoizedProps;switch(r[fi]=t,r[hi]=s,e=0!==(1&t.mode),n){case"dialog":Br("cancel",r),Br("close",r);break;case"iframe":case"object":case"embed":Br("load",r);break;case"video":case"audio":for(i=0;i<Mr.length;i++)Br(Mr[i],r);break;case"source":Br("error",r);break;case"img":case"image":case"link":Br("error",r),Br("load",r);break;case"details":Br("toggle",r);break;case"input":J(r,s),Br("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Br("invalid",r);break;case"textarea":ie(r,s),Br("invalid",r)}for(var u in ye(n,s),i=null,s)if(s.hasOwnProperty(u)){var c=s[u];"children"===u?"string"===typeof c?r.textContent!==c&&(!0!==s.suppressHydrationWarning&&Xr(r.textContent,c,e),i=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==s.suppressHydrationWarning&&Xr(r.textContent,c,e),i=["children",""+c]):o.hasOwnProperty(u)&&null!=c&&"onScroll"===u&&Br("scroll",r)}switch(n){case"input":W(r),Z(r,s,!0);break;case"textarea":W(r),se(r);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(r.onclick=Zr)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{u=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=u.createElement(n,{is:r.is}):(e=u.createElement(n),"select"===n&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,n),e[fi]=t,e[hi]=r,Do(e,t),t.stateNode=e;e:{switch(u=be(n,r),n){case"dialog":Br("cancel",e),Br("close",e),i=r;break;case"iframe":case"object":case"embed":Br("load",e),i=r;break;case"video":case"audio":for(i=0;i<Mr.length;i++)Br(Mr[i],e);i=r;break;case"source":Br("error",e),i=r;break;case"img":case"image":case"link":Br("error",e),Br("load",e),i=r;break;case"details":Br("toggle",e),i=r;break;case"input":J(e,r),i=Q(e,r),Br("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=F({},r,{value:void 0}),Br("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),Br("invalid",e)}for(s in ye(n,i),c=i)if(c.hasOwnProperty(s)){var l=c[s];"style"===s?ge(e,l):"dangerouslySetInnerHTML"===s?null!=(l=l?l.__html:void 0)&&de(e,l):"children"===s?"string"===typeof l?("textarea"!==n||""!==l)&&fe(e,l):"number"===typeof l&&fe(e,""+l):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(o.hasOwnProperty(s)?null!=l&&"onScroll"===s&&Br("scroll",e):null!=l&&b(e,s,l,u))}switch(n){case"input":W(e),Z(e,r,!1);break;case"textarea":W(e),se(e);break;case"option":null!=r.value&&e.setAttribute("value",""+H(r.value));break;case"select":e.multiple=!!r.multiple,null!=(s=r.value)?ne(e,!!r.multiple,s,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=Zr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Wo(t),null;case 6:if(e&&null!=t.stateNode)Oo(0,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(a(166));if(n=ns(ts.current),ns(Za.current),da(t)){if(r=t.stateNode,n=t.memoizedProps,r[fi]=t,(s=r.nodeValue!==n)&&null!==(e=na))switch(e.tag){case 3:Xr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Xr(r.nodeValue,n,0!==(1&e.mode))}s&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[fi]=t,t.stateNode=r}return Wo(t),null;case 13:if(xi(os),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ia&&null!==ra&&0!==(1&t.mode)&&0===(128&t.flags))fa(),ha(),t.flags|=98560,s=!1;else if(s=da(t),null!==r&&null!==r.dehydrated){if(null===e){if(!s)throw Error(a(318));if(!(s=null!==(s=t.memoizedState)?s.dehydrated:null))throw Error(a(317));s[fi]=t}else ha(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Wo(t),s=!1}else null!==aa&&(sc(aa),aa=null),s=!0;if(!s)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&os.current)?0===Ou&&(Ou=3):vc())),null!==t.updateQueue&&(t.flags|=4),Wo(t),null);case 4:return is(),null===e&&Vr(t.stateNode.containerInfo),Wo(t),null;case 10:return Ea(t.type._context),Wo(t),null;case 19:if(xi(os),null===(s=t.memoizedState))return Wo(t),null;if(r=0!==(128&t.flags),null===(u=s.rendering))if(r)zo(s,!1);else{if(0!==Ou||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(u=us(e))){for(t.flags|=128,zo(s,!1),null!==(r=u.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(s=n).flags&=14680066,null===(u=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=u.childLanes,s.lanes=u.lanes,s.child=u.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=u.memoizedProps,s.memoizedState=u.memoizedState,s.updateQueue=u.updateQueue,s.type=u.type,e=u.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ri(os,1&os.current|2),t.child}e=e.sibling}null!==s.tail&&$e()>Vu&&(t.flags|=128,r=!0,zo(s,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=us(u))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),zo(s,!0),null===s.tail&&"hidden"===s.tailMode&&!u.alternate&&!ia)return Wo(t),null}else 2*$e()-s.renderingStartTime>Vu&&1073741824!==n&&(t.flags|=128,r=!0,zo(s,!1),t.lanes=4194304);s.isBackwards?(u.sibling=t.child,t.child=u):(null!==(n=s.last)?n.sibling=u:t.child=u,s.last=u)}return null!==s.tail?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=$e(),t.sibling=null,n=os.current,Ri(os,r?1&n|2:1&n),t):(Wo(t),null);case 22:case 23:return dc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Du)&&(Wo(t),6&t.subtreeFlags&&(t.flags|=8192)):Wo(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function Yo(e,t){switch(ta(t),t.tag){case 1:return Di(t.type)&&Li(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return is(),xi(Ii),xi(Ai),ls(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return ss(t),null;case 13:if(xi(os),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));ha()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return xi(os),null;case 4:return is(),null;case 10:return Ea(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}Do=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Lo=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,ns(Za.current);var a,s=null;switch(n){case"input":i=Q(e,i),r=Q(e,r),s=[];break;case"select":i=F({},i,{value:void 0}),r=F({},r,{value:void 0}),s=[];break;case"textarea":i=re(e,i),r=re(e,r),s=[];break;default:"function"!==typeof i.onClick&&"function"===typeof r.onClick&&(e.onclick=Zr)}for(l in ye(n,r),n=null,i)if(!r.hasOwnProperty(l)&&i.hasOwnProperty(l)&&null!=i[l])if("style"===l){var u=i[l];for(a in u)u.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==l&&"children"!==l&&"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&"autoFocus"!==l&&(o.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in r){var c=r[l];if(u=null!=i?i[l]:void 0,r.hasOwnProperty(l)&&c!==u&&(null!=c||null!=u))if("style"===l)if(u){for(a in u)!u.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&u[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(s||(s=[]),s.push(l,n)),n=c;else"dangerouslySetInnerHTML"===l?(c=c?c.__html:void 0,u=u?u.__html:void 0,null!=c&&u!==c&&(s=s||[]).push(l,c)):"children"===l?"string"!==typeof c&&"number"!==typeof c||(s=s||[]).push(l,""+c):"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&(o.hasOwnProperty(l)?(null!=c&&"onScroll"===l&&Br("scroll",e),s||u===c||(s=[])):(s=s||[]).push(l,c))}n&&(s=s||[]).push("style",n);var l=s;(t.updateQueue=l)&&(t.flags|=4)}},Oo=function(e,t,n,r){n!==r&&(t.flags|=4)};var Qo=!1,Jo=!1,$o="function"===typeof WeakSet?WeakSet:Set,Xo=null;function Zo(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){wc(e,t,r)}else n.current=null}function eu(e,t,n){try{n()}catch(r){wc(e,t,r)}}var tu=!1;function nu(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var a=i.destroy;i.destroy=void 0,void 0!==a&&eu(t,n,a)}i=i.next}while(i!==r)}}function ru(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function iu(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function au(e){var t=e.alternate;null!==t&&(e.alternate=null,au(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[fi],delete t[hi],delete t[vi],delete t[gi],delete t[mi])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function su(e){return 5===e.tag||3===e.tag||4===e.tag}function ou(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||su(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function uu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Zr));else if(4!==r&&null!==(e=e.child))for(uu(e,t,n),e=e.sibling;null!==e;)uu(e,t,n),e=e.sibling}function cu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(cu(e,t,n),e=e.sibling;null!==e;)cu(e,t,n),e=e.sibling}var lu=null,du=!1;function fu(e,t,n){for(n=n.child;null!==n;)hu(e,t,n),n=n.sibling}function hu(e,t,n){if(at&&"function"===typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(it,n)}catch(o){}switch(n.tag){case 5:Jo||Zo(n,t);case 6:var r=lu,i=du;lu=null,fu(e,t,n),du=i,null!==(lu=r)&&(du?(e=lu,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):lu.removeChild(n.stateNode));break;case 18:null!==lu&&(du?(e=lu,n=n.stateNode,8===e.nodeType?ui(e.parentNode,n):1===e.nodeType&&ui(e,n),Vt(e)):ui(lu,n.stateNode));break;case 4:r=lu,i=du,lu=n.stateNode.containerInfo,du=!0,fu(e,t,n),lu=r,du=i;break;case 0:case 11:case 14:case 15:if(!Jo&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var a=i,s=a.destroy;a=a.tag,void 0!==s&&(0!==(2&a)||0!==(4&a))&&eu(n,t,s),i=i.next}while(i!==r)}fu(e,t,n);break;case 1:if(!Jo&&(Zo(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(o){wc(n,t,o)}fu(e,t,n);break;case 21:fu(e,t,n);break;case 22:1&n.mode?(Jo=(r=Jo)||null!==n.memoizedState,fu(e,t,n),Jo=r):fu(e,t,n);break;default:fu(e,t,n)}}function pu(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new $o),t.forEach((function(t){var r=Ac.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function vu(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var s=e,o=t,u=o;e:for(;null!==u;){switch(u.tag){case 5:lu=u.stateNode,du=!1;break e;case 3:case 4:lu=u.stateNode.containerInfo,du=!0;break e}u=u.return}if(null===lu)throw Error(a(160));hu(s,o,i),lu=null,du=!1;var c=i.alternate;null!==c&&(c.return=null),i.return=null}catch(l){wc(i,t,l)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gu(t,e),t=t.sibling}function gu(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(vu(t,e),mu(e),4&r){try{nu(3,e,e.return),ru(3,e)}catch(g){wc(e,e.return,g)}try{nu(5,e,e.return)}catch(g){wc(e,e.return,g)}}break;case 1:vu(t,e),mu(e),512&r&&null!==n&&Zo(n,n.return);break;case 5:if(vu(t,e),mu(e),512&r&&null!==n&&Zo(n,n.return),32&e.flags){var i=e.stateNode;try{fe(i,"")}catch(g){wc(e,e.return,g)}}if(4&r&&null!=(i=e.stateNode)){var s=e.memoizedProps,o=null!==n?n.memoizedProps:s,u=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===u&&"radio"===s.type&&null!=s.name&&$(i,s),be(u,o);var l=be(u,s);for(o=0;o<c.length;o+=2){var d=c[o],f=c[o+1];"style"===d?ge(i,f):"dangerouslySetInnerHTML"===d?de(i,f):"children"===d?fe(i,f):b(i,d,f,l)}switch(u){case"input":X(i,s);break;case"textarea":ae(i,s);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var p=s.value;null!=p?ne(i,!!s.multiple,p,!1):h!==!!s.multiple&&(null!=s.defaultValue?ne(i,!!s.multiple,s.defaultValue,!0):ne(i,!!s.multiple,s.multiple?[]:"",!1))}i[hi]=s}catch(g){wc(e,e.return,g)}}break;case 6:if(vu(t,e),mu(e),4&r){if(null===e.stateNode)throw Error(a(162));i=e.stateNode,s=e.memoizedProps;try{i.nodeValue=s}catch(g){wc(e,e.return,g)}}break;case 3:if(vu(t,e),mu(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Vt(t.containerInfo)}catch(g){wc(e,e.return,g)}break;case 4:default:vu(t,e),mu(e);break;case 13:vu(t,e),mu(e),8192&(i=e.child).flags&&(s=null!==i.memoizedState,i.stateNode.isHidden=s,!s||null!==i.alternate&&null!==i.alternate.memoizedState||(Gu=$e())),4&r&&pu(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Jo=(l=Jo)||d,vu(t,e),Jo=l):vu(t,e),mu(e),8192&r){if(l=null!==e.memoizedState,(e.stateNode.isHidden=l)&&!d&&0!==(1&e.mode))for(Xo=e,d=e.child;null!==d;){for(f=Xo=d;null!==Xo;){switch(p=(h=Xo).child,h.tag){case 0:case 11:case 14:case 15:nu(4,h,h.return);break;case 1:Zo(h,h.return);var v=h.stateNode;if("function"===typeof v.componentWillUnmount){r=h,n=h.return;try{t=r,v.props=t.memoizedProps,v.state=t.memoizedState,v.componentWillUnmount()}catch(g){wc(r,n,g)}}break;case 5:Zo(h,h.return);break;case 22:if(null!==h.memoizedState){Tu(f);continue}}null!==p?(p.return=h,Xo=p):Tu(f)}d=d.sibling}e:for(d=null,f=e;;){if(5===f.tag){if(null===d){d=f;try{i=f.stateNode,l?"function"===typeof(s=i.style).setProperty?s.setProperty("display","none","important"):s.display="none":(u=f.stateNode,o=void 0!==(c=f.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,u.style.display=ve("display",o))}catch(g){wc(e,e.return,g)}}}else if(6===f.tag){if(null===d)try{f.stateNode.nodeValue=l?"":f.memoizedProps}catch(g){wc(e,e.return,g)}}else if((22!==f.tag&&23!==f.tag||null===f.memoizedState||f===e)&&null!==f.child){f.child.return=f,f=f.child;continue}if(f===e)break e;for(;null===f.sibling;){if(null===f.return||f.return===e)break e;d===f&&(d=null),f=f.return}d===f&&(d=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:vu(t,e),mu(e),4&r&&pu(e);case 21:}}function mu(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(su(n)){var r=n;break e}n=n.return}throw Error(a(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(fe(i,""),r.flags&=-33),cu(e,ou(e),i);break;case 3:case 4:var s=r.stateNode.containerInfo;uu(e,ou(e),s);break;default:throw Error(a(161))}}catch(o){wc(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yu(e,t,n){Xo=e,bu(e,t,n)}function bu(e,t,n){for(var r=0!==(1&e.mode);null!==Xo;){var i=Xo,a=i.child;if(22===i.tag&&r){var s=null!==i.memoizedState||Qo;if(!s){var o=i.alternate,u=null!==o&&null!==o.memoizedState||Jo;o=Qo;var c=Jo;if(Qo=s,(Jo=u)&&!c)for(Xo=i;null!==Xo;)u=(s=Xo).child,22===s.tag&&null!==s.memoizedState?Eu(i):null!==u?(u.return=s,Xo=u):Eu(i);for(;null!==a;)Xo=a,bu(a,t,n),a=a.sibling;Xo=i,Qo=o,Jo=c}ku(e)}else 0!==(8772&i.subtreeFlags)&&null!==a?(a.return=i,Xo=a):ku(e)}}function ku(e){for(;null!==Xo;){var t=Xo;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Jo||ru(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Jo)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:ga(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&Ua(t,s,r);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Ua(t,o,n)}break;case 5:var u=t.stateNode;if(null===n&&4&t.flags){n=u;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var l=t.alternate;if(null!==l){var d=l.memoizedState;if(null!==d){var f=d.dehydrated;null!==f&&Vt(f)}}}break;default:throw Error(a(163))}Jo||512&t.flags&&iu(t)}catch(h){wc(t,t.return,h)}}if(t===e){Xo=null;break}if(null!==(n=t.sibling)){n.return=t.return,Xo=n;break}Xo=t.return}}function Tu(e){for(;null!==Xo;){var t=Xo;if(t===e){Xo=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Xo=n;break}Xo=t.return}}function Eu(e){for(;null!==Xo;){var t=Xo;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ru(4,t)}catch(u){wc(t,n,u)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(u){wc(t,i,u)}}var a=t.return;try{iu(t)}catch(u){wc(t,a,u)}break;case 5:var s=t.return;try{iu(t)}catch(u){wc(t,s,u)}}}catch(u){wc(t,t.return,u)}if(t===e){Xo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Xo=o;break}Xo=t.return}}var Su,wu=Math.ceil,xu=k.ReactCurrentDispatcher,Ru=k.ReactCurrentOwner,Cu=k.ReactCurrentBatchConfig,Au=0,Iu=null,Pu=null,_u=0,Du=0,Lu=wi(0),Ou=0,Mu=null,Nu=0,Fu=0,Uu=0,Bu=null,ju=null,Gu=0,Vu=1/0,Ku=null,Hu=!1,zu=null,Wu=null,qu=!1,Yu=null,Qu=0,Ju=0,$u=null,Xu=-1,Zu=0;function ec(){return 0!==(6&Au)?$e():-1!==Xu?Xu:Xu=$e()}function tc(e){return 0===(1&e.mode)?1:0!==(2&Au)&&0!==_u?_u&-_u:null!==va.transition?(0===Zu&&(Zu=vt()),Zu):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Jt(e.type)}function nc(e,t,n,r){if(50<Ju)throw Ju=0,$u=null,Error(a(185));mt(e,n,r),0!==(2&Au)&&e===Iu||(e===Iu&&(0===(2&Au)&&(Fu|=n),4===Ou&&oc(e,_u)),rc(e,r),1===n&&0===Au&&0===(1&t.mode)&&(Vu=$e()+500,Bi&&Vi()))}function rc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=e.pendingLanes;0<a;){var s=31-st(a),o=1<<s,u=i[s];-1===u?0!==(o&n)&&0===(o&r)||(i[s]=ht(o,t)):u<=t&&(e.expiredLanes|=o),a&=~o}}(e,t);var r=ft(e,e===Iu?_u:0);if(0===r)null!==n&&Ye(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ye(n),1===t)0===e.tag?function(e){Bi=!0,Gi(e)}(uc.bind(null,e)):Gi(uc.bind(null,e)),si((function(){0===(6&Au)&&Vi()})),n=null;else{switch(kt(r)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Ic(n,ic.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ic(e,t){if(Xu=-1,Zu=0,0!==(6&Au))throw Error(a(327));var n=e.callbackNode;if(Ec()&&e.callbackNode!==n)return null;var r=ft(e,e===Iu?_u:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=gc(e,r);else{t=r;var i=Au;Au|=2;var s=pc();for(Iu===e&&_u===t||(Ku=null,Vu=$e()+500,fc(e,t));;)try{yc();break}catch(u){hc(e,u)}Ta(),xu.current=s,Au=i,null!==Pu?t=0:(Iu=null,_u=0,t=Ou)}if(0!==t){if(2===t&&(0!==(i=pt(e))&&(r=i,t=ac(e,i))),1===t)throw n=Mu,fc(e,0),oc(e,r),rc(e,$e()),n;if(6===t)oc(e,r);else{if(i=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!or(a(),i))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=gc(e,r))&&(0!==(s=pt(e))&&(r=s,t=ac(e,s))),1===t))throw n=Mu,fc(e,0),oc(e,r),rc(e,$e()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(a(345));case 2:case 5:Tc(e,ju,Ku);break;case 3:if(oc(e,r),(130023424&r)===r&&10<(t=Gu+500-$e())){if(0!==ft(e,0))break;if(((i=e.suspendedLanes)&r)!==r){ec(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(Tc.bind(null,e,ju,Ku),t);break}Tc(e,ju,Ku);break;case 4:if(oc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var o=31-st(r);s=1<<o,(o=t[o])>i&&(i=o),r&=~s}if(r=i,10<(r=(120>(r=$e()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*wu(r/1960))-r)){e.timeoutHandle=ri(Tc.bind(null,e,ju,Ku),r);break}Tc(e,ju,Ku);break;default:throw Error(a(329))}}}return rc(e,$e()),e.callbackNode===n?ic.bind(null,e):null}function ac(e,t){var n=Bu;return e.current.memoizedState.isDehydrated&&(fc(e,t).flags|=256),2!==(e=gc(e,t))&&(t=ju,ju=n,null!==t&&sc(t)),e}function sc(e){null===ju?ju=e:ju.push.apply(ju,e)}function oc(e,t){for(t&=~Uu,t&=~Fu,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-st(t),r=1<<n;e[n]=-1,t&=~r}}function uc(e){if(0!==(6&Au))throw Error(a(327));Ec();var t=ft(e,0);if(0===(1&t))return rc(e,$e()),null;var n=gc(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=ac(e,r))}if(1===n)throw n=Mu,fc(e,0),oc(e,t),rc(e,$e()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Tc(e,ju,Ku),rc(e,$e()),null}function cc(e,t){var n=Au;Au|=1;try{return e(t)}finally{0===(Au=n)&&(Vu=$e()+500,Bi&&Vi())}}function lc(e){null!==Yu&&0===Yu.tag&&0===(6&Au)&&Ec();var t=Au;Au|=1;var n=Cu.transition,r=bt;try{if(Cu.transition=null,bt=1,e)return e()}finally{bt=r,Cu.transition=n,0===(6&(Au=t))&&Vi()}}function dc(){Du=Lu.current,xi(Lu)}function fc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==Pu)for(n=Pu.return;null!==n;){var r=n;switch(ta(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Li();break;case 3:is(),xi(Ii),xi(Ai),ls();break;case 5:ss(r);break;case 4:is();break;case 13:case 19:xi(os);break;case 10:Ea(r.type._context);break;case 22:case 23:dc()}n=n.return}if(Iu=e,Pu=e=Lc(e.current,null),_u=Du=t,Ou=0,Mu=null,Uu=Fu=Nu=0,ju=Bu=null,null!==Ra){for(t=0;t<Ra.length;t++)if(null!==(r=(n=Ra[t]).interleaved)){n.interleaved=null;var i=r.next,a=n.pending;if(null!==a){var s=a.next;a.next=i,r.next=s}n.pending=r}Ra=null}return e}function hc(e,t){for(;;){var n=Pu;try{if(Ta(),ds.current=ao,ms){for(var r=ps.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}ms=!1}if(hs=0,gs=vs=ps=null,ys=!1,bs=0,Ru.current=null,null===n||null===n.return){Ou=1,Mu=t,Pu=null;break}e:{var s=e,o=n.return,u=n,c=t;if(t=_u,u.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var l=c,d=u,f=d.tag;if(0===(1&d.mode)&&(0===f||11===f||15===f)){var h=d.alternate;h?(d.updateQueue=h.updateQueue,d.memoizedState=h.memoizedState,d.lanes=h.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=mo(o);if(null!==p){p.flags&=-257,yo(p,o,u,0,t),1&p.mode&&go(s,l,t),c=l;var v=(t=p).updateQueue;if(null===v){var g=new Set;g.add(c),t.updateQueue=g}else v.add(c);break e}if(0===(1&t)){go(s,l,t),vc();break e}c=Error(a(426))}else if(ia&&1&u.mode){var m=mo(o);if(null!==m){0===(65536&m.flags)&&(m.flags|=256),yo(m,o,u,0,t),pa(co(c,u));break e}}s=c=co(c,u),4!==Ou&&(Ou=2),null===Bu?Bu=[s]:Bu.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t,Na(s,po(0,c,t));break e;case 1:u=c;var y=s.type,b=s.stateNode;if(0===(128&s.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Wu||!Wu.has(b)))){s.flags|=65536,t&=-t,s.lanes|=t,Na(s,vo(s,u,t));break e}}s=s.return}while(null!==s)}kc(n)}catch(k){t=k,Pu===n&&null!==n&&(Pu=n=n.return);continue}break}}function pc(){var e=xu.current;return xu.current=ao,null===e?ao:e}function vc(){0!==Ou&&3!==Ou&&2!==Ou||(Ou=4),null===Iu||0===(268435455&Nu)&&0===(268435455&Fu)||oc(Iu,_u)}function gc(e,t){var n=Au;Au|=2;var r=pc();for(Iu===e&&_u===t||(Ku=null,fc(e,t));;)try{mc();break}catch(i){hc(e,i)}if(Ta(),Au=n,xu.current=r,null!==Pu)throw Error(a(261));return Iu=null,_u=0,Ou}function mc(){for(;null!==Pu;)bc(Pu)}function yc(){for(;null!==Pu&&!Qe();)bc(Pu)}function bc(e){var t=Su(e.alternate,e,Du);e.memoizedProps=e.pendingProps,null===t?kc(e):Pu=t,Ru.current=null}function kc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=qo(n,t,Du)))return void(Pu=n)}else{if(null!==(n=Yo(n,t)))return n.flags&=32767,void(Pu=n);if(null===e)return Ou=6,void(Pu=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Pu=t);Pu=t=e}while(null!==t);0===Ou&&(Ou=5)}function Tc(e,t,n){var r=bt,i=Cu.transition;try{Cu.transition=null,bt=1,function(e,t,n,r){do{Ec()}while(null!==Yu);if(0!==(6&Au))throw Error(a(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var s=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-st(n),a=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~a}}(e,s),e===Iu&&(Pu=Iu=null,_u=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||qu||(qu=!0,Ic(tt,(function(){return Ec(),null}))),s=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||s){s=Cu.transition,Cu.transition=null;var o=bt;bt=1;var u=Au;Au|=4,Ru.current=null,function(e,t){if(ei=Ht,hr(e=fr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch(T){n=null;break e}var o=0,u=-1,c=-1,l=0,d=0,f=e,h=null;t:for(;;){for(var p;f!==n||0!==i&&3!==f.nodeType||(u=o+i),f!==s||0!==r&&3!==f.nodeType||(c=o+r),3===f.nodeType&&(o+=f.nodeValue.length),null!==(p=f.firstChild);)h=f,f=p;for(;;){if(f===e)break t;if(h===n&&++l===i&&(u=o),h===s&&++d===r&&(c=o),null!==(p=f.nextSibling))break;h=(f=h).parentNode}f=p}n=-1===u||-1===c?null:{start:u,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},Ht=!1,Xo=t;null!==Xo;)if(e=(t=Xo).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Xo=e;else for(;null!==Xo;){t=Xo;try{var v=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==v){var g=v.memoizedProps,m=v.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:ga(t.type,g),m);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var k=t.stateNode.containerInfo;1===k.nodeType?k.textContent="":9===k.nodeType&&k.documentElement&&k.removeChild(k.documentElement);break;default:throw Error(a(163))}}catch(T){wc(t,t.return,T)}if(null!==(e=t.sibling)){e.return=t.return,Xo=e;break}Xo=t.return}v=tu,tu=!1}(e,n),gu(n,e),pr(ti),Ht=!!ei,ti=ei=null,e.current=n,yu(n,e,i),Je(),Au=u,bt=o,Cu.transition=s}else e.current=n;if(qu&&(qu=!1,Yu=e,Qu=i),0===(s=e.pendingLanes)&&(Wu=null),function(e){if(at&&"function"===typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(it,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rc(e,$e()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)r((i=t[n]).value,{componentStack:i.stack,digest:i.digest});if(Hu)throw Hu=!1,e=zu,zu=null,e;0!==(1&Qu)&&0!==e.tag&&Ec(),0!==(1&(s=e.pendingLanes))?e===$u?Ju++:(Ju=0,$u=e):Ju=0,Vi()}(e,t,n,r)}finally{Cu.transition=i,bt=r}return null}function Ec(){if(null!==Yu){var e=kt(Qu),t=Cu.transition,n=bt;try{if(Cu.transition=null,bt=16>e?16:e,null===Yu)var r=!1;else{if(e=Yu,Yu=null,Qu=0,0!==(6&Au))throw Error(a(331));var i=Au;for(Au|=4,Xo=e.current;null!==Xo;){var s=Xo,o=s.child;if(0!==(16&Xo.flags)){var u=s.deletions;if(null!==u){for(var c=0;c<u.length;c++){var l=u[c];for(Xo=l;null!==Xo;){var d=Xo;switch(d.tag){case 0:case 11:case 15:nu(8,d,s)}var f=d.child;if(null!==f)f.return=d,Xo=f;else for(;null!==Xo;){var h=(d=Xo).sibling,p=d.return;if(au(d),d===l){Xo=null;break}if(null!==h){h.return=p,Xo=h;break}Xo=p}}}var v=s.alternate;if(null!==v){var g=v.child;if(null!==g){v.child=null;do{var m=g.sibling;g.sibling=null,g=m}while(null!==g)}}Xo=s}}if(0!==(2064&s.subtreeFlags)&&null!==o)o.return=s,Xo=o;else e:for(;null!==Xo;){if(0!==(2048&(s=Xo).flags))switch(s.tag){case 0:case 11:case 15:nu(9,s,s.return)}var y=s.sibling;if(null!==y){y.return=s.return,Xo=y;break e}Xo=s.return}}var b=e.current;for(Xo=b;null!==Xo;){var k=(o=Xo).child;if(0!==(2064&o.subtreeFlags)&&null!==k)k.return=o,Xo=k;else e:for(o=b;null!==Xo;){if(0!==(2048&(u=Xo).flags))try{switch(u.tag){case 0:case 11:case 15:ru(9,u)}}catch(E){wc(u,u.return,E)}if(u===o){Xo=null;break e}var T=u.sibling;if(null!==T){T.return=u.return,Xo=T;break e}Xo=u.return}}if(Au=i,Vi(),at&&"function"===typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(it,e)}catch(E){}r=!0}return r}finally{bt=n,Cu.transition=t}}return!1}function Sc(e,t,n){e=Oa(e,t=po(0,t=co(n,t),1),1),t=ec(),null!==e&&(mt(e,1,t),rc(e,t))}function wc(e,t,n){if(3===e.tag)Sc(e,e,n);else for(;null!==t;){if(3===t.tag){Sc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Wu||!Wu.has(r))){t=Oa(t,e=vo(t,e=co(n,e),1),1),e=ec(),null!==t&&(mt(t,1,e),rc(t,e));break}}t=t.return}}function xc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,Iu===e&&(_u&n)===n&&(4===Ou||3===Ou&&(130023424&_u)===_u&&500>$e()-Gu?fc(e,0):Uu|=n),rc(e,t)}function Rc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=lt,0===(130023424&(lt<<=1))&&(lt=4194304)));var n=ec();null!==(e=Ia(e,t))&&(mt(e,t,n),rc(e,n))}function Cc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Rc(e,n)}function Ac(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(a(314))}null!==r&&r.delete(t),Rc(e,n)}function Ic(e,t){return qe(e,t)}function Pc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _c(e,t,n,r){return new Pc(e,t,n,r)}function Dc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Lc(e,t){var n=e.alternate;return null===n?((n=_c(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Oc(e,t,n,r,i,s){var o=2;if(r=e,"function"===typeof e)Dc(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case S:return Mc(n.children,i,s,t);case w:o=8,i|=8;break;case x:return(e=_c(12,n,t,2|i)).elementType=x,e.lanes=s,e;case I:return(e=_c(13,n,t,i)).elementType=I,e.lanes=s,e;case P:return(e=_c(19,n,t,i)).elementType=P,e.lanes=s,e;case L:return Nc(n,i,s,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case R:o=10;break e;case C:o=9;break e;case A:o=11;break e;case _:o=14;break e;case D:o=16,r=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=_c(o,n,t,i)).elementType=e,t.type=r,t.lanes=s,t}function Mc(e,t,n,r){return(e=_c(7,e,r,t)).lanes=n,e}function Nc(e,t,n,r){return(e=_c(22,e,r,t)).elementType=L,e.lanes=n,e.stateNode={isHidden:!1},e}function Fc(e,t,n){return(e=_c(6,e,null,t)).lanes=n,e}function Uc(e,t,n){return(t=_c(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Bc(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function jc(e,t,n,r,i,a,s,o,u){return e=new Bc(e,t,n,o,u),1===t?(t=1,!0===a&&(t|=8)):t=0,a=_c(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},_a(a),e}function Gc(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:E,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}function Vc(e){if(!e)return Ci;e:{if(Ve(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Di(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(Di(n))return Mi(e,n,t)}return t}function Kc(e,t,n,r,i,a,s,o,u){return(e=jc(n,r,!0,e,0,a,0,o,u)).context=Vc(null),n=e.current,(a=La(r=ec(),i=tc(n))).callback=void 0!==t&&null!==t?t:null,Oa(n,a,i),e.current.lanes=i,mt(e,i,r),rc(e,r),e}function Hc(e,t,n,r){var i=t.current,a=ec(),s=tc(i);return n=Vc(n),null===t.context?t.context=n:t.pendingContext=n,(t=La(a,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Oa(i,t,s))&&(nc(e,i,s,a),Ma(e,i,s)),s}function zc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function qc(e,t){Wc(e,t),(e=e.alternate)&&Wc(e,t)}Su=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ii.current)ko=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return ko=!1,function(e,t,n){switch(t.tag){case 3:Po(t),ha();break;case 5:as(t);break;case 1:Di(t.type)&&Ni(t);break;case 4:rs(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Ri(ma,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ri(os,1&os.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Fo(e,t,n):(Ri(os,1&os.current),null!==(e=Ho(e,t,n))?e.sibling:null);Ri(os,1&os.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Vo(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ri(os,os.current),r)break;return null;case 22:case 23:return t.lanes=0,xo(e,t,n)}return Ho(e,t,n)}(e,t,n);ko=0!==(131072&e.flags)}else ko=!1,ia&&0!==(1048576&t.flags)&&Zi(t,Wi,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Ko(e,t),e=t.pendingProps;var i=_i(t,Ai.current);wa(t,n),i=Ss(null,t,r,e,i,n);var s=ws();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Di(r)?(s=!0,Ni(t)):s=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,_a(t),i.updater=Ga,t.stateNode=i,i._reactInternals=t,za(t,r,e,n),t=Io(null,t,r,!0,s,n)):(t.tag=0,ia&&s&&ea(t),To(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Ko(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"===typeof e)return Dc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===A)return 11;if(e===_)return 14}return 2}(r),e=ga(r,e),i){case 0:t=Co(null,t,r,e,n);break e;case 1:t=Ao(null,t,r,e,n);break e;case 11:t=Eo(null,t,r,e,n);break e;case 14:t=So(null,t,r,ga(r.type,e),n);break e}throw Error(a(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Co(e,t,r,i=t.elementType===r?i:ga(r,i),n);case 1:return r=t.type,i=t.pendingProps,Ao(e,t,r,i=t.elementType===r?i:ga(r,i),n);case 3:e:{if(Po(t),null===e)throw Error(a(387));r=t.pendingProps,i=(s=t.memoizedState).element,Da(e,t),Fa(t,r,null,n);var o=t.memoizedState;if(r=o.element,s.isDehydrated){if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=_o(e,t,r,n,i=co(Error(a(423)),t));break e}if(r!==i){t=_o(e,t,r,n,i=co(Error(a(424)),t));break e}for(ra=ci(t.stateNode.containerInfo.firstChild),na=t,ia=!0,aa=null,n=$a(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ha(),r===i){t=Ho(e,t,n);break e}To(e,t,r,n)}t=t.child}return t;case 5:return as(t),null===e&&ca(t),r=t.type,i=t.pendingProps,s=null!==e?e.memoizedProps:null,o=i.children,ni(r,i)?o=null:null!==s&&ni(r,s)&&(t.flags|=32),Ro(e,t),To(e,t,o,n),t.child;case 6:return null===e&&ca(t),null;case 13:return Fo(e,t,n);case 4:return rs(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Ja(t,null,r,n):To(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,Eo(e,t,r,i=t.elementType===r?i:ga(r,i),n);case 7:return To(e,t,t.pendingProps,n),t.child;case 8:case 12:return To(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,s=t.memoizedProps,o=i.value,Ri(ma,r._currentValue),r._currentValue=o,null!==s)if(or(s.value,o)){if(s.children===i.children&&!Ii.current){t=Ho(e,t,n);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var u=s.dependencies;if(null!==u){o=s.child;for(var c=u.firstContext;null!==c;){if(c.context===r){if(1===s.tag){(c=La(-1,n&-n)).tag=2;var l=s.updateQueue;if(null!==l){var d=(l=l.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),l.pending=c}}s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),Sa(s.return,n,t),u.lanes|=n;break}c=c.next}}else if(10===s.tag)o=s.type===t.type?null:s.child;else if(18===s.tag){if(null===(o=s.return))throw Error(a(341));o.lanes|=n,null!==(u=o.alternate)&&(u.lanes|=n),Sa(o,n,t),o=s.sibling}else o=s.child;if(null!==o)o.return=s;else for(o=s;null!==o;){if(o===t){o=null;break}if(null!==(s=o.sibling)){s.return=o.return,o=s;break}o=o.return}s=o}To(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,wa(t,n),r=r(i=xa(i)),t.flags|=1,To(e,t,r,n),t.child;case 14:return i=ga(r=t.type,t.pendingProps),So(e,t,r,i=ga(r.type,i),n);case 15:return wo(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:ga(r,i),Ko(e,t),t.tag=1,Di(r)?(e=!0,Ni(t)):e=!1,wa(t,n),Ka(t,r,i),za(t,r,i,n),Io(null,t,r,!0,e,n);case 19:return Vo(e,t,n);case 22:return xo(e,t,n)}throw Error(a(156,t.tag))};var Yc="function"===typeof reportError?reportError:function(e){console.error(e)};function Qc(e){this._internalRoot=e}function Jc(e){this._internalRoot=e}function $c(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Xc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zc(){}function el(e,t,n,r,i){var a=n._reactRootContainer;if(a){var s=a;if("function"===typeof i){var o=i;i=function(){var e=zc(s);o.call(e)}}Hc(t,s,e,i)}else s=function(e,t,n,r,i){if(i){if("function"===typeof r){var a=r;r=function(){var e=zc(s);a.call(e)}}var s=Kc(t,r,e,0,null,!1,0,"",Zc);return e._reactRootContainer=s,e[pi]=s.current,Vr(8===e.nodeType?e.parentNode:e),lc(),s}for(;i=e.lastChild;)e.removeChild(i);if("function"===typeof r){var o=r;r=function(){var e=zc(u);o.call(e)}}var u=jc(e,0,!1,null,0,!1,0,"",Zc);return e._reactRootContainer=u,e[pi]=u.current,Vr(8===e.nodeType?e.parentNode:e),lc((function(){Hc(t,u,n,r)})),u}(n,t,e,i,r);return zc(s)}Jc.prototype.render=Qc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Hc(e,t,null,null)},Jc.prototype.unmount=Qc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;lc((function(){Hc(null,e,null,null)})),t[pi]=null}},Jc.prototype.unstable_scheduleHydration=function(e){if(e){var t=wt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Lt.length&&0!==t&&t<Lt[n].priority;n++);Lt.splice(n,0,e),0===n&&Ft(e)}},Tt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(yt(t,1|n),rc(t,$e()),0===(6&Au)&&(Vu=$e()+500,Vi()))}break;case 13:lc((function(){var t=Ia(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}})),qc(e,1)}},Et=function(e){if(13===e.tag){var t=Ia(e,134217728);if(null!==t)nc(t,e,134217728,ec());qc(e,134217728)}},St=function(e){if(13===e.tag){var t=tc(e),n=Ia(e,t);if(null!==n)nc(n,e,t,ec());qc(e,t)}},wt=function(){return bt},xt=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},Ee=function(e,t,n){switch(t){case"input":if(X(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=Ti(r);if(!i)throw Error(a(90));q(r),X(r,i)}}}break;case"textarea":ae(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ae=cc,Ie=lc;var tl={usingClientEntryPoint:!1,Events:[bi,ki,Ti,Re,Ce,cc]},nl={findFiberByHostInstance:yi,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},rl={bundleType:nl.bundleType,version:nl.version,rendererPackageName:nl.rendererPackageName,rendererConfig:nl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:k.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=ze(e))?null:e.stateNode},findFiberByHostInstance:nl.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var il=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!il.isDisabled&&il.supportsFiber)try{it=il.inject(rl),at=il}catch(le){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tl,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!$c(t))throw Error(a(200));return Gc(e,t,null,n)},t.createRoot=function(e,t){if(!$c(e))throw Error(a(299));var n=!1,r="",i=Yc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=jc(e,1,!1,null,0,n,0,r,i),e[pi]=t.current,Vr(8===e.nodeType?e.parentNode:e),new Qc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=ze(t))?null:e.stateNode},t.flushSync=function(e){return lc(e)},t.hydrate=function(e,t,n){if(!Xc(t))throw Error(a(200));return el(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!$c(e))throw Error(a(405));var r=null!=n&&n.hydratedSources||null,i=!1,s="",o=Yc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(s=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),t=Kc(t,null,e,1,null!=n?n:null,i,0,s,o),e[pi]=t.current,Vr(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Jc(t)},t.render=function(e,t,n){if(!Xc(t))throw Error(a(200));return el(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Xc(e))throw Error(a(40));return!!e._reactRootContainer&&(lc((function(){el(null,null,e,!1,(function(){e._reactRootContainer=null,e[pi]=null}))})),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Xc(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return el(e,t,n,!1,r)},t.version="18.2.0-next-9e3b772b8-20220608"},250:function(e,t,n){"use strict";var r=n(164);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},164:function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(463)},372:function(e,t){"use strict";var n="function"===typeof Symbol&&Symbol.for,r=n?Symbol.for("react.element"):60103,i=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,s=n?Symbol.for("react.strict_mode"):60108,o=n?Symbol.for("react.profiler"):60114,u=n?Symbol.for("react.provider"):60109,c=n?Symbol.for("react.context"):60110,l=n?Symbol.for("react.async_mode"):60111,d=n?Symbol.for("react.concurrent_mode"):60111,f=n?Symbol.for("react.forward_ref"):60112,h=n?Symbol.for("react.suspense"):60113,p=n?Symbol.for("react.suspense_list"):60120,v=n?Symbol.for("react.memo"):60115,g=n?Symbol.for("react.lazy"):60116,m=n?Symbol.for("react.block"):60121,y=n?Symbol.for("react.fundamental"):60117,b=n?Symbol.for("react.responder"):60118,k=n?Symbol.for("react.scope"):60119;function T(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case l:case d:case a:case o:case s:case h:return e;default:switch(e=e&&e.$$typeof){case c:case f:case g:case v:case u:return e;default:return t}}case i:return t}}}function E(e){return T(e)===d}t.AsyncMode=l,t.ConcurrentMode=d,t.ContextConsumer=c,t.ContextProvider=u,t.Element=r,t.ForwardRef=f,t.Fragment=a,t.Lazy=g,t.Memo=v,t.Portal=i,t.Profiler=o,t.StrictMode=s,t.Suspense=h,t.isAsyncMode=function(e){return E(e)||T(e)===l},t.isConcurrentMode=E,t.isContextConsumer=function(e){return T(e)===c},t.isContextProvider=function(e){return T(e)===u},t.isElement=function(e){return"object"===typeof e&&null!==e&&e.$$typeof===r},t.isForwardRef=function(e){return T(e)===f},t.isFragment=function(e){return T(e)===a},t.isLazy=function(e){return T(e)===g},t.isMemo=function(e){return T(e)===v},t.isPortal=function(e){return T(e)===i},t.isProfiler=function(e){return T(e)===o},t.isStrictMode=function(e){return T(e)===s},t.isSuspense=function(e){return T(e)===h},t.isValidElementType=function(e){return"string"===typeof e||"function"===typeof e||e===a||e===d||e===o||e===s||e===h||e===p||"object"===typeof e&&null!==e&&(e.$$typeof===g||e.$$typeof===v||e.$$typeof===u||e.$$typeof===c||e.$$typeof===f||e.$$typeof===y||e.$$typeof===b||e.$$typeof===k||e.$$typeof===m)},t.typeOf=T},441:function(e,t,n){"use strict";e.exports=n(372)},374:function(e,t,n){"use strict";var r=n(791),i=Symbol.for("react.element"),a=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,a={},c=null,l=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(l=t.ref),t)s.call(t,r)&&!u.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:i,type:e,key:c,ref:l,props:a,_owner:o.current}}t.Fragment=a,t.jsx=c,t.jsxs=c},117:function(e,t){"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),u=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),h=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,g={};function m(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}m.prototype.isReactComponent={},m.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},m.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=m.prototype;var k=b.prototype=new y;k.constructor=b,v(k,m.prototype),k.isPureReactComponent=!0;var T=Array.isArray,E=Object.prototype.hasOwnProperty,S={current:null},w={key:!0,ref:!0,__self:!0,__source:!0};function x(e,t,r){var i,a={},s=null,o=null;if(null!=t)for(i in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(s=""+t.key),t)E.call(t,i)&&!w.hasOwnProperty(i)&&(a[i]=t[i]);var u=arguments.length-2;if(1===u)a.children=r;else if(1<u){for(var c=Array(u),l=0;l<u;l++)c[l]=arguments[l+2];a.children=c}if(e&&e.defaultProps)for(i in u=e.defaultProps)void 0===a[i]&&(a[i]=u[i]);return{$$typeof:n,type:e,key:s,ref:o,props:a,_owner:S.current}}function R(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var C=/\/+/g;function A(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function I(e,t,i,a,s){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var u=!1;if(null===e)u=!0;else switch(o){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case r:u=!0}}if(u)return s=s(u=e),e=""===a?"."+A(u,0):a,T(s)?(i="",null!=e&&(i=e.replace(C,"$&/")+"/"),I(s,t,i,"",(function(e){return e}))):null!=s&&(R(s)&&(s=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,i+(!s.key||u&&u.key===s.key?"":(""+s.key).replace(C,"$&/")+"/")+e)),t.push(s)),1;if(u=0,a=""===a?".":a+":",T(e))for(var c=0;c<e.length;c++){var l=a+A(o=e[c],c);u+=I(o,t,i,l,s)}else if(l=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=h&&e[h]||e["@@iterator"])?e:null}(e),"function"===typeof l)for(e=l.call(e),c=0;!(o=e.next()).done;)u+=I(o=o.value,t,i,l=a+A(o,c++),s);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return u}function P(e,t,n){if(null==e)return e;var r=[],i=0;return I(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function _(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D={current:null},L={transition:null},O={ReactCurrentDispatcher:D,ReactCurrentBatchConfig:L,ReactCurrentOwner:S};t.Children={map:P,forEach:function(e,t,n){P(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return P(e,(function(){t++})),t},toArray:function(e){return P(e,(function(e){return e}))||[]},only:function(e){if(!R(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=m,t.Fragment=i,t.Profiler=s,t.PureComponent=b,t.StrictMode=a,t.Suspense=l,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=v({},e.props),a=e.key,s=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,o=S.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(c in t)E.call(t,c)&&!w.hasOwnProperty(c)&&(i[c]=void 0===t[c]&&void 0!==u?u[c]:t[c])}var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){u=Array(c);for(var l=0;l<c;l++)u[l]=arguments[l+2];i.children=u}return{$$typeof:n,type:e.type,key:a,ref:s,props:i,_owner:o}},t.createContext=function(e){return(e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=x,t.createFactory=function(e){var t=x.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=R,t.lazy=function(e){return{$$typeof:f,_payload:{_status:-1,_result:e},_init:_}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=L.transition;L.transition={};try{e()}finally{L.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return D.current.useCallback(e,t)},t.useContext=function(e){return D.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return D.current.useDeferredValue(e)},t.useEffect=function(e,t){return D.current.useEffect(e,t)},t.useId=function(){return D.current.useId()},t.useImperativeHandle=function(e,t,n){return D.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return D.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return D.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return D.current.useMemo(e,t)},t.useReducer=function(e,t,n){return D.current.useReducer(e,t,n)},t.useRef=function(e){return D.current.useRef(e)},t.useState=function(e){return D.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return D.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return D.current.useTransition()},t.version="18.2.0"},791:function(e,t,n){"use strict";e.exports=n(117)},184:function(e,t,n){"use strict";e.exports=n(374)},813:function(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<a(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,s=i>>>1;r<s;){var o=2*(r+1)-1,u=e[o],c=o+1,l=e[c];if(0>a(u,n))c<i&&0>a(l,u)?(e[r]=l,e[c]=n,r=c):(e[r]=u,e[o]=n,r=o);else{if(!(c<i&&0>a(l,n)))break e;e[r]=l,e[c]=n,r=c}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,u=o.now();t.unstable_now=function(){return o.now()-u}}var c=[],l=[],d=1,f=null,h=3,p=!1,v=!1,g=!1,m="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function k(e){for(var t=r(l);null!==t;){if(null===t.callback)i(l);else{if(!(t.startTime<=e))break;i(l),t.sortIndex=t.expirationTime,n(c,t)}t=r(l)}}function T(e){if(g=!1,k(e),!v)if(null!==r(c))v=!0,L(E);else{var t=r(l);null!==t&&O(T,t.startTime-e)}}function E(e,n){v=!1,g&&(g=!1,y(R),R=-1),p=!0;var a=h;try{for(k(n),f=r(c);null!==f&&(!(f.expirationTime>n)||e&&!I());){var s=f.callback;if("function"===typeof s){f.callback=null,h=f.priorityLevel;var o=s(f.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?f.callback=o:f===r(c)&&i(c),k(n)}else i(c);f=r(c)}if(null!==f)var u=!0;else{var d=r(l);null!==d&&O(T,d.startTime-n),u=!1}return u}finally{f=null,h=a,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,w=!1,x=null,R=-1,C=5,A=-1;function I(){return!(t.unstable_now()-A<C)}function P(){if(null!==x){var e=t.unstable_now();A=e;var n=!0;try{n=x(!0,e)}finally{n?S():(w=!1,x=null)}}else w=!1}if("function"===typeof b)S=function(){b(P)};else if("undefined"!==typeof MessageChannel){var _=new MessageChannel,D=_.port2;_.port1.onmessage=P,S=function(){D.postMessage(null)}}else S=function(){m(P,0)};function L(e){x=e,w||(w=!0,S())}function O(e,n){R=m((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){v||p||(v=!0,L(E))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(h){case 1:case 2:case 3:var t=3;break;default:t=h}var n=h;h=t;try{return e()}finally{h=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=h;h=e;try{return t()}finally{h=n}},t.unstable_scheduleCallback=function(e,i,a){var s=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?s+a:s:a=s,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:d++,callback:i,priorityLevel:e,startTime:a,expirationTime:o=a+o,sortIndex:-1},a>s?(e.sortIndex=a,n(l,e),null===r(c)&&e===r(l)&&(g?(y(R),R=-1):g=!0,O(T,a-s))):(e.sortIndex=o,n(c,e),v||p||(v=!0,L(E))),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=h;return function(){var n=h;h=t;try{return e.apply(this,arguments)}finally{h=n}}}},296:function(e,t,n){"use strict";e.exports=n(813)},712:function(e){var t=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(t).forEach((function(e){t[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},861:function(e,t,n){var r=n(775),i=n(921);t.cW=i,t.Qc=r.parse,r.parseParams,r.parseFmtpConfig,r.parsePayloads,r.parseRemoteCandidates,r.parseImageAttributes,r.parseSimulcastStreamList},775:function(e,t,n){var r=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,n){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var a=e.push?{}:i?t[e.name]:t;!function(e,t,n,i){if(i&&!n)t[i]=r(e[1]);else for(var a=0;a<n.length;a+=1)null!=e[a+1]&&(t[n[a]]=r(e[a+1]))}(n.match(e.reg),a,e.names,e.name),e.push&&t[e.push].push(a)},a=n(712),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},n=[],r=t;return e.split(/(\r\n|\r|\n)/).filter(s).forEach((function(e){var t=e[0],s=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),r=n[n.length-1]);for(var o=0;o<(a[t]||[]).length;o+=1){var u=a[t][o];if(u.reg.test(s))return i(u,r,s)}})),t.media=n,t};var o=function(e,t){var n=t.split(/=(.+)/,2);return 2===n.length?e[n[0]]=r(n[1]):1===n.length&&t.length>1&&(e[n[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(r),i=0;i<n.length;i+=3)t.push({component:n[i],ip:n[i+1],port:n[i+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,n=!1;return"~"!==e[0]?t=r(e):(t=r(e.substring(1,e.length)),n=!0),{scid:t,paused:n}}))}))}},921:function(e,t,n){var r=n(712),i=/%[sdv%]/g,a=function(e){var t=1,n=arguments,r=n.length;return e.replace(i,(function(e){if(t>=r)return e;var i=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},s=function(e,t,n){var r=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var s=t.names[i];t.name?r.push(n[t.name][s]):r.push(n[t.names[i]])}else r.push(n[t.name]);return a.apply(null,r)},o=["v","o","s","i","u","e","p","c","b","t","r","z","a"],u=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var n=t.outerOrder||o,i=t.innerOrder||u,a=[];return n.forEach((function(t){r[t].forEach((function(n){n.name in e&&null!=e[n.name]?a.push(s(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){a.push(s(t,n,e))}))}))})),e.media.forEach((function(e){a.push(s("m",r.m[0],e)),i.forEach((function(t){r[t].forEach((function(n){n.name in e&&null!=e[n.name]?a.push(s(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){a.push(s(t,n,e))}))}))}))})),a.join("\r\n")+"\r\n"}},800:function(e){"use strict";var t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},t.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},t.getDescription=function(e){var n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){var n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((function(e){return 0===e.indexOf(n)}))},t.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:void 0===n[t[r]]&&(n[t[r]]=t[r+1])}return n},t.writeCandidate=function(e){var t=[];t.push(e.foundation);var n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){var t=e.substring(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){var t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){for(var t,n={},r=e.substring(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},t.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach((function(t){void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){var t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substring(t+1,r),n.value=e.substring(r+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){var t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},t.getMid=function(e){var n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){var t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){var t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){var r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],i=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substring(12),password:i.substring(10)}:null},t.writeIceParameters=function(e){var t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){var n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" ");n.profile=r[2];for(var i=3;i<r.length;i++){var a=r[i],s=t.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(s){var o=t.parseRtpMap(s),u=t.matchPrefix(e,"a=fmtp:"+a+" ");switch(o.parameters=u.length?t.parseFmtp(u[0]):{},o.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(t.parseRtcpFb),n.codecs.push(o),o.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(o.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((function(e){n.headerExtensions.push(t.parseExtmap(e))}));var c=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach((function(e){c.forEach((function(t){e.rtcpFeedback.find((function(e){return e.type===t.type&&e.parameter===t.parameter}))||e.rtcpFeedback.push(t)}))})),n},t.writeRtpDescription=function(e,n){var r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=n.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((function(e){r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)}));var i=0;return n.codecs.forEach((function(e){e.maxptime>i&&(i=e.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((function(e){r+=t.writeExtmap(e)})),r},t.parseRtpEncodingParameters=function(e){var n,r=[],i=t.parseRtpParameters(e),a=-1!==i.fecMechanisms.indexOf("RED"),s=-1!==i.fecMechanisms.indexOf("ULPFEC"),o=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),u=o.length>0&&o[0].ssrc,c=t.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substring(17).split(" ").map((function(e){return parseInt(e,10)}))}));c.length>0&&c[0].length>1&&c[0][0]===u&&(n=c[0][1]),i.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:u,codecPayloadType:parseInt(e.parameters.apt,10)};u&&n&&(t.rtx={ssrc:n}),r.push(t),a&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:u,mechanism:s?"red+ulpfec":"red"},r.push(t))}})),0===r.length&&u&&r.push({ssrc:u});var l=t.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substring(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substring(5),10)*.95-16e3:void 0,r.forEach((function(e){e.maxBitrate=l}))),r},t.parseRtcpParameters=function(e){var n={},r=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);var i=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;var a=t.matchPrefix(e,"a=rtcp-mux");return n.mux=a.length>0,n},t.writeRtcpParameters=function(e){var t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){var n,r=t.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(n=r[0].substring(7).split(" "))[0],track:n[1]};var i=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return i.length>0?{stream:(n=i[0].value.split(" "))[0],track:n[1]}:void 0},t.parseSctpDescription=function(e){var n,r=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");i.length>0&&(n=parseInt(i[0].substring(19),10)),isNaN(n)&&(n=65536);var a=t.matchPrefix(e,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:r.fmt,maxMessageSize:n};var s=t.matchPrefix(e,"a=sctpmap:");if(s.length>0){var o=s[0].substring(10).split(" ");return{port:parseInt(o[0],10),protocol:o[1],maxMessageSize:n}}},t.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,r){var i=void 0!==n?n:2;return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||t.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){for(var r=t.splitLines(e),i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){var n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){var n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!==typeof e||0===e.length)return!1;for(var n=t.splitLines(e),r=0;r<n.length;r++)if(n[r].length<2||"="!==n[r].charAt(1))return!1;return!0},e.exports=t},210:function(e,t,n){var r;!function(i,a){"use strict";var s="function",o="undefined",u="object",c="string",l="model",d="name",f="type",h="vendor",p="version",v="architecture",g="console",m="mobile",y="tablet",b="smarttv",k="wearable",T="embedded",E="Amazon",S="Apple",w="ASUS",x="BlackBerry",R="Firefox",C="Google",A="Huawei",I="LG",P="Microsoft",_="Motorola",D="Opera",L="Samsung",O="Sharp",M="Sony",N="Xiaomi",F="Zebra",U="Facebook",B=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},j=function(e,t){return typeof e===c&&-1!==G(t).indexOf(G(e))},G=function(e){return e.toLowerCase()},V=function(e,t){if(typeof e===c)return e=e.replace(/^\s\s*/,""),typeof t===o?e:e.substring(0,350)},K=function(e,t){for(var n,r,i,o,c,l,d=0;d<t.length&&!c;){var f=t[d],h=t[d+1];for(n=r=0;n<f.length&&!c;)if(c=f[n++].exec(e))for(i=0;i<h.length;i++)l=c[++r],typeof(o=h[i])===u&&o.length>0?2===o.length?typeof o[1]==s?this[o[0]]=o[1].call(this,l):this[o[0]]=o[1]:3===o.length?typeof o[1]!==s||o[1].exec&&o[1].test?this[o[0]]=l?l.replace(o[1],o[2]):a:this[o[0]]=l?o[1].call(this,l,o[2]):a:4===o.length&&(this[o[0]]=l?o[3].call(this,l.replace(o[1],o[2])):a):this[o]=l||a;d+=2}},H=function(e,t){for(var n in t)if(typeof t[n]===u&&t[n].length>0){for(var r=0;r<t[n].length;r++)if(j(t[n][r],e))return"?"===n?a:n}else if(j(t[n],e))return"?"===n?a:n;return e},z={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},W={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[p,[d,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[p,[d,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[d,p],[/opios[\/ ]+([\w\.]+)/i],[p,[d,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[p,[d,D]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[d,p],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[p,[d,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[p,[d,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[p,[d,"WeChat"]],[/konqueror\/([\w\.]+)/i],[p,[d,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[p,[d,"IE"]],[/yabrowser\/([\w\.]+)/i],[p,[d,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[d,/(.+)/,"$1 Secure Browser"],p],[/\bfocus\/([\w\.]+)/i],[p,[d,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[p,[d,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[p,[d,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[p,[d,"Dolphin"]],[/coast\/([\w\.]+)/i],[p,[d,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[p,[d,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[p,[d,R]],[/\bqihu|(qi?ho?o?|360)browser/i],[[d,"360 Browser"]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[d,/(.+)/,"$1 Browser"],p],[/(comodo_dragon)\/([\w\.]+)/i],[[d,/_/g," "],p],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[d,p],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[d],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[d,U],p],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[d,p],[/\bgsa\/([\w\.]+) .*safari\//i],[p,[d,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[p,[d,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[d,"Chrome WebView"],p],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[p,[d,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[d,p],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[p,[d,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[p,d],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[d,[p,H,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[d,p],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[d,"Netscape"],p],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[p,[d,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[d,p],[/(cobalt)\/([\w\.]+)/i],[d,[p,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[v,"amd64"]],[/(ia32(?=;))/i],[[v,G]],[/((?:i[346]|x)86)[;\)]/i],[[v,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[v,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[v,"armhf"]],[/windows (ce|mobile); ppc;/i],[[v,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[v,/ower/,"",G]],[/(sun4\w)[;\)]/i],[[v,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[v,G]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[l,[h,L],[f,y]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[l,[h,L],[f,m]],[/\((ip(?:hone|od)[\w ]*);/i],[l,[h,S],[f,m]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[l,[h,S],[f,y]],[/(macintosh);/i],[l,[h,S]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[l,[h,A],[f,y]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[l,[h,A],[f,m]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[l,/_/g," "],[h,N],[f,m]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[l,/_/g," "],[h,N],[f,y]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[l,[h,"OPPO"],[f,m]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[l,[h,"Vivo"],[f,m]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[l,[h,"Realme"],[f,m]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[l,[h,_],[f,m]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[l,[h,_],[f,y]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[l,[h,I],[f,y]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[l,[h,I],[f,m]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[l,[h,"Lenovo"],[f,y]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[l,/_/g," "],[h,"Nokia"],[f,m]],[/(pixel c)\b/i],[l,[h,C],[f,y]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[l,[h,C],[f,m]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[l,[h,M],[f,m]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[l,"Xperia Tablet"],[h,M],[f,y]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[l,[h,"OnePlus"],[f,m]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[l,[h,E],[f,y]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[l,/(.+)/g,"Fire Phone $1"],[h,E],[f,m]],[/(playbook);[-\w\),; ]+(rim)/i],[l,h,[f,y]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[l,[h,x],[f,m]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[l,[h,w],[f,y]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[l,[h,w],[f,m]],[/(nexus 9)/i],[l,[h,"HTC"],[f,y]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony(?!-bra))[-_ ]?([-\w]*)/i],[h,[l,/_/g," "],[f,m]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[l,[h,"Acer"],[f,y]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[l,[h,"Meizu"],[f,m]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[l,[h,O],[f,m]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[h,l,[f,m]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[h,l,[f,y]],[/(surface duo)/i],[l,[h,P],[f,y]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[l,[h,"Fairphone"],[f,m]],[/(u304aa)/i],[l,[h,"AT&T"],[f,m]],[/\bsie-(\w*)/i],[l,[h,"Siemens"],[f,m]],[/\b(rct\w+) b/i],[l,[h,"RCA"],[f,y]],[/\b(venue[\d ]{2,7}) b/i],[l,[h,"Dell"],[f,y]],[/\b(q(?:mv|ta)\w+) b/i],[l,[h,"Verizon"],[f,y]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[l,[h,"Barnes & Noble"],[f,y]],[/\b(tm\d{3}\w+) b/i],[l,[h,"NuVision"],[f,y]],[/\b(k88) b/i],[l,[h,"ZTE"],[f,y]],[/\b(nx\d{3}j) b/i],[l,[h,"ZTE"],[f,m]],[/\b(gen\d{3}) b.+49h/i],[l,[h,"Swiss"],[f,m]],[/\b(zur\d{3}) b/i],[l,[h,"Swiss"],[f,y]],[/\b((zeki)?tb.*\b) b/i],[l,[h,"Zeki"],[f,y]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[h,"Dragon Touch"],l,[f,y]],[/\b(ns-?\w{0,9}) b/i],[l,[h,"Insignia"],[f,y]],[/\b((nxa|next)-?\w{0,9}) b/i],[l,[h,"NextBook"],[f,y]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[h,"Voice"],l,[f,m]],[/\b(lvtel\-)?(v1[12]) b/i],[[h,"LvTel"],l,[f,m]],[/\b(ph-1) /i],[l,[h,"Essential"],[f,m]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[l,[h,"Envizen"],[f,y]],[/\b(trio[-\w\. ]+) b/i],[l,[h,"MachSpeed"],[f,y]],[/\btu_(1491) b/i],[l,[h,"Rotor"],[f,y]],[/(shield[\w ]+) b/i],[l,[h,"Nvidia"],[f,y]],[/(sprint) (\w+)/i],[h,l,[f,m]],[/(kin\.[onetw]{3})/i],[[l,/\./g," "],[h,P],[f,m]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[l,[h,F],[f,y]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[l,[h,F],[f,m]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[h,l,[f,g]],[/droid.+; (shield) bui/i],[l,[h,"Nvidia"],[f,g]],[/(playstation [345portablevi]+)/i],[l,[h,M],[f,g]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[l,[h,P],[f,g]],[/smart-tv.+(samsung)/i],[h,[f,b]],[/hbbtv.+maple;(\d+)/i],[[l,/^/,"SmartTV"],[h,L],[f,b]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[h,I],[f,b]],[/(apple) ?tv/i],[h,[l,"Apple TV"],[f,b]],[/crkey/i],[[l,"Chromecast"],[h,C],[f,b]],[/droid.+aft(\w)( bui|\))/i],[l,[h,E],[f,b]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[l,[h,O],[f,b]],[/(bravia[\w ]+)( bui|\))/i],[l,[h,M],[f,b]],[/(mitv-\w{5}) bui/i],[l,[h,N],[f,b]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[h,V],[l,V],[f,b]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[f,b]],[/((pebble))app/i],[h,l,[f,k]],[/droid.+; (glass) \d/i],[l,[h,C],[f,k]],[/droid.+; (wt63?0{2,3})\)/i],[l,[h,F],[f,k]],[/(quest( 2)?)/i],[l,[h,U],[f,k]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[h,[f,T]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[l,[f,m]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[l,[f,y]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[f,y]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[f,m]],[/(android[-\w\. ]{0,9});.+buil/i],[l,[h,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[p,[d,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[d,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[d,p],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[p,d]],os:[[/microsoft (windows) (vista|xp)/i],[d,p],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[d,[p,H,z]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[d,"Windows"],[p,H,z]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[p,/_/g,"."],[d,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[d,"Mac OS"],[p,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[p,d],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[d,p],[/\(bb(10);/i],[p,[d,x]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[p,[d,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[p,[d,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[p,[d,"webOS"]],[/crkey\/([\d\.]+)/i],[p,[d,"Chromecast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[d,"Chromium OS"],p],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[d,p],[/(sunos) ?([\w\.\d]*)/i],[[d,"Solaris"],p],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[d,p]]},q=function e(t,n){if(typeof t===u&&(n=t,t=a),!(this instanceof e))return new e(t,n).getResult();var r=t||(typeof i!==o&&i.navigator&&i.navigator.userAgent?i.navigator.userAgent:""),s=n?function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2===0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n}(W,n):W;return this.getBrowser=function(){var e,t={};return t.name=a,t.version=a,K.call(t,r,s.browser),t.major=typeof(e=t.version)===c?e.replace(/[^\d\.]/g,"").split(".")[0]:a,t},this.getCPU=function(){var e={};return e.architecture=a,K.call(e,r,s.cpu),e},this.getDevice=function(){var e={};return e.vendor=a,e.model=a,e.type=a,K.call(e,r,s.device),e},this.getEngine=function(){var e={};return e.name=a,e.version=a,K.call(e,r,s.engine),e},this.getOS=function(){var e={};return e.name=a,e.version=a,K.call(e,r,s.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return r},this.setUA=function(e){return r=typeof e===c&&e.length>350?V(e,350):e,this},this.setUA(r),this};q.VERSION="1.0.33",q.BROWSER=B([d,p,"major"]),q.CPU=B([v]),q.DEVICE=B([l,h,f,g,m,b,y,k,T]),q.ENGINE=q.OS=B([d,p]),typeof t!==o?(e.exports&&(t=e.exports=q),t.UAParser=q):n.amdO?(r=function(){return q}.call(t,n,t,e))===a||(e.exports=r):typeof i!==o&&(i.UAParser=q);var Y=typeof i!==o&&(i.jQuery||i.Zepto);if(Y&&!Y.ua){var Q=new q;Y.ua=Q.getResult(),Y.ua.get=function(){return Q.getUA()},Y.ua.set=function(e){Q.setUA(e);var t=Q.getResult();for(var n in t)Y.ua[n]=t[n]}}}("object"===typeof window?window:this)}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}n.amdO={},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},function(){var e,t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};n.t=function(r,i){if(1&i&&(r=this(r)),8&i)return r;if("object"===typeof r&&r){if(4&i&&r.__esModule)return r;if(16&i&&"function"===typeof r.then)return r}var a=Object.create(null);n.r(a);var s={};e=e||[null,t({}),t([]),t(t)];for(var o=2&i&&r;"object"==typeof o&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach((function(e){s[e]=function(){return r[e]}}));return s.default=function(){return r},n.d(a,s),a}}(),n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){"use strict";var e={};n.r(e),n.d(e,{fixNegotiationNeeded:function(){return st},shimAddTrackRemoveTrack:function(){return it},shimAddTrackRemoveTrackWithNative:function(){return rt},shimGetDisplayMedia:function(){return $e},shimGetSendersWithDtmf:function(){return et},shimGetStats:function(){return tt},shimGetUserMedia:function(){return Je},shimMediaStream:function(){return Xe},shimOnTrack:function(){return Ze},shimPeerConnection:function(){return at},shimSenderReceiverGetStats:function(){return nt}});var t={};n.r(t),n.d(t,{shimAddTransceiver:function(){return vt},shimCreateAnswer:function(){return yt},shimCreateOffer:function(){return mt},shimGetDisplayMedia:function(){return ut},shimGetParameters:function(){return gt},shimGetUserMedia:function(){return ot},shimOnTrack:function(){return ct},shimPeerConnection:function(){return lt},shimRTCDataChannel:function(){return pt},shimReceiverGetStats:function(){return ft},shimRemoveStream:function(){return ht},shimSenderGetStats:function(){return dt}});var r={};n.r(r),n.d(r,{shimAudioContext:function(){return Ct},shimCallbacksAPI:function(){return Tt},shimConstraints:function(){return St},shimCreateOfferLegacy:function(){return Rt},shimGetUserMedia:function(){return Et},shimLocalStreamsAPI:function(){return bt},shimRTCIceServerUrls:function(){return wt},shimRemoteStreamsAPI:function(){return kt},shimTrackEventTransceiver:function(){return xt}});var i={};n.r(i),n.d(i,{removeExtmapAllowMixed:function(){return Mt},shimAddIceCandidateNullOrEmpty:function(){return Nt},shimConnectionState:function(){return Ot},shimMaxMessageSize:function(){return Dt},shimParameterlessSetLocalDescription:function(){return Ft},shimRTCIceCandidate:function(){return Pt},shimRTCIceCandidateRelayProtocol:function(){return _t},shimSendThrowTypeError:function(){return Lt}});var a=n(791),s=n.t(a,2),o=n(250);function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function c(){c=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function o(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{o({},"")}catch(A){o=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof h?t:h,a=Object.create(i.prototype),s=new x(r||[]);return a._invoke=function(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return C()}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var o=E(s,n);if(o){if(o===f)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=d(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,s),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(A){return{type:"throw",arg:A}}}e.wrap=l;var f={};function h(){}function p(){}function v(){}var g={};o(g,i,(function(){return this}));var m=Object.getPrototypeOf,y=m&&m(m(R([])));y&&y!==t&&n.call(y,i)&&(g=y);var b=v.prototype=h.prototype=Object.create(g);function k(e){["next","throw","return"].forEach((function(t){o(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function r(i,a,s,o){var c=d(e[i],e,a);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==u(f)&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){r("next",e,s,o)}),(function(e){r("throw",e,s,o)})):t.resolve(f).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,o)}))}o(c.arg)}var i;this._invoke=function(e,n){function a(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(a,a):a()}}function E(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=d(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,f;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:C}}function C(){return{value:void 0,done:!0}}return p.prototype=v,o(b,"constructor",v),o(v,"constructor",p),p.displayName=o(v,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,o(e,s,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},k(T.prototype),o(T.prototype,a,(function(){return this})),e.AsyncIterator=T,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var s=new T(l(t,n,r,i),a);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},k(b),o(b,s,"Generator"),o(b,i,(function(){return this})),o(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=R,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return s.type="throw",s.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var o=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(o&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(o){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),w(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;w(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},e}function l(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(c){return void n(c)}o.done?t(u):Promise.resolve(u).then(r,i)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function s(e){l(a,r,i,s,o,"next",e)}function o(e){l(a,r,i,s,o,"throw",e)}s(void 0)}))}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function h(e,t){if(e){if("string"===typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a=[],s=!0,o=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);s=!0);}catch(u){o=!0,i=u}finally{try{s||null==n.return||n.return()}finally{if(o)throw i}}return a}}(e,t)||h(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e){var t,n=new Set,r=function(e,r){var i="function"===typeof e?e(t):e;if(i!==t){var a=t;t=r?i:Object.assign({},t,i),n.forEach((function(e){return e(t,a)}))}},i=function(){return t},a={setState:r,getState:i,subscribe:function(e,r,a){return r||a?function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object.is;console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");var s=r(t);function o(){var n=r(t);if(!a(s,n)){var i=s;e(s=n,i)}}return n.add(o),function(){return n.delete(o)}}(e,r,a):(n.add(e),function(){return n.delete(e)})},destroy:function(){return n.clear()}};return t=e(r,i,a),a}var g="undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?a.useEffect:a.useLayoutEffect;function m(e){var t="function"===typeof e?v(e):e,n=function(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.getState,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object.is,i=(0,a.useReducer)((function(e){return e+1}),0),s=p(i,2),o=s[1],u=t.getState(),c=(0,a.useRef)(u),l=(0,a.useRef)(n),d=(0,a.useRef)(r),f=(0,a.useRef)(!1),h=(0,a.useRef)();void 0===h.current&&(h.current=n(u));var v=!1;(c.current!==u||l.current!==n||d.current!==r||f.current)&&(e=n(u),v=!r(h.current,e)),g((function(){v&&(h.current=e),c.current=u,l.current=n,d.current=r,f.current=!1}));var m=(0,a.useRef)(u);g((function(){var e=function(){try{var e=t.getState(),n=l.current(e);d.current(h.current,n)||(c.current=e,h.current=n,o())}catch(r){f.current=!0,o()}},n=t.subscribe(e);return t.getState()!==m.current&&e(),n}),[]);var y=v?e:h.current;return(0,a.useDebugValue)(y),y};return Object.assign(n,t),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");var e=[n,t];return{next:function(){var t=e.length<=0;return{value:e.shift(),done:t}}}},n}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t,n){return t&&b(e.prototype,t),n&&b(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function T(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||h(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=h(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw a}}}}function w(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw Error("[Immer] minified error nr: "+e+(n.length?" "+n.map((function(e){return"'"+e+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function x(e){return!!e&&!!e[fe]}function R(e){return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===he}(e)||Array.isArray(e)||!!e[de]||!!e.constructor[de]||L(e)||O(e))}function C(e,t,n){void 0===n&&(n=!1),0===A(e)?(n?Object.keys:pe)(e).forEach((function(r){n&&"symbol"==typeof r||t(r,e[r],e)})):e.forEach((function(n,r){return t(r,n,e)}))}function A(e){var t=e[fe];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:L(e)?2:O(e)?3:0}function I(e,t){return 2===A(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function P(e,t){return 2===A(e)?e.get(t):e[t]}function _(e,t,n){var r=A(e);2===r?e.set(t,n):3===r?(e.delete(t),e.add(n)):e[t]=n}function D(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function L(e){return oe&&e instanceof Map}function O(e){return ue&&e instanceof Set}function M(e){return e.o||e.t}function N(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=ve(e);delete t[fe];for(var n=pe(t),r=0;r<n.length;r++){var i=n[r],a=t[i];!1===a.writable&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(t[i]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[i]})}return Object.create(Object.getPrototypeOf(e),t)}function F(e,t){return void 0===t&&(t=!1),B(e)||x(e)||!R(e)||(A(e)>1&&(e.set=e.add=e.clear=e.delete=U),Object.freeze(e),t&&C(e,(function(e,t){return F(t,!0)}),!0)),e}function U(){w(2)}function B(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function j(e){var t=ge[e];return t||w(18,e),t}function G(){return ae}function V(e,t){t&&(j("Patches"),e.u=[],e.s=[],e.v=t)}function K(e){H(e),e.p.forEach(W),e.p=null}function H(e){e===ae&&(ae=e.l)}function z(e){return ae={p:[],l:ae,h:e,m:!0,_:0}}function W(e){var t=e[fe];0===t.i||1===t.i?t.j():t.O=!0}function q(e,t){t._=t.p.length;var n=t.p[0],r=void 0!==e&&e!==n;return t.h.g||j("ES5").S(t,e,r),r?(n[fe].P&&(K(t),w(4)),R(e)&&(e=Y(t,e),t.l||J(t,e)),t.u&&j("Patches").M(n[fe].t,e,t.u,t.s)):e=Y(t,n,[]),K(t),t.u&&t.v(t.u,t.s),e!==le?e:void 0}function Y(e,t,n){if(B(t))return t;var r=t[fe];if(!r)return C(t,(function(i,a){return Q(e,r,t,i,a,n)}),!0),t;if(r.A!==e)return t;if(!r.P)return J(e,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var i=4===r.i||5===r.i?r.o=N(r.k):r.o;C(3===r.i?new Set(i):i,(function(t,a){return Q(e,r,i,t,a,n)})),J(e,i,!1),n&&e.u&&j("Patches").R(r,n,e.u,e.s)}return r.o}function Q(e,t,n,r,i,a){if(x(i)){var s=Y(e,i,a&&t&&3!==t.i&&!I(t.D,r)?a.concat(r):void 0);if(_(n,r,s),!x(s))return;e.m=!1}if(R(i)&&!B(i)){if(!e.h.F&&e._<1)return;Y(e,i),t&&t.A.l||J(e,i)}}function J(e,t,n){void 0===n&&(n=!1),e.h.F&&e.m&&F(t,n)}function $(e,t){var n=e[fe];return(n?M(n):e)[t]}function X(e,t){if(t in e)for(var n=Object.getPrototypeOf(e);n;){var r=Object.getOwnPropertyDescriptor(n,t);if(r)return r;n=Object.getPrototypeOf(n)}}function Z(e){e.P||(e.P=!0,e.l&&Z(e.l))}function ee(e){e.o||(e.o=N(e.t))}function te(e,t,n){var r=L(t)?j("MapSet").N(t,n):O(t)?j("MapSet").T(t,n):e.g?function(e,t){var n=Array.isArray(e),r={i:n?1:0,A:t?t.A:G(),P:!1,I:!1,D:{},l:t,t:e,k:null,o:null,j:null,C:!1},i=r,a=me;n&&(i=[r],a=ye);var s=Proxy.revocable(i,a),o=s.revoke,u=s.proxy;return r.k=u,r.j=o,u}(t,n):j("ES5").J(t,n);return(n?n.A:G()).p.push(r),r}function ne(e){return x(e)||w(22,e),function e(t){if(!R(t))return t;var n,r=t[fe],i=A(t);if(r){if(!r.P&&(r.i<4||!j("ES5").K(r)))return r.t;r.I=!0,n=re(t,i),r.I=!1}else n=re(t,i);return C(n,(function(t,i){r&&P(r.t,t)===i||_(n,t,e(i))})),3===i?new Set(n):n}(e)}function re(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return N(e)}var ie,ae,se="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),oe="undefined"!=typeof Map,ue="undefined"!=typeof Set,ce="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,le=se?Symbol.for("immer-nothing"):((ie={})["immer-nothing"]=!0,ie),de=se?Symbol.for("immer-draftable"):"__$immer_draftable",fe=se?Symbol.for("immer-state"):"__$immer_state",he=("undefined"!=typeof Symbol&&Symbol.iterator,""+Object.prototype.constructor),pe="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,ve=Object.getOwnPropertyDescriptors||function(e){var t={};return pe(e).forEach((function(n){t[n]=Object.getOwnPropertyDescriptor(e,n)})),t},ge={},me={get:function(e,t){if(t===fe)return e;var n=M(e);if(!I(n,t))return function(e,t,n){var r,i=X(t,n);return i?"value"in i?i.value:null===(r=i.get)||void 0===r?void 0:r.call(e.k):void 0}(e,n,t);var r=n[t];return e.I||!R(r)?r:r===$(e.t,t)?(ee(e),e.o[t]=te(e.A.h,r,e)):r},has:function(e,t){return t in M(e)},ownKeys:function(e){return Reflect.ownKeys(M(e))},set:function(e,t,n){var r=X(M(e),t);if(null==r?void 0:r.set)return r.set.call(e.k,n),!0;if(!e.P){var i=$(M(e),t),a=null==i?void 0:i[fe];if(a&&a.t===n)return e.o[t]=n,e.D[t]=!1,!0;if(D(n,i)&&(void 0!==n||I(e.t,t)))return!0;ee(e),Z(e)}return e.o[t]===n&&"number"!=typeof n&&(void 0!==n||t in e.o)||(e.o[t]=n,e.D[t]=!0,!0)},deleteProperty:function(e,t){return void 0!==$(e.t,t)||t in e.t?(e.D[t]=!1,ee(e),Z(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var n=M(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:r.enumerable,value:n[t]}:r},defineProperty:function(){w(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){w(12)}},ye={};C(me,(function(e,t){ye[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),ye.deleteProperty=function(e,t){return ye.set.call(this,e,t,void 0)},ye.set=function(e,t,n){return me.set.call(this,e[0],t,n,e[0])};var be=function(){function e(e){var t=this;this.g=ce,this.F=!0,this.produce=function(e,n,r){if("function"==typeof e&&"function"!=typeof n){var i=n;n=e;var a=t;return function(e){var t=this;void 0===e&&(e=i);for(var r=arguments.length,s=Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return a.produce(e,(function(e){var r;return(r=n).call.apply(r,[t,e].concat(s))}))}}var s;if("function"!=typeof n&&w(6),void 0!==r&&"function"!=typeof r&&w(7),R(e)){var o=z(t),u=te(t,e,void 0),c=!0;try{s=n(u),c=!1}finally{c?K(o):H(o)}return"undefined"!=typeof Promise&&s instanceof Promise?s.then((function(e){return V(o,r),q(e,o)}),(function(e){throw K(o),e})):(V(o,r),q(s,o))}if(!e||"object"!=typeof e){if(void 0===(s=n(e))&&(s=e),s===le&&(s=void 0),t.F&&F(s,!0),r){var l=[],d=[];j("Patches").M(e,s,l,d),r(l,d)}return s}w(21,e)},this.produceWithPatches=function(e,n){if("function"==typeof e)return function(n){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return t.produceWithPatches(n,(function(t){return e.apply(void 0,[t].concat(i))}))};var r,i,a=t.produce(e,n,(function(e,t){r=e,i=t}));return"undefined"!=typeof Promise&&a instanceof Promise?a.then((function(e){return[e,r,i]})):[a,r,i]},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var t=e.prototype;return t.createDraft=function(e){R(e)||w(8),x(e)&&(e=ne(e));var t=z(this),n=te(this,e,void 0);return n[fe].C=!0,H(t),n},t.finishDraft=function(e,t){var n=(e&&e[fe]).A;return V(n,t),q(void 0,n)},t.setAutoFreeze=function(e){this.F=e},t.setUseProxies=function(e){e&&!ce&&w(20),this.g=e},t.applyPatches=function(e,t){var n;for(n=t.length-1;n>=0;n--){var r=t[n];if(0===r.path.length&&"replace"===r.op){e=r.value;break}}n>-1&&(t=t.slice(n+1));var i=j("Patches").$;return x(e)?i(e,t):this.produce(e,(function(e){return i(e,t)}))},e}(),ke=new be,Te=ke.produce,Ee=(ke.produceWithPatches.bind(ke),ke.setAutoFreeze.bind(ke),ke.setUseProxies.bind(ke),ke.applyPatches.bind(ke),ke.createDraft.bind(ke),ke.finishDraft.bind(ke),Te);var Se=function(e,t){if(Object.is(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(var r=0;r<n.length;r++)if(!Object.prototype.hasOwnProperty.call(t,n[r])||!Object.is(e[n[r]],t[n[r]]))return!1;return!0};var we=function(e){var t,n=new Set,r=function(e,r){var i="function"===typeof e?e(t):e;if(i!==t){var a=t;t=r?i:Object.assign({},t,i),n.forEach((function(e){return e(t,a)}))}},i=function(){return t},a={setState:r,getState:i,subscribe:function(e,r,a){return r||a?function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object.is,s=r(t);function o(){var n=r(t);if(!a(s,n)){var i=s;e(s=n,i)}}return n.add(o),function(){return n.delete(o)}}(e,r,a):(n.add(e),function(){return n.delete(e)})},destroy:function(){return n.clear()}};return t=e(r,i,a),a};function xe(e){return xe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},xe(e)}function Re(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=xe(e)););return e}function Ce(){return Ce="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=Re(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},Ce.apply(this,arguments)}function Ae(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ie(e,t){return Ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ie(e,t)}function Pe(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _e(e,t,n){return _e=Pe()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&Ie(i,n.prototype),i},_e.apply(null,arguments)}function De(e){var t="function"===typeof Map?new Map:void 0;return De=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return _e(e,arguments,xe(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Ie(n,e)},De(e)}function Le(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ie(e,t)}function Oe(e,t){if(t&&("object"===u(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Ae(e)}function Me(e){var t=Pe();return function(){var n,r=xe(e);if(t){var i=xe(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Oe(this,n)}}var Ne=!0,Fe=!0;function Ue(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function Be(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);var a=function(e){var t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,a),i.apply(this,[e,a])};var a=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(n))return a.apply(this,arguments);var r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,a.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function je(e){return"boolean"!==typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Ne=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Ge(e){return"boolean"!==typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Fe=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Ve(){if("object"===typeof window){if(Ne)return;"undefined"!==typeof console&&"function"===typeof console.log&&console.log.apply(console,arguments)}}function Ke(e,t){Fe&&console.warn(e+" is deprecated, please use "+t+" instead.")}function He(e){var t={browser:null,version:null};if("undefined"===typeof e||!e.navigator)return t.browser="Not a browser.",t;var n=e.navigator;if(n.mozGetUserMedia)t.browser="firefox",t.version=Ue(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=Ue(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=Ue(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}function ze(e){return"[object Object]"===Object.prototype.toString.call(e)}function We(e){return ze(e)?Object.keys(e).reduce((function(t,n){var r=ze(e[n]),i=r?We(e[n]):e[n],a=r&&!Object.keys(i).length;return void 0===i||a?t:Object.assign(t,E({},n,i))}),{}):e}function qe(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((function(r){r.endsWith("Id")?qe(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach((function(t){qe(e,e.get(t),n)}))})))}function Ye(e,t,n){var r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var a=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)})),a.forEach((function(t){e.forEach((function(n){n.type===r&&n.trackId===t.id&&qe(e,n,i)}))})),i}var Qe=Ve;function Je(e,t){var n=e&&e.navigator;if(n.mediaDevices){var r=function(e){if("object"!==typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"===typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"===typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var a={};"number"===typeof r.ideal?(a[i("min",n)]=r.ideal,t.optional.push(a),(a={})[i("max",n)]=r.ideal,t.optional.push(a)):(a[i("",n)]=r.ideal,t.optional.push(a))}void 0!==r.exact&&"number"!==typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach((function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===typeof e.audio){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"===typeof e.video){var s=e.video.facingMode;s=s&&("object"===typeof s?s:{ideal:s});var o,u=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||u))if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?o=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(o=["front"]),o)return n.mediaDevices.enumerateDevices().then((function(t){t=t.filter((function(e){return"videoinput"===e.kind}));var n=t.find((function(e){return o.some((function(t){return e.label.toLowerCase().includes(t)}))}));return!n&&t.length&&o.includes("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=s.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=r(e.video),Qe("chrome: "+JSON.stringify(e)),i(e)}));e.video=r(e.video)}return Qe("chrome: "+JSON.stringify(e)),i(e)},a=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){i(e,(function(e){n.webkitGetUserMedia(e,t,(function(e){r&&r(a(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){var s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return i(e,(function(e){return s(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Promise.reject(a(e))}))}))}}}}function $e(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"===typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((function(t){var r=n.video&&n.video.width,i=n.video&&n.video.height,a=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:a||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function Xe(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Ze(e){if("object"===typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track&&e.track.id===r.track.id})):{track:r.track};var a=new Event("track");a.track=r.track,a.receiver=i,a.transceiver={receiver:i},a.streams=[t.stream],n.dispatchEvent(a)})),t.stream.getTracks().forEach((function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track&&e.track.id===r.id})):{track:r};var a=new Event("track");a.track=r,a.receiver=i,a.transceiver={receiver:i},a.streams=[t.stream],n.dispatchEvent(a)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Be(e,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}))}function et(e){if("object"===typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((function(e){n._senders.push(t(n,e))}))};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],a.apply(this,[e]),e.getTracks().forEach((function(e){var n=t._senders.find((function(t){return t.track===e}));n&&t._senders.splice(t._senders.indexOf(n),1)}))}}else if("object"===typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var s=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=s.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function tt(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,n=Array.prototype.slice.call(arguments),r=n[0],i=n[1],a=n[2];if(arguments.length>0&&"function"===typeof r)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!==typeof r))return t.apply(this,[]);var s=function(e){var t={};return e.result().forEach((function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){n[t]=e.stat(t)})),t[n.id]=n})),t},o=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};if(arguments.length>=2){var u=function(e){i(o(s(e)))};return t.apply(this,[u,r])}return new Promise((function(n,r){t.apply(e,[function(e){n(o(s(e)))},r])})).then(i,a)}}}function nt(e){if("object"===typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return Ye(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=r.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),Be(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return Ye(t,e.track,!1)}))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,n,r,a=arguments[0];return this.getSenders().forEach((function(e){e.track===a&&(t?r=!0:t=e)})),this.getReceivers().forEach((function(e){return e.track===a&&(n?r=!0:n=e),e.track===a})),r||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}}}function rt(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(t){return e._shimmedLocalStreams[t][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){if(t.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var r=this.getSenders();n.apply(this,arguments);var i=this.getSenders().filter((function(e){return-1===r.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(i)};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((function(n){var r=t._shimmedLocalStreams[n].indexOf(e);-1!==r&&t._shimmedLocalStreams[n].splice(r,1),1===t._shimmedLocalStreams[n].length&&delete t._shimmedLocalStreams[n]})),i.apply(this,arguments)}}function it(e,t){if(e.RTCPeerConnection){if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return rt(e);var n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=n.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((function(t){return e._reverseStreams[t.id]}))};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){if(n.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}r.apply(this,[t])};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var a=this.getSenders().find((function(e){return e.track===t}));if(a)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var s=this._streams[n.id];if(s)s.addTrack(t),Promise.resolve().then((function(){r.dispatchEvent(new Event("negotiationneeded"))}));else{var o=new e.MediaStream([t]);this._streams[n.id]=o,this._reverseStreams[o.id]=n,this.addStream(o)}return this.getSenders().find((function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],r=E({},t,(function(){var e=this,t=arguments,r=arguments.length&&"function"===typeof arguments[0];return r?n.apply(this,[function(n){var r=o(e,n);t[0].apply(null,[r])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):n.apply(this,arguments).then((function(t){return o(e,t)}))}));e.RTCPeerConnection.prototype[t]=r[t]}));var a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=u(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};var s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=s.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach((function(r){n._streams[r].getTracks().find((function(t){return e.track===t}))&&(t=n._streams[r])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function o(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}function u(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}}function at(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],r=E({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=r[t]}))}function st(e,t){Be(e,"negotiationneeded",(function(e){var n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}function ot(e,t){var n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){Ke("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var i=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"===typeof e&&"object"===typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),i(e.audio,"autoGainControl","mozAutoGainControl"),i(e.audio,"noiseSuppression","mozNoiseSuppression")),a(e)},r&&r.prototype.getSettings){var s=r.prototype.getSettings;r.prototype.getSettings=function(){var e=s.apply(this,arguments);return i(e,"mozAutoGainControl","autoGainControl"),i(e,"mozNoiseSuppression","noiseSuppression"),e}}if(r&&r.prototype.applyConstraints){var o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===typeof e&&(e=JSON.parse(JSON.stringify(e)),i(e,"autoGainControl","mozAutoGainControl"),i(e,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[e])}}}}function ut(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){var r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}function ct(e){"object"===typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function lt(e,t){if("object"===typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],r=E({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=r[t]}));var n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),i=e[0],a=e[1],s=e[2];return r.apply(this,[i||null]).then((function(e){if(t.version<53&&!a)try{e.forEach((function(e){e.type=n[e.type]||e.type}))}catch(r){if("TypeError"!==r.name)throw r;e.forEach((function(t,r){e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(a,s)}}}function dt(e){if("object"===typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function ft(e){if("object"===typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n}),Be(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function ht(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;Ke("removeStream","removeTrack"),this.getSenders().forEach((function(n){n.track&&e.getTracks().includes(n.track)&&t.removeTrack(n)}))})}function pt(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function vt(e){if("object"===typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]);var n=(e=T(e)).length>0;n&&e.forEach((function(e){if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var r=t.apply(this,arguments);if(n){var i=r.sender,a=i.getParameters();(!("encodings"in a)||1===a.encodings.length&&0===Object.keys(a.encodings[0]).length)&&(a.encodings=e,i.sendEncodings=e,this.setParametersPromises.push(i.setParameters(a).then((function(){delete i.sendEncodings})).catch((function(){delete i.sendEncodings}))))}return r})}}function gt(e){if("object"===typeof e&&e.RTCRtpSender){var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}}function mt(e){if("object"===typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=arguments,n=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(n,e)})).finally((function(){n.setParametersPromises=[]})):t.apply(this,arguments)}}}function yt(e){if("object"===typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=arguments,n=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(n,e)})).finally((function(){n.setParametersPromises=[]})):t.apply(this,arguments)}}}function bt(e){if("object"===typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((function(r){return t.call(n,r,e)})),e.getVideoTracks().forEach((function(r){return t.call(n,r,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=this,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return i&&i.forEach((function(e){n._localStreams?n._localStreams.includes(e)||n._localStreams.push(e):n._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var n=this._localStreams.indexOf(e);if(-1!==n){this._localStreams.splice(n,1);var r=e.getTracks();this.getSenders().forEach((function(e){r.includes(e.track)&&t.removeTrack(e)}))}})}}function kt(e){if("object"===typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var n=new Event("addstream");n.stream=e,t.dispatchEvent(n)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}}))}),t.apply(e,arguments)}}}function Tt(e){if("object"===typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};var o=function(e,t,n){var r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=o,o=function(e,t,n){var r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=o,o=function(e,t,n){var r=s.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=o}}function Et(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=function(e){return r(St(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function St(e){return e&&void 0!==e.video?Object.assign({},e,{video:We(e.video)}):e}function wt(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var r=[],i=0;i<e.iceServers.length;i++){var a=e.iceServers[i];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(Ke("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,r.push(a)):r.push(e.iceServers[i])}e.iceServers=r}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}}function xt(e){"object"===typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function Rt(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){"undefined"!==typeof e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=this.getTransceivers().find((function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveAudio||n||this.addTransceiver("audio",{direction:"recvonly"}),"undefined"!==typeof e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var r=this.getTransceivers().find((function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Ct(e){"object"!==typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var At=n(800),It=n.n(At);function Pt(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var n=new t(e),r=It().parseCandidate(e.candidate),i=Object.assign(n,r);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,Be(e,"icecandidate",(function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))}}function _t(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Be(e,"icecandidate",(function(e){if(e.candidate){var t=It().parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function Dt(e,t){if(e.RTCPeerConnection){"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return"undefined"===typeof this._sctp?null:this._sctp}});var n=function(e){if(!e||!e.sdp)return!1;var t=It().splitSections(e.sdp);return t.shift(),t.some((function(e){var t=It().parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},r=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var n=parseInt(t[1],10);return n!==n?-1:n},i=function(e){var n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},a=function(e,n){var r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);var i=It().matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){var e=this.getConfiguration(),o=e.sdpSemantics;"plan-b"===o&&Object.defineProperty(this,"sctp",{get:function(){return"undefined"===typeof this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){var u,c=r(arguments[0]),l=i(c),d=a(arguments[0],c);u=0===l&&0===d?Number.POSITIVE_INFINITY:0===l||0===d?Math.max(l,d):Math.min(l,d);var f={};Object.defineProperty(f,"maxMessageSize",{get:function(){return u}}),this._sctp=f}return s.apply(this,arguments)}}}function Lt(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return n(e,this),e},Be(e,"datachannel",(function(e){return n(e.channel,e.target),e}))}function n(e,t){var n=e.send;e.send=function(){var r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}}function Ot(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}}function Mt(e,t){if(e.RTCPeerConnection&&!("chrome"===t.browser&&t.version>=71)&&!("safari"===t.browser&&t.version>=605)){var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){var r=t.sdp.split("\n").filter((function(e){return"a=extmap-allow-mixed"!==e.trim()})).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:r}):t.sdp=r}return n.apply(this,arguments)}}}function Nt(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}}function Ft(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this,t=arguments[0]||{};if("object"!==typeof t||t.type&&t.sdp)return n.apply(this,arguments);if(!(t={type:t.type,sdp:t.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":t.type="offer";break;default:t.type="answer"}if(t.sdp||"offer"!==t.type&&"answer"!==t.type)return n.apply(this,[t]);var r="offer"===t.type?this.createOffer:this.createAnswer;return r.apply(this).then((function(t){return n.apply(e,[t])}))})}}var Ut,Bt=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=n.window,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},o=Ve,u=He(a),c={browserDetails:u,commonShim:i,extractVersion:Ue,disableLog:je,disableWarnings:Ge,sdp:At};switch(u.browser){case"chrome":if(!e||!at||!s.shimChrome)return o("Chrome shim is not included in this adapter release."),c;if(null===u.version)return o("Chrome shim can not determine version, not shimming."),c;o("adapter.js shimming chrome."),c.browserShim=e,Nt(a,u),Ft(a),Je(a,u),Xe(a),at(a,u),Ze(a),it(a,u),et(a),tt(a),nt(a),st(a,u),Pt(a),_t(a),Ot(a),Dt(a,u),Lt(a),Mt(a,u);break;case"firefox":if(!t||!lt||!s.shimFirefox)return o("Firefox shim is not included in this adapter release."),c;o("adapter.js shimming firefox."),c.browserShim=t,Nt(a,u),Ft(a),ot(a,u),lt(a,u),ct(a),ht(a),dt(a),ft(a),pt(a),vt(a),gt(a),mt(a),yt(a),Pt(a),Ot(a),Dt(a,u),Lt(a);break;case"safari":if(!r||!s.shimSafari)return o("Safari shim is not included in this adapter release."),c;o("adapter.js shimming safari."),c.browserShim=r,Nt(a,u),Ft(a),wt(a),Rt(a),Tt(a),bt(a),kt(a),xt(a),Et(a),Ct(a),Pt(a),_t(a),Dt(a,u),Lt(a),Mt(a,u);break;default:o("Unsupported browser!")}return c}({window:"undefined"===typeof window?void 0:window}),jt=Bt,Gt=n(210),Vt=new Uint8Array(16);function Kt(){if(!Ut&&!(Ut="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ut(Vt)}var Ht=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var zt=function(e){return"string"===typeof e&&Ht.test(e)},Wt=[],qt=0;qt<256;++qt)Wt.push((qt+256).toString(16).substr(1));var Yt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(Wt[e[t+0]]+Wt[e[t+1]]+Wt[e[t+2]]+Wt[e[t+3]]+"-"+Wt[e[t+4]]+Wt[e[t+5]]+"-"+Wt[e[t+6]]+Wt[e[t+7]]+"-"+Wt[e[t+8]]+Wt[e[t+9]]+"-"+Wt[e[t+10]]+Wt[e[t+11]]+Wt[e[t+12]]+Wt[e[t+13]]+Wt[e[t+14]]+Wt[e[t+15]]).toLowerCase();if(!zt(n))throw TypeError("Stringified UUID is invalid");return n};var Qt,Jt,$t,Xt=function(e,t,n){var r=(e=e||{}).random||(e.rng||Kt)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return Yt(r)},Zt=n(371),en=n.n(Zt),tn=n(861),nn=Object.defineProperty,rn=Object.defineProperties,an=Object.getOwnPropertyDescriptors,sn=Object.getOwnPropertySymbols,on=Object.prototype.hasOwnProperty,un=Object.prototype.propertyIsEnumerable,cn=function(e,t,n){return t in e?nn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},ln=function(e,t){for(var n in t||(t={}))on.call(t,n)&&cn(e,n,t[n]);if(sn){var r,i=S(sn(t));try{for(i.s();!(r=i.n()).done;){n=r.value;un.call(t,n)&&cn(e,n,t[n])}}catch(a){i.e(a)}finally{i.f()}}return e},dn=function(e,t){return rn(e,an(t))},fn=function(e,t){var n={};for(var r in e)on.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&sn){var i,a=S(sn(e));try{for(a.s();!(i=a.n()).done;){r=i.value;t.indexOf(r)<0&&un.call(e,r)&&(n[r]=e[r])}}catch(s){a.e(s)}finally{a.f()}}return n},hn=function(e,t,n){return new Promise((function(r,i){var a=function(e){try{o(n.next(e))}catch(M){i(M)}},s=function(e){try{o(n.throw(e))}catch(M){i(M)}},o=function(e){return e.done?r(e.value):Promise.resolve(e.value).then(a,s)};o((n=n.apply(e,t)).next())}))},pn=function(e,t){return function(){return t||e((t={exports:{}}).exports,t),t.exports}}((function(e,t){t.exports={name:"@100mslive/hms-video",version:"0.7.3",license:"MIT",main:"dist/index.cjs.js",typings:"dist/index.d.ts",module:"dist/index.js",files:["dist","src"],engines:{node:">=10"},exports:{".":{require:"./dist/index.cjs.js",import:"./dist/index.js",default:"./dist/index.js"}},scripts:{prestart:"rm -rf dist && yarn types:build",start:'concurrently "yarn dev" "yarn types"',dev:"node ../../scripts/dev","build:only":"node ../../scripts/build",build:"yarn build:only && yarn types:build",types:"tsc -w","types:build":"tsc -p tsconfig.json",test:"jest --maxWorkers=1",lint:"eslint -c ../../.eslintrc .","lint:fix":"yarn lint --fix",prepare:"yarn build",size:"size-limit",analyze:"size-limit --why",format:"prettier --write src/**/*.ts"},author:"100ms <tech-common@100ms.live>",devDependencies:{"@types/sdp-transform":"^2.4.4","@types/ua-parser-js":"^0.7.36","@types/uuid":"^8.3.0","jest-canvas-mock":"^2.3.1",tslib:"^2.2.0"},dependencies:{eventemitter2:"^6.4.7","sdp-transform":"^2.14.1","ua-parser-js":"^1.0.1",uuid:"^8.3.2","webrtc-adapter":"^8.0.0"},gitHead:"8193e1162ae5138fe8fc001aaecce1cf7624bd9e"}})),vn=function(){function e(t){y(this,e),this.key=t,this.storage=null}return k(e,[{key:"getStorage",value:function(){return yn&&!this.storage&&(En(),this.storage=window.localStorage),this.storage}},{key:"get",value:function(){var e,t=null==(e=this.getStorage())?void 0:e.getItem(this.key);return t?JSON.parse(t):void 0}},{key:"set",value:function(e){var t,n=JSON.stringify(e);null==(t=this.getStorage())||t.setItem(this.key,n)}},{key:"clear",value:function(){var e;null==(e=this.getStorage())||e.removeItem(this.key)}}]),e}(),gn=new Gt.UAParser,mn="undefined"==typeof window&&!(null==(Jt=gn.getBrowser().name)?void 0:Jt.toLowerCase().includes("electron")),yn="undefined"!=typeof window;!function(e){e.PROD="prod",e.QA="qa",e.DEV="dev"}($t||($t={}));var bn,kn=function(){var e;return"ios"===(null==(e=gn.getOS().name)?void 0:e.toLowerCase())},Tn=function(){function e(){y(this,e),this.valuesMap=new Map}return k(e,[{key:"getItem",value:function(e){return this.valuesMap.has(e)?String(this.valuesMap.get(e)):null}},{key:"setItem",value:function(e,t){this.valuesMap.set(e,t)}},{key:"removeItem",value:function(e){this.valuesMap.delete(e)}},{key:"clear",value:function(){this.valuesMap.clear()}},{key:"key",value:function(e){if(0===arguments.length)throw new TypeError("Failed to execute 'key' on 'Storage': 1 argument required, but only 0 present.");return Array.from(this.valuesMap.keys())[e]}},{key:"length",get:function(){return this.valuesMap.size}}]),e}(),En=function(){yn&&!localStorage&&(window.localStorage=new Tn)};!function(e){e[e.VERBOSE=0]="VERBOSE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.TIME=4]="TIME",e[e.TIMEEND=5]="TIMEEND",e[e.ERROR=6]="ERROR",e[e.NONE=7]="NONE"}(bn||(bn={}));var Sn="undefined"!=typeof window&&"undefined"!=typeof window.expect,wn=function(){function e(){y(this,e)}return k(e,null,[{key:"v",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,[0,e].concat(n))}},{key:"d",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,[1,e].concat(n))}},{key:"i",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,[2,e].concat(n))}},{key:"w",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,[3,e].concat(n))}},{key:"e",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,[6,e].concat(n))}},{key:"time",value:function(e){this.log(4,"[HMSPerformanceTiming]",e)}},{key:"timeEnd",value:function(e){this.log(5,"[HMSPerformanceTiming]",e,e)}},{key:"cleanUp",value:function(){performance.clearMarks(),performance.clearMeasures()}},{key:"log",value:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(!(this.level.valueOf()>e.valueOf()))switch(e){case 0:var a;(a=console).log.apply(a,[t].concat(r));break;case 1:var s;(s=console).debug.apply(s,[t].concat(r));break;case 2:var o;(o=console).info.apply(o,[t].concat(r));break;case 3:var u;(u=console).warn.apply(u,[t].concat(r));break;case 6:var c;(c=console).error.apply(c,[t].concat(r));break;case 4:performance.mark(r[0]);break;case 5:var l=r[0];try{var d=performance.measure(l,l);this.log(1,t,l,null==d?void 0:d.duration),performance.clearMarks(l),performance.clearMeasures(l)}catch(d){this.log(1,t,l,d)}}}}]),e}();wn.level=Sn?7:0;var xn=function(){function e(t){var n=t.sender,r=t.message,i=t.type,a=void 0===i?"chat":i,s=t.recipientPeer,o=t.recipientRoles,u=t.time;y(this,e),this.sender=n,this.message=r,this.type=a,this.recipientPeer=s,this.recipientRoles=o,this.time=u}return k(e,[{key:"toSignalParams",value:function(){var e,t,n=null==(e=this.recipientRoles)?void 0:e.map((function(e){return e.name})),r=null==(t=this.recipientPeer)?void 0:t.peerId,i={info:{message:this.message,type:this.type}};return(null==n?void 0:n.length)&&(i.roles=n),r&&(i.peer_id=r),i}},{key:"toString",value:function(){var e;return"{\n      sender: ".concat(this.sender,";\n      recipientPeer: ").concat(this.recipientPeer,";\n      recipientRoles: ").concat(null==(e=this.recipientRoles)?void 0:e.map((function(e){return e.name})),";\n      message: ").concat(this.message,";\n      time: ").concat(this.time,";\n      type: ").concat(this.type,";\n    }")}}]),e}(),Rn=function(){function e(t,n){y(this,e),this.id=t,this.store=n,this.recording={server:{running:!1},browser:{running:!1},hls:{running:!1}},this.rtmp={running:!1},this.hls={running:!1,variants:[]}}return k(e,[{key:"localPeer",get:function(){return this.store.getLocalPeer()}},{key:"peers",get:function(){return this.store.getPeers()}}]),e}(),Cn=function(){function e(t){var n=t.peerId,r=t.name,i=t.isLocal,a=t.customerUserId,s=t.metadata,o=t.role,u=t.joinedAt;y(this,e),this.customerUserId="",this.metadata="",this.auxiliaryTracks=[],this.name=r,this.peerId=n,this.isLocal=i,this.customerUserId=a,this.metadata=s,this.joinedAt=u,o&&(this.role=o)}return k(e,[{key:"updateRole",value:function(e){this.role=e}},{key:"updateName",value:function(e){this.name=e}},{key:"updateMetadata",value:function(e){this.metadata=e}},{key:"toString",value:function(){var e,t,n;return"{\n      name: ".concat(this.name,";\n      role: ").concat(null==(e=this.role)?void 0:e.name,";\n      peerId: ").concat(this.peerId,";\n      customerUserId: ").concat(this.customerUserId,";\n      ").concat(this.audioTrack?"audioTrack: ".concat(null==(t=this.audioTrack)?void 0:t.trackId,";"):"","\n      ").concat(this.videoTrack?"videoTrack: ".concat(null==(n=this.videoTrack)?void 0:n.trackId,";"):"","\n    }")}}]),e}(),An=k((function e(){y(this,e)}));An.makePeerId=function(){return Xt()};var In,Pn=function(e){Le(n,e);var t=Me(n);function n(e){var r;return y(this,n),(r=t.call(this,dn(ln({},e),{peerId:An.makePeerId(),isLocal:!0}))).isLocal=!0,r.auxiliaryTracks=[],r}return k(n)}(Cn),_n=function(e){Le(n,e);var t=Me(n);function n(e){var r;return y(this,n),(r=t.call(this,dn(ln({},e),{isLocal:!1}))).isLocal=!1,r.auxiliaryTracks=[],r.fromRoomState=!1,r.fromRoomState=!!e.fromRoomState,r}return k(n)}(Cn);!function(e){e.CUSTOM="CUSTOM",e.LOCAL="LOCAL",e.HMS="HMS"}(In||(In={}));var Dn=function(){if(yn&&window){var e=window.location.hostname;return"localhost"===e||"127.0.0.1"===e?In.LOCAL:e.includes("app.100ms.live")?In.HMS:In.CUSTOM}return In.CUSTOM}(),Ln=pn().version;function On(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$t.PROD,t=arguments.length>1?arguments[1]:void 0,n="web",r=Dn!==In.LOCAL&&e===$t.PROD?"prod":"debug";if(mn)return Un({os:"web_nodejs",os_version:process.version,sdk:n,sdk_version:Ln,env:r,domain:Dn,framework:"node",framework_version:process.version,framework_sdk_version:null==t?void 0:t.sdkVersion});var i=gn.getOS(),a=gn.getDevice(),s=gn.getBrowser(),o=Mn("web_".concat(i.name)),u=i.version||"",c=Mn("".concat(s.name,"_").concat(s.version)),l=c;return a.type&&(l="".concat(Mn("".concat(a.vendor,"_").concat(a.type)),"/").concat(c)),Un({os:o,os_version:u,sdk:n,sdk_version:Ln,device_model:l,env:r,domain:Dn,framework:null==t?void 0:t.type,framework_version:null==t?void 0:t.version,framework_sdk_version:null==t?void 0:t.sdkVersion})}function Mn(e){return e.replace(/ /g,"_")}var Nn,Fn,Un=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";return Object.keys(e).filter((function(t){return!!e[t]})).map((function(t){return"".concat(t,":").concat(e[t])})).join(t)},Bn=function(){function e(t){var n=t.name,r=t.level,i=t.properties,a=t.includesPII,s=t.timestamp;y(this,e),this.metadata={peer:{},userAgent:On()},this.name=n,this.level=r,this.includesPII=a||!1,this.properties=i||{},this.timestamp=s||(new Date).getTime(),this.event_id=Xt(),this.device_id=function(){var e,t=new vn("hms-analytics-deviceId"),n=t.get();return n?e=n:(e=Xt(),t.set(e)),e}()}return k(e,[{key:"toSignalParams",value:function(){return{name:this.name,info:dn(ln({},this.properties),{timestamp:this.timestamp,domain:Dn}),timestamp:(new Date).getTime()}}}]),e}();!function(e){e[e.VERBOSE=0]="VERBOSE",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.OFF=3]="OFF"}(Nn||(Nn={})),function(e){e[e.VERBOSE=0]="VERBOSE",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.OFF=3]="OFF"}(Fn||(Fn={}));var jn,Gn=function(e){Le(n,e);var t=Me(n);function n(e,r,i,a,s){var o,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return y(this,n),(o=t.call(this,a)).code=e,o.name=r,o.message=a,o.description=s,o.isTerminal=u,Object.setPrototypeOf(Ae(o),n.prototype),o.action=i.toString(),o}return k(n,[{key:"toAnalyticsProperties",value:function(){return{error_name:this.name,error_code:this.code,error_message:this.message,error_description:this.description,action:this.action,is_terminal:this.isTerminal}}},{key:"addNativeError",value:function(e){this.nativeError=e}},{key:"toString",value:function(){var e;return"{\n      code: ".concat(this.code,";\n      name: ").concat(this.name,";\n      action: ").concat(this.action,";\n      message: ").concat(this.message,";\n      description: ").concat(this.description,";\n      isTerminal: ").concat(this.isTerminal,";\n      nativeError: ").concat(null==(e=this.nativeError)?void 0:e.message,";\n    }")}}]),n}(De(Error)),Vn=function(){function e(){y(this,e)}return k(e,null,[{key:"connect",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Date,a=arguments.length>4?arguments[4]:void 0,s=this.eventNameFor("connect",void 0===e),o=e?Fn.ERROR:Fn.INFO,u=this.getPropertiesWithError(dn(ln({},t),(E(n={},this.KEY_REQUESTED_AT,null==r?void 0:r.getTime()),E(n,this.KEY_RESPONDED_AT,null==i?void 0:i.getTime()),E(n,"endpoint",a),n)),e);return new Bn({name:s,level:o,properties:u})}},{key:"disconnect",value:function(e,t){var n=e?Fn.ERROR:Fn.INFO,r=this.getPropertiesWithError(t,e);return new Bn({name:"disconnected",level:n,properties:r})}},{key:"preview",value:function(e){var t=e,n=t.error,r=fn(t,["error"]),i=this.eventNameFor("preview",void 0===n),a=n?Fn.ERROR:Fn.INFO,s=this.getPropertiesWithError(r,n);return new Bn({name:i,level:a,properties:s})}},{key:"join",value:function(e){var t=e,n=t.error,r=fn(t,["error"]),i=this.eventNameFor("join",void 0===n),a=n?Fn.ERROR:Fn.INFO,s=this.getPropertiesWithError(dn(ln({},r),{is_preview_called:!!r.is_preview_called}),n);return new Bn({name:i,level:a,properties:s})}},{key:"publish",value:function(e){var t=e.devices,n=e.settings,r=e.error,i=this.eventNameFor("publish",void 0===r),a=r?Fn.ERROR:Fn.INFO,s=this.getPropertiesWithError({devices:t,audio:null==n?void 0:n.audio,video:null==n?void 0:n.video},r);return new Bn({name:i,level:a,properties:s})}},{key:"subscribeFail",value:function(e){var t=this.eventNameFor("subscribe",!1),n=Fn.ERROR,r=this.getErrorProperties(e);return new Bn({name:t,level:n,properties:r})}},{key:"leave",value:function(){return new Bn({name:"leave",level:Fn.INFO})}},{key:"autoplayError",value:function(){return new Bn({name:"autoplayError",level:Fn.ERROR})}},{key:"audioPlaybackError",value:function(e){return new Bn({name:"audioPlaybackError",level:Fn.ERROR,properties:this.getErrorProperties(e)})}},{key:"deviceChange",value:function(e){var t=e.selection,n=e.type,r=e.devices,i=e.error,a=this.eventNameFor(i?"publish":"device.".concat(n),void 0===i),s=i?Fn.ERROR:Fn.INFO,o=this.getPropertiesWithError({selection:t,devices:r},i);return new Bn({name:a,level:s,properties:o})}},{key:"performance",value:function(e){var t=Fn.INFO,n=e.toAnalyticsProperties();return new Bn({name:"perf.stats",level:t,properties:n})}},{key:"rtcStats",value:function(e){var t=Fn.INFO,n=e.toAnalyticsProperties();return new Bn({name:"rtc.stats",level:t,properties:n})}},{key:"degradationStats",value:function(e,t){var n=Fn.INFO,r={degradedAt:e.degradedAt,trackId:e.trackId};if(!t&&e.degradedAt instanceof Date){var i=new Date,a=i.valueOf()-e.degradedAt.valueOf();r=dn(ln({},r),{duration:a,restoredAt:i})}return new Bn({name:"video.degradation.stats",level:n,properties:r})}},{key:"audioDetectionFail",value:function(e,t){var n=this.getPropertiesWithError({device:t},e),r=Fn.ERROR;return new Bn({name:"audiopresence.failed",level:r,properties:n})}},{key:"previewNetworkQuality",value:function(e){return new Bn({name:"perf.networkquality.preview",level:e.error?Fn.ERROR:Fn.INFO,properties:e})}},{key:"eventNameFor",value:function(e,t){return"".concat(e,".").concat(t?"success":"failed")}},{key:"getPropertiesWithError",value:function(e,t){var n=this.getErrorProperties(t);return e=ln(ln({},n),e)}},{key:"getErrorProperties",value:function(e){return e?e instanceof Gn?e.toAnalyticsProperties():{error_name:e.name,error_message:e.message,error_description:e.cause}:{}}}]),e}();Vn.KEY_REQUESTED_AT="requested_at",Vn.KEY_RESPONDED_AT="responded_at",function(e){e.INIT="init_response_time",e.WEBSOCKET_CONNECT="ws_connect_time",e.ON_POLICY_CHANGE="on_policy_change_time",e.LOCAL_AUDIO_TRACK="local_audio_track_time",e.LOCAL_VIDEO_TRACK="local_video_track_time",e.JOIN="join_time",e.PREVIEW="preview_time",e.PEER_LIST="peer_list_time",e.ROOM_STATE="room_state_time",e.JOIN_RESPONSE="join_response_time"}(jn||(jn={}));var Kn,Hn=[jn.INIT,jn.WEBSOCKET_CONNECT,jn.ON_POLICY_CHANGE,jn.LOCAL_AUDIO_TRACK,jn.LOCAL_VIDEO_TRACK,jn.PEER_LIST,jn.ROOM_STATE],zn=function(){function e(){y(this,e),this.eventPerformanceMeasures={}}return k(e,[{key:"start",value:function(e){performance.mark(e)}},{key:"end",value:function(e){var t;try{this.eventPerformanceMeasures[e]=performance.measure(e,e),wn.d("[HMSPerformanceTiming]",e,null==(t=this.eventPerformanceMeasures[e])?void 0:t.duration)}catch(C){wn.w("[AnalyticsTimer]","Error in measuring performance for event ".concat(e),{error:C})}}},{key:"getTimeTaken",value:function(e){var t;return null==(t=this.eventPerformanceMeasures[e])?void 0:t.duration}},{key:"getTimes",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return[].concat(Hn,n).reduce((function(t,n){return dn(ln({},t),E({},n,e.getTimeTaken(n)))}),{})}},{key:"cleanUp",value:function(){this.eventPerformanceMeasures={}}}]),e}(),Wn={WebSocketConnectionErrors:{FAILED_TO_CONNECT:1e3,WEBSOCKET_CONNECTION_LOST:1003,ABNORMAL_CLOSE:1006},InitAPIErrors:{SERVER_ERRORS:2e3,INIT_CONFIG_NOT_AVAILABLE:2002,ENDPOINT_UNREACHABLE:2003,INVALID_TOKEN_FORMAT:2004},TracksErrors:{GENERIC_TRACK:3e3,CANT_ACCESS_CAPTURE_DEVICE:3001,DEVICE_NOT_AVAILABLE:3002,DEVICE_IN_USE:3003,DEVICE_LOST_MIDWAY:3008,NOTHING_TO_RETURN:3005,INVALID_VIDEO_SETTINGS:3006,CODEC_CHANGE_NOT_PERMITTED:3007,AUTOPLAY_ERROR:3008,OVER_CONSTRAINED:3009,NO_AUDIO_DETECTED:3010,SYSTEM_DENIED_PERMISSION:3011,CURRENT_TAB_NOT_SHARED:3012,AUDIO_PLAYBACK_ERROR:3013},WebrtcErrors:{CREATE_OFFER_FAILED:4001,CREATE_ANSWER_FAILED:4002,SET_LOCAL_DESCRIPTION_FAILED:4003,SET_REMOTE_DESCRIPTION_FAILED:4004,ICE_FAILURE:4005,ICE_DISCONNECTED:4006},WebsocketMethodErrors:{SERVER_ERRORS:5e3,ALREADY_JOINED:5001,CANNOT_JOIN_PREVIEW_IN_PROGRESS:5002},GenericErrors:{NOT_CONNECTED:6e3,SIGNALLING:6001,UNKNOWN:6002,NOT_READY:6003,JSON_PARSING_FAILED:6004,TRACK_METADATA_MISSING:6005,RTC_TRACK_MISSING:6006,PEER_METADATA_MISSING:6007,INVALID_ROLE:6008,PREVIEW_IN_PROGRESS:6009,MISSING_MEDIADEVICES:6010,MISSING_RTCPEERCONNECTION:6011},PlaylistErrors:{NO_ENTRY_TO_PLAY:8001,NO_ENTRY_IS_PLAYING:8002}};!function(e){e.NONE="NONE",e.TRACK="TRACK",e.INIT="INIT",e.PUBLISH="PUBLISH",e.UNPUBLISH="UNPUBLISH",e.JOIN="JOIN",e.SUBSCRIBE="SUBSCRIBE",e.DATA_CHANNEL_SEND="DATA_CHANNEL_SEND",e.RESTART_ICE="RESTART_ICE",e.VIDEO_PLUGINS="VIDEO_PLUGINS",e.AUDIO_PLUGINS="AUDIO_PLUGINS",e.AUTOPLAY="AUTOPLAY",e.RECONNECT_SIGNAL="RECONNECT_SIGNAL",e.VALIDATION="VALIDATION",e.PLAYLIST="PLAYLIST",e.PREVIEW="PREVIEW"}(Kn||(Kn={}));var qn,Yn,Qn,Jn,$n,Xn={FailedToConnect:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(Wn.WebSocketConnectionErrors.FAILED_TO_CONNECT,"WebsocketFailedToConnect",e,"[WS]: ".concat(t),"[WS]: ".concat(t))},WebSocketConnectionLost:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(Wn.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,"WebSocketConnectionLost",e,"Network connection lost ",t)},AbnormalClose:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(Wn.WebSocketConnectionErrors.ABNORMAL_CLOSE,"WebSocketAbnormalClose",e,"Websocket closed abnormally",t)}},Zn={ServerErrors:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Gn(e,"ServerErrors",t,"[INIT]: Server error ".concat(n),n,!0)},EndpointUnreachable:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(Wn.InitAPIErrors.ENDPOINT_UNREACHABLE,"EndpointUnreachable",e,"Endpoint is not reachable - ".concat(t),t)},InvalidTokenFormat:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(Wn.InitAPIErrors.INVALID_TOKEN_FORMAT,"InvalidTokenFormat",e,"Token is not in proper JWT format - ".concat(t),t,!0)},InitConfigNotAvailable:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(Wn.InitAPIErrors.INIT_CONFIG_NOT_AVAILABLE,"InitError",e,"[INIT]: ".concat(t),"[INIT]: ".concat(t))}},er={GenericTrack:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(Wn.TracksErrors.GENERIC_TRACK,"GenericTrack",e,"[TRACK]: ".concat(t),"[TRACK]: ".concat(t))},CantAccessCaptureDevice:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Gn(Wn.TracksErrors.CANT_ACCESS_CAPTURE_DEVICE,"CantAccessCaptureDevice",e,"User denied permission to access capture device - ".concat(t),n)},DeviceNotAvailable:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Gn(Wn.TracksErrors.DEVICE_NOT_AVAILABLE,"DeviceNotAvailable",e,"[TRACK]: Capture device is no longer available - ".concat(t),n)},DeviceInUse:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Gn(Wn.TracksErrors.DEVICE_IN_USE,"DeviceInUse",e,"[TRACK]: Capture device is in use by another application - ".concat(t),n)},DeviceLostMidway:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Gn(Wn.TracksErrors.DEVICE_LOST_MIDWAY,"DeviceLostMidway",e,"Lost access to capture device midway - ".concat(t),n)},NothingToReturn:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"There is no media to return. Please select either video or audio or both.";return new Gn(Wn.TracksErrors.NOTHING_TO_RETURN,"NothingToReturn",e,n,t)},InvalidVideoSettings:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(Wn.TracksErrors.INVALID_VIDEO_SETTINGS,"InvalidVideoSettings",e,"Cannot enable simulcast when no video settings are provided",t)},AutoplayBlocked:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(Wn.TracksErrors.AUTOPLAY_ERROR,"AutoplayBlocked",e,"Autoplay blocked because the user didn't interact with the document first",t)},CodecChangeNotPermitted:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(Wn.TracksErrors.CODEC_CHANGE_NOT_PERMITTED,"CodecChangeNotPermitted",e,"Codec can't be changed mid call.",t)},OverConstrained:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Gn(Wn.TracksErrors.OVER_CONSTRAINED,"OverConstrained",e,"[TRACK]: Requested constraints cannot be satisfied with the device hardware - ".concat(t),n)},NoAudioDetected:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Please check the mic or use another audio input";return new Gn(Wn.TracksErrors.NO_AUDIO_DETECTED,"NoAudioDetected",e,"No audio input detected from microphone",t)},SystemDeniedPermission:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Gn(Wn.TracksErrors.SYSTEM_DENIED_PERMISSION,"SystemDeniedPermission",e,"Operating System denied permission to access capture device - ".concat(t),n)},CurrentTabNotShared:function(){return new Gn(Wn.TracksErrors.CURRENT_TAB_NOT_SHARED,"CurrentTabNotShared",Kn.TRACK,"The app requires you to share the current tab","You must screen share the current tab in order to proceed")},AudioPlaybackError:function(e){return new Gn(Wn.TracksErrors.AUDIO_PLAYBACK_ERROR,"Audio playback error",Kn.TRACK,e,e)}},tr={CreateOfferFailed:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(Wn.WebrtcErrors.CREATE_OFFER_FAILED,"CreateOfferFailed",e,"[".concat(e.toString(),"]: Failed to create offer. "),t)},CreateAnswerFailed:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(Wn.WebrtcErrors.CREATE_ANSWER_FAILED,"CreateAnswerFailed",e,"[".concat(e.toString(),"]: Failed to create answer. "),t)},SetLocalDescriptionFailed:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(Wn.WebrtcErrors.SET_LOCAL_DESCRIPTION_FAILED,"SetLocalDescriptionFailed",e,"[".concat(e.toString(),"]: Failed to set offer. "),t)},SetRemoteDescriptionFailed:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(Wn.WebrtcErrors.SET_REMOTE_DESCRIPTION_FAILED,"SetRemoteDescriptionFailed",e,"[".concat(e.toString(),"]: Failed to set answer. "),t)},ICEFailure:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(Wn.WebrtcErrors.ICE_FAILURE,"ICEFailure",e,"[".concat(e.toString(),"]: Ice connection state FAILED"),t)},ICEDisconnected:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(Wn.WebrtcErrors.ICE_DISCONNECTED,"ICEDisconnected",e,"[".concat(e.toString(),"]: Ice connection state DISCONNECTED"),t)}},nr={ServerErrors:function(e,t,n){return new Gn(e,"ServerErrors",t,n,n,!0)},AlreadyJoined:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(Wn.WebsocketMethodErrors.ALREADY_JOINED,"AlreadyJoined",e,"[JOIN]: You have already joined this room.",t)},CannotJoinPreviewInProgress:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(Wn.WebsocketMethodErrors.CANNOT_JOIN_PREVIEW_IN_PROGRESS,"CannotJoinPreviewInProgress",e,"[JOIN]: Cannot join if preview is in progress",t)}},rr={NotConnected:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(Wn.GenericErrors.NOT_CONNECTED,"NotConnected",e,"Client is not connected",t)},Signalling:function(e,t){return new Gn(Wn.GenericErrors.SIGNALLING,"Signalling",e,"Unknown signalling error: ".concat(e.toString()," ").concat(t," "),t)},Unknown:function(e,t){return new Gn(Wn.GenericErrors.UNKNOWN,"Unknown",e,"Unknown exception: ".concat(t),t)},NotReady:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(Wn.GenericErrors.NOT_READY,"NotReady",e,t,t)},JsonParsingFailed:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Gn(Wn.GenericErrors.JSON_PARSING_FAILED,"JsonParsingFailed",e,"Failed to parse JSON message - ".concat(t),n)},TrackMetadataMissing:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(Wn.GenericErrors.TRACK_METADATA_MISSING,"TrackMetadataMissing",e,"Track Metadata Missing",t)},RTCTrackMissing:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(Wn.GenericErrors.RTC_TRACK_MISSING,"RTCTrackMissing",e,"RTC Track missing",t)},PeerMetadataMissing:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(Wn.GenericErrors.PEER_METADATA_MISSING,"PeerMetadataMissing",e,"Peer Metadata Missing",t)},ValidationFailed:function(e,t){return new Gn(Wn.GenericErrors.INVALID_ROLE,"ValidationFailed",Kn.VALIDATION,e,t?JSON.stringify(t):"")},InvalidRole:function(e,t){return new Gn(Wn.GenericErrors.INVALID_ROLE,"InvalidRole",e,"Invalid role. Join with valid role",t,!0)},PreviewAlreadyInProgress:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(Wn.GenericErrors.PREVIEW_IN_PROGRESS,"PreviewAlreadyInProgress",e,"[Preview]: Cannot join if preview is in progress",t)},MissingMediaDevices:function(){return new Gn(Wn.GenericErrors.MISSING_MEDIADEVICES,"MissingMediaDevices",Kn.JOIN,"navigator.mediaDevices is undefined. 100ms SDK won't work on this website as WebRTC is not supported on HTTP endpoints(missing navigator.mediaDevices). Please ensure you're using the SDK either on localhost or a valid HTTPS endpoint.","",!0)},MissingRTCPeerConnection:function(){return new Gn(Wn.GenericErrors.MISSING_RTCPEERCONNECTION,"MissingRTCPeerConnection",Kn.JOIN,"RTCPeerConnection which is a core requirement for WebRTC call was not found, this could be due to an unsupported browser or browser extensions blocking WebRTC","",!0)}},ir={PlatformNotSupported:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(7001,"PlatformNotSupported",e,"Check HMS Docs to see the list of supported platforms",t)},InitFailed:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(7002,"InitFailed",e,"Plugin init failed",t)},ProcessingFailed:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(7003,"ProcessingFailed",e,"Plugin processing failed",t)},AddAlreadyInProgress:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(7004,"AddAlreadyInProgress",e,"Plugin add already in progress",t)},DeviceNotSupported:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Gn(7005,"DeviceNotSupported",e,"Check HMS Docs to see the list of supported devices",t)}},ar={NoEntryToPlay:function(e,t){return new Gn(Wn.PlaylistErrors.NO_ENTRY_TO_PLAY,"NoEntryToPlay",e,"Reached end of playlist",t)},NoEntryPlaying:function(e,t){return new Gn(Wn.PlaylistErrors.NO_ENTRY_IS_PLAYING,"NoEntryIsPlaying",e,"No entry is playing at this time",t)}};function sr(e,t){var n=e.toLowerCase();return n.includes("device not found")?er.DeviceNotAvailable(Kn.TRACK,t,e):n.includes("permission denied")?er.CantAccessCaptureDevice(Kn.TRACK,t,e):er.GenericTrack(Kn.TRACK,e)}function or(e,t){var n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if("chrome"===jt.browserDetails.browser&&"NotAllowedError"===e.name&&e.message.includes("denied by system"))return er.SystemDeniedPermission(Kn.TRACK,t,e.message);if("firefox"===jt.browserDetails.browser&&"NotFoundError"===e.name){var n=er.SystemDeniedPermission(Kn.TRACK,t,e.message);return n.description="Capture device is either blocked at Operating System level or not available - ".concat(t),n}switch(e.name){case"OverconstrainedError":return er.OverConstrained(Kn.TRACK,t,e.constraint);case"NotAllowedError":return er.CantAccessCaptureDevice(Kn.TRACK,t,e.message);case"NotFoundError":return er.DeviceNotAvailable(Kn.TRACK,t,e.message);case"NotReadableError":return er.DeviceInUse(Kn.TRACK,t,e.message);case"TypeError":return er.NothingToReturn(Kn.TRACK,e.message);default:return sr(e.message,t)}}(e,t);return n.addNativeError(e),n}!function(e){e.UNKNOWN="unknown(video or audio)",e.AUDIO="audio",e.VIDEO="video",e.AV="audio, video",e.SCREEN="screen"}(qn||(qn={})),function(e){e.RECORDING_STATE_UPDATED="RECORDING_STATE_UPDATED",e.BROWSER_RECORDING_STATE_UPDATED="BROWSER_RECORDING_STATE_UPDATED",e.SERVER_RECORDING_STATE_UPDATED="SERVER_RECORDING_STATE_UPDATED",e.RTMP_STREAMING_STATE_UPDATED="RTMP_STREAMING_STATE_UPDATED",e.HLS_STREAMING_STATE_UPDATED="HLS_STREAMING_STATE_UPDATED"}(Yn||(Yn={})),function(e){e[e.PEER_JOINED=0]="PEER_JOINED",e[e.PEER_LEFT=1]="PEER_LEFT",e[e.AUDIO_TOGGLED=2]="AUDIO_TOGGLED",e[e.VIDEO_TOGGLED=3]="VIDEO_TOGGLED",e[e.BECAME_DOMINANT_SPEAKER=4]="BECAME_DOMINANT_SPEAKER",e[e.RESIGNED_DOMINANT_SPEAKER=5]="RESIGNED_DOMINANT_SPEAKER",e[e.STARTED_SPEAKING=6]="STARTED_SPEAKING",e[e.STOPPED_SPEAKING=7]="STOPPED_SPEAKING",e[e.ROLE_UPDATED=8]="ROLE_UPDATED",e[e.PEER_LIST=9]="PEER_LIST",e[e.NAME_UPDATED=10]="NAME_UPDATED",e[e.METADATA_UPDATED=11]="METADATA_UPDATED"}(Qn||(Qn={})),function(e){e[e.TRACK_ADDED=0]="TRACK_ADDED",e[e.TRACK_REMOVED=1]="TRACK_REMOVED",e[e.TRACK_MUTED=2]="TRACK_MUTED",e[e.TRACK_UNMUTED=3]="TRACK_UNMUTED",e[e.TRACK_DESCRIPTION_CHANGED=4]="TRACK_DESCRIPTION_CHANGED",e[e.TRACK_DEGRADED=5]="TRACK_DEGRADED",e[e.TRACK_RESTORED=6]="TRACK_RESTORED"}(Jn||(Jn={})),function(e){e.NONE="none",e.LOW="low",e.MEDIUM="medium",e.HIGH="high"}($n||($n={}));var ur,cr,lr,dr,fr={f:$n.HIGH,h:$n.MEDIUM,q:$n.LOW};!function(e){e.VP8="vp8",e.VP9="vp9",e.H264="h264"}(ur||(ur={})),function(e){e.OPUS="opus"}(cr||(cr={})),function(e){e.videoInput="videoInput",e.audioInput="audioInput",e.audioOutput="audioOutput"}(lr||(lr={})),function(e){e.audio="audio",e.video="video"}(dr||(dr={}));var hr,pr=function(){function e(){y(this,e),this._volume=1,this._codec=cr.OPUS,this._maxBitrate=32,this._deviceId="default",this._advanced=[{googEchoCancellation:{exact:!0}},{googExperimentalEchoCancellation:{exact:!0}},{autoGainControl:{exact:!0}},{noiseSuppression:{exact:!0}},{googHighpassFilter:{exact:!0}},{googAudioMirroring:{exact:!0}}]}return k(e,[{key:"volume",value:function(e){if(!(0<=e&&e<=1))throw Error("volume can only be in range [0.0, 1.0]");return this._volume=e,this}},{key:"codec",value:function(e){return this._codec=e,this}},{key:"maxBitrate",value:function(e){if(e&&e<=0)throw Error("maxBitrate should be >= 1");return this._maxBitrate=e,this}},{key:"deviceId",value:function(e){return this._deviceId=e,this}},{key:"advanced",value:function(e){return this._advanced=e,this}},{key:"build",value:function(){return new vr(this._volume,this._codec,this._maxBitrate,this._deviceId,this._advanced)}}]),e}(),vr=function(){function e(t,n,r,i,a){y(this,e),this.volume=t,this.codec=n,this.maxBitrate=r,this.deviceId=i,this.advanced=a}return k(e,[{key:"toConstraints",value:function(){return{deviceId:this.deviceId,advanced:this.advanced}}},{key:"toAnalyticsProperties",value:function(){return{audio_bitrate:this.maxBitrate,audio_codec:this.codec}}}]),e}(),gr=function(){function e(){y(this,e),this._width=320,this._height=180,this._codec=ur.VP8,this._maxFramerate=30,this._maxBitrate=150,this._advanced=[]}return k(e,[{key:"setWidth",value:function(e){return this._width=e,this}},{key:"setHeight",value:function(e){return this._height=e,this}},{key:"codec",value:function(e){return this._codec=e,this}},{key:"maxFramerate",value:function(e){if(e&&e<=0)throw Error("maxFramerate should be >= 1");return this._maxFramerate=e,this}},{key:"maxBitrate",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("number"==typeof e&&e<=0)throw Error("maxBitrate should be >= 1");return this._maxBitrate=e,!this._maxBitrate&&t&&(this._maxBitrate=15e4),this}},{key:"deviceId",value:function(e){return this._deviceId=e,this}},{key:"advanced",value:function(e){return this._advanced=e,this}},{key:"build",value:function(){return new mr(this._width,this._height,this._codec,this._maxFramerate,this._deviceId,this._advanced,this._maxBitrate)}}]),e}(),mr=function(){function e(t,n,r,i,a,s,o){y(this,e),this.width=t,this.height=n,this.codec=r,this.maxFramerate=i,this.maxBitrate=o,this.deviceId=a,this.advanced=s}return k(e,[{key:"toConstraints",value:function(e){var t="ideal";return e&&(t="max"),{width:E({},t,this.width),height:E({},t,this.height),frameRate:this.maxFramerate,deviceId:this.deviceId}}},{key:"toAnalyticsProperties",value:function(){return{width:this.width,height:this.height,video_bitrate:this.maxBitrate,framerate:this.maxFramerate,video_codec:this.codec}}}]),e}(),yr=function(){function e(){y(this,e),this._video=(new gr).build(),this._audio=(new pr).build(),this._screen=(new gr).build(),this._simulcast=!1}return k(e,[{key:"video",value:function(e){return this._video=e,this}},{key:"audio",value:function(e){return this._audio=e,this}},{key:"screen",value:function(e){return this._screen=e,this}},{key:"simulcast",value:function(e){return this._simulcast=e,this}},{key:"build",value:function(){if(null===this._audio&&null===this._video)throw er.NothingToReturn(Kn.TRACK);if(null===this._video&&this._simulcast)throw er.InvalidVideoSettings(Kn.TRACK,"Cannot enable simulcast when no video settings are provided");return new br(this._video,this._audio,this._simulcast,this._screen||void 0)}}]),e}(),br=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;y(this,e),this.video=t,this.audio=n,this.simulcast=r,this.screen=i}return k(e,[{key:"toAnalyticsProperties",value:function(){var e={audio_enabled:null!==this.audio,video_enabled:null!==this.video};return this.audio&&(e=ln(ln({},this.audio.toAnalyticsProperties()),e)),this.video&&(e=ln(ln({},this.video.toAnalyticsProperties()),e)),e}}]),e}(),kr=k((function e(t){y(this,e),this.tracks=new Array,this.nativeStream=t,this.id=t.id})),Tr=function(e){return e?"{\n    trackId: ".concat(e.id,";\n    kind: ").concat(e.kind,";\n    enabled: ").concat(e.enabled,";\n    muted: ").concat(e.muted,";\n    readyState: ").concat(e.readyState,";\n  }"):""},Er=function(){function e(t,n,r){y(this,e),this.logIdentifier="",this.stream=t,this.nativeTrack=n,this.source=r}return k(e,[{key:"enabled",get:function(){return this.nativeTrack.enabled}},{key:"trackId",get:function(){return this.firstTrackId||this.sdpTrackId||this.nativeTrack.id}},{key:"getMediaTrackSettings",value:function(){return this.nativeTrack.getSettings()}},{key:"setEnabled",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.nativeTrack.enabled=e;case 1:case"end":return t.stop()}}),t,this)})))}},{key:"setSdpTrackId",value:function(e){this.sdpTrackId=e}},{key:"setFirstTrackId",value:function(e){this.firstTrackId=e}},{key:"cleanup",value:function(){var e;wn.d("[HMSTrack]","Stopping track",this.toString()),null==(e=this.nativeTrack)||e.stop()}},{key:"toString",value:function(){return"{\n      streamId: ".concat(this.stream.id,";\n      peerId: ").concat(this.peerId,";\n      trackId: ").concat(this.trackId,";\n      logIdentifier: ").concat(this.logIdentifier,";\n      source: ").concat(this.source,";\n      enabled: ").concat(this.enabled,";\n      nativeTrack: ").concat(Tr(this.nativeTrack),";\n    }")}}]),e}();!function(e){e.AUDIO="audio",e.VIDEO="video"}(hr||(hr={}));var Sr,wr,xr=function(e){Le(n,e);var t=Me(n);function n(e,r){var i;return y(this,n),(i=t.call(this,e)).audio=!0,i.video=$n.NONE,i.connection=r,i}return k(n,[{key:"setAudio",value:function(e,t,n){return hn(this,null,c().mark((function r(){return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.t0=this.audio!==e,!r.t0){r.next=6;break}return this.audio=e,wn.d("[Remote stream] ".concat(n||""," ").concat(this.id),"subscribing audio - ".concat(this.audio)),r.next=6,this.connection.sendOverApiDataChannelWithResponse({params:{subscribed:this.audio,track_id:t},method:"prefer-audio-track-state"});case 6:case"end":return r.stop()}}),r,this)})))}},{key:"setVideoLayerLocally",value:function(e,t,n){this.video=e,wn.d("[Remote stream] ".concat(t," - ").concat(this.id),"source: ".concat(n," Setting layer field to - ").concat(e))}},{key:"setVideoLayer",value:function(e,t,n,r){return this.setVideoLayerLocally(e,n,r),wn.d("[Remote stream] ".concat(n," - ").concat(this.id),"request ".concat(e," layer")),this.connection.sendOverApiDataChannelWithResponse({params:{max_spatial_layer:this.video,track_id:t},method:"prefer-video-track-state"})}},{key:"getSimulcastLayer",value:function(){return this.video}},{key:"getVideoLayer",value:function(){return this.video}},{key:"isAudioSubscribed",value:function(){return this.audio}}]),n}(kr),Rr=function(e){Le(n,e);var t=Me(n);function n(e,r,i){var a;if(y(this,n),(a=t.call(this,e,r,i)).type=hr.AUDIO,a.audioElement=null,"audio"!==r.kind)throw new Error("Expected 'track' kind = 'audio'");return a}return k(n,[{key:"getVolume",value:function(){return this.audioElement?100*this.audioElement.volume:null}},{key:"setVolume",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e<0||e>100)){t.next=2;break}throw Error("Please pass a valid number between 0-100");case 2:return t.next=4,this.subscribeToAudio(0!==e&&this.enabled);case 4:this.audioElement&&(this.audioElement.volume=e/100);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"setAudioElement",value:function(e){this.audioElement=e}},{key:"getAudioElement",value:function(){return this.audioElement}},{key:"getOutputDevice",value:function(){return this.outputDevice}},{key:"cleanup",value:function(){Ce(xe(n.prototype),"cleanup",this).call(this),this.audioElement&&(this.audioElement.srcObject=null,this.audioElement.remove(),this.audioElement=null)}},{key:"setOutputDevice",value:function(e){return hn(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.audioElement){t.next=3;break}return wn.d("audio-track","no audio element to set output"),t.abrupt("return");case 3:if(t.prev=3,t.t0="function"==typeof this.audioElement.setSinkId,!t.t0){t.next=9;break}return t.next=8,null==(n=this.audioElement)?void 0:n.setSinkId(e.deviceId);case 8:this.outputDevice=e;case 9:t.next=14;break;case 11:t.prev=11,t.t1=t.catch(3),wn.d("audio-track",t.t1);case 14:case"end":return t.stop()}}),t,this,[[3,11]])})))}},{key:"subscribeToAudio",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=this.stream instanceof xr,!t.t0){t.next=4;break}return t.next=4,this.stream.setAudio(e,this.trackId,this.logIdentifier);case 4:case"end":return t.stop()}}),t,this)})))}}]),n}(Er),Cr=function(){function e(){y(this,e),this.storage=new vn("hms-device-selection"),this.remember=!1,this.TAG="[HMSDeviceStorage]"}return k(e,[{key:"setDevices",value:function(e){this.devices=e}},{key:"rememberDevices",value:function(e){this.remember=e}},{key:"updateSelection",value:function(e,t){var n=this,r=t.deviceId,i=t.groupId;if(this.devices&&this.remember){var a=this.devices[e].find((function(e){return n.isSame({deviceId:r,groupId:i},e)}));if(a){var s=this.storage.get()||{};s[e]=a,this.storage.set(s)}else wn.w(this.TAG,"Could not find device with deviceId: ".concat(r,", groupId: ").concat(i))}}},{key:"getSelection",value:function(){if(this.remember)return this.storage.get()}},{key:"cleanup",value:function(){this.remember=!1,this.devices=void 0}},{key:"isSame",value:function(e,t){return e.deviceId===t.deviceId&&(e.groupId===t.groupId||!e.groupId)}}]),e}(),Ar=new Cr;!function(e){e.TRANSFORM="TRANSFORM",e.ANALYZE="ANALYZE"}(Sr||(Sr={})),function(e){e.PLATFORM_NOT_SUPPORTED="PLATFORM_NOT_SUPPORTED",e.DEVICE_NOT_SUPPORTED="DEVICE_NOT_SUPPORTED"}(wr||(wr={}));var Ir=function(){function e(){y(this,e)}return k(e,null,[{key:"failure",value:function(e,t){var n=Fn.ERROR,r=ln({plugin_name:e},t.toAnalyticsProperties());return new Bn({name:"mediaPlugin.failed",level:n,properties:r})}},{key:"audioPluginFailure",value:function(e,t,n){var r=Fn.ERROR,i=ln({plugin_name:e,sampleRate:t},n.toAnalyticsProperties());return new Bn({name:"mediaPlugin.failed",level:r,properties:i})}},{key:"audioPluginStats",value:function(e){var t=e.pluginName,n=e.duration,r=e.loadTime,i=e.sampleRate,a=Fn.INFO;return new Bn({name:"mediaPlugin.stats",level:a,properties:{plugin_name:t,duration:n,load_time:r,sampleRate:i}})}},{key:"stats",value:function(e){var t=e.pluginName,n=e.duration,r=e.loadTime,i=e.avgPreProcessingTime,a=e.avgProcessingTime,s=e.inputFrameRate,o=e.pluginFrameRate,u=Fn.INFO;return new Bn({name:"mediaPlugin.stats",level:u,properties:{plugin_name:t,duration:n,load_time:r,avg_preprocessing_time:i,avg_processing_time:a,input_frame_rate:s,plugin_frame_rate:o}})}}]),e}(),Pr=function(){function e(t){y(this,e),this.eventBus=t,this.TAG="[AudioPluginsAnalytics]",this.initTime={},this.addedTimestamps={},this.pluginAdded={},this.pluginSampleRate={}}return k(e,[{key:"added",value:function(e,t){this.pluginAdded[e]=!0,this.addedTimestamps[e]=Date.now(),this.initTime[e]=0,this.pluginSampleRate[e]=t}},{key:"removed",value:function(e){if(this.pluginAdded[e]){var t={pluginName:e,duration:Math.floor((Date.now()-this.addedTimestamps[e])/1e3),loadTime:this.initTime[e],sampleRate:this.pluginSampleRate[e]};this.eventBus.analytics.publish(Ir.audioPluginStats(t)),this.clean(e)}}},{key:"failure",value:function(e,t){this.pluginAdded[e]&&(this.eventBus.analytics.publish(Ir.audioPluginFailure(e,this.pluginSampleRate[e],t)),this.clean(e))}},{key:"initWithTime",value:function(e,t){return hn(this,null,c().mark((function n(){var r,i;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.initTime[e]){n.next=3;break}return wn.i(this.TAG,"Plugin Already loaded ".concat(e,", time it took: ").concat(this.initTime[e])),n.abrupt("return");case 3:return n.prev=3,n.next=6,this.timeInMs(t);case 6:r=n.sent,wn.i(this.TAG,"Time taken for Plugin ".concat(e," initialization : ").concat(r)),n.next=14;break;case 10:throw n.prev=10,n.t0=n.catch(3),i=ir.InitFailed(Kn.AUDIO_PLUGINS,"failed during initialization of plugin".concat(n.t0.message||n.t0)),wn.e(this.TAG,i),this.failure(e,i),i;case 14:r&&(this.initTime[e]=r);case 15:case"end":return n.stop()}}),n,this,[[3,10]])})))}},{key:"timeInMs",value:function(e){return hn(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Date.now(),t.next=3,e();case 3:return t.abrupt("return",Math.floor(Date.now()-n));case 4:case"end":return t.stop()}}),t)})))}},{key:"clean",value:function(e){delete this.addedTimestamps[e],delete this.initTime[e],delete this.pluginAdded[e],delete this.pluginSampleRate[e]}}]),e}(),_r=function(){function e(t,n){y(this,e),this.TAG="[AudioPluginsManager]",this.pluginAddInProgress=!1,this.hmsTrack=t,this.pluginsMap=new Map,this.analytics=new Pr(n),this.createAudioContext()}return k(e,[{key:"getPlugins",value:function(){return Array.from(this.pluginsMap.keys())}},{key:"addPlugin",value:function(e){return hn(this,null,c().mark((function t(){var n,r,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=null==(n=e.getName)?void 0:n.call(e)){t.next=4;break}return wn.w("no name provided by the plugin"),t.abrupt("return");case 4:if(!this.pluginAddInProgress){t.next=7;break}throw i=ir.AddAlreadyInProgress(Kn.AUDIO_PLUGINS,"Add Plugin is already in Progress"),this.analytics.added(r,this.audioContext.sampleRate),this.analytics.failure(r,i),wn.w("can't add another plugin when previous add is in progress"),i;case 7:return this.pluginAddInProgress=!0,t.prev=8,t.next=11,this.addPluginInternal(e);case 11:return t.prev=11,this.pluginAddInProgress=!1,t.finish(11);case 14:case"end":return t.stop()}}),t,this,[[8,,11,14]])})))}},{key:"addPluginInternal",value:function(e){return hn(this,null,c().mark((function t(){var n,r,i=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=null==(n=e.getName)?void 0:n.call(e),!this.pluginsMap.get(r)){t.next=4;break}return wn.w(this.TAG,"plugin - ".concat(r," already added.")),t.abrupt("return");case 4:return t.next=6,this.validateAndThrow(r,e);case 6:if(t.prev=6,0!==this.pluginsMap.size){t.next=12;break}return t.next=10,this.initAudioNodes();case 10:t.next=13;break;case 12:this.prevAudioNode&&this.prevAudioNode.disconnect();case 13:return this.analytics.added(r,this.audioContext.sampleRate),t.next=16,this.analytics.initWithTime(r,(function(){return hn(i,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.init());case 1:case"end":return t.stop()}}),t)})))}));case 16:return this.pluginsMap.set(r,e),t.next=19,this.processPlugin(e);case 19:return t.next=21,this.connectToDestination();case 21:t.next=26;break;case 23:throw t.prev=23,t.t0=t.catch(6),wn.e(this.TAG,"failed to add plugin",t.t0),t.t0;case 26:case"end":return t.stop()}}),t,this,[[6,23]])})))}},{key:"validatePlugin",value:function(e){return e.checkSupport(this.audioContext)}},{key:"validateAndThrow",value:function(e,t){return hn(this,null,c().mark((function n(){var r,i,a;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=this.validatePlugin(t)).isSupported){n.next=5;break}wn.i(this.TAG,"plugin is supported,- ".concat(t.getName())),n.next=19;break;case 5:if(this.analytics.added(e,this.audioContext.sampleRate),r.errType!==wr.PLATFORM_NOT_SUPPORTED){n.next=13;break}return i=ir.PlatformNotSupported(Kn.AUDIO_PLUGINS,"platform not supported, see docs"),this.analytics.failure(e,i),n.next=10,this.cleanup();case 10:throw i;case 13:if(r.errType!==wr.DEVICE_NOT_SUPPORTED){n.next=19;break}return a=ir.DeviceNotSupported(Kn.AUDIO_PLUGINS,"audio device not supported, see docs"),this.analytics.failure(e,a),n.next=18,this.cleanup();case 18:throw a;case 19:case"end":return n.stop()}}),n,this)})))}},{key:"removePlugin",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.removePluginInternal(e);case 2:if(0!==this.pluginsMap.size){t.next=10;break}return t.next=5,this.cleanup();case 5:return wn.i(this.TAG,"No plugins left, stopping plugins loop"),t.next=8,this.hmsTrack.setProcessedTrack(void 0);case 8:t.next=12;break;case 10:return t.next=12,this.reprocessPlugins();case 12:case"end":return t.stop()}}),t,this)})))}},{key:"cleanup",value:function(){return hn(this,null,c().mark((function e(){var t,n,r,i,a,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=S(this.pluginsMap.values()),e.prev=1,i.s();case 3:if((a=i.n()).done){e.next=9;break}return s=a.value,e.next=7,this.removePluginInternal(s);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),i.e(e.t0);case 14:return e.prev=14,i.f(),e.finish(14);case 17:return e.next=19,this.hmsTrack.setProcessedTrack(void 0);case 19:null==(t=this.sourceNode)||t.disconnect(),null==(n=this.prevAudioNode)||n.disconnect(),null==(r=this.outputTrack)||r.stop(),this.sourceNode=void 0,this.destinationNode=void 0,this.prevAudioNode=void 0,this.outputTrack=void 0;case 26:case"end":return e.stop()}}),e,this,[[1,11,14,17]])})))}},{key:"closeContext",value:function(){return hn(this,null,c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==(t=this.audioContext)||t.close(),this.audioContext=void 0;case 1:case"end":return e.stop()}}),e,this)})))}},{key:"reprocessPlugins",value:function(){return hn(this,null,c().mark((function e(){var t,n,r,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.pluginsMap.size&&this.sourceNode){e.next=2;break}return e.abrupt("return");case 2:return t=Array.from(this.pluginsMap.values()),e.next=5,this.cleanup();case 5:return e.next=7,this.initAudioNodes();case 7:n=0,r=t;case 8:if(!(n<r.length)){e.next=15;break}return i=r[n],e.next=12,this.addPlugin(i);case 12:n++,e.next=8;break;case 15:case"end":return e.stop()}}),e,this)})))}},{key:"initAudioNodes",value:function(){return hn(this,null,c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.audioContext){e.next=12;break}if(this.sourceNode||(t=new MediaStream([this.hmsTrack.nativeTrack]),this.sourceNode=this.audioContext.createMediaStreamSource(t)),this.destinationNode){e.next=12;break}return this.destinationNode=this.audioContext.createMediaStreamDestination(),this.outputTrack=this.destinationNode.stream.getAudioTracks()[0],e.prev=4,e.next=7,this.hmsTrack.setProcessedTrack(this.outputTrack);case 7:e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(4),wn.e(this.TAG,"error in setting processed track",e.t0),e.t0;case 12:case"end":return e.stop()}}),e,this,[[4,9]])})))}},{key:"processPlugin",value:function(e){return hn(this,null,c().mark((function t(){var n,r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.processAudioTrack(this.audioContext,this.prevAudioNode||this.sourceNode);case 3:n=t.sent,this.prevAudioNode&&this.prevAudioNode.connect(n),this.prevAudioNode=n,t.next=13;break;case 7:return t.prev=7,t.t0=t.catch(0),r=e.getName(),wn.e(this.TAG,"error in processing plugin ".concat(r),t.t0),t.next=13,this.removePluginInternal(e);case 13:case"end":return t.stop()}}),t,this,[[0,7]])})))}},{key:"connectToDestination",value:function(){return hn(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{this.prevAudioNode&&this.destinationNode&&this.prevAudioNode.context===this.destinationNode.context&&this.prevAudioNode.connect(this.destinationNode)}catch(t){wn.e(this.TAG,"error in connecting to destination node",t)}case 1:case"end":return e.stop()}}),e,this)})))}},{key:"removePluginInternal",value:function(e){return hn(this,null,c().mark((function t(){var n,r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=null==(n=e.getName)?void 0:n.call(e),this.pluginsMap.get(r)){t.next=4;break}return wn.w(this.TAG,"plugin - ".concat(r," not found to remove.")),t.abrupt("return");case 4:wn.i(this.TAG,"removing plugin ".concat(r)),this.pluginsMap.delete(r),e.stop(),this.analytics.removed(r);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"createAudioContext",value:function(){this.audioContext||(-1!==navigator.userAgent.indexOf("Firefox")?this.audioContext=new AudioContext:this.audioContext=new AudioContext({sampleRate:48e3}))}}]),e}();function Dr(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.mediaDevices.getUserMedia({audio:!!e&&e.toConstraints()});case 3:return t.abrupt("return",t.sent.getAudioTracks()[0]);case 6:throw t.prev=6,t.t0=t.catch(0),or(t.t0,qn.AUDIO);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})))}function Lr(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.mediaDevices.getUserMedia({video:!!e&&e.toConstraints()});case 3:return t.abrupt("return",t.sent.getVideoTracks()[0]);case 6:throw t.prev=6,t.t0=t.catch(0),or(t.t0,qn.VIDEO);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})))}function Or(e){return"canvas"in e||"MediaStreamAudioDestinationNode"===e.label||""===e.label}var Mr={audioContext:null,getAudioContext:function(){return this.audioContext||(this.audioContext=new AudioContext),this.audioContext},resumeContext:function(){return hn(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getAudioContext().resume();case 3:return e.abrupt("return",e.sent);case 6:e.prev=6,e.t0=e.catch(0),wn.e("AudioContext",e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,6]])})))}},Nr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0;y(this,e),this.capacity=t,this.storage=[]}return k(e,[{key:"size",value:function(){return this.storage.length}},{key:"toList",value:function(){return this.storage.slice(0)}},{key:"enqueue",value:function(e){this.size()===this.capacity&&this.dequeue(),this.storage.push(e)}},{key:"dequeue",value:function(){return this.storage.shift()}},{key:"aggregate",value:function(e){return e(this.storage)}}]),e}();function Fr(e){if(e<0)throw Error("`ms` should be a positive integer");return new Promise((function(t){return setTimeout(t,e)}))}var Ur=function(){function e(t,n,r){var i=this;y(this,e),this.track=t,this.audioLevelEvent=n,this.silenceEvent=r,this.TAG="[TrackAudioLevelMonitor]",this.audioLevel=0,this.isMonitored=!1,this.interval=100,this.historyInterval=700,this.history=new Nr(this.historyInterval/this.interval),this.detectSilence=function(){return hn(i,null,c().mark((function e(){var t,n,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=20,n=50,r=0;case 1:if(!this.isMonitored){e.next=14;break}if(!this.track.enabled){e.next=10;break}if(!this.isSilentThisInstant()){e.next=9;break}if(!(++r>n)){e.next=7;break}return this.silenceEvent.publish({track:this.track}),e.abrupt("break",14);case 7:e.next=10;break;case 9:return e.abrupt("break",14);case 10:return e.next=12,Fr(t);case 12:e.next=1;break;case 14:case"end":return e.stop()}}),e,this)})))};try{var a=new MediaStream([this.track.nativeTrack]);this.analyserNode=this.createAnalyserNodeForStream(a)}catch(a){wn.w(this.TAG,"Unable to initialize AudioContext",a)}}return k(e,[{key:"start",value:function(){var e=this;this.stop(),this.isMonitored=!0,wn.d(this.TAG,"Starting track Monitor","".concat(this.track)),this.loop().then((function(){return wn.d(e.TAG,"Stopping track Monitor","".concat(e.track))}))}},{key:"stop",value:function(){this.analyserNode?(this.sendAudioLevel(0),this.isMonitored=!1):wn.d(this.TAG,"AudioContext not initialized")}},{key:"loop",value:function(){return hn(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isMonitored){e.next=6;break}return this.sendAudioLevel(this.getMaxAudioLevelOverPeriod()),e.next=4,Fr(this.interval);case 4:e.next=0;break;case 6:case"end":return e.stop()}}),e,this)})))}},{key:"sendAudioLevel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e=e>35?e:0,Math.abs(this.audioLevel-e)>5){this.audioLevel=e;var t={track:this.track,audioLevel:this.audioLevel};this.audioLevelEvent.publish(t)}}},{key:"getMaxAudioLevelOverPeriod",value:function(){if(this.analyserNode){var e=this.calculateAudioLevel();return void 0!==e&&this.history.enqueue(e),this.history.aggregate((function(e){return Math.max.apply(Math,T(e))}))}wn.d(this.TAG,"AudioContext not initialized")}},{key:"calculateAudioLevel",value:function(){if(this.analyserNode){var e=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(e);var t,n=.009,r=n,i=S(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;r=Math.max(r,(a-128)/128)}}catch(o){i.e(o)}finally{i.f()}var s=(Math.log(n)-Math.log(r))/Math.log(n);return Math.ceil(Math.min(Math.max(100*s,0),100))}wn.d(this.TAG,"AudioContext not initialized")}},{key:"isSilentThisInstant",value:function(){if(this.analyserNode){var e=new Uint8Array(this.analyserNode.fftSize);return this.analyserNode.getByteTimeDomainData(e),!e.some((function(e){return 128!==e&&0!==e}))}wn.d(this.TAG,"AudioContext not initialized")}},{key:"createAnalyserNodeForStream",value:function(e){var t=Mr.getAudioContext(),n=t.createAnalyser();return t.createMediaStreamSource(e).connect(n),n}}]),e}();function Br(e,t){return function(n){return n in e&&e[n]!==t[n]}}var jr,Gr,Vr=function(e){Le(n,e);var t=Me(n);function n(e,r,i,a){var s,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(new pr).build();return y(this,n),(s=t.call(this,e,r,i)).eventBus=a,s.TAG="[HMSLocalAudioTrack]",s.handleVisibilityChange=function(){return hn(Ae(s),null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0="visible"===document.visibilityState,!e.t0){e.next=4;break}return e.next=4,this.replaceTrackWith(this.settings);case 4:case"end":return e.stop()}}),e,this)})))},s.handleSettingsChange=function(e){return hn(Ae(s),null,c().mark((function t(){var n,r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.stream,r=Br(e,this.settings),t.t0=r("maxBitrate")&&e.maxBitrate,!t.t0){t.next=5;break}return t.next=5,n.setMaxBitrateAndFramerate(this);case 5:if(t.t1=r("advanced"),!t.t1){t.next=9;break}return t.next=9,this.replaceTrackWith(e);case 9:case"end":return t.stop()}}),t,this)})))},s.handleDeviceChange=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return hn(Ae(s),null,c().mark((function n(){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.t0=Br(e,this.settings)("deviceId"),!n.t0){n.next=5;break}return n.next=4,this.replaceTrackWith(e);case 4:t||Ar.updateSelection("audioInput",{deviceId:e.deviceId,groupId:this.nativeTrack.getSettings().groupId});case 5:case"end":return n.stop()}}),n,this)})))},e.tracks.push(Ae(s)),s.settings=o,o.deviceId!==r.getSettings().deviceId&&!Or(r)&&(s.settings=s.buildNewSettings({deviceId:r.getSettings().deviceId})),s.pluginsManager=new _r(Ae(s),a),s.setFirstTrackId(r.id),kn()&&yn&&document.addEventListener("visibilitychange",s.handleVisibilityChange),s}return k(n,[{key:"replaceTrackWith",value:function(e){return hn(this,null,c().mark((function t(){var n,r,i,a,s;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.nativeTrack,r=this.enabled,i=Boolean(this.audioLevelMonitor),t.next=5,Dr(e);case 5:return a=t.sent,null==n||n.stop(),wn.d(this.TAG,"replaceTrack, Previous track stopped",n,"newTrack",a),a.enabled=r,s=this.stream,t.next=10,s.replaceSenderTrack(n,this.processedTrack||a);case 10:return t.next=12,s.replaceStreamTrack(n,a);case 12:return this.nativeTrack=a,i&&this.initAudioLevelMonitor(),t.prev=14,t.next=17,this.pluginsManager.reprocessPlugins();case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(14),this.eventBus.audioPluginFailed.publish(t.t0);case 22:case"end":return t.stop()}}),t,this,[[14,19]])})))}},{key:"setEnabled",value:function(e){var t=this,r=function(e){return Ce(xe(n.prototype),e,t)};return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=e!==this.enabled,!t.t0){t.next=11;break}if(t.t1=e&&Or(this.nativeTrack),!t.t1){t.next=6;break}return t.next=6,this.replaceTrackWith(this.settings);case 6:return t.next=8,r("setEnabled").call(this,e);case 8:e&&(this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId})),this.eventBus.localAudioEnabled.publish({enabled:e,track:this}),this.stream.trackUpdate(this);case 11:case"end":return t.stop()}}),t,this)})))}},{key:"isPublishedTrackId",value:function(e){return this.publishedTrackId===e}},{key:"setSettings",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return hn(this,null,c().mark((function n(){var r;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=this.buildNewSettings(e),n.next=3,this.handleDeviceChange(r,t);case 3:if(!Or(this.nativeTrack)){n.next=6;break}return this.settings=r,n.abrupt("return");case 6:return n.next=8,this.handleSettingsChange(r);case 8:this.settings=r;case 9:case"end":return n.stop()}}),n,this)})))}},{key:"getPlugins",value:function(){return this.pluginsManager.getPlugins()}},{key:"addPlugin",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.pluginsManager.addPlugin(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"removePlugin",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.pluginsManager.removePlugin(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"validatePlugin",value:function(e){return this.pluginsManager.validatePlugin(e)}},{key:"setProcessedTrack",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=7;break}if(t.t0=this.processedTrack,!t.t0){t.next=5;break}return t.next=5,this.stream.replaceSenderTrack(this.processedTrack,this.nativeTrack);case 5:return this.processedTrack=void 0,t.abrupt("return");case 7:if(t.t1=e!==this.processedTrack,!t.t1){t.next=17;break}if(!this.processedTrack){t.next=14;break}return t.next=12,this.stream.replaceSenderTrack(this.processedTrack,e);case 12:t.next=16;break;case 14:return t.next=16,this.stream.replaceSenderTrack(this.nativeTrack,e);case 16:this.processedTrack=e;case 17:case"end":return t.stop()}}),t,this)})))}},{key:"initAudioLevelMonitor",value:function(){this.audioLevelMonitor&&this.destroyAudioLevelMonitor(),wn.d(this.TAG,"Monitor Audio Level for",this,this.getMediaTrackSettings().deviceId),this.audioLevelMonitor=new Ur(this,this.eventBus.trackAudioLevelUpdate,this.eventBus.localAudioSilence),this.audioLevelMonitor.start(),this.audioLevelMonitor.detectSilence()}},{key:"destroyAudioLevelMonitor",value:function(){var e;null==(e=this.audioLevelMonitor)||e.stop(),this.audioLevelMonitor=void 0}},{key:"cleanup",value:function(){var e=this,t=function(t){return Ce(xe(n.prototype),t,e)};return hn(this,null,c().mark((function e(){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t("cleanup").call(this),e.next=3,this.pluginsManager.cleanup();case 3:return e.next=5,this.pluginsManager.closeContext();case 5:null==(n=this.processedTrack)||n.stop(),this.destroyAudioLevelMonitor(),kn()&&yn&&document.removeEventListener("visibilitychange",this.handleVisibilityChange);case 8:case"end":return e.stop()}}),e,this)})))}},{key:"getTrackIDBeingSent",value:function(){return this.processedTrack?this.processedTrack.id:this.nativeTrack.id}},{key:"getTrackBeingSent",value:function(){return this.processedTrack||this.nativeTrack}},{key:"buildNewSettings",value:function(e){var t=ln(ln({},this.settings),e),n=t.volume,r=t.codec,i=t.maxBitrate,a=t.deviceId,s=t.advanced;return new vr(n,r,i,a,s)}}]),n}(Rr),Kr=function(e){Le(n,e);var t=Me(n);function n(){return y(this,n),t.apply(this,arguments)}return k(n,[{key:"setEnabled",value:function(e){var t=this,r=function(e){return Ce(xe(n.prototype),e,t)};return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=e!==this.enabled,!t.t0){t.next=6;break}return t.next=4,r("setEnabled").call(this,e);case 4:return t.next=6,this.subscribeToAudio(e);case 6:case"end":return t.stop()}}),t,this)})))}}]),n}(Rr),Hr=function(e){Le(n,e);var t=Me(n);function n(e,r,i){var a;if(y(this,n),(a=t.call(this,e,r,i)).type=hr.VIDEO,a.sinkCount=0,"video"!==r.kind)throw new Error("Expected 'track' kind = 'video'");return a}return k(n,[{key:"hasSinks",value:function(){return this.sinkCount>0}},{key:"addSink",value:function(e){this.addSinkInternal(e,this.nativeTrack)}},{key:"removeSink",value:function(e){null!==e.srcObject&&(e.srcObject=null,this.sinkCount>0&&this.sinkCount--)}},{key:"addSinkInternal",value:function(e,t){var n,r=e.srcObject;null!==r&&r instanceof MediaStream&&(null==(n=r.getVideoTracks()[0])?void 0:n.id)===t.id||(e.srcObject=new MediaStream([t]),this.sinkCount++)}}]),n}(Er);!function(e){e.TRANSFORM="TRANSFORM",e.ANALYZE="ANALYZE"}(jr||(jr={})),function(e){e["2D"]="2d",e.WEBGL="webgl",e.WEBGL2="webgl2"}(Gr||(Gr={}));var zr=function(){function e(){y(this,e),this.total=0,this.count=0}return k(e,[{key:"add",value:function(e){this.count++,this.total+=e}},{key:"getAvg",value:function(){return Math.floor(this.total/this.count)}},{key:"reset",value:function(){this.total=0,this.count=0}}]),e}(),Wr=function(){function e(t){y(this,e),this.eventBus=t,this.TAG="[VideoPluginsAnalytics]",this.initTime={},this.preProcessingAvgs=new zr,this.addedTimestamps={},this.processingAvgs={},this.pluginAdded={},this.pluginInputFrameRate={},this.pluginFrameRate={}}return k(e,[{key:"added",value:function(e,t,n){this.pluginAdded[e]=!0,this.addedTimestamps[e]=Date.now(),this.initTime[e]=0,this.processingAvgs[e]=new zr,this.pluginInputFrameRate[e]=t,this.pluginFrameRate[e]=n||t}},{key:"removed",value:function(e){var t;if(this.pluginAdded[e]){var n={pluginName:e,duration:Math.floor((Date.now()-this.addedTimestamps[e])/1e3),loadTime:this.initTime[e],avgPreProcessingTime:this.preProcessingAvgs.getAvg(),avgProcessingTime:null==(t=this.processingAvgs[e])?void 0:t.getAvg(),inputFrameRate:this.pluginInputFrameRate[e],pluginFrameRate:this.pluginFrameRate[e]};this.eventBus.analytics.publish(Ir.stats(n)),this.clean(e)}}},{key:"failure",value:function(e,t){this.pluginAdded[e]&&(this.eventBus.analytics.publish(Ir.failure(e,t)),this.clean(e))}},{key:"initWithTime",value:function(e,t){return hn(this,null,c().mark((function n(){var r,i;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.initTime[e]){n.next=3;break}return wn.i(this.TAG,"Plugin Already loaded ".concat(e,", time it took: ").concat(this.initTime[e])),n.abrupt("return");case 3:return n.prev=3,n.next=6,this.timeInMs(t);case 6:r=n.sent,wn.i(this.TAG,"Time taken for Plugin ".concat(e," initialization : ").concat(r)),n.next=14;break;case 10:throw n.prev=10,n.t0=n.catch(3),i=ir.InitFailed(Kn.VIDEO_PLUGINS,"failed during initialization of plugin".concat(n.t0.message||n.t0)),wn.e(this.TAG,i),this.failure(e,i),i;case 14:r&&(this.initTime[e]=r);case 15:case"end":return n.stop()}}),n,this,[[3,10]])})))}},{key:"preProcessWithTime",value:function(e){return hn(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.timeInMs(e);case 2:n=t.sent,this.preProcessingAvgs.add(n);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"processWithTime",value:function(e,t){return hn(this,null,c().mark((function n(){var r,i,a;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this.timeInMs(t);case 3:i=n.sent,n.next=10;break;case 6:throw n.prev=6,n.t0=n.catch(0),a=ir.ProcessingFailed(Kn.VIDEO_PLUGINS,"Failed during processing of plugin".concat(n.t0.message||n.t0)),wn.e(this.TAG,a),this.failure(e,a),a;case 10:i&&(null==(r=this.processingAvgs[e])||r.add(i));case 11:case"end":return n.stop()}}),n,this,[[0,6]])})))}},{key:"timeInMs",value:function(e){return hn(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Date.now(),t.next=3,e();case 3:return t.abrupt("return",Math.floor(Date.now()-n));case 4:case"end":return t.stop()}}),t)})))}},{key:"clean",value:function(e){delete this.addedTimestamps[e],delete this.initTime[e],delete this.processingAvgs[e],delete this.pluginAdded[e],delete this.pluginInputFrameRate[e],delete this.pluginFrameRate[e]}}]),e}(),qr=function(){function e(t,n){y(this,e),this.TAG="[VideoPluginsManager]",this.pluginsLoopRunning=!1,this.pluginsLoopState="paused",this.pluginAddInProgress=!1,this.hmsTrack=t,this.pluginsMap=new Map,this.pluginNumFramesToSkip={},this.pluginNumFramesSkipped={},this.analytics=new Wr(n),this.canvases=new Array}return k(e,[{key:"getPlugins",value:function(){return Array.from(this.pluginsMap.keys())}},{key:"addPlugin",value:function(e,t){return hn(this,null,c().mark((function n(){var r,i,a;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.pluginAddInProgress){n.next=7;break}if((i=null==(r=e.getName)?void 0:r.call(e))&&""!==i){n.next=5;break}return wn.w("no name provided by the plugin"),n.abrupt("return");case 5:throw a=ir.AddAlreadyInProgress(Kn.VIDEO_PLUGINS,"Add Plugin is already in Progress"),this.analytics.failure(i,a),wn.w("can't add another plugin when previous add is in progress"),a;case 7:return this.pluginAddInProgress=!0,n.prev=8,n.next=11,this.addPluginInternal(e,t);case 11:return n.prev=11,this.pluginAddInProgress=!1,n.finish(11);case 14:case"end":return n.stop()}}),n,this,[[8,,11,14]])})))}},{key:"addPluginInternal",value:function(e,t){return hn(this,null,c().mark((function n(){var r,i,a,s,o,u,l=this;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((a=null==(r=e.getName)?void 0:r.call(e))&&""!==a){n.next=4;break}return wn.w("no name provided by the plugin"),n.abrupt("return");case 4:if(!this.pluginsMap.has(a)){n.next=7;break}return wn.w(this.TAG,"plugin - ".concat(e.getName()," already added.")),n.abrupt("return");case 7:return s=this.hmsTrack.getMediaTrackSettings().frameRate||24,o=0,t&&t>0?(wn.i(this.TAG,"adding plugin ".concat(e.getName()," with framerate ").concat(t)),t<s&&(o=Math.ceil(s/t)-1),this.analytics.added(a,s,t)):(wn.i(this.TAG,"adding plugin ".concat(e.getName())),this.analytics.added(a,s)),wn.i(this.TAG,"numFrames to skip processing",o),this.pluginNumFramesToSkip[a]=o,this.pluginNumFramesSkipped[a]=o,this.validateAndThrow(a,e),n.prev=9,n.next=12,this.analytics.initWithTime(a,(function(){return hn(l,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.init();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))}));case 12:if(this.pluginsMap.set(a,e),!(this.pluginsMap.size+1>this.canvases.length)){n.next=15;break}for(u=this.canvases.length;u<=this.pluginsMap.size;u++)this.canvases[u]=document.createElement("canvas");case 15:return n.next=17,this.startPluginsLoop(null==(i=e.getContextType)?void 0:i.call(e));case 17:n.next=25;break;case 19:return n.prev=19,n.t0=n.catch(9),wn.e(this.TAG,"failed to add plugin",n.t0),n.next=24,this.removePlugin(e);case 24:throw n.t0;case 25:case"end":return n.stop()}}),n,this,[[9,19]])})))}},{key:"validatePlugin",value:function(e){return e.checkSupport()}},{key:"validateAndThrow",value:function(e,t){var n,r=this.validatePlugin(t);if(r.isSupported)wn.i(this.TAG,"plugin is supported,- ".concat(t.getName()));else switch(r.errType){case wr.PLATFORM_NOT_SUPPORTED:throw n=ir.PlatformNotSupported(Kn.VIDEO_PLUGINS,"platform not supported, see docs"),this.analytics.failure(e,n),n;case wr.DEVICE_NOT_SUPPORTED:throw n=ir.DeviceNotSupported(Kn.VIDEO_PLUGINS,"video device not supported, see docs"),this.analytics.failure(e,n),n}}},{key:"removePlugin",value:function(e){return hn(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.getName(),this.pluginsMap.get(n)){t.next=4;break}return wn.w(this.TAG,"plugin - ".concat(n," not found to remove.")),t.abrupt("return");case 4:if(wn.i(this.TAG,"removing plugin ".concat(n)),this.removePluginEntry(n),t.t0=0===this.pluginsMap.size,!t.t0){t.next=11;break}return wn.i(this.TAG,"No plugins left, stopping plugins loop"),t.next=11,this.stopPluginsLoop();case 11:e.stop(),this.analytics.removed(n);case 13:case"end":return t.stop()}}),t,this)})))}},{key:"removePluginEntry",value:function(e){this.pluginsMap.delete(e),this.pluginNumFramesToSkip[e]&&delete this.pluginNumFramesToSkip[e],this.pluginNumFramesSkipped[e]&&delete this.pluginNumFramesSkipped[e]}},{key:"waitForRestart",value:function(){return hn(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pluginsLoopRunning||"running"===this.pluginsLoopState){e.next=6;break}case 1:if("paused"!==this.pluginsLoopState){e.next=6;break}return e.next=4,Fr(100);case 4:e.next=1;break;case 6:case"end":return e.stop()}}),e,this)})))}},{key:"cleanup",value:function(){return hn(this,null,c().mark((function e(){var t,n,r,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=S(this.pluginsMap.values()),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return i=r.value,e.next=7,this.removePlugin(i);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:null==(t=this.outputTrack)||t.stop();case 18:case"end":return e.stop()}}),e,this,[[1,11,14,17]])})))}},{key:"initElementsAndStream",value:function(e){this.inputCanvas||(this.inputCanvas=document.createElement("canvas")),this.outputCanvas=document.createElement("canvas"),this.inputVideo||(this.inputVideo=document.createElement("video")),this.inputCanvas.getContext("2d"),this.outputCanvas.getContext(e||Gr["2D"]);var t=this.outputCanvas.captureStream();this.outputTrack=t.getVideoTracks()[0]}},{key:"startPluginsLoop",value:function(e){return hn(this,null,c().mark((function t(){var n=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.pluginsLoopRunning){t.next=11;break}return this.initElementsAndStream(e),this.pluginsLoopRunning=!0,t.prev=2,t.next=5,this.hmsTrack.setProcessedTrack(this.outputTrack);case 5:t.next=10;break;case 7:throw t.prev=7,t.t0=t.catch(2),this.pluginsLoopRunning=!1,wn.e(this.TAG,"error in setting processed track",t.t0),t.t0;case 10:this.pluginsLoop().then((function(){wn.d(n.TAG,"processLoop stopped")}));case 11:case"end":return t.stop()}}),t,this,[[2,7]])})))}},{key:"stopPluginsLoop",value:function(){return hn(this,null,c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.pluginsLoopRunning=!1,e.next=3,this.hmsTrack.setProcessedTrack(void 0);case 3:this.resetCanvases(),null==(t=this.outputTrack)||t.stop(),this.inputVideo&&(this.inputVideo.srcObject=null,this.inputVideo=void 0);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"pluginsLoop",value:function(){return hn(this,null,c().mark((function e(){var t,n,r,i,a=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pluginsLoopRunning){e.next=27;break}if(t=this.hmsTrack.getMediaTrackSettings().frameRate||24,n=Math.floor(1e3/t),this.hmsTrack.enabled&&"ended"!==this.hmsTrack.nativeTrack.readyState){e.next=8;break}return"running"===this.pluginsLoopState&&this.resetCanvases(),this.pluginsLoopState="paused",e.next=7,Fr(n);case 7:return e.abrupt("continue",25);case 8:return r=0,e.prev=9,e.next=12,this.analytics.preProcessWithTime((function(){return hn(a,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.doPreProcessing();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))}));case 12:return i=Date.now(),e.next=15,this.processFramesThroughPlugins();case 15:(r=Math.floor(Date.now()-i))>n&&(r=n),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(9),wn.e(this.TAG,"error in plugins loop",e.t0);case 22:return this.pluginsLoopState="running",e.next=25,Fr(n-r);case 25:e.next=0;break;case 27:case"end":return e.stop()}}),e,this,[[9,19]])})))}},{key:"doPreProcessing",value:function(){return hn(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.addTrackToVideo();case 2:return e.next=4,this.updateInputCanvas();case 4:case"end":return e.stop()}}),e,this)})))}},{key:"processFramesThroughPlugins",value:function(){return hn(this,null,c().mark((function e(){var t,n,r,i,a=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.canvases[0]=this.inputCanvas,t=0,n=S(this.pluginsMap.values()),e.prev=3,i=c().mark((function e(){var n,i,s,o,u,l;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.value,i=n.getName(),!n){e.next=39;break}if(e.prev=3,s=a.checkIfSkipRequired(i),n.getPluginType()!==jr.TRANSFORM){e.next=27;break}if(o=function(e,t){return hn(a,null,c().mark((function r(){return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,n.processVideoFrame(e,t,s);case 3:r.next=8;break;case 5:r.prev=5,r.t0=r.catch(0),wn.e(this.TAG,"error in processing plugin ".concat(i),r.t0);case 8:case"end":return r.stop()}}),r,this,[[0,5]])})))},!s){e.next=17;break}if(t!==a.pluginsMap.size-1){e.next=13;break}return e.next=11,o(a.canvases[t],a.outputCanvas);case 11:e.next=15;break;case 13:return e.next=15,o(a.canvases[t],a.canvases[t+1]);case 15:e.next=25;break;case 17:if(u=a.canvases[t],l=a.canvases[t+1],t!==a.pluginsMap.size-1){e.next=23;break}return e.next=21,a.analytics.processWithTime(i,(function(){return hn(a,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o(u,this.outputCanvas));case 1:case"end":return e.stop()}}),e,this)})))}));case 21:e.next=25;break;case 23:return e.next=25,a.analytics.processWithTime(i,(function(){return hn(a,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o(u,l));case 1:case"end":return e.stop()}}),e)})))}));case 25:e.next=31;break;case 27:if(e.t0=n.getPluginType()===jr.ANALYZE&&!s,!e.t0){e.next=31;break}return e.next=31,a.analytics.processWithTime(i,(function(){return hn(a,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.processVideoFrame(this.inputCanvas);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))}));case 31:e.next=38;break;case 33:return e.prev=33,e.t1=e.catch(3),wn.e(a.TAG,"error in processing plugin ".concat(i),e.t1),e.next=38,a.removePlugin(n);case 38:t++;case 39:case"end":return e.stop()}}),e,null,[[3,33]])})),n.s();case 6:if((r=n.n()).done){e.next=10;break}return e.delegateYield(i(),"t0",8);case 8:e.next=6;break;case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(3),n.e(e.t1);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[3,12,15,18]])})))}},{key:"addTrackToVideo",value:function(){return hn(this,null,c().mark((function e(){var t,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.inputVideo){e.next=2;break}return e.abrupt("return");case 2:if(n=this.inputVideo.srcObject,e.t0=null!==n&&n instanceof MediaStream&&(null==(t=n.getVideoTracks()[0])?void 0:t.id)===this.hmsTrack.nativeTrack.id,e.t0){e.next=11;break}return this.inputVideo.pause(),this.inputVideo.srcObject=new MediaStream([this.hmsTrack.nativeTrack]),this.inputVideo.muted=!0,this.inputVideo.playsInline=!0,e.next=11,this.inputVideo.play();case 11:case"end":return e.stop()}}),e,this)})))}},{key:"updateInputCanvas",value:function(){return hn(this,null,c().mark((function e(){var t,n,r,i,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.inputCanvas&&this.inputVideo){e.next=2;break}return e.abrupt("return");case 2:t=this.hmsTrack.getMediaTrackSettings(),n=t.width,r=void 0===n?320:n,i=t.height,a=void 0===i?240:i,this.inputCanvas.height!==a&&(this.inputCanvas.height=a),this.inputCanvas.width!==r&&(this.inputCanvas.width=r),this.inputCanvas.getContext("2d").drawImage(this.inputVideo,0,0,r,a);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"resetCanvases",value:function(){if(this.outputCanvas&&this.inputCanvas){var e=this.inputCanvas.getContext("2d");e&&(e.fillStyle="rgb(0, 0, 0)",e.fillRect(0,0,this.outputCanvas.width,this.outputCanvas.height)),this.canvases=[]}}},{key:"checkIfSkipRequired",value:function(e){var t=!1;return this.pluginNumFramesSkipped[e]<this.pluginNumFramesToSkip[e]?(this.pluginNumFramesSkipped[e]++,t=!0):(t=!1,this.pluginNumFramesSkipped[e]=0),t}}]),e}();function Yr(e,t){return function(n){return n in e&&e[n]!==t[n]}}var Qr,Jr,$r=function(e){Le(n,e);var t=Me(n);function n(e,r,i,a){var s,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(new gr).build();return y(this,n),(s=t.call(this,e,r,i)).eventBus=a,s._layerDefinitions=[],s.TAG="[HMSLocalVideoTrack]",s.isCurrentTab=!1,s.buildNewSettings=function(e){var t=ln(ln({},s.settings),e),n=t.width,r=t.height,i=t.codec,a=t.maxFramerate,o=t.maxBitrate,u=t.deviceId,c=t.advanced;return new mr(n,r,i,a,u,c,o)},s.handleSettingsChange=function(e){return hn(Ae(s),null,c().mark((function t(){var n,r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.stream,r=Yr(e,this.settings),t.t0=r("maxBitrate")&&e.maxBitrate,!t.t0){t.next=5;break}return t.next=5,n.setMaxBitrateAndFramerate(this);case 5:if(t.t1=r("width")||r("height")||r("advanced"),!t.t1){t.next=9;break}return t.next=9,this.nativeTrack.applyConstraints(e.toConstraints());case 9:case"end":return t.stop()}}),t,this)})))},s.handleDeviceChange=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return hn(Ae(s),null,c().mark((function n(){var r;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!Yr(e,this.settings)("deviceId")||"regular"!==this.source){n.next=9;break}if(!this.enabled){n.next=8;break}return n.next=4,this.replaceTrackWith(e);case 4:return r=n.sent,n.next=7,this.replaceSender(r,this.enabled);case 7:this.nativeTrack=r;case 8:t||Ar.updateSelection("videoInput",{deviceId:e.deviceId,groupId:this.nativeTrack.getSettings().groupId});case 9:case"end":return n.stop()}}),n,this)})))},e.tracks.push(Ae(s)),s.settings=o,o.deviceId!==r.getSettings().deviceId&&r.enabled&&(s.settings=s.buildNewSettings({deviceId:r.getSettings().deviceId})),s.pluginsManager=new qr(Ae(s),a),s.setFirstTrackId(s.trackId),s}return k(n,[{key:"setSimulcastDefinitons",value:function(e){this._layerDefinitions=e}},{key:"getSimulcastDefinitions",value:function(){return this._layerDefinitions}},{key:"setEnabled",value:function(e){var t=this,r=function(e){return Ce(xe(n.prototype),e,t)};return hn(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e===this.enabled){t.next=23;break}if("regular"!==this.source){t.next=19;break}if(!e){t.next=8;break}return t.next=5,this.replaceTrackWith(this.settings);case 5:n=t.sent,t.next=11;break;case 8:return t.next=10,this.replaceTrackWithBlank();case 10:n=t.sent;case 11:return t.next=13,this.replaceSender(n,e);case 13:if(this.nativeTrack=n,t.t0=e,!t.t0){t.next=19;break}return t.next=18,this.pluginsManager.waitForRestart();case 18:this.settings=this.buildNewSettings({deviceId:n.getSettings().deviceId});case 19:return t.next=21,r("setEnabled").call(this,e);case 21:this.eventBus.localVideoEnabled.publish({enabled:e,track:this}),this.stream.trackUpdate(this);case 23:case"end":return t.stop()}}),t,this)})))}},{key:"isPublishedTrackId",value:function(e){return this.publishedTrackId===e}},{key:"addSink",value:function(e){this.addSinkInternal(e,this.processedTrack||this.nativeTrack)}},{key:"setSettings",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return hn(this,null,c().mark((function n(){var r;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=this.buildNewSettings(e),n.next=3,this.handleDeviceChange(r,t);case 3:if(this.enabled){n.next=6;break}return this.settings=r,n.abrupt("return");case 6:return n.next=8,this.handleSettingsChange(r);case 8:this.settings=r;case 9:case"end":return n.stop()}}),n,this)})))}},{key:"getPlugins",value:function(){return this.pluginsManager.getPlugins()}},{key:"addPlugin",value:function(e,t){return hn(this,null,c().mark((function n(){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.pluginsManager.addPlugin(e,t));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"removePlugin",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.pluginsManager.removePlugin(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"validatePlugin",value:function(e){return this.pluginsManager.validatePlugin(e)}},{key:"cleanup",value:function(){var e=this,t=function(t){return Ce(xe(n.prototype),t,e)};return hn(this,null,c().mark((function e(){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t("cleanup").call(this),e.next=3,this.pluginsManager.cleanup();case 3:null==(n=this.processedTrack)||n.stop();case 4:case"end":return e.stop()}}),e,this)})))}},{key:"cropTo",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e||"screen"!==this.source){t.next=11;break}if(t.prev=1,t.t0=this.nativeTrack.cropTo,!t.t0){t.next=6;break}return t.next=6,this.nativeTrack.cropTo(e);case 6:t.next=11;break;case 8:throw t.prev=8,t.t1=t.catch(1),wn.e(this.TAG,"failed to crop screenshare capture - ",t.t1),er.GenericTrack(Kn.TRACK,"failed to crop screenshare capture");case 11:case"end":return t.stop()}}),t,this,[[1,8]])})))}},{key:"getCaptureHandle",value:function(){if(this.nativeTrack.getCaptureHandle)return this.nativeTrack.getCaptureHandle()}},{key:"setProcessedTrack",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.nativeTrack.enabled){t.next=3;break}return this.processedTrack=e,t.abrupt("return");case 3:if(e){t.next=10;break}if(t.t0=this.processedTrack,!t.t0){t.next=8;break}return t.next=8,this.stream.replaceSenderTrack(this.processedTrack,this.nativeTrack);case 8:return this.processedTrack=void 0,t.abrupt("return");case 10:if(t.t1=e!==this.processedTrack,!t.t1){t.next=20;break}if(!this.processedTrack){t.next=17;break}return t.next=15,this.stream.replaceSenderTrack(this.processedTrack,e);case 15:t.next=19;break;case 17:return t.next=19,this.stream.replaceSenderTrack(this.nativeTrack,e);case 19:this.processedTrack=e;case 20:case"end":return t.stop()}}),t,this)})))}},{key:"getTrackIDBeingSent",value:function(){return this.getTrackBeingSent().id}},{key:"getTrackBeingSent",value:function(){return this.enabled&&this.processedTrack||this.nativeTrack}},{key:"replaceTrackWith",value:function(e){return hn(this,null,c().mark((function t(){var n,r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.nativeTrack,t.next=3,Lr(e);case 3:return r=t.sent,t.abrupt("return",(null==n||n.stop(),wn.d(this.TAG,"replaceTrack, Previous track stopped",n,"newTrack",r),"default"===this.settings.deviceId&&(this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId})),r));case 5:case"end":return t.stop()}}),t,this)})))}},{key:"replaceTrackWithBlank",value:function(){return hn(this,null,c().mark((function e(){var t,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.nativeTrack,n=Si.getEmptyVideoTrack(t),e.abrupt("return",(null==t||t.stop(),wn.d(this.TAG,"replaceTrackWithBlank, Previous track stopped",t,"newTrack",n),n));case 2:case"end":return e.stop()}}),e,this)})))}},{key:"replaceSender",value:function(e,t){return hn(this,null,c().mark((function n(){var r;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=this.stream,!t){n.next=6;break}return n.next=4,r.replaceSenderTrack(this.nativeTrack,this.processedTrack||e);case 4:n.next=8;break;case 6:return n.next=8,r.replaceSenderTrack(this.processedTrack||this.nativeTrack,e);case 8:return n.next=10,r.replaceStreamTrack(this.nativeTrack,e);case 10:case"end":return n.stop()}}),n,this)})))}}]),n}(Hr),Xr="renegotiation-callback-id",Zr="ion-sfu",ei="SUBSCRIBE_ICE_CONNECTION_CALLBACK_ID",ti="device-change",ni="local-audio-enabled",ri="local-video-enabled",ii="stats-update",ai="track-degraded",si="track-restored",oi="track-audio-level-update",ui="local-audio-silence",ci="analytics",li="audio-plugin-failed",di="policy-change",fi="local-role-update",hi="audio-track-update",pi="audio-track-added",vi="audio-track-removed",gi="autoplay-error",mi="leave",yi=function(e){Le(n,e);var t=Me(n);function n(){var e;return y(this,n),(e=t.apply(this,arguments))._degraded=!1,e._degradedAt=null,e._layerDefinitions=[],e.history=new bi,e.preferredLayer=$n.HIGH,e}return k(n,[{key:"degraded",get:function(){return this._degraded}},{key:"degradedAt",get:function(){return this._degradedAt}},{key:"setEnabled",value:function(e){var t=this,r=function(e){return Ce(xe(n.prototype),e,t)};return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=e!==this.enabled,!t.t0){t.next=4;break}return t.next=4,r("setEnabled").call(this,e);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"setPreferredLayer",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e!==$n.NONE){t.next=3;break}return wn.w("layer ".concat($n.NONE," will be ignored")),t.abrupt("return");case 3:if(this.preferredLayer=e,!this.shouldSendVideoLayer(e,"preferLayer")){t.next=10;break}if(this.hasSinks()){t.next=7;break}return wn.d("[Remote Track] ".concat(this.logIdentifier),"Track does not have any sink, saving ".concat(e,", source=").concat(this.source)),t.abrupt("return");case 7:return t.next=9,this.requestLayer(e,"preferLayer");case 9:this.pushInHistory("uiPreferLayer-".concat(e));case 10:case"end":return t.stop()}}),t,this)})))}},{key:"getSimulcastLayer",value:function(){return this.stream.getSimulcastLayer()}},{key:"getLayer",value:function(){return this.stream.getVideoLayer()}},{key:"getPreferredLayer",value:function(){return this.preferredLayer}},{key:"addSink",value:function(e){var t=this,r=function(e){return Ce(xe(n.prototype),e,t)};return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r("addSink").call(this,e),t.next=3,this.updateLayer("addSink");case 3:this.pushInHistory("uiSetLayer-high");case 4:case"end":return t.stop()}}),t,this)})))}},{key:"removeSink",value:function(e){var t=this,r=function(e){return Ce(xe(n.prototype),e,t)};return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r("removeSink").call(this,e),t.next=3,this.updateLayer("removeSink");case 3:this._degraded=!1,this.pushInHistory("uiSetLayer-none");case 5:case"end":return t.stop()}}),t,this)})))}},{key:"getSimulcastDefinitions",value:function(){return T(this._layerDefinitions)}},{key:"setSimulcastDefinitons",value:function(e){this._layerDefinitions=e}},{key:"setLayerFromServer",value:function(e){this._degraded=(e.publisher_degraded||e.subscriber_degraded)&&e.current_layer===$n.NONE,this._degradedAt=this._degraded?new Date:this._degradedAt;var t=e.current_layer;return wn.d("[Remote Track] ".concat(this.logIdentifier," ").concat(this.stream.id," - layer update from sfu"),"currLayer=".concat(e.current_layer,", preferredLayer=").concat(e.expected_layer),"sub_degraded=".concat(e.subscriber_degraded),"pub_degraded=".concat(e.publisher_degraded),"isDegraded=".concat(this._degraded)),this.stream.setVideoLayerLocally(t,this.logIdentifier,"setLayerFromServer"),this.pushInHistory("sfuLayerUpdate-".concat(t)),this._degraded}},{key:"setDegradedFromSdk",value:function(e){this._degraded=e,this._degradedAt=e?new Date:this._degradedAt,this.updateLayer("sdkDegradation"),this.pushInHistory(e?"sdkDegraded-none":"sdkRecovered-high")}},{key:"updateLayer",value:function(e){return hn(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.degraded||!this.hasSinks()?$n.NONE:this.preferredLayer,t.t0=!this.shouldSendVideoLayer(n,e),t.t0){t.next=5;break}return t.next=5,this.requestLayer(n,e);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"pushInHistory",value:function(e){}},{key:"requestLayer",value:function(e,t){return hn(this,null,c().mark((function n(){var r;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this.stream.setVideoLayer(e,this.trackId,this.logIdentifier,t);case 3:return r=n.sent,n.abrupt("return",(wn.d("[Remote Track] ".concat(this.logIdentifier),"Requested layer ".concat(e,", source=").concat(this.source)),r));case 7:throw n.prev=7,n.t0=n.catch(0),wn.d("[Remote Track] ".concat(this.logIdentifier),"Failed to set layer ".concat(e,", source=").concat(this.source,", ").concat(n.t0.message)),n.t0;case 10:case"end":return n.stop()}}),n,this,[[0,7]])})))}},{key:"shouldSendVideoLayer",value:function(e,t){var n=this.getLayer();return!(!this.degraded||e!==$n.NONE)||(n!==e||(wn.d("[Remote Track] ".concat(this.logIdentifier),"Not sending update, already on layer ".concat(e,", source=").concat(t)),!1))}}]),n}(Hr),bi=function(){function e(){y(this,e),this.history=[]}return k(e,[{key:"push",value:function(e){e.time=(new Date).toISOString().split("T")[1],this.history.push(e)}}]),e}(),ki=function(e){Le(n,e);var t=Me(n);function n(){var e;return y(this,n),(e=t.apply(this,arguments)).TAG="[HMSLocalStream]",e.connection=null,e}return k(n,[{key:"setConnection",value:function(e){this.connection=e}},{key:"addTransceiver",value:function(e,t){var n=[];if(e instanceof $r)if(t.length>0)wn.v(this.TAG,"Simulcast enabled with layers",t),n.push.apply(n,T(t));else{var r={active:this.nativeStream.active};e.settings.maxBitrate&&!mn&&(r.maxBitrate=e.settings.maxBitrate),n.push(r)}var i=this.connection.addTransceiver(e.getTrackBeingSent(),{streams:[this.nativeStream],direction:"sendonly",sendEncodings:n});return this.setPreferredCodec(i,e.nativeTrack.kind),i}},{key:"setMaxBitrateAndFramerate",value:function(e){return hn(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,null==(n=this.connection)?void 0:n.setMaxBitrateAndFramerate(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"setPreferredCodec",value:function(e,t){}},{key:"replaceTrack",value:function(e,t){return hn(this,null,c().mark((function n(){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.replaceSenderTrack(e,t);case 2:e.stop(),this.replaceStreamTrack(e,t);case 4:case"end":return n.stop()}}),n,this)})))}},{key:"replaceStreamTrack",value:function(e,t){this.nativeStream.addTrack(t),this.nativeStream.removeTrack(e)}},{key:"replaceSenderTrack",value:function(e,t){return hn(this,null,c().mark((function n(){var r,i;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=null==(r=this.connection)?void 0:r.getSenders().find((function(t){return t.track&&t.track.id===e.id})),void 0!==i){n.next=4;break}return wn.w(this.TAG,"No sender found for trackId=".concat(e.id)),n.abrupt("return");case 4:return n.next=6,i.replaceTrack(t);case 6:case"end":return n.stop()}}),n,this)})))}},{key:"removeSender",value:function(e){var t=this,n=0;this.connection.getSenders().forEach((function(r){var i,a;if((null==(i=r.track)?void 0:i.id)===e.trackId||(null==(a=r.track)?void 0:a.id)===e.getTrackIDBeingSent()){t.connection.removeTrack(r),n+=1;var s=t.tracks.indexOf(e);-1!==s?t.tracks.splice(s,1):wn.e(t.TAG,"Cannot find ".concat(e.trackId," in locally stored tracks"))}})),1!==n&&wn.e(this.TAG,"Removed ".concat(n," sender's, expected to remove 1"))}},{key:"trackUpdate",value:function(e){var t;null==(t=this.connection)||t.trackUpdate(e)}}]),n}(kr),Ti="default",Ei="default",Si=function(){function e(t,n,r,i,a){y(this,e),this.store=t,this.observer=n,this.deviceManager=r,this.eventBus=i,this.analyticsTimer=a,this.TAG="[LocalTrackManager]",this.setScreenCaptureHandleConfig()}return k(e,[{key:"getTracksToPublish",value:function(e){return hn(this,null,c().mark((function t(){var n,r,i,a,s,o,u,l,d,f,h;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.getAVTrackSettings(e)){t.next=3;break}return t.abrupt("return",[]);case 3:return r=!!n.audio,i=!!n.video,a=[],t.next=8,this.updateCurrentLocalTrackSettings(n);case 8:if(s=t.sent,o=s.videoTrack,u=s.audioTrack,l=(null==o?void 0:o.stream)||(null==u?void 0:u.stream),d=Boolean(o&&this.store.getTrackById(o.trackId)),f=Boolean(u&&this.store.getTrackById(u.trackId)),!d||!f){t.next=16;break}return t.abrupt("return",[]);case 16:return h={audio:r&&!u&&(!e.isAudioMuted||"empty"),video:i&&!o&&(!e.isVideoMuted||"empty")},this.analyticsTimer.start(jn.LOCAL_AUDIO_TRACK),this.analyticsTimer.start(jn.LOCAL_VIDEO_TRACK),t.prev=18,wn.d(this.TAG,"Init Local Tracks",{fetchTrackOptions:h}),t.next=22,this.getLocalTracks(h,n,l);case 22:a=t.sent,t.next=30;break;case 25:return t.prev=25,t.t0=t.catch(18),t.next=29,this.retryGetLocalTracks(t.t0,n,h,l);case 29:a=t.sent;case 30:return t.abrupt("return",(this.analyticsTimer.end(jn.LOCAL_AUDIO_TRACK),this.analyticsTimer.end(jn.LOCAL_VIDEO_TRACK),o&&i&&!d&&a.push(o),u&&r&&!f&&a.push(u),a));case 31:case"end":return t.stop()}}),t,this,[[18,25]])})))}},{key:"getLocalTracks",value:function(){return hn(this,arguments,c().mark((function e(){var t,n,r,i,a=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{audio:!0,video:!0},n=a.length>1?a[1]:void 0,r=a.length>2?a[2]:void 0,e.prev=3,e.next=6,this.getNativeLocalTracks(t,n);case 6:return i=e.sent,e.abrupt("return",this.createHMSLocalTracks(i,n,r));case 10:throw e.prev=10,e.t0=e.catch(3),this.eventBus.analytics.publish(Vn.publish({devices:this.deviceManager.getDevices(),error:e.t0,settings:n})),e.t0;case 13:case"end":return e.stop()}}),e,this,[[3,10]])})))}},{key:"getNativeLocalTracks",value:function(){return hn(this,arguments,c().mark((function e(){var t,n,r,i,a=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:{audio:!1,video:!1},n=a.length>1?a[1]:void 0,r=new br(!0===t.video?n.video:null,!0===t.audio?n.audio:null,n.simulcast),i=[],e.t0=r.audio||r.video,!e.t0){e.next=13;break}return e.t1=i.push,e.t2=i,e.t3=T,e.next=10,this.getAVTracks(r);case 10:e.t4=e.sent,e.t5=(0,e.t3)(e.t4),e.t1.apply.call(e.t1,e.t2,e.t5);case 13:return i.push.apply(i,T(this.getEmptyTracks(t))),e.abrupt("return",i);case 15:case"end":return e.stop()}}),e,this)})))}},{key:"getLocalScreen",value:function(e){return hn(this,null,c().mark((function t(){var n,r,i,a,s,o,u,l,d,f,h,p,v,g;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getOrDefaultScreenshareConfig(e);case 2:return r=t.sent,i=this.getScreenshareSettings(r.videoOnly),a={video:dn(ln({},null==i?void 0:i.video.toConstraints(!0)),{displaySurface:r.displaySurface}),preferCurrentTab:r.preferCurrentTab,selfBrowserSurface:r.selfBrowserSurface,surfaceSwitching:r.surfaceSwitching,systemAudio:r.systemAudio},(null==i?void 0:i.audio)&&(delete(s=null==(n=null==i?void 0:i.audio)?void 0:n.toConstraints()).advanced,a.audio=dn(ln({},s),{autoGainControl:!1,noiseSuppression:!1,googAutoGainControl:!1,echoCancellation:!1})),t.prev=6,wn.d("retrieving screenshare with ",{config:r},{constraints:a}),t.next=10,navigator.mediaDevices.getDisplayMedia(a);case 10:o=t.sent,t.next=18;break;case 13:throw t.prev=13,t.t0=t.catch(6),wn.w(this.TAG,"error in getting screenshare - ",t.t0),u=or(t.t0,qn.SCREEN),this.eventBus.analytics.publish(Vn.publish({error:u,devices:this.deviceManager.getDevices(),settings:new br(null==i?void 0:i.video,null==i?void 0:i.audio,!1)})),u;case 18:return l=[],d=new ki(o),f=o.getVideoTracks()[0],(h=new $r(d,f,"screen",this.eventBus,null==i?void 0:i.video)).setSimulcastDefinitons(this.store.getSimulcastDefinitionsForPeer(this.store.getLocalPeer(),"screen")),t.prev=20,p=this.validateCurrentTabCapture(h,r.forceCurrentTab),h.isCurrentTab=p,t.next=25,h.cropTo(r.cropTarget);case 25:t.next=30;break;case 27:throw t.prev=27,t.t1=t.catch(20),o.getTracks().forEach((function(e){return e.stop()})),t.t1;case 30:return l.push(h),(v=o.getAudioTracks()[0])&&(g=new Vr(d,v,"screen",this.eventBus,null==i?void 0:i.audio),l.push(g)),t.abrupt("return",(wn.v(this.TAG,"getLocalScreen",l),l));case 34:case"end":return t.stop()}}),t,this,[[6,13],[20,27]])})))}},{key:"setScreenCaptureHandleConfig",value:function(e){var t;!(null==(t=navigator.mediaDevices)?void 0:t.setCaptureHandleConfig)||this.isInIframe()||(e=e||{},Object.assign(e,{handle:Xt(),exposeOrigin:!1,permittedOrigins:[window.location.origin]}),wn.d("setting capture handle - ",e.handle),navigator.mediaDevices.setCaptureHandleConfig(e),this.captureHandleIdentifier=e.handle)}},{key:"validateCurrentTabCapture",value:function(e,t){var n=e.getCaptureHandle(),r=!(!this.captureHandleIdentifier||(null==n?void 0:n.handle)!==this.captureHandleIdentifier);if(t&&!r)throw wn.e(this.TAG,"current tab was not shared with forceCurrentTab as true"),er.CurrentTabNotShared();return r}},{key:"requestPermissions",value:function(){return hn(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 3:e.sent.getTracks().forEach((function(e){return e.stop()})),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),wn.e(this.TAG,e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,6]])})))}},{key:"getAVTracks",value:function(e){return hn(this,null,c().mark((function t(){var n,r,i,a;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.mediaDevices.getUserMedia({audio:!!e.audio&&e.audio.toConstraints(),video:!!e.video&&e.video.toConstraints()});case 3:return n=t.sent,t.abrupt("return",n.getVideoTracks().concat(n.getAudioTracks()));case 7:return t.prev=7,t.t0=t.catch(0),t.next=11,this.deviceManager.init();case 11:throw r=!(this.deviceManager.hasWebcamPermission||!e.video),i=!(this.deviceManager.hasMicrophonePermission||!e.audio),a=this.getErrorType(r,i),or(t.t0,a);case 13:case"end":return t.stop()}}),t,this,[[0,7]])})))}},{key:"getAVTrackSettings",value:function(e){var t=this.getAudioSettings(e),n=this.getVideoSettings(e);return t||n?(new yr).video(n).audio(t).build():null}},{key:"isInIframe",value:function(){try{return window.self!==window.top}catch(e){return!0}}},{key:"retryGetLocalTracks",value:function(e,t,n,r){return hn(this,null,c().mark((function i(){var a,s,o,u,l,d,f;return c().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!(e instanceof Gn&&e.action===Kn.TRACK)){i.next=37;break}if(this.observer.onFailure(e),a=e.code===Wn.TracksErrors.OVER_CONSTRAINED,s=e.message.includes("audio"),o=e.message.includes("video"),!a){i.next=19;break}return u=(new yr).video(new mr).audio(new vr).build(),wn.w(this.TAG,"Fetch AV Tracks failed with overconstrained error",{fetchTrackOptions:n},{error:e}),i.prev=6,i.next=9,this.getLocalTracks(n,u,r);case 9:case 18:case 23:case 34:return i.abrupt("return",i.sent);case 12:return i.prev=12,i.t0=i.catch(6),l=i.t0 instanceof Gn?i.t0.nativeError:i.t0,d=i.t0,"OverconstrainedError"===(null==l?void 0:l.name)&&((f=er.GenericTrack(Kn.TRACK,"Overconstrained error after dropping all constraints")).addNativeError(l),d=f),i.next=18,this.retryGetLocalTracks(d,t,n,r);case 19:return n.audio=s?"empty":n.audio,n.video=o?"empty":n.video,wn.w(this.TAG,"Fetch AV Tracks failed",{fetchTrackOptions:n},e),i.prev=20,i.next=23,this.getLocalTracks(n,t,r);case 26:return i.prev=26,i.t1=i.catch(20),wn.w(this.TAG,"Fetch empty tacks failed",i.t1),n.audio=n.audio&&"empty",n.video=n.video&&"empty",this.observer.onFailure(i.t1),i.next=34,this.getLocalTracks(n,t,r);case 35:i.next=38;break;case 37:return i.abrupt("return",(wn.w(this.TAG,"Fetch AV Tracks failed - unknown exception",e),this.observer.onFailure(e),[]));case 38:case"end":return i.stop()}}),i,this,[[6,12],[20,26]])})))}},{key:"getErrorType",value:function(e,t){return e&&t?qn.AV:e?qn.VIDEO:t?qn.AUDIO:qn.UNKNOWN}},{key:"getEmptyTracks",value:function(t){var n=[];return"empty"===t.audio&&n.push(e.getEmptyAudioTrack()),"empty"===t.video&&n.push(e.getEmptyVideoTrack()),n}},{key:"updateCurrentLocalTrackSettings",value:function(e){return hn(this,null,c().mark((function t(){var n,r,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.store.getLocalPeerTracks(),r=n.find((function(e){return e.type===hr.VIDEO&&"regular"===e.source})),i=n.find((function(e){return e.type===hr.AUDIO&&"regular"===e.source})),t.t0=null==e?void 0:e.video,!t.t0){t.next=5;break}return t.next=5,null==r?void 0:r.setSettings(e.video);case 5:if(t.t1=null==e?void 0:e.audio,!t.t1){t.next=9;break}return t.next=9,null==i?void 0:i.setSettings(e.audio);case 9:return t.abrupt("return",{videoTrack:r,audioTrack:i});case 10:case"end":return t.stop()}}),t,this)})))}},{key:"getAudioSettings",value:function(e){var t,n=this.store.getPublishParams();if(!n||!(null==(t=n.allowed)?void 0:t.includes("audio")))return null;var r=this.store.getLocalPeer(),i=null==r?void 0:r.audioTrack,a=(null==i?void 0:i.settings.deviceId)||e.audioInputDeviceId;return(new pr).codec(n.audio.codec).maxBitrate(n.audio.bitRate).deviceId(a||Ti).build()}},{key:"getVideoSettings",value:function(e){var t,n=this.store.getPublishParams();if(!n||!(null==(t=n.allowed)?void 0:t.includes("video")))return null;var r=this.store.getLocalPeer(),i=null==r?void 0:r.videoTrack,a=(null==i?void 0:i.settings.deviceId)||e.videoDeviceId,s=n.video;return(new gr).codec(s.codec).maxBitrate(s.bitRate).maxFramerate(s.frameRate).setWidth(s.width).setHeight(s.height).deviceId(a||Ei).build()}},{key:"getScreenshareSettings",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.store.getPublishParams();if(!n||!(null==(e=n.allowed)?void 0:e.includes("screen")))return null;var r=n.screen;return{video:(new gr).maxBitrate(r.bitRate,!1).codec(r.codec).maxFramerate(r.frameRate).setWidth(r.width).setHeight(r.height).build(),audio:t?void 0:(new pr).build()}}},{key:"getOrDefaultScreenshareConfig",value:function(e){return hn(this,null,c().mark((function t(){var n,r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((r=Object.assign({videoOnly:!1,audioOnly:!1,forceCurrentTab:!1,preferCurrentTab:!1,selfBrowserSurface:"exclude",surfaceSwitching:"include",systemAudio:"exclude",displaySurface:"monitor"},e||{})).forceCurrentTab&&(r.videoOnly=!0,r.preferCurrentTab=!0,r.selfBrowserSurface="include",r.surfaceSwitching="exclude"),r.preferCurrentTab&&(r.selfBrowserSurface="include",r.displaySurface=void 0),t.t0=r.cropElement&&(null==(n=window.CropTarget)?void 0:n.fromElement),!t.t0){t.next=8;break}return t.next=7,window.CropTarget.fromElement(r.cropElement);case 7:r.cropTarget=t.sent;case 8:return t.abrupt("return",r);case 9:case"end":return t.stop()}}),t)})))}},{key:"createHMSLocalTracks",value:function(e,t,n){var r=e.find((function(e){return"video"===e.kind})),i=e.find((function(e){return"audio"===e.kind}));n?e.forEach((function(e){return null==n?void 0:n.nativeStream.addTrack(e)})):n=new ki(new MediaStream(e));var a=[];if(i&&(null==t?void 0:t.audio)){var s=new Vr(n,i,"regular",this.eventBus,t.audio);a.push(s)}if(r&&(null==t?void 0:t.video)){var o=new $r(n,r,"regular",this.eventBus,t.video);o.setSimulcastDefinitons(this.store.getSimulcastDefinitionsForPeer(this.store.getLocalPeer(),"regular")),a.push(o)}return a}}],[{key:"getEmptyVideoTrack",value:function(e){var t,n,r,i=(null==(t=null==e?void 0:e.getSettings())?void 0:t.width)||320,a=(null==(n=null==e?void 0:e.getSettings())?void 0:n.height)||240;Qr||(null==(r=(Qr=Object.assign(document.createElement("canvas"),{width:i,height:a})).getContext("2d"))||r.fillRect(0,0,i,a));var s=Qr.captureStream(10).getVideoTracks()[0],o=setInterval((function(){if("ended"!==s.readyState){var e=Qr.getContext("2d");if(e){var t=0===e.getImageData(0,0,1,1).data[0]?1:0;e.fillStyle="rgb(".concat(t,", 0, 0)"),e.fillRect(0,0,1,1)}}else clearInterval(o)}),100);return s.onended=function(){clearInterval(o)},s.enabled=!1,s}},{key:"getEmptyAudioTrack",value:function(){var e=Mr.getAudioContext(),t=e.createOscillator(),n=e.createMediaStreamDestination();t.connect(n),t.start();var r=n.stream.getAudioTracks()[0];return r.enabled=!1,r}}]),e}(),wi=function(){function e(t,n){var r=this;y(this,e),this.eventBus=t,this.listener=n,this.TAG="[NetworkTestManager]",this.controller=new AbortController,this.start=function(e){return hn(r,null,c().mark((function t(){var n,r,i,a,s,o,u,l,d,f,h=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return r=e.url,i=e.timeout,a=e.scoreMap,s=this.controller.signal,o=Date.now(),u=0,l=Fr(i).then((function(){h.controller.abort()})),t.prev=3,t.next=6,fetch("".concat(r,"?").concat(Date.now()),{signal:s});case 6:if(t.t0=n=t.sent.body,null!=t.t0){t.next=11;break}t.t1=void 0,t.next=12;break;case 11:t.t1=n.getReader();case 12:if(d=t.t1){t.next=15;break}throw Error("unable to process request");case 15:return f=function(){return hn(h,null,c().mark((function e(){var t,n,r,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!d){e.next=17;break}e.prev=1,t=!1;case 3:if(t){e.next=12;break}return e.next=6,d.read();case 6:n=e.sent,r=n.value,i=n.done,t=i,r&&(u+=r.byteLength,this.sendScore({scoreMap:a,downloadedSize:u,startTime:o}));case 10:e.next=3;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),"AbortError"!==e.t0.name&&wn.e(this.TAG,e.t0);case 17:case"end":return e.stop()}}),e,this,[[1,14]])})))},t.abrupt("return",Promise.race([f(),l]).then((function(){h.sendScore({scoreMap:a,downloadedSize:u,startTime:o,finished:!0})})).catch((function(e){wn.e(h.TAG,e),h.updateScoreToListener(0),h.eventBus.analytics.publish(Vn.previewNetworkQuality({error:e.message}))})));case 19:t.prev=19,t.t2=t.catch(3),"AbortError"!==t.t2.name?(wn.e(this.TAG,t.t2),this.updateScoreToListener(0),this.eventBus.analytics.publish(Vn.previewNetworkQuality({error:t.t2.message}))):wn.d(this.TAG,t.t2);case 22:case"end":return t.stop()}}),t,this,[[3,19]])})))},this.stop=function(){r.controller.signal.aborted||r.controller.abort()},this.sendScore=function(e){var t=e.scoreMap,n=e.downloadedSize,i=e.startTime,a=e.finished,s=void 0!==a&&a,o=n/1024/((Date.now()-i)/1e3)*8,u=-1;for(var c in t){var l=t[c];o>=l.low&&(!l.high||o<=l.high)&&(u=Number(c))}r.updateScoreToListener(u),s&&r.eventBus.analytics.publish(Vn.previewNetworkQuality({score:u,downLink:o.toFixed(2)}))}}return k(e,[{key:"updateScoreToListener",value:function(e){var t,n;e!==this.score&&(this.score=e,null==(n=null==(t=this.listener)?void 0:t.onNetworkQuality)||n.call(t,e))}}]),e}(),xi=function(){function e(t,n,r,i,a){var s=this;y(this,e),this.store=t,this.transport=n,this.publish=r,this.removeAuxiliaryTrack=i,this.listener=a,this.handleLocalPeerRoleUpdate=function(e){return hn(s,[e],c().mark((function e(t){var n,r,i,a,s,o,u,l,d,f,h,p,v,g,m,y,b;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.oldRole,r=t.newRole,d=this.store.getLocalPeer()){e.next=4;break}return e.abrupt("return");case 4:return f=new Set(n.publishParams.allowed),h=new Set(r.publishParams.allowed),p=this.removeTrack(f,h,"video"),v=this.hasSimulcastDifference(null==(i=n.publishParams.simulcast)?void 0:i.video,null==(a=r.publishParams.simulcast)?void 0:a.video),g=this.removeTrack(f,h,"audio"),m=this.removeTrack(f,h,"screen"),y=this.hasSimulcastDifference(null==(s=n.publishParams.simulcast)?void 0:s.screen,null==(o=r.publishParams.simulcast)?void 0:o.screen),e.next=7,this.removeAudioTrack(g);case 7:return e.next=9,this.removeVideoTracks(p||v);case 9:return e.next=11,this.removeScreenTracks(m||y);case 11:return b=(null==(u=this.store.getConfig())?void 0:u.settings)||{isAudioMuted:!0,isVideoMuted:!0,audioInputDeviceId:"default",videoDeviceId:"default",audioOutputDeviceId:"default"},e.next=14,this.publish(dn(ln({},b),{isAudioMuted:!0,isVideoMuted:!0}));case 14:null==(l=this.listener)||l.onPeerUpdate(Qn.ROLE_UPDATED,d);case 15:case"end":return e.stop()}}),e,this)})))}}return k(e,[{key:"removeVideoTracks",value:function(e){return hn(this,null,c().mark((function t(){var n,r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:if(r=this.store.getLocalPeer(),t.t0=null==r?void 0:r.videoTrack,!t.t0){t.next=14;break}if(!r.videoTrack.publishedTrackId){t.next=10;break}return t.next=8,this.transport.unpublish([r.videoTrack]);case 8:t.next=12;break;case 10:return t.next=12,r.videoTrack.cleanup();case 12:null==(n=this.listener)||n.onTrackUpdate(Jn.TRACK_REMOVED,r.videoTrack,r),r.videoTrack=void 0;case 14:return t.next=16,this.removeAuxTracks((function(e){return"screen"!==e.source&&"video"===e.type}));case 16:case"end":return t.stop()}}),t,this)})))}},{key:"removeAudioTrack",value:function(e){return hn(this,null,c().mark((function t(){var n,r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:if(r=this.store.getLocalPeer(),t.t0=null==r?void 0:r.audioTrack,!t.t0){t.next=14;break}if(!r.audioTrack.publishedTrackId){t.next=10;break}return t.next=8,this.transport.unpublish([r.audioTrack]);case 8:t.next=12;break;case 10:return t.next=12,r.audioTrack.cleanup();case 12:null==(n=this.listener)||n.onTrackUpdate(Jn.TRACK_REMOVED,r.audioTrack,r),r.audioTrack=void 0;case 14:return t.next=16,this.removeAuxTracks((function(e){return"screen"!==e.source&&"audio"===e.type}));case 16:case"end":return t.stop()}}),t,this)})))}},{key:"removeScreenTracks",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=!e,t.t0){t.next=4;break}return t.next=4,this.removeAuxTracks((function(e){return"screen"===e.source}));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"removeAuxTracks",value:function(e){return hn(this,null,c().mark((function t(){var n,r,i,a,s;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(null==(n=this.store.getLocalPeer())?void 0:n.auxiliaryTracks)){t.next=22;break}r=T(n.auxiliaryTracks),i=S(r),t.prev=4,i.s();case 6:if((a=i.n()).done){t.next=14;break}if(s=a.value,t.t0=e(s),!t.t0){t.next=12;break}return t.next=12,this.removeAuxiliaryTrack(s.trackId);case 12:t.next=6;break;case 14:t.next=19;break;case 16:t.prev=16,t.t1=t.catch(4),i.e(t.t1);case 19:return t.prev=19,i.f(),t.finish(19);case 22:case"end":return t.stop()}}),t,this,[[4,16,19,22]])})))}},{key:"removeTrack",value:function(e,t,n){return e.has(n)&&!t.has(n)}},{key:"hasSimulcastDifference",value:function(e,t){var n,r;return!(!e&&!t)&&(null==(n=null==e?void 0:e.layers)?void 0:n.length)!==(null==(r=null==t?void 0:t.layers)?void 0:r.length)}}]),e}(),Ri=function(){function e(t){y(this,e),this.store=t,this.primitiveComparator=function(e,t){return e===t?0:Number(e)-Number(t)},this.stringComparator=function(e,t){return e===t?0:e<t?-1:1}}return k(e,[{key:"getPeerComparators",value:function(){var e=this;return{videoEnabled:function(t,n){var r,i;return e.primitiveComparator(Boolean(null==(r=t.videoTrack)?void 0:r.enabled),Boolean(null==(i=n.videoTrack)?void 0:i.enabled))},audioEnabled:function(t,n){var r,i;return e.primitiveComparator(Boolean(null==(r=t.audioTrack)?void 0:r.enabled),Boolean(null==(i=n.audioTrack)?void 0:i.enabled))},screenShare:function(t,n){return e.primitiveComparator(t.auxiliaryTracks.some((function(e){return"screen"===e.source})),n.auxiliaryTracks.some((function(e){return"screen"===e.source})))},audioLevel:function(t,n){var r,i;return e.primitiveComparator((null==(r=e.store.getSpeakers().find((function(e){return e.peer&&e.peer.peerId===(null==t?void 0:t.peerId)})))?void 0:r.audioLevel)||-1,(null==(i=e.store.getSpeakers().find((function(e){return e.peer&&e.peer.peerId===(null==n?void 0:n.peerId)})))?void 0:i.audioLevel)||-1)},rolePriority:function(t,n){var r,i;return e.primitiveComparator((null==(r=n.role)?void 0:r.priority)||0,(null==(i=t.role)?void 0:i.priority)||0)}}}},{key:"getTrackComparators",value:function(){var e=this;return{video:function(t,n){return e.primitiveComparator(t.type===hr.VIDEO,n.type===hr.VIDEO)},audio:function(t,n){return e.primitiveComparator(t.type===hr.AUDIO,n.type===hr.AUDIO)},enabled:function(t,n){return e.primitiveComparator(Boolean(t.enabled),Boolean(n.enabled))},peerAudioLevel:function(t,n){var r=e.store.getPeerByTrackId(t.trackId),i=e.store.getPeerByTrackId(n.trackId);return e.getPeerComparators().audioLevel(r,i)},audioLevel:function(t,n){var r,i;return e.primitiveComparator((null==(r=e.store.getSpeakers().find((function(e){return e.track.trackId===t.trackId})))?void 0:r.audioLevel)||0,(null==(i=e.store.getSpeakers().find((function(e){return e.track.trackId===n.trackId})))?void 0:i.audioLevel)||0)},screenShare:function(t,n){return e.primitiveComparator("screen"===t.source,"screen"===n.source)},rolePriority:function(t,n){var r,i,a,s;return e.primitiveComparator((null==(i=null==(r=e.store.getPeerByTrackId(n.trackId))?void 0:r.role)?void 0:i.priority)||0,(null==(s=null==(a=e.store.getPeerByTrackId(t.trackId))?void 0:a.role)?void 0:s.priority)||0)}}}}]),e}(),Ci=function(){function e(){y(this,e),this.TAG="[HTTPAnalyticsTransport]",this.failedEvents=new vn("client-events"),this.isConnected=!0,this.env=null,this.websocketURL=""}return k(e,[{key:"setEnv",value:function(e){this.env=e,this.flushFailedEvents()}},{key:"setWebsocketEndpoint",value:function(e){this.websocketURL=e}},{key:"sendEvent",value:function(e){var t=this;if(this.env&&this.websocketURL){var n={event:e.name,payload:e.properties,event_id:String(e.timestamp),peer:e.metadata.peer,timestamp:e.timestamp,device_id:e.device_id,cluster:{websocket_url:this.websocketURL}},r=this.env===$t.PROD?"https://event.100ms.live/v2/client/report":"https://event-nonprod.100ms.live/v2/client/report";fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.metadata.token),user_agent_v2:e.metadata.userAgent},body:JSON.stringify(n)}).then((function(n){if(401!==n.status){if(200!==n.status)throw Error(n.statusText);t.removeFromStorage(e)}else t.removeFromStorage(e)})).catch((function(n){wn.v(t.TAG,"Failed to send event",n,e),t.addEventToStorage(e)}))}else this.addEventToStorage(e)}},{key:"flushFailedEvents",value:function(){var e=this,t=this.failedEvents.get();null==t||t.forEach((function(t){return e.sendEvent(t)}))}},{key:"addEventToStorage",value:function(e){var t=this.failedEvents.get()||[];t.find((function(t){return t.timestamp===e.timestamp}))||(100===t.length&&t.shift(),t.push(e),this.failedEvents.set(t))}},{key:"removeFromStorage",value:function(e){var t=this.failedEvents.get()||[],n=t.findIndex((function(t){return t.timestamp===e.timestamp}));n>-1&&(t.splice(n,1),this.failedEvents.set(t))}}]),e}(),Ai=new Ci,Ii=function(){function e(){y(this,e),this.comparator=new Ri(this),this.knownRoles={},this.peers={},this.tracks={},this.peerTrackStates={},this.speakers=[],this.roleDetailsArrived=!1,this.env=$t.PROD,this.simulcastEnabled=!1,this.userAgent=On(this.env)}return k(e,[{key:"getConfig",value:function(){return this.config}},{key:"setSimulcastEnabled",value:function(e){this.simulcastEnabled=e}},{key:"getEnv",value:function(){return this.env}},{key:"getPublishParams",value:function(){var e,t;return null==(t=null==(e=this.getLocalPeer())?void 0:e.role)?void 0:t.publishParams}},{key:"getComparator",value:function(){return this.comparator}},{key:"getRoom",value:function(){return this.room}},{key:"getPolicyForRole",value:function(e){return this.knownRoles[e]}},{key:"getKnownRoles",value:function(){return this.knownRoles}},{key:"getLocalPeer",value:function(){if(this.localPeerId&&this.peers[this.localPeerId])return this.peers[this.localPeerId]}},{key:"getRemotePeers",value:function(){return Object.values(this.peers).filter((function(e){return!e.isLocal}))}},{key:"getPeers",value:function(){return Object.values(this.peers)}},{key:"getPeerById",value:function(e){if(this.peers[e])return this.peers[e]}},{key:"getTracksMap",value:function(){return this.tracks}},{key:"getTracks",value:function(){return Object.values(this.tracks)}},{key:"getVideoTracks",value:function(){return this.getTracks().filter((function(e){return e.type===hr.VIDEO}))}},{key:"getRemoteVideoTracks",value:function(){return this.getTracks().filter((function(e){return e instanceof yi}))}},{key:"getAudioTracks",value:function(){return this.getTracks().filter((function(e){return e.type===hr.AUDIO}))}},{key:"getPeerTracks",value:function(e){var t=e?this.peers[e]:void 0,n=[];return(null==t?void 0:t.videoTrack)&&n.push(t.videoTrack),(null==t?void 0:t.audioTrack)&&n.push(t.audioTrack),n.concat((null==t?void 0:t.auxiliaryTracks)||[])}},{key:"getLocalPeerTracks",value:function(){return this.getPeerTracks(this.localPeerId)}},{key:"getTrackById",value:function(e){var t,n,r=this.tracks[e];if(r)return r;var i=this.getLocalPeer();if(i){if(null==(t=i.audioTrack)?void 0:t.isPublishedTrackId(e))return i.audioTrack;if(null==(n=i.videoTrack)?void 0:n.isPublishedTrackId(e))return i.videoTrack}}},{key:"getPeerByTrackId",value:function(e){var t=this.tracks[e];return t.peerId?this.peers[t.peerId]:void 0}},{key:"getSpeakers",value:function(){return this.speakers}},{key:"getSpeakerPeers",value:function(){return this.speakers.map((function(e){return e.peer}))}},{key:"getUserAgent",value:function(){return this.userAgent}},{key:"createAndSetUserAgent",value:function(e){this.userAgent=On(this.env,e)}},{key:"setRoom",value:function(e){this.room=e}},{key:"setKnownRoles",value:function(e){var t,n;if(this.knownRoles=e.known_roles,this.roleDetailsArrived=!0,this.simulcastEnabled){var r=null==(t=this.knownRoles[e.name])?void 0:t.publishParams;this.videoLayers=this.convertSimulcastLayers(null==(n=r.simulcast)?void 0:n.video),this.updatePeersPolicy()}}},{key:"hasRoleDetailsArrived",value:function(){return this.roleDetailsArrived}},{key:"setConfig",value:function(e){var t,n,r;if(Ar.rememberDevices(Boolean(e.rememberDeviceSelection)),e.rememberDeviceSelection){var i=Ar.getSelection();i&&(e.settings||(e.settings={}),(null==(t=i.audioInput)?void 0:t.deviceId)&&(e.settings.audioInputDeviceId=e.settings.audioInputDeviceId||i.audioInput.deviceId),(null==(n=i.audioOutput)?void 0:n.deviceId)&&(e.settings.audioOutputDeviceId=e.settings.audioOutputDeviceId||i.audioOutput.deviceId),(null==(r=i.videoInput)?void 0:r.deviceId)&&(e.settings.videoDeviceId=e.settings.videoDeviceId||i.videoInput.deviceId))}this.config=e,this.setEnv()}},{key:"addPeer",value:function(e){this.peers[e.peerId]=e,e.isLocal&&(this.localPeerId=e.peerId)}},{key:"addTrack",value:function(e){this.tracks[e.trackId]=e}},{key:"getTrackState",value:function(e){return this.peerTrackStates[e]}},{key:"setTrackState",value:function(e){this.peerTrackStates[e.trackInfo.track_id]=e}},{key:"removePeer",value:function(e){this.localPeerId===e&&(this.localPeerId=void 0),delete this.peers[e]}},{key:"removeTrack",value:function(e){delete this.tracks[e]}},{key:"updateSpeakers",value:function(e){this.speakers=e}},{key:"updateAudioOutputVolume",value:function(e){return hn(this,null,c().mark((function t(){var n,r,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=S(this.getAudioTracks()),t.prev=1,n.s();case 3:if((r=n.n()).done){t.next=9;break}return i=r.value,t.next=7,i.setVolume(e);case 7:t.next=3;break;case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),n.e(t.t0);case 14:return t.prev=14,n.f(),t.finish(14);case 17:case"end":return t.stop()}}),t,this,[[1,11,14,17]])})))}},{key:"updateAudioOutputDevice",value:function(e){return hn(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],this.getAudioTracks().forEach((function(t){n.push(t.setOutputDevice(e))})),t.next=4,Promise.all(n);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"getSimulcastLayers",value:function(e){var t;return this.simulcastEnabled?"screen"===e?[]:(null==(t=this.videoLayers)?void 0:t.layers)||[]:[]}},{key:"convertSimulcastLayers",value:function(e){if(e)return dn(ln({},e),{layers:(e.layers||[]).map((function(e){return dn(ln({},e),{maxBitrate:1e3*e.maxBitrate})}))})}},{key:"getSimulcastDefinitionsForPeer",value:function(e,t){var n,r,i;if([!e||!e.role,"screen"===t,!this.simulcastEnabled].some((function(e){return!!e})))return[];var a,s,o,u=this.getPolicyForRole(e.role.name).publishParams;return"regular"===t?(a=null==(n=u.simulcast)?void 0:n.video,s=u.video.width,o=u.video.height):"screen"===t&&(a=null==(r=u.simulcast)?void 0:r.screen,s=u.screen.width,o=u.screen.height),(null==(i=null==a?void 0:a.layers)?void 0:i.map((function(e){return{layer:fr[e.rid],resolution:{width:s/e.scaleResolutionDownBy,height:o/e.scaleResolutionDownBy}}})))||[]}},{key:"getErrorListener",value:function(){return this.errorListener}},{key:"cleanUp",value:function(){var e,t=S(this.getTracks());try{for(t.s();!(e=t.n()).done;){e.value.cleanup()}}catch(n){t.e(n)}finally{t.f()}this.room=void 0,this.config=void 0,this.localPeerId=void 0,this.roleDetailsArrived=!1}},{key:"setErrorListener",value:function(e){this.errorListener=e}},{key:"updatePeersPolicy",value:function(){var e=this;this.getPeers().forEach((function(t){var n;t.role?t.role=e.getPolicyForRole(t.role.name):null==(n=e.errorListener)||n.onError(rr.InvalidRole(Kn.VALIDATION,""))}))}},{key:"setEnv",value:function(){var e,t=(null==(e=this.config)?void 0:e.initEndpoint).split("https://")[1],n=$t.PROD;t.startsWith($t.PROD)?n=$t.PROD:t.startsWith($t.QA)?n=$t.QA:t.startsWith($t.DEV)&&(n=$t.DEV),this.env=n,Ai.setEnv(n)}}]),e}(),Pi=function(){function e(t){y(this,e),this.store=t,this.bufferSize=100,this.TAG="[AnalyticsEventsService]",this.transport=null,this.pendingEvents=[],this.level=Nn.INFO}return k(e,[{key:"setTransport",value:function(e){this.transport=e}},{key:"reset",value:function(){this.transport=null,this.pendingEvents=[]}},{key:"queue",value:function(e){if(e.level>=this.level&&(this.pendingEvents.push(e),this.pendingEvents.length>this.bufferSize)){var t=this.pendingEvents.shift();wn.d(this.TAG,"Max buffer size reached","Removed event to accommodate new events",t)}return this}},{key:"flushFailedClientEvents",value:function(){Ai.flushFailedEvents()}},{key:"flush",value:function(){var e;try{for(;this.pendingEvents.length>0;){var t=this.pendingEvents.shift();t&&(t.metadata.peer.peer_id=null==(e=this.store.getLocalPeer())?void 0:e.peerId,t.metadata.userAgent=this.store.getUserAgent(),this.transport&&this.transport.transportProvider.isConnected?this.transport.sendEvent(t):this.sendClientEventOnHTTP(t))}}catch(R){wn.w(this.TAG,"Flush Failed",R)}}},{key:"sendClientEventOnHTTP",value:function(e){var t,n,r,i,a=this.store.getRoom(),s=this.store.getLocalPeer();e.metadata.token=null==(t=this.store.getConfig())?void 0:t.authToken,e.metadata.peer={session_id:a.sessionId,room_id:a.id,room_name:a.name,template_id:a.templateId,joined_at:null==(n=a.joinedAt)?void 0:n.getTime(),session_started_at:null==(r=a.startedAt)?void 0:r.getTime(),role:null==(i=null==s?void 0:s.role)?void 0:i.name,user_name:null==s?void 0:s.name,user_data:null==s?void 0:s.metadata},Ai.sendEvent(e)}}]),e}(),_i={autoplayFailed:void 0,initialized:!1,autoplayCheckPromise:void 0},Di=function(){function e(t,n,r){var i=this;y(this,e),this.store=t,this.deviceManager=n,this.eventBus=r,this.autoPausedTracks=new Set,this.TAG="[AudioSinkManager]:",this.volume=100,this.state=ln({},_i),this.retryCountMapping=new Map,this.handleAudioPaused=function(e){return hn(i,null,c().mark((function t(){var n,r,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null==(r=null==(n=e.target.srcObject)?void 0:n.getAudioTracks()[0])?void 0:r.enabled){t.next=3;break}return t.abrupt("return");case 3:if(wn.d(this.TAG,"Audio Paused",e.target.id),i=this.store.getTrackById(e.target.id),t.t0=i,!t.t0){t.next=14;break}if("mobile"!==gn.getDevice().type){t.next=13;break}return t.next=10,Fr(500);case 10:this.playAudioFor(i),t.next=14;break;case 13:this.autoPausedTracks.add(i);case 14:case"end":return t.stop()}}),t,this)})))},this.handleTrackUpdate=function(e){var t=e.track;wn.d(i.TAG,"Track updated","".concat(t))},this.handleTrackAdd=function(e){return hn(i,[e],c().mark((function e(t){var n,r,i,a,s,o,u,l,d=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.track,r=t.peer,i=t.callListener,a=void 0===i||i,null==(s=this.retryCountMapping.get(n.trackId))||!s){e.next=3;break}return e.abrupt("return");case 3:return(l=document.createElement("audio")).style.display="none",l.id=n.trackId,l.addEventListener("pause",this.handleAudioPaused),l.onerror=function(){var e,t;wn.e(d.TAG,"error on audio element",l.error);var i=er.AudioPlaybackError("Audio playback error for track - ".concat(n.trackId));d.eventBus.analytics.publish(Vn.audioPlaybackError(i)),(null==(e=null==l?void 0:l.error)?void 0:e.code)===MediaError.MEDIA_ERR_DECODE&&(d.removeAudioElement(l,n),d.retryCountMapping.set(n.trackId,(null!=(t=d.retryCountMapping.get(n.trackId))?t:0)+1),d.handleTrackAdd({track:n,peer:r,callListener:!1}))},n.setAudioElement(l),n.setVolume(this.volume),wn.d(this.TAG,"Audio track added","".concat(n)),e.next=13,this.init();case 13:if(null==(o=this.audioSink)||o.append(l),e.t0=this.outputDevice,!e.t0){e.next=18;break}return e.next=18,n.setOutputDevice(this.outputDevice);case 18:return l.srcObject=new MediaStream([n.nativeTrack]),a&&(null==(u=this.listener)||u.onTrackUpdate(Jn.TRACK_ADDED,n,r)),e.next=22,this.handleAutoplayError(n);case 22:case"end":return e.stop()}}),e,this)})))},this.handleAutoplayError=function(e){return hn(i,null,c().mark((function t(){var n=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=void 0===this.state.autoplayFailed,!t.t0){t.next=5;break}return this.state.autoplayCheckPromise||(this.state.autoplayCheckPromise=new Promise((function(t){n.playAudioFor(e).then(t)}))),t.next=5,this.state.autoplayCheckPromise;case 5:if(!this.state.autoplayFailed){t.next=8;break}return this.autoPausedTracks.add(e),t.abrupt("return");case 8:return t.next=10,this.playAudioFor(e);case 10:case"end":return t.stop()}}),t,this)})))},this.handleAudioDeviceChange=function(e){e.error||!e.selection||"video"===e.type||i.unpauseAudioTracks()},this.handleTrackRemove=function(e){i.autoPausedTracks.delete(e);var t=document.getElementById(e.trackId);t&&i.removeAudioElement(t,e),i.audioSink&&0===i.audioSink.childElementCount&&(i.state.autoplayCheckPromise=void 0,i.state.autoplayFailed=void 0),wn.d(i.TAG,"Audio track removed","".concat(e))},this.unpauseAudioTracks=function(){return hn(i,null,c().mark((function e(){var t,n=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],this.autoPausedTracks.forEach((function(e){t.push(n.playAudioFor(e))})),e.next=4,Promise.all(t);case 4:case"end":return e.stop()}}),e,this)})))},this.removeAudioElement=function(e,t){e&&(e.removeEventListener("pause",i.handleAudioPaused),e.srcObject=null,e.remove(),t.setAudioElement(null))},this.eventBus.audioTrackAdded.subscribe(this.handleTrackAdd),this.eventBus.audioTrackRemoved.subscribe(this.handleTrackRemove),this.eventBus.audioTrackUpdate.subscribe(this.handleTrackUpdate),this.eventBus.deviceChange.subscribe(this.handleAudioDeviceChange)}return k(e,[{key:"setListener",value:function(e){this.listener=e}},{key:"outputDevice",get:function(){return this.deviceManager.outputDevice}},{key:"getVolume",value:function(){return this.volume}},{key:"setVolume",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.store.updateAudioOutputVolume(e);case 2:this.volume=e;case 3:case"end":return t.stop()}}),t,this)})))}},{key:"unblockAutoplay",value:function(){return hn(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.autoPausedTracks.size>0&&this.unpauseAudioTracks();case 1:case"end":return e.stop()}}),e,this)})))}},{key:"init",value:function(e){if(!this.state.initialized){this.state.initialized=!0;var t=document.createElement("div");t.id="HMS-SDK-audio-sink-".concat(Xt()),(e&&document.getElementById(e)||document.body).append(t),this.audioSink=t}}},{key:"cleanUp",value:function(){var e;null==(e=this.audioSink)||e.remove(),this.audioSink=void 0,this.retryCountMapping.clear(),this.eventBus.audioTrackAdded.unsubscribe(this.handleTrackAdd),this.eventBus.audioTrackRemoved.unsubscribe(this.handleTrackRemove),this.eventBus.audioTrackUpdate.unsubscribe(this.handleTrackUpdate),this.eventBus.deviceChange.unsubscribe(this.handleAudioDeviceChange),this.autoPausedTracks=new Set,this.state=ln({},_i)}},{key:"playAudioFor",value:function(e){return hn(this,null,c().mark((function t(){var n,r,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.getAudioElement()){t.next=4;break}return wn.w(this.TAG,"No audio element found on track",e.trackId),t.abrupt("return");case 4:return t.prev=4,t.next=7,n.play();case 7:this.state.autoplayFailed=!1,this.autoPausedTracks.delete(e),wn.d(this.TAG,"Played track","".concat(e)),t.next=17;break;case 12:t.prev=12,t.t0=t.catch(4),this.autoPausedTracks.add(e),wn.e(this.TAG,"Failed to play track","".concat(e),t.t0),r=t.t0,this.state.autoplayFailed||"NotAllowedError"!==r.name||(this.state.autoplayFailed=!0,(i=er.AutoplayBlocked(Kn.AUTOPLAY,"")).addNativeError(r),this.eventBus.analytics.publish(Vn.autoplayError()),this.eventBus.autoplayError.publish(i));case 17:case"end":return t.stop()}}),t,this,[[4,12]])})))}}]),e}(),Li=function(){function e(t,n){var r=this;y(this,e),this.store=t,this.eventBus=n,this.audioInput=[],this.audioOutput=[],this.videoInput=[],this.hasWebcamPermission=!1,this.hasMicrophonePermission=!1,this.TAG="[Device Manager]:",this.initialized=!1,this.videoInputChanged=!1,this.audioInputChanged=!1,this.updateOutputDevice=function(e){return hn(r,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.audioOutput.find((function(t){return t.deviceId===e})),t.t0=n,!t.t0){t.next=7;break}return this.outputDevice=n,t.next=6,this.store.updateAudioOutputDevice(n);case 6:Ar.updateSelection("audioOutput",{deviceId:n.deviceId,groupId:n.groupId});case 7:return t.abrupt("return",n);case 8:case"end":return t.stop()}}),t,this)})))},this.getCurrentSelection=function(){var e,t,n=r.store.getLocalPeer(),i=r.createIdentifier(null==(e=null==n?void 0:n.audioTrack)?void 0:e.getMediaTrackSettings()),a=r.createIdentifier(null==(t=null==n?void 0:n.videoTrack)?void 0:t.getMediaTrackSettings()),s=r.audioInput.find((function(e){return r.createIdentifier(e)===i})),o=r.videoInput.find((function(e){return r.createIdentifier(e)===a}));return{audioInput:s,videoInput:o,audioOutput:r.outputDevice}},this.computeChange=function(e,t){return e.length!==t.length||t.some((function(t){return!e.includes(r.createIdentifier(t))}))},this.enumerateDevices=function(){return hn(r,null,c().mark((function e(){var t,n,r,i=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.enumerateDevices();case 3:t=e.sent,n=this.videoInput.map(this.createIdentifier),r=this.audioInput.map(this.createIdentifier),this.audioInput=[],this.audioOutput=[],this.videoInput=[],t.forEach((function(e){"audioinput"===e.kind&&e.label?(i.hasMicrophonePermission=!0,i.audioInput.push(e)):"audiooutput"===e.kind?i.audioOutput.push(e):"videoinput"===e.kind&&e.label&&(i.hasWebcamPermission=!0,i.videoInput.push(e))})),this.videoInputChanged=this.computeChange(n,this.videoInput),this.audioInputChanged=this.computeChange(r,this.audioInput),Ar.setDevices({videoInput:T(this.videoInput),audioInput:T(this.audioInput),audioOutput:T(this.audioOutput)}),this.logDevices("Enumerate Devices"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),wn.e(this.TAG,"Failed enumerating devices",e.t0);case 12:case"end":return e.stop()}}),e,this,[[0,9]])})))},this.handleDeviceChange=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;return function(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];clearTimeout(t),t=void 0;var s=this;t=setTimeout((function(){e.apply(s,i)}),n)}}((function(){return hn(r,null,c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enumerateDevices();case 2:return this.logDevices("After Device Change"),t=this.store.getLocalPeer(),e.next=6,this.setOutputDevice(!0);case 6:return e.next=8,this.handleAudioInputDeviceChange(null==t?void 0:t.audioTrack);case 8:return e.next=10,this.handleVideoInputDeviceChange(null==t?void 0:t.videoTrack);case 10:this.eventBus.analytics.publish(Vn.deviceChange({selection:this.getCurrentSelection(),type:"change",devices:this.getDevices()}));case 11:case"end":return e.stop()}}),e,this)})))}),500).bind(this),this.handleAudioInputDeviceChange=function(e){return hn(r,null,c().mark((function t(){var n,r,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=3;break}return wn.d(this.TAG,"No Audio track on local peer"),t.abrupt("return");case 3:if(this.audioInputChanged){t.next=6;break}return wn.d(this.TAG,"No Change in AudioInput Device"),t.abrupt("return");case 6:if((n=this.getNewAudioInputDevice())&&n.deviceId){t.next=10;break}return this.eventBus.analytics.publish(Vn.deviceChange({selection:{audioInput:n},error:new Error("Audio device not found"),devices:this.getDevices(),type:"audioInput"})),wn.w(this.TAG,"Audio device not found"),t.abrupt("return");case 10:return r=e.settings,i=(new pr).codec(r.codec).maxBitrate(r.maxBitrate).deviceId(n.deviceId).build(),t.prev=11,t.next=14,e.setSettings(i,!0);case 14:this.eventBus.deviceChange.publish({devices:this.getDevices(),selection:n,type:"audioInput"}),this.logDevices("Audio Device Change Success"),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),wn.e(this.TAG,"[Audio Device Change]",t.t0),this.eventBus.analytics.publish(Vn.deviceChange({selection:{audioInput:n},devices:this.getDevices(),type:"audioInput",error:t.t0})),this.eventBus.deviceChange.publish({error:t.t0,selection:n,type:"audioInput",devices:this.getDevices()});case 21:case"end":return t.stop()}}),t,this,[[11,18]])})))},this.handleVideoInputDeviceChange=function(e){return hn(r,null,c().mark((function t(){var n,r,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=3;break}return wn.d(this.TAG,"No video track on local peer"),t.abrupt("return");case 3:if(this.videoInputChanged){t.next=6;break}return wn.d(this.TAG,"No Change in VideoInput Device"),t.abrupt("return");case 6:if((n=this.videoInput[0])&&n.deviceId){t.next=10;break}return this.eventBus.analytics.publish(Vn.deviceChange({selection:{videoInput:n},error:new Error("Video device not found"),devices:this.getDevices(),type:"video"})),wn.w(this.TAG,"Video device not found"),t.abrupt("return");case 10:return r=e.settings,i=(new gr).codec(r.codec).maxBitrate(r.maxBitrate).maxFramerate(r.maxFramerate).setWidth(r.width).setHeight(r.height).deviceId(n.deviceId).build(),t.prev=11,t.next=14,e.setSettings(i,!0);case 14:this.eventBus.deviceChange.publish({devices:this.getDevices(),selection:n,type:"video"}),this.logDevices("Video Device Change Success"),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),wn.e(this.TAG,"[Video Device Change]",t.t0),this.eventBus.analytics.publish(Vn.deviceChange({selection:{videoInput:n},devices:this.getDevices(),type:"video",error:t.t0})),this.eventBus.deviceChange.publish({error:t.t0,type:"video",selection:n,devices:this.getDevices()});case 21:case"end":return t.stop()}}),t,this,[[11,18]])})))};var i=function(e){var t=e.enabled,n=e.track;return t&&"regular"===n.source};this.eventBus.localVideoEnabled.waitFor(i).then((function(){return hn(r,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enumerateDevices();case 2:this.videoInputChanged&&this.eventBus.deviceChange.publish({devices:this.getDevices()});case 3:case"end":return e.stop()}}),e,this)})))})),this.eventBus.localAudioEnabled.waitFor(i).then((function(){return hn(r,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enumerateDevices();case 2:this.audioInputChanged&&this.eventBus.deviceChange.publish({devices:this.getDevices()});case 3:case"end":return e.stop()}}),e,this)})))}))}return k(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=this.initialized&&!e,t.t0){t.next=11;break}return!this.initialized&&navigator.mediaDevices.addEventListener("devicechange",this.handleDeviceChange),this.initialized=!0,t.next=6,this.enumerateDevices();case 6:return this.logDevices("Init"),t.next=9,this.setOutputDevice();case 9:this.eventBus.deviceChange.publish({devices:this.getDevices()}),this.eventBus.analytics.publish(Vn.deviceChange({selection:this.getCurrentSelection(),type:"list",devices:this.getDevices()}));case 11:case"end":return t.stop()}}),t,this)})))}},{key:"getDevices",value:function(){return{audioInput:this.audioInput,audioOutput:this.audioOutput,videoInput:this.videoInput}}},{key:"cleanUp",value:function(){this.initialized=!1,this.audioInput=[],this.audioOutput=[],this.videoInput=[],this.outputDevice=void 0,navigator.mediaDevices.removeEventListener("devicechange",this.handleDeviceChange)}},{key:"createIdentifier",value:function(e){return e?"".concat(e.deviceId).concat(e.groupId):""}},{key:"getNewAudioInputDevice",value:function(){var e=this.audioInput.find((function(e){return"default"===e.deviceId}));return e?this.audioInput.find((function(t){return t.label!==e.label&&e.label.includes(t.label)})):this.audioInput[0]}},{key:"setOutputDevice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return hn(this,null,c().mark((function t(){var n,r,i=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.getNewAudioInputDevice(),r=this.createIdentifier(this.outputDevice),this.outputDevice=this.getAudioOutputDeviceMatchingInput(n),this.outputDevice||(this.outputDevice=this.audioOutput.find((function(e){return i.createIdentifier(e)===r})),this.outputDevice||(this.outputDevice=this.audioOutput.find((function(e){return"default"===e.deviceId}))||this.audioOutput[0])),t.next=5,this.store.updateAudioOutputDevice(this.outputDevice);case 5:e&&r!==this.createIdentifier(this.outputDevice)&&(this.eventBus.analytics.publish(Vn.deviceChange({selection:{audioOutput:this.outputDevice},devices:this.getDevices(),type:"audioOutput"})),this.eventBus.deviceChange.publish({selection:this.outputDevice,type:"audioOutput",devices:this.getDevices()}));case 6:case"end":return t.stop()}}),t,this)})))}},{key:"getAudioOutputDeviceMatchingInput",value:function(e){var t,n,r=(null==(n=null==(t=this.store.getConfig())?void 0:t.settings)?void 0:n.speakerAutoSelectionBlacklist)||[];if("all"!==r){var i=(null==e?void 0:e.label.toLowerCase())||"";return!r.some((function(e){return i.includes(e.toLowerCase())}))&&(null==e?void 0:e.groupId)?this.audioOutput.find((function(t){return"default"!==e.deviceId&&t.label===e.label})):void 0}}},{key:"logDevices",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";wn.d(this.TAG,e,JSON.stringify({videoInput:T(this.videoInput),audioInput:T(this.audioInput),audioOutput:T(this.audioOutput),selected:this.getCurrentSelection()},null,4))}}]),e}(),Oi=function(){function e(t,n){y(this,e),this.deviceManager=t,this.audioSinkManager=n}return k(e,[{key:"getVolume",value:function(){return this.audioSinkManager.getVolume()}},{key:"setVolume",value:function(e){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");this.audioSinkManager.setVolume(e)}},{key:"getDevice",value:function(){return this.deviceManager.outputDevice}},{key:"setDevice",value:function(e){return this.deviceManager.updateOutputDevice(e)}},{key:"unblockAutoplay",value:function(){return hn(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.audioSinkManager.unblockAutoplay();case 2:return e.next=4,Mr.resumeContext();case 4:case"end":return e.stop()}}),e,this)})))}}]),e}(),Mi=k((function e(t,n){var r=this;y(this,e),this.eventName=t,this.eventEmitter=n,this.publish=function(e){r.eventEmitter.emit(r.eventName,e)},this.subscribe=function(e){r.eventEmitter.on(r.eventName,e)},this.subscribeOnce=function(e){r.eventEmitter.once(r.eventName,e)},this.unsubscribe=function(e){r.eventEmitter.off(r.eventName,e)},this.waitFor=function(e){return r.eventEmitter.waitFor(r.eventName,{filter:e})},this.removeAllListeners=function(){r.eventEmitter.removeAllListeners(r.eventName)}})),Ni=k((function e(){y(this,e),this.eventEmitter=new Zt.EventEmitter2,this.deviceChange=new Mi(ti,this.eventEmitter),this.localAudioEnabled=new Mi(ni,this.eventEmitter),this.localVideoEnabled=new Mi(ri,this.eventEmitter),this.statsUpdate=new Mi(ii,this.eventEmitter),this.trackDegraded=new Mi(ai,this.eventEmitter),this.trackRestored=new Mi(si,this.eventEmitter),this.trackAudioLevelUpdate=new Mi(oi,this.eventEmitter),this.audioPluginFailed=new Mi(li,this.eventEmitter),this.localAudioSilence=new Mi(ui,this.eventEmitter),this.analytics=new Mi(ci,this.eventEmitter),this.policyChange=new Mi(di,this.eventEmitter),this.localRoleUpdate=new Mi(fi,this.eventEmitter),this.audioTrackUpdate=new Mi(hi,this.eventEmitter),this.audioTrackAdded=new Mi(pi,this.eventEmitter),this.audioTrackRemoved=new Mi(vi,this.eventEmitter),this.autoplayError=new Mi(gi,this.eventEmitter),this.leave=new Mi(mi,this.eventEmitter)})),Fi=function(){function e(t,n,r){y(this,e),this.store=t,this.listener=n,this.audioListener=r}return k(e,[{key:"handleActiveSpeakers",value:function(e){var t,n,r,i=this,a=e["speaker-list"],s=a.map((function(e){return{audioLevel:e.level,peer:i.store.getPeerById(e.peer_id),track:i.store.getTrackById(e.track_id)}}));null==(t=this.audioListener)||t.onAudioLevelUpdate(s),this.store.updateSpeakers(s);var o=a[0];if(o){var u=this.store.getPeerById(o.peer_id);null==(n=this.listener)||n.onPeerUpdate(Qn.BECAME_DOMINANT_SPEAKER,u)}else null==(r=this.listener)||r.onPeerUpdate(Qn.RESIGNED_DOMINANT_SPEAKER,null)}}]),e}();!function(e){e.ROOM_STATE="room-state",e.PEER_JOIN="on-peer-join",e.PEER_LEAVE="on-peer-leave",e.PEER_LIST="peer-list",e.TRACK_METADATA_ADD="on-track-add",e.TRACK_UPDATE="on-track-update",e.CHANGE_TRACK_MUTE_STATE_UPDATE="on-change-track-mute-state-request",e.ACTIVE_SPEAKERS="active-speakers",e.CONNECTION_QUALITY="on-connection-quality-update",e.SFU_STATS="sfu-stats",e.ON_SFU_TRACK_LAYER_UPDATE="on-track-layer-update",e.BROADCAST="on-broadcast",e.ROLE_CHANGE="on-role-change",e.POLICY_CHANGE="on-policy-change",e.ROLE_CHANGE_REQUEST="on-role-change-request",e.TRACK_UPDATE_REQUEST="on-track-update-request",e.PEER_UPDATE="on-peer-update",e.PEER_LEAVE_REQUEST="on-peer-leave-request",e.UNSUPPORTED="unsupported",e.RTMP_START="on-rtmp-start",e.RTMP_STOP="on-rtmp-stop",e.RECORDING_START="on-record-start",e.RECORDING_STOP="on-record-stop",e.HLS_START="on-hls-start",e.HLS_STOP="on-hls-stop"}(Jr||(Jr={}));var Ui,Bi=function(){function e(t,n){y(this,e),this.store=t,this.listener=n,this.TAG="[BroadcastManager]"}return k(e,[{key:"handleNotification",value:function(e,t){e===Jr.BROADCAST&&this.handleBroadcast(t)}},{key:"handleBroadcast",value:function(e){var t,n=e.peer,r=e.info,i=e.roles,a=this.getSender(n),s=e.private?this.store.getLocalPeer():void 0,o=[];if(null==i?void 0:i.length){var u,c=this.store.getKnownRoles(),l=S(i);try{for(l.s();!(u=l.n()).done;){var d=u.value;c[d]&&o.push(c[d])}}catch(h){l.e(h)}finally{l.f()}}var f=new xn(dn(ln({},r),{sender:a,recipientRoles:o,recipientPeer:s,time:new Date(e.timestamp)}));wn.d(this.TAG,"Received Message from sender=".concat(null==n?void 0:n.peer_id,": ").concat(f)),null==(t=this.listener)||t.onMessageReceived(f)}},{key:"getSender",value:function(e){var t=e?this.store.getPeerById(e.peer_id):void 0;return!t&&e&&(t=new Cn({peerId:e.peer_id,name:e.info.name,isLocal:!1,customerUserId:e.info.user_id,metadata:e.info.data})),t}}]),e}(),ji=function(){function e(t){y(this,e),this.listener=t}return k(e,[{key:"handleQualityUpdate",value:function(e){var t,n=e.peers.map((function(e){return{peerID:e.peer_id,downlinkQuality:e.downlink_score}}));null==(t=this.listener)||t.onConnectionQualityUpdate(n)}}]),e}(),Gi=function(){function e(t,n,r,i){var a=this;y(this,e),this.store=t,this.peerManager=n,this.trackManager=r,this.listener=i,this.TAG="[PeerListManager]",this.handleInitialPeerList=function(e){var t=Object.values(e.peers);a.peerManager.handlePeerList(t)},this.handleReconnectPeerList=function(e){a.handleRepeatedPeerList(e.peers)},this.handlePreviewRoomState=function(e){if(a.store.hasRoleDetailsArrived()){var t=e.peers;null!=t?(Object.keys(t).forEach((function(e){t[e].tracks={},t[e].is_from_room_state=!0})),a.handleRepeatedPeerList(t)):0===e.peer_count&&a.handleRepeatedPeerList({})}},this.handleRepeatedPeerList=function(e){var t=a.store.getRemotePeers(),n=Object.values(e),r=t.filter((function(t){return!e[t.peerId]}));r.length>0&&wn.d(a.TAG,"".concat(r)),r.forEach((function(e){var t,n={peer_id:e.peerId,role:(null==(t=e.role)?void 0:t.name)||"",info:{name:e.name,data:e.metadata||"",user_id:e.customerUserId||""},tracks:{}};a.peerManager.handlePeerLeave(n)})),n.forEach((function(e){var t=a.store.getPeerById(e.peer_id),n=Object.values(e.tracks);t?(a.store.getPeerTracks(t.peerId).forEach((function(n){var r;e.tracks[n.trackId]||(a.removePeerTrack(t,n.trackId),null==(r=a.listener)||r.onTrackUpdate(Jn.TRACK_REMOVED,n,t))})),n.forEach((function(e){a.store.getTrackById(e.track_id)||a.store.setTrackState({peerId:t.peerId,trackInfo:e})})),a.trackManager.handleTrackUpdate({peer:{info:e.info,peer_id:e.peer_id},tracks:e.tracks}),a.peerManager.handlePeerUpdate(e)):a.peerManager.handlePeerJoin(e)}))}}return k(e,[{key:"handleNotification",value:function(e,t,n){if(e===Jr.PEER_LIST){var r=t;n?(wn.d(this.TAG,"RECONNECT_PEER_LIST event",JSON.stringify(r,null,2)),this.handleReconnectPeerList(r)):(wn.d(this.TAG,"PEER_LIST event",JSON.stringify(r,null,2)),this.handleInitialPeerList(r))}else if(e===Jr.ROOM_STATE){var i=t;this.handlePreviewRoomState(i)}}},{key:"removePeerTrack",value:function(e,t){var n,r;if(wn.d(this.TAG,"removing track - ".concat(t," from ").concat(e)),(null==(n=e.audioTrack)?void 0:n.trackId)===t)e.audioTrack=void 0;else if((null==(r=e.videoTrack)?void 0:r.trackId)===t)e.videoTrack=void 0;else{var i=e.auxiliaryTracks.findIndex((function(e){return e.trackId===t}));i>=0&&e.auxiliaryTracks.splice(i,1)}}}]),e}(),Vi=function(e){return e?new Date(e):void 0},Ki=function(){function e(t,n,r){var i=this;y(this,e),this.store=t,this.trackManager=n,this.listener=r,this.TAG="[PeerManager]",this.handlePeerList=function(e){var t,n;if(0!==e.length){var r=[],a=new Set(e.map((function(e){return e.peer_id})));i.store.getRemotePeers().forEach((function(e){var t=e.peerId,n=e.fromRoomState;!a.has(t)&&n&&i.store.removePeer(t)}));var s,o=S(e);try{for(o.s();!(s=o.n()).done;){var u=s.value;r.push(i.makePeer(u))}}catch(c){o.e(c)}finally{o.f()}null==(n=i.listener)||n.onPeerUpdate(Qn.PEER_LIST,r),i.trackManager.processPendingTracks()}else null==(t=i.listener)||t.onPeerUpdate(Qn.PEER_LIST,[])},this.handlePeerJoin=function(e){var t,n=i.makePeer(e);null==(t=i.listener)||t.onPeerUpdate(Qn.PEER_JOINED,n),i.trackManager.processPendingTracks()},this.handlePeerLeave=function(e){var t,n,r,a,s=i.store.getPeerById(e.peer_id);i.store.removePeer(e.peer_id),wn.d(i.TAG,"PEER_LEAVE",e.peer_id,"remainingPeers=".concat(i.store.getPeers().length)),s&&(s.audioTrack&&(null==(t=i.listener)||t.onTrackUpdate(Jn.TRACK_REMOVED,s.audioTrack,s)),s.videoTrack&&(null==(n=i.listener)||n.onTrackUpdate(Jn.TRACK_REMOVED,s.videoTrack,s)),null==(r=s.auxiliaryTracks)||r.forEach((function(e){var t;null==(t=i.listener)||t.onTrackUpdate(Jn.TRACK_REMOVED,e,s)})),null==(a=i.listener)||a.onPeerUpdate(Qn.PEER_LEFT,s))}}return k(e,[{key:"handleNotification",value:function(e,t){switch(e){case Jr.PEER_JOIN:var n=t;this.handlePeerJoin(n);break;case Jr.PEER_LEAVE:var r=t;this.handlePeerLeave(r);break;case Jr.PEER_UPDATE:this.handlePeerUpdate(t)}}},{key:"handlePeerUpdate",value:function(e){var t,n=this.store.getPeerById(e.peer_id);if(n){if(n.role&&n.role.name!==e.role){var r=this.store.getPolicyForRole(e.role);n.updateRole(r),null==(t=this.listener)||t.onPeerUpdate(Qn.ROLE_UPDATED,n)}this.handlePeerInfoUpdate(ln({peer:n},e.info))}}},{key:"handlePeerInfoUpdate",value:function(e){var t,n,r=e.peer,i=e.name,a=e.data;!r||(i&&r.name!==i&&(r.updateName(i),null==(t=this.listener)||t.onPeerUpdate(Qn.NAME_UPDATED,r)),a&&r.metadata!==a&&(r.updateMetadata(a),null==(n=this.listener)||n.onPeerUpdate(Qn.METADATA_UPDATED,r)))}},{key:"makePeer",value:function(e){var t=this.store.getPeerById(e.peer_id);for(var n in t||(t=new _n({peerId:e.peer_id,name:e.info.name,customerUserId:e.info.user_id,metadata:e.info.data,role:this.store.getPolicyForRole(e.role),joinedAt:Vi(e.joined_at),fromRoomState:!!e.is_from_room_state}),this.store.addPeer(t),wn.d(this.TAG,"adding to the peerList","".concat(t))),e.tracks)this.store.setTrackState({peerId:e.peer_id,trackInfo:e.tracks[n]});return t}}]),e}(),Hi=function(){function e(t,n){y(this,e),this.store=t,this.eventBus=n}return k(e,[{key:"handlePolicyChange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.store.getLocalPeer();if(n&&!n.role){var r=e.known_roles[e.name];n.updateRole(r)}if(this.store.setKnownRoles(e),this.store.getRoom().templateId=e.template_id,!t&&(null==n?void 0:n.role)&&n.role.name!==e.name){var i=this.store.getPolicyForRole(e.name),a=n.role;n.updateRole(i),this.eventBus.localRoleUpdate.publish({oldRole:a,newRole:i})}this.eventBus.policyChange.publish(e)}}]),e}(),zi=function(){function e(t,n){y(this,e),this.store=t,this.listener=n}return k(e,[{key:"handleNotification",value:function(e,t){switch(e){case Jr.ROLE_CHANGE_REQUEST:this.handleRoleChangeRequest(t);break;case Jr.TRACK_UPDATE_REQUEST:this.handleTrackUpdateRequest(t);break;case Jr.CHANGE_TRACK_MUTE_STATE_UPDATE:this.handleChangeTrackStateRequest(t);break;default:return}}},{key:"handleRoleChangeRequest",value:function(e){var t,n={requestedBy:e.requested_by?this.store.getPeerById(e.requested_by):void 0,role:this.store.getPolicyForRole(e.role),token:e.token};null==(t=this.listener)||t.onRoleChangeRequest(n)}},{key:"handleTrackUpdateRequest",value:function(e){var t=this,n=e.requested_by,r=e.track_id,i=e.mute,a=n?this.store.getPeerById(n):void 0,s=this.store.getLocalPeerTracks().find((function(e){return e.publishedTrackId===r}));if(s){var o=function(){var e;null==(e=t.listener)||e.onChangeTrackStateRequest({requestedBy:a,track:s,enabled:!i})};if(i){if(s.enabled===!i)return;s.setEnabled(!i).then(o)}else o()}}},{key:"handleChangeTrackStateRequest",value:function(e){var t,n=this,r=e.type,i=e.source,a=e.value,s=e.requested_by,o=s?this.store.getPeerById(s):void 0,u=!a,c=this.getTracksToBeUpdated({type:r,source:i,enabled:u});if(0!==c.length)if(u)null==(t=this.listener)||t.onChangeMultiTrackStateRequest({requestedBy:o,tracks:c,type:r,source:i,enabled:!0});else{var l,d=[],f=S(c);try{for(f.s();!(l=f.n()).done;){var h=l.value;d.push(h.setEnabled(!1))}}catch(p){f.e(p)}finally{f.f()}Promise.all(d).then((function(){var e;null==(e=n.listener)||e.onChangeMultiTrackStateRequest({requestedBy:o,tracks:c,enabled:!1})}))}}},{key:"getTracksToBeUpdated",value:function(e){var t=e.type,n=e.source,r=e.enabled,i=this.store.getLocalPeerTracks();return t&&(i=i.filter((function(e){return e.type===t}))),n&&(i=i.filter((function(e){return e.source===n}))),i.filter((function(e){return e.enabled!==r}))}}]),e}(),Wi=function(){function e(t,n){y(this,e),this.store=t,this.listener=n,this.TAG="[RoomUpdateManager]"}return k(e,[{key:"handleNotification",value:function(e,t){switch(e){case Jr.PEER_LIST:this.onRoomState(t.room);break;case Jr.RTMP_START:this.onRTMPStart(t);break;case Jr.RTMP_STOP:this.onRTMPStop(t);break;case Jr.RECORDING_START:this.onRecordingStart(t);break;case Jr.RECORDING_STOP:this.onRecordingStop(t);break;case Jr.ROOM_STATE:this.handlePreviewRoomState(t);break;default:this.onHLS(e,t)}}},{key:"handlePreviewRoomState",value:function(e){var t=e.room;this.onRoomState(t,e.peer_count)}},{key:"onRoomState",value:function(e,t){var n,r,i,a=e.recording,s=e.streaming,o=e.session_id,u=e.started_at,c=e.name,l=this.store.getRoom();l.peerCount=t,l.name=c,l.recording.server.running=!!(null==a?void 0:a.sfu.enabled),l.recording.browser.running=!!(null==a?void 0:a.browser.enabled),l.rtmp.running=!!(null==(n=null==s?void 0:s.rtmp)?void 0:n.enabled),l.rtmp.startedAt=Vi(null==(r=null==s?void 0:s.rtmp)?void 0:r.started_at),l.recording.server.startedAt=Vi(null==a?void 0:a.sfu.started_at),l.recording.browser.startedAt=Vi(null==a?void 0:a.browser.started_at),l.recording.hls=this.getPeerListHLSRecording(a),l.hls=this.convertHls(null==s?void 0:s.hls),l.sessionId=o,l.startedAt=Vi(u),null==(i=this.listener)||i.onRoomUpdate(Yn.RECORDING_STATE_UPDATED,l)}},{key:"onRTMPStart",value:function(e){var t;this.setRTMPStatus(!(null==(t=e.error)?void 0:t.code),e)}},{key:"onRTMPStop",value:function(e){this.setRTMPStatus(!1,e)}},{key:"onRecordingStart",value:function(e){var t;this.setRecordingStatus(!(null==(t=e.error)?void 0:t.code),e)}},{key:"onRecordingStop",value:function(e){this.setRecordingStatus(!1,e)}},{key:"onHLS",value:function(e,t){var n,r;if([Jr.HLS_START,Jr.HLS_STOP].includes(e)){var i=this.store.getRoom();t.enabled=e===Jr.HLS_START&&!(null==(n=t.error)?void 0:n.code),i.hls=this.convertHls(t),i.recording.hls=this.getHLSRecording(t),null==(r=this.listener)||r.onRoomUpdate(Yn.HLS_STREAMING_STATE_UPDATED,i)}}},{key:"convertHls",value:function(e){var t,n={running:!!(null==e?void 0:e.enabled),variants:[],error:this.toSdkError(null==e?void 0:e.error)};return null==(t=null==e?void 0:e.variants)||t.forEach((function(e){n.variants.push({meetingURL:e.meeting_url,url:e.url,metadata:e.metadata,startedAt:Vi(e.started_at)})})),n}},{key:"getHLSRecording",value:function(e){var t,n,r,i={running:!1};return(null==e?void 0:e.hls_recording)&&(i={running:!!(null==e?void 0:e.enabled),singleFilePerLayer:!!(null==(t=e.hls_recording)?void 0:t.single_file_per_layer),hlsVod:!!(null==(n=e.hls_recording)?void 0:n.hls_vod),startedAt:Vi(null==(r=null==e?void 0:e.variants)?void 0:r[0].started_at),error:this.toSdkError(e.error)}),i}},{key:"getPeerListHLSRecording",value:function(e){var t,n,r=null==e?void 0:e.hls;return{running:!!(null==r?void 0:r.enabled),startedAt:Vi(null==r?void 0:r.started_at),singleFilePerLayer:!!(null==(t=null==r?void 0:r.config)?void 0:t.single_file_per_layer),hlsVod:!!(null==(n=null==r?void 0:r.config)?void 0:n.hls_vod)}}},{key:"setRecordingStatus",value:function(e,t){var n,r,i=this.store.getRoom();"sfu"===t.type?(i.recording.server={running:e,startedAt:e?Vi(t.started_at):void 0,error:this.toSdkError(t.error)},r=Yn.SERVER_RECORDING_STATE_UPDATED):(i.recording.browser={running:e,startedAt:e?Vi(t.started_at):void 0,error:this.toSdkError(t.error)},r=Yn.BROWSER_RECORDING_STATE_UPDATED),null==(n=this.listener)||n.onRoomUpdate(r,i)}},{key:"setRTMPStatus",value:function(e,t){var n,r=this.store.getRoom();r.rtmp={running:e,startedAt:e?Vi(t.started_at):void 0,error:this.toSdkError(t.error)},null==(n=this.listener)||n.onRoomUpdate(Yn.RTMP_STREAMING_STATE_UPDATED,r)}},{key:"toSdkError",value:function(e){if(null==e?void 0:e.code){var t=e.message||"error in streaming/recording",n=new Gn(e.code,"ServerErrors",Kn.NONE,t,t);return wn.e(this.TAG,"error in streaming/recording",n),n}}}]),e}(),qi=function(){function e(t,n,r){var i=this;y(this,e),this.store=t,this.eventBus=n,this.listener=r,this.TAG="[TrackManager]",this.tracksToProcess=new Map,this.handleTrackAdd=function(e){wn.d(i.TAG,"ONTRACKADD","".concat(e)),i.store.addTrack(e),i.tracksToProcess.set(e.trackId,e),i.processPendingTracks()},this.handleTrackRemove=function(e){var t;wn.d(i.TAG,"ONTRACKREMOVE","".concat(e));var n=i.store.getTrackState(e.trackId);if(n){e.type===hr.AUDIO&&i.eventBus.audioTrackRemoved.publish(e),i.store.removeTrack(e.trackId);var r=i.store.getPeerById(n.peerId);!r||(i.removePeerTracks(r,e),null==(t=i.listener)||t.onTrackUpdate(Jn.TRACK_REMOVED,e,r))}},this.handleTrackLayerUpdate=function(e){for(var t in e.tracks){var n=e.tracks[t],r=i.store.getTrackById(t);!r||!i.store.getPeerByTrackId(t)||r instanceof yi&&i.setLayer(r,n)}},this.handleTrackUpdate=function(e){var t,n,r=i.store.getPeerById(e.peer.peer_id);if(r)for(var a in e.tracks){var s=Object.assign({},null==(t=i.store.getTrackState(a))?void 0:t.trackInfo),o=e.tracks[a],u=i.store.getTrackById(a);if(i.store.setTrackState({peerId:e.peer.peer_id,trackInfo:ln(ln({},s),o)}),!u||i.tracksToProcess.has(a))i.processPendingTracks();else{u.setEnabled(!o.mute);var c=i.processTrackUpdate(u,s,o);c&&(null==(n=i.listener)||n.onTrackUpdate(c,u,r))}}else wn.d(i.TAG,"Track Update ignored - Peer not added to store")}}return k(e,[{key:"handleTrackMetadataAdd",value:function(e){for(var t in wn.d(this.TAG,"TRACK_METADATA_ADD",JSON.stringify(e,null,2)),e.tracks)this.store.setTrackState({peerId:e.peer.peer_id,trackInfo:e.tracks[t]});this.processPendingTracks()}},{key:"processPendingTracks",value:function(){var e=this;new Map(this.tracksToProcess).forEach((function(t){var n,r=e.store.getTrackState(t.trackId);if(r){var i=e.store.getPeerById(r.peerId);i?(t.source=r.trackInfo.source,t.peerId=i.peerId,t.logIdentifier=i.name,t.setEnabled(!r.trackInfo.mute),e.addAudioTrack(i,t),e.addVideoTrack(i,t),t.type===hr.AUDIO?e.eventBus.audioTrackAdded.publish({track:t,peer:i}):null==(n=e.listener)||n.onTrackUpdate(Jn.TRACK_ADDED,t,i),e.tracksToProcess.delete(t.trackId)):wn.d(e.TAG,"Peer not added to store, peerId",r.peerId)}else wn.d(e.TAG,"TrackState not added to store","peerId - ".concat(t.peerId),"trackId -".concat(t.trackId))}))}},{key:"setLayer",value:function(e,t){var n,r,i=this.store.getPeerByTrackId(e.trackId);i&&(e.setLayerFromServer(t)?null==(n=this.listener)||n.onTrackUpdate(Jn.TRACK_DEGRADED,e,i):null==(r=this.listener)||r.onTrackUpdate(Jn.TRACK_RESTORED,e,i))}},{key:"removePeerTracks",value:function(e,t){var n,r,i=e.auxiliaryTracks.indexOf(t);i>-1?e.auxiliaryTracks.splice(i,1):t.type===hr.AUDIO&&(null==(n=e.audioTrack)?void 0:n.trackId)===t.trackId?e.audioTrack=void 0:t.type===hr.VIDEO&&(null==(r=e.videoTrack)?void 0:r.trackId)===t.trackId&&(e.videoTrack=void 0)}},{key:"addAudioTrack",value:function(e,t){t.type===hr.AUDIO&&(e.audioTrack||"regular"!==t.source?e.auxiliaryTracks.push(t):e.audioTrack=t)}},{key:"addVideoTrack",value:function(e,t){if(t.type===hr.VIDEO){var n=t,r=this.store.getSimulcastDefinitionsForPeer(e,n.source);n.setSimulcastDefinitons(r),e.videoTrack||"regular"!==t.source?e.auxiliaryTracks.push(n):e.videoTrack=n}}},{key:"processTrackUpdate",value:function(e,t,n){var r;return t.mute!==n.mute?(r=n.mute?Jn.TRACK_MUTED:Jn.TRACK_UNMUTED,e.type===hr.AUDIO&&this.eventBus.audioTrackUpdate.publish({track:e,enabled:!n.mute})):t.description!==n.description&&(r=Jn.TRACK_DESCRIPTION_CHANGED),r}}]),e}(),Yi=function(){function e(t,n,r,i,a){var s=this;y(this,e),this.store=t,this.listener=r,this.audioListener=i,this.connectionQualityListener=a,this.TAG="[HMSNotificationManager]",this.hasConsistentRoomStateArrived=!1,this.ignoreNotification=function(e){if(e===Jr.PEER_LIST)s.hasConsistentRoomStateArrived=!0;else if(e===Jr.ROOM_STATE)return s.hasConsistentRoomStateArrived;return!1},this.handleTrackAdd=function(e){s.trackManager.handleTrackAdd(e)},this.handleTrackRemove=function(e){s.trackManager.handleTrackRemove(e)},this.updateLocalPeer=function(e){var t=e.name,n=e.metadata,r=s.store.getLocalPeer();s.peerManager.handlePeerInfoUpdate({peer:r,name:t,data:n})},this.trackManager=new qi(this.store,n,this.listener),this.peerManager=new Ki(this.store,this.trackManager,this.listener),this.peerListManager=new Gi(this.store,this.peerManager,this.trackManager,this.listener),this.broadcastManager=new Bi(this.store,this.listener),this.policyChangeManager=new Hi(this.store,n),this.requestManager=new zi(this.store,this.listener),this.activeSpeakerManager=new Fi(this.store,this.listener,this.audioListener),this.connectionQualityManager=new ji(this.connectionQualityListener),this.roomUpdateManager=new Wi(this.store,this.listener)}return k(e,[{key:"setListener",value:function(e){this.listener=e,this.trackManager.listener=e,this.peerManager.listener=e,this.peerListManager.listener=e,this.broadcastManager.listener=e,this.requestManager.listener=e,this.activeSpeakerManager.listener=e,this.roomUpdateManager.listener=e}},{key:"setAudioListener",value:function(e){this.audioListener=e,this.activeSpeakerManager.audioListener=e}},{key:"setConnectionQualityListener",value:function(e){this.connectionQualityListener=e,this.connectionQualityManager.listener=e}},{key:"handleNotification",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=e.method,s=e.params;[Jr.ACTIVE_SPEAKERS,Jr.SFU_STATS,Jr.CONNECTION_QUALITY,void 0].includes(a)||wn.d(this.TAG,"Received notification - ".concat(a),{notification:s}),a===Jr.SFU_STATS&&(null==(t=window.HMS)?void 0:t.ON_SFU_STATS)&&"function"==typeof(null==(n=window.HMS)?void 0:n.ON_SFU_STATS)&&window.HMS.ON_SFU_STATS(e.params),!this.ignoreNotification(a)&&(this.roomUpdateManager.handleNotification(a,s),this.peerManager.handleNotification(a,s),this.requestManager.handleNotification(a,s),this.peerListManager.handleNotification(a,s,r),this.broadcastManager.handleNotification(a,s),this.handleIsolatedMethods(a,s,i))}},{key:"handleIsolatedMethods",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];switch(e){case Jr.TRACK_METADATA_ADD:this.trackManager.handleTrackMetadataAdd(t);break;case Jr.TRACK_UPDATE:this.trackManager.handleTrackUpdate(t);break;case Jr.ON_SFU_TRACK_LAYER_UPDATE:this.trackManager.handleTrackLayerUpdate(t);break;case Jr.ACTIVE_SPEAKERS:this.activeSpeakerManager.handleActiveSpeakers(t);break;case Jr.CONNECTION_QUALITY:this.connectionQualityManager.handleQualityUpdate(t);break;case Jr.POLICY_CHANGE:this.policyChangeManager.handlePolicyChange(t,n)}}}]),e}(),Qi=k((function e(t){y(this,e),this.type=t.type,this.source=t.source||"regular",this.description="",t instanceof Er?(this.mute=!t.enabled,this.track_id=t.publishedTrackId,this.stream_id=t.stream.id):(this.mute=t.mute,this.track_id=t.track_id,this.stream_id=t.stream_id)})),Ji=function(){function e(t){y(this,e),this.TAG="[AudioContextManager]",this.audioContext=new AudioContext,this.source=this.audioContext.createMediaElementSource(t),this.source.connect(this.audioContext.destination)}return k(e,[{key:"resumeContext",value:function(){"suspended"===this.audioContext.state&&(wn.d(this.TAG,"AudioContext is resumed"),this.audioContext.resume())}},{key:"getAudioTrack",value:function(){return this.destinationNode&&this.source.disconnect(this.destinationNode),this.destinationNode=this.audioContext.createMediaStreamDestination(),this.source.connect(this.destinationNode),this.destinationNode.stream.getAudioTracks()[0]}},{key:"cleanup",value:function(){"closed"!==this.audioContext.state&&this.audioContext.close()}}]),e}(),$i=function(e){Le(n,e);var t=Me(n);function n(){return y(this,n),t.apply(this,arguments)}return k(n,[{key:"on",value:function(e,t){return Ce(xe(n.prototype),"on",this).call(this,e,t)}},{key:"off",value:function(e,t){return Ce(xe(n.prototype),"off",this).call(this,e,t)}},{key:"emit",value:function(e,t){return Ce(xe(n.prototype),"emit",this).call(this,e,t)}},{key:"listeners",value:function(e){return Ce(xe(n.prototype),"listeners",this).call(this,e)}}]),n}(Zt.EventEmitter2),Xi=function(e){Le(n,e);var t=Me(n);function n(){var e;return y(this,n),(e=t.apply(this,arguments)).audioElement=null,e.TAG="[PlaylistAudioManager]",e.seeked=!1,e}return k(n,[{key:"play",value:function(e){return hn(this,null,c().mark((function t(){var n=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(this.audioElement=this.getAudioElement(),new Promise((function(t,r){n.audioElement=n.getAudioElement(),n.audioElement.src=e,n.seeked=!1,n.audioElement.onerror=function(){var t="Error loading ".concat(e);wn.e(n.TAG,t),n.stop(),r(t)},n.audioElement.oncanplaythrough=function(){return hn(n,null,c().mark((function n(){var i;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,this.audioElement){n.next=3;break}return n.abrupt("return");case 3:if(this.audioContextManager.resumeContext(),!this.track){n.next=13;break}if(!this.seeked){n.next=8;break}this.seeked=!1,n.next=11;break;case 8:return n.next=10,this.audioElement.play();case 10:t([this.track]);case 11:n.next=17;break;case 13:return n.next=15,this.audioElement.play();case 15:i=this.audioContextManager.getAudioTrack(),this.track=i,t([i]);case 17:n.next=22;break;case 19:n.prev=19,n.t0=n.catch(0),wn.e(this.TAG,"Error playing audio",e,n.t0.message),r(n.t0);case 22:case"end":return n.stop()}}),n,this,[[0,19]])})))},n.audioElement.onseeked=function(){n.seeked=!0}}))));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"getTracks",value:function(){return this.track?[this.track.id]:[]}},{key:"getElement",value:function(){return this.audioElement}},{key:"stop",value:function(){var e,t,n;null==(e=this.audioElement)||e.pause(),null==(t=this.audioElement)||t.removeAttribute("src"),this.audioElement=null,null==(n=this.audioContextManager)||n.cleanup(),this.track=void 0}},{key:"getAudioElement",value:function(){var e=this;if(this.audioElement)return this.audioElement;var t=document.createElement("audio");return t.crossOrigin="anonymous",t.addEventListener("timeupdate",(function(t){return e.emit("progress",t)})),t.addEventListener("ended",(function(){e.emit("ended",null)})),this.audioContextManager=new Ji(t),t}}]),n}($i),Zi=function(e){Le(n,e);var t=Me(n);function n(){var e;return y(this,n),(e=t.apply(this,arguments)).TAG="[PlaylistVideoManager]",e.videoElement=null,e.canvasContext=null,e.tracks=[],e.DEFAUL_FPS=24,e.seeked=!1,e.drawImage=function(){var t,n,r;e.videoElement&&!e.videoElement.paused&&!e.videoElement.ended&&(null==(r=e.canvasContext)||r.drawImage(e.videoElement,0,0,null==(t=e.canvas)?void 0:t.width,null==(n=e.canvas)?void 0:n.height),e.timer=setTimeout((function(){e.drawImage()}),1e3/e.DEFAUL_FPS))},e}return k(n,[{key:"play",value:function(e){var t=this;return this.videoElement=this.getVideoElement(),this.createCanvas(),new Promise((function(n,r){t.videoElement=t.getVideoElement(),t.videoElement.src=e,t.seeked=!1,t.videoElement.onerror=function(){var n="Error loading ".concat(e);wn.e(t.TAG,n),t.stop(),r(n)},t.videoElement.oncanplaythrough=function(){return hn(t,null,c().mark((function t(){var i,a,s,o,u,l=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.videoElement){t.next=3;break}return t.abrupt("return");case 3:if(this.canvas.width=this.videoElement.videoWidth,this.canvas.height=this.videoElement.videoHeight,0!==this.tracks.length){t.next=17;break}if(this.clearCanvasAndTracks(),o=this.canvas.captureStream()){t.next=9;break}return wn.e(this.TAG,"Browser does not support captureStream"),t.abrupt("return");case 9:return this.videoElement.onplay=this.drawImage,this.audioContextManager.resumeContext(),t.next=13,this.videoElement.play();case 13:u=this.audioContextManager.getAudioTrack(),o.addTrack(u),o.getTracks().forEach((function(e){l.tracks.push(e)})),n(this.tracks),t.next=24;break;case 17:if(!this.seeked){t.next=21;break}this.seeked=!1,null==(s=this.canvasContext)||s.drawImage(this.videoElement,0,0,null==(i=this.canvas)?void 0:i.width,null==(a=this.canvas)?void 0:a.height),t.next=24;break;case 21:return t.next=23,this.videoElement.play();case 23:n(this.tracks);case 24:t.next=29;break;case 26:t.prev=26,t.t0=t.catch(0),wn.e(this.TAG,"Error playing video",e,t.t0.message),r(t.t0);case 29:case"end":return t.stop()}}),t,this,[[0,26]])})))},t.videoElement.onseeked=function(){t.seeked=!0}}))}},{key:"getTracks",value:function(){return this.tracks.map((function(e){return e.id}))}},{key:"getElement",value:function(){return this.videoElement}},{key:"stop",value:function(){var e,t,n;null==(e=this.videoElement)||e.pause(),null==(t=this.videoElement)||t.removeAttribute("src"),this.videoElement=null,null==(n=this.audioContextManager)||n.cleanup(),this.clearCanvasAndTracks()}},{key:"clearCanvasAndTracks",value:function(){var e;this.tracks=[],null==(e=this.canvasContext)||e.clearRect(0,0,this.canvas.width,this.canvas.height),clearTimeout(this.timer)}},{key:"getVideoElement",value:function(){var e=this;if(this.videoElement)return this.videoElement;var t=document.createElement("video");return t.crossOrigin="anonymous",t.addEventListener("timeupdate",(function(t){return e.emit("progress",t)})),t.addEventListener("ended",(function(){e.emit("ended",null)})),this.audioContextManager=new Ji(t),t}},{key:"createCanvas",value:function(){this.canvas||(this.canvas=document.createElement("canvas"),this.canvasContext=this.canvas.getContext("2d"))}}]),n}($i),ea={list:[],currentIndex:-1,isAutoplayOn:!0},ta={list:[],currentIndex:-1,isAutoplayOn:!0},na=function(e){Le(n,e);var t=Me(n);function n(e,r){var i;return y(this,n),(i=t.call(this)).sdk=e,i.eventBus=r,i.state={audio:ln({},ea),video:ln({},ta)},i.TAG="[PlaylistManager]",i.handlePausePlaylist=function(e){return hn(Ae(i),[e],c().mark((function e(t){var n,r,i,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.enabled,r=t.track,!n){e.next=3;break}return e.abrupt("return");case 3:"audioplaylist"===r.source&&(a=dr.audio),"videoplaylist"===r.source&&(a=dr.video),a&&(null==(i=this.getElement(a))||i.pause());case 4:case"end":return e.stop()}}),e,this)})))},i.addTrack=function(e,t){return hn(Ae(i),null,c().mark((function n(){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.sdk.addTrack(e,t);case 2:wn.d(this.TAG,"Playlist track added",Tr(e));case 3:case"end":return n.stop()}}),n,this)})))},i.removeTrack=function(e){return hn(Ae(i),null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.removeTrack(e);case 2:wn.d(this.TAG,"Playlist track removed",e);case 3:case"end":return t.stop()}}),t,this)})))},i.audioManager=new Xi,i.videoManager=new Zi,i.addListeners(),i}return k(n,[{key:"getList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dr.audio;return this.state[e].list}},{key:"setList",value:function(e){var t=this;e&&0!==e.length?e.forEach((function(e){t.state[e.type].list.includes(e)||t.state[e.type].list.push(e)})):wn.w(this.TAG,"Please pass in a list of HMSPlaylistItem's")}},{key:"clearList",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=this.isPlaying(e),!t.t0){t.next=4;break}return t.next=4,this.stop(e);case 4:this.state[e].list=[];case 5:case"end":return t.stop()}}),t,this)})))}},{key:"removeItem",value:function(e,t){return hn(this,null,c().mark((function n(){var r,i,a,s;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=this.state[t],i=r.list,a=r.currentIndex,s=i.findIndex((function(t){return e===t.id})),!(s>-1)){n.next=10;break}if(n.t1=a===s&&this.isPlaying(t),!n.t1){n.next=6;break}return n.next=6,this.stop(t);case 6:i.splice(s,1),n.t0=!0,n.next=11;break;case 10:n.t0=!1;case 11:return n.abrupt("return",n.t0);case 12:case"end":return n.stop()}}),n,this)})))}},{key:"seek",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dr.audio,n=this.state[t].currentIndex;if(-1===n)throw ar.NoEntryToPlay(Kn.PLAYLIST,"No item is currently playing");var r=this.getElement(t);if(r){var i=Math.max(r.currentTime+e,0);r.currentTime=Math.min(i,r.duration)}}},{key:"seekTo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dr.audio,n=this.state[t].currentIndex;if(-1===n)throw ar.NoEntryToPlay(Kn.PLAYLIST,"No item is currently playing");if(e<0)throw Error("value cannot be negative");var r=this.getElement(t);r&&(r.currentTime=Math.min(e,r.duration))}},{key:"setVolume",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dr.audio;if(e<0||e>100)throw Error("Please pass a valid number between 0-100");var n=this.getElement(t);n&&(n.volume=.01*e)}},{key:"getVolume",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dr.audio,t=this.getElement(e);return t?100*t.volume:0}},{key:"getCurrentTime",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dr.audio,t=this.getElement(e);return(null==t?void 0:t.currentTime)||0}},{key:"getCurrentIndex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dr.audio;return this.state[e].currentIndex}},{key:"getCurrentProgress",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dr.audio,n=this.state[t],r=n.list,i=n.currentIndex,a=null==(e=r[i])?void 0:e.url,s=this.getElement(t);return a&&s?Math.floor(s.currentTime/s.duration*100):0}},{key:"getCurrentSelection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dr.audio,t=this.state[e],n=t.list,r=t.currentIndex;if(-1!==r)return n[r]}},{key:"isPlaying",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dr.audio,t=this.getElement(e);return!!t&&!t.paused}},{key:"setIsAutoplayOn",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dr.audio,t=arguments.length>1?arguments[1]:void 0;this.state[e].isAutoplayOn=t}},{key:"getPlaybackRate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dr.audio,t=this.getElement(e);return t?t.playbackRate:1}},{key:"setPlaybackRate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dr.audio,t=arguments.length>1?arguments[1]:void 0;if(t<.25||t>2)throw Error("Please pass a value between 0.25 and 2.0");var n=this.getElement(e);n&&(n.playbackRate=t)}},{key:"setEnabled",value:function(e,t){return hn(this,arguments,c().mark((function e(t,n){var r,i,a,s,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.id,i=n.type,a=void 0===i?dr.audio:i,s=this.state[a].list.findIndex((function(e){return e.id===r})),r&&-1!==s){e.next=5;break}return wn.w(this.TAG,"Pass a valid id"),e.abrupt("return");case 5:if(o=this.state[a].list[s].url,!t){e.next=11;break}return e.next=9,this.play(o,a);case 9:e.next=13;break;case 11:return e.next=13,this.pause(o,a);case 13:this.state[a].currentIndex=s,this.setDuration(a);case 15:case"end":return e.stop()}}),e,this)})))}},{key:"playNext",value:function(){return hn(this,arguments,c().mark((function e(){var t,n,r,i,a=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:dr.audio,n=this.state[t],r=n.list,!((i=n.currentIndex)>=r.length-1)){e.next=4;break}throw ar.NoEntryToPlay(Kn.PLAYLIST,"Reached end of playlist");case 4:return e.next=6,this.play(r[i+1].url,t);case 6:this.state[t].currentIndex=i+1,this.setDuration(t);case 8:case"end":return e.stop()}}),e,this)})))}},{key:"playPrevious",value:function(){return hn(this,arguments,c().mark((function e(){var t,n,r,i,a=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:dr.audio,n=this.state[t],r=n.list,!((i=n.currentIndex)<=0)){e.next=4;break}throw ar.NoEntryToPlay(Kn.PLAYLIST,"Reached start of playlist");case 4:return e.next=6,this.play(r[i-1].url,t);case 6:this.state[t].currentIndex=i-1,this.setDuration(t);case 8:case"end":return e.stop()}}),e,this)})))}},{key:"stop",value:function(){return hn(this,arguments,c().mark((function e(){var t,n,r,i=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:dr.audio,r=t===dr.audio?this.audioManager:this.videoManager,null==(n=r.getElement())||n.pause(),e.next=5,this.removeTracks(t);case 5:r.stop(),this.state[t].currentIndex=-1;case 7:case"end":return e.stop()}}),e,this)})))}},{key:"cleanup",value:function(){this.state={audio:ln({},ea),video:ln({},ta)},this.eventBus.localAudioEnabled.unsubscribe(this.handlePausePlaylist),this.eventBus.localVideoEnabled.unsubscribe(this.handlePausePlaylist),this.audioManager.stop(),this.videoManager.stop()}},{key:"onProgress",value:function(e){var t=this;this.videoManager.on("progress",(function(){try{e({type:dr.video,progress:t.getCurrentProgress(dr.video)})}catch(R){wn.e(t.TAG,"Error in onProgress callback")}})),this.audioManager.on("progress",(function(){try{e({type:dr.audio,progress:t.getCurrentProgress(dr.audio)})}catch(R){wn.e(t.TAG,"Error in onProgress callback")}}))}},{key:"onNewTrackStart",value:function(e){this.on("newTrackStart",e)}},{key:"onPlaylistEnded",value:function(e){this.on("playlistEnded",e)}},{key:"onCurrentTrackEnded",value:function(e){this.on("currentTrackEnded",e)}},{key:"getElement",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dr.audio;return e===dr.audio?this.audioManager.getElement():this.videoManager.getElement()}},{key:"removeTracks",value:function(){return hn(this,arguments,c().mark((function e(){var t,n,r,i,a,s=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=s.length>0&&void 0!==s[0]?s[0]:dr.audio,n=(t===dr.audio?this.audioManager:this.videoManager).getTracks(),r=S(n),e.prev=3,r.s();case 5:if((i=r.n()).done){e.next=11;break}return a=i.value,e.next=9,this.removeTrack(a);case 9:e.next=5;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),r.e(e.t0);case 16:return e.prev=16,r.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[3,13,16,19]])})))}},{key:"play",value:function(e){return hn(this,arguments,c().mark((function e(t){var n,r,i,a,s,o,u,l=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:dr.audio,r=n===dr.audio?this.audioManager:this.videoManager,i=r.getElement(),!this.isItemCurrentlyPlaying(t,n)){e.next=5;break}return wn.w(this.TAG,"The ".concat(n," is currently playing")),e.abrupt("return");case 5:if(!(null==i?void 0:i.src.includes(t))){e.next=10;break}return e.next=8,i.play();case 8:e.next=31;break;case 10:return null==i||i.pause(),e.next=13,r.play(t);case 13:a=e.sent,s=S(a),e.prev=15,s.s();case 17:if((o=s.n()).done){e.next=23;break}return u=o.value,e.next=21,this.addTrack(u,n===dr.audio?"audioplaylist":"videoplaylist");case 21:e.next=17;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(15),s.e(e.t0);case 28:return e.prev=28,s.f(),e.finish(28);case 31:case"end":return e.stop()}}),e,this,[[15,25,28,31]])})))}},{key:"isItemCurrentlyPlaying",value:function(e,t){var n=this.getElement(t);return!(!n||n.paused||!n.src.includes(e))}},{key:"setDuration",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dr.audio,t=this.getElement(e),n=this.state[e],r=n.list,i=n.currentIndex;r[i]&&(r[i].duration=(null==t?void 0:t.duration)||0),this.emit("newTrackStart",r[i])}},{key:"pause",value:function(e){return hn(this,arguments,c().mark((function e(t){var n,r,i=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=i.length>1&&void 0!==i[1]?i[1]:dr.audio,(r=this.getElement(n))&&!r.paused&&r.src.includes(t)?(r.pause(),wn.d(this.TAG,"paused url",t)):wn.w(this.TAG,"The passed in url is not currently playing");case 3:case"end":return e.stop()}}),e,this)})))}},{key:"addListeners",value:function(){var e=this;this.audioManager.on("ended",(function(){return e.handleEnded(dr.audio)})),this.videoManager.on("ended",(function(){return e.handleEnded(dr.video)})),this.eventBus.localAudioEnabled.subscribe(this.handlePausePlaylist),this.eventBus.localVideoEnabled.subscribe(this.handlePausePlaylist)}},{key:"handleEnded",value:function(){return hn(this,arguments,c().mark((function e(){var t,n,r,i,a,s=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:dr.audio,n=this.state[t],r=n.list,i=n.currentIndex,a=n.isAutoplayOn,i!==r.length-1){e.next=8;break}return e.next=5,this.stop(t);case 5:this.emit("playlistEnded",t),e.next=14;break;case 8:if(!a){e.next=12;break}this.playNext(t),e.next=14;break;case 12:return e.next=14,this.pause(r[i].url,t);case 14:this.emit("currentTrackEnded",r[i]);case 15:case"end":return e.stop()}}),e,this)})))}}]),n}($i),ra=k((function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"https://prod-init.100ms.live/init",s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];y(this,e),this.authToken=t,this.peerId=n,this.peerName=r,this.data=i,this.endpoint=a,this.autoSubscribeVideo=s}));!function(e){e[e.ConnectFailed=0]="ConnectFailed",e[e.SignalDisconnect=1]="SignalDisconnect",e[e.JoinWSMessageFailed=2]="JoinWSMessageFailed",e[e.PublishIceConnectionFailed=3]="PublishIceConnectionFailed",e[e.SubscribeIceConnectionFailed=4]="SubscribeIceConnectionFailed"}(Ui||(Ui={}));var ia,aa=(E(Qt={},0,[]),E(Qt,1,[]),E(Qt,2,[1]),E(Qt,3,[1]),E(Qt,4,[1]),Qt);!function(e){e.Disconnected="Disconnected",e.Connecting="Connecting",e.Joined="Joined",e.Preview="Preview",e.Failed="Failed",e.Reconnecting="Reconnecting",e.Leaving="Leaving"}(ia||(ia={}));var sa,oa=k((function e(t){var n=this;y(this,e),this.promise=new Promise((function(e,r){n.resolve=e,n.reject=r,t(e,r)}))})),ua=function(){function e(t,n){y(this,e),this.onStateChange=t,this.sendEvent=n,this.TAG="[RetryScheduler]",this.inProgress=new Map,this.retryTaskIds=[]}return k(e,[{key:"schedule",value:function(e){return hn(this,arguments,c().mark((function e(t){var n,r,i,a,s,o,u,l;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.category,r=t.error,i=t.task,a=t.originalState,s=t.maxFailedRetries,o=void 0===s?5:s,u=t.changeState,l=void 0===u||u,e.next=3,this.scheduleTask({category:n,error:r,changeState:l,task:i,originalState:a,maxFailedRetries:o});case 3:case"end":return e.stop()}}),e,this)})))}},{key:"reset",value:function(){this.retryTaskIds.forEach((function(e){return clearTimeout(e)})),this.retryTaskIds=[],this.inProgress.clear()}},{key:"scheduleTask",value:function(e){return hn(this,arguments,c().mark((function e(t){var n,r,i,a,s,o,u,l,d,f,h,p,v,g,m,y,b,k,T;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.category,r=t.error,i=t.changeState,a=t.task,s=t.originalState,o=t.maxFailedRetries,u=void 0===o?5:o,l=t.failedRetryCount,d=void 0===l?0:l,wn.d(this.TAG,"schedule: ",{category:Ui[n],error:r}),0!==d){e.next=10;break}if(!(f=this.inProgress.get(n))){e.next=8;break}return wn.d(this.TAG,"schedule: Already a task for ".concat(Ui[n]," scheduled, waiting for its completion")),e.next=7,f.promise;case 7:return e.abrupt("return");case 8:h=new oa((function(e,t){})),this.inProgress.set(n,h),this.sendEvent(r,n);case 10:p=!1,v=aa[n],e.t0=c().keys(v);case 12:if((e.t1=e.t0()).done){e.next=31;break}if(g=e.t1.value,m=v[parseInt(g)],e.prev=15,y=this.inProgress.get(m),e.t2=y,!e.t2){e.next=23;break}return wn.d(this.TAG,"schedule: Suspending retry task of ".concat(Ui[n],", waiting for ").concat(Ui[m]," to recover")),e.next=22,y.promise;case 22:wn.d(this.TAG,"schedule: Resuming retry task ".concat(Ui[n]," as it's dependency ").concat(Ui[m]," is recovered"));case 23:e.next=29;break;case 25:return e.prev=25,e.t3=e.catch(15),wn.d(this.TAG,"schedule: Stopping retry task of ".concat(Ui[n]," as it's dependency ").concat(Ui[m]," failed to recover")),p=!0,e.abrupt("break",31);case 29:e.next=12;break;case 31:if(!(d>=u||p)){e.next=38;break}if(r.description+=". [".concat(Ui[n],"] Could not recover after ").concat(d," tries"),p&&(r.description+=" Could not recover all of it's required dependencies - [".concat(v.map((function(e){return Ui[e]})).toString(),"]")),r.isTerminal=!0,this.inProgress.delete(n),this.sendEvent(r,n),this.reset(),!i){e.next=36;break}this.onStateChange(ia.Failed,r),e.next=37;break;case 36:throw r;case 37:return e.abrupt("return");case 38:return i&&this.onStateChange(ia.Reconnecting,r),b=this.getDelayForRetryCount(n,d),wn.i(this.TAG,"schedule: [".concat(Ui[n],"] [failedRetryCount=").concat(d,"] Scheduling retry task in ").concat(b,"ms")),e.prev=41,e.next=44,this.setTimeoutPromise(a,b);case 44:k=e.sent,e.next=50;break;case 47:e.prev=47,e.t4=e.catch(41),k=!1,wn.w(this.TAG,"[".concat(Ui[n],"] Un-caught exception ").concat(e.t4.name," in retry-task, initiating retry"),e.t4);case 50:if(!k){e.next=55;break}T=this.inProgress.get(n),this.inProgress.delete(n),null==T||T.resolve(d),i&&0===this.inProgress.size&&this.onStateChange(s),wn.i(this.TAG,"schedule: [".concat(Ui[n],"] [failedRetryCount=").concat(d,"] Recovered \u267b\ufe0f")),e.next=57;break;case 55:return e.next=57,this.scheduleTask({category:n,error:r,changeState:i,task:a,originalState:s,maxFailedRetries:u,failedRetryCount:d+1});case 57:case"end":return e.stop()}}),e,this,[[15,25],[41,47]])})))}},{key:"getBaseDelayForTask",value:function(e,t){return e===Ui.JoinWSMessageFailed?2:Math.pow(2,t)}},{key:"getDelayForRetryCount",value:function(e,t){var n=this.getBaseDelayForTask(e,t),r=e===Ui.JoinWSMessageFailed?2*Math.random():Math.random();return Math.round(1e3*Math.min(n+r,60))}},{key:"setTimeoutPromise",value:function(e,t){return hn(this,null,c().mark((function n(){var r=this;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise((function(n,i){var a=window.setTimeout((function(){return hn(r,null,c().mark((function t(){var r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e();case 3:(r=t.sent)&&this.retryTaskIds.splice(this.retryTaskIds.indexOf(a),1),n(r),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),i(t.t0);case 10:case"end":return t.stop()}}),t,this,[[0,7]])})))}),t);r.retryTaskIds.push(a)})));case 1:case"end":return n.stop()}}),n)})))}}]),e}(),ca=function(e){Le(n,e);var t=Me(n);function n(){var e;return y(this,n),(e=t.call(this,100)).localStorage=new vn("hms-analytics"),e.localStorage.clear(),e.initLocalStorageQueue(),e}return k(n,[{key:"enqueue",value:function(e){Ce(xe(n.prototype),"enqueue",this).call(this,e),this.localStorage.set(this.storage)}},{key:"dequeue",value:function(){var e=Ce(xe(n.prototype),"dequeue",this).call(this);return this.localStorage.set(this.storage),e}},{key:"initLocalStorageQueue",value:function(){var e,t=this;null==(e=this.localStorage.get())||e.forEach((function(e){var r=new Bn(e);Ce(xe(n.prototype),"enqueue",t).call(t,r)}))}}]),n}(Nr),la=function(){function e(){y(this,e),this.TAG="[AnalyticsTransport]"}return k(e,[{key:"sendEvent",value:function(e){try{this.sendSingleEvent(e),this.flushFailedEvents()}catch(R){wn.w(this.TAG,"sendEvent failed",R)}}},{key:"flushFailedEvents",value:function(e){var t;try{for(wn.d(this.TAG,"Flushing failed events",this.failedEvents);this.failedEvents.size()>0;){var n=this.failedEvents.dequeue();n&&((null==(t=n.metadata)?void 0:t.peer.peer_id)!==e&&n.metadata.peer.peer_id?Ai.sendEvent(n):this.sendSingleEvent(n))}}catch(C){wn.w(this.TAG,"flushFailedEvents failed",C)}}},{key:"sendSingleEvent",value:function(e){try{this.transportProvider.sendEvent(e),wn.d(this.TAG,"Sent event",e.name,e)}catch(R){throw wn.w(this.TAG,"".concat(this.transportProvider.TAG,".sendEvent failed, adding to local storage events"),{event:e,error:R}),this.failedEvents.enqueue(e),R}}}]),e}(),da=function(e){Le(n,e);var t=Me(n);function n(e){var r;return y(this,n),(r=t.call(this)).transportProvider=e,r.failedEvents=new ca,r}return k(n)}(la);!function(e){e[e.Publish=0]="Publish",e[e.Subscribe=1]="Subscribe"}(sa||(sa={}));var fa="[VALIDATIONS]";function ha(e){return null!=e}var pa=function(){if(!ha(RTCPeerConnection)){var e=rr.MissingRTCPeerConnection();throw wn.e(fa,e),e}},va=function(){if(!ha(navigator.mediaDevices)){var e=rr.MissingMediaDevices();throw wn.e(fa,e),e}};function ga(e,t){var n,r=(0,tn.Qc)(e.sdp);if(!(null==(n=r.origin)?void 0:n.username.startsWith("mozilla")))return e;var i=t?Array.from(t.values()):[];return r.media.forEach((function(e){var t,n,r,a=null==(t=e.msid)?void 0:t.split(" ")[0],s=null==(n=i.find((function(t){return t.type===e.type&&t.stream_id===a})))?void 0:n.track_id;s&&(e.msid=null==(r=e.msid)?void 0:r.replace(/\s(.+)/," ".concat(s)))})),{type:e.type,sdp:(0,tn.cW)(r)}}function ma(e){return e.sdp.includes("usedtx=1")?e:{type:e.type,sdp:e.sdp.replace("useinbandfec=1","useinbandfec=1;usedtx=1")}}var ya,ba,ka="[HMSConnection]",Ta=function(){function e(t,n){y(this,e),this.candidates=new Array,this.role=t,this.signal=n}return k(e,[{key:"iceConnectionState",get:function(){return this.nativeConnection.iceConnectionState}},{key:"connectionState",get:function(){return this.nativeConnection.connectionState}},{key:"action",get:function(){return this.role===sa.Publish?Kn.PUBLISH:Kn.SUBSCRIBE}},{key:"addTransceiver",value:function(e,t){return this.nativeConnection.addTransceiver(e,t)}},{key:"createOffer",value:function(e,t){return hn(this,null,c().mark((function n(){var r;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this.nativeConnection.createOffer(t);case 3:return r=n.sent,n.abrupt("return",(wn.d(ka,"[role=".concat(this.role,"] createOffer offer=").concat(JSON.stringify(r,null,1))),ma(ga(r,e))));case 7:throw n.prev=7,n.t0=n.catch(0),tr.CreateOfferFailed(this.action,n.t0.message);case 10:case"end":return n.stop()}}),n,this,[[0,7]])})))}},{key:"createAnswer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return hn(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.nativeConnection.createAnswer(e);case 3:return n=t.sent,t.abrupt("return",(wn.d(ka,"[role=".concat(this.role,"] createAnswer answer=").concat(JSON.stringify(n,null,1))),n));case 7:throw t.prev=7,t.t0=t.catch(0),tr.CreateAnswerFailed(this.action,t.t0.message);case 10:case"end":return t.stop()}}),t,this,[[0,7]])})))}},{key:"setLocalDescription",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,wn.d(ka,"[role=".concat(this.role,"] setLocalDescription description=").concat(JSON.stringify(e,null,1))),t.next=4,this.nativeConnection.setLocalDescription(e);case 4:t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(0),tr.SetLocalDescriptionFailed(this.action,t.t0.message);case 9:case"end":return t.stop()}}),t,this,[[0,6]])})))}},{key:"setRemoteDescription",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,wn.d(ka,"[role=".concat(this.role,"] setRemoteDescription description=").concat(JSON.stringify(e,null,1))),t.next=4,this.nativeConnection.setRemoteDescription(e);case 4:t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(0),tr.SetRemoteDescriptionFailed(this.action,t.t0.message);case 9:case"end":return t.stop()}}),t,this,[[0,6]])})))}},{key:"addIceCandidate",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return wn.d(ka,"[role=".concat(this.role,"] addIceCandidate candidate=").concat(JSON.stringify(e,null,1))),t.next=3,this.nativeConnection.addIceCandidate(e);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"remoteDescription",get:function(){return this.nativeConnection.remoteDescription}},{key:"getSenders",value:function(){return this.nativeConnection.getSenders()}},{key:"logSelectedIceCandidatePairs",value:function(){var e=this;try{(this.role===sa.Publish?this.getSenders():this.getReceivers()).forEach((function(t){var n,r=null==(n=t.track)?void 0:n.kind;if(t.transport){var i=t.transport.iceTransport,a=function(){"function"==typeof i.getSelectedCandidatePair&&(e.selectedCandidatePair=i.getSelectedCandidatePair(),wn.d(ka,"".concat(sa[e.role]," connection"),"selected ".concat(r||"unknown"," candidate pair"),JSON.stringify(e.selectedCandidatePair,null,2)))};"function"==typeof i.onselectedcandidatepairchange&&(i.onselectedcandidatepairchange=a),a()}}))}catch(t){wn.w(ka,"Error in logging selected ice candidate pair for ".concat(sa[this.role]," connection"),t)}}},{key:"removeTrack",value:function(e){"closed"!==this.nativeConnection.signalingState&&this.nativeConnection.removeTrack(e)}},{key:"setMaxBitrateAndFramerate",value:function(e){return hn(this,null,c().mark((function t(){var n,r,i,a;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.settings.maxBitrate,r=e instanceof $r&&e.settings.maxFramerate,i=this.getSenders().find((function(t){var n;return(null==(n=null==t?void 0:t.track)?void 0:n.id)===e.getTrackIDBeingSent()})),!i){t.next=8;break}return(a=i.getParameters()).encodings.length>0&&(n&&(a.encodings[0].maxBitrate=1e3*n),r&&(a.encodings[0].maxFramerate=r)),t.next=6,i.setParameters(a);case 6:t.next=9;break;case 8:wn.w(ka,"no sender found to setMaxBitrate for track - ".concat(e.trackId,", sentTrackId - ").concat(e.getTrackIDBeingSent()));case 9:case"end":return t.stop()}}),t,this)})))}},{key:"getStats",value:function(){return hn(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.nativeConnection.getStats();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"close",value:function(){return hn(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.nativeConnection.close();case 1:case"end":return e.stop()}}),e,this)})))}},{key:"getReceivers",value:function(){return this.nativeConnection.getReceivers()}}]),e}(),Ea=function(e){Le(n,e);var t=Me(n);function n(e,r,i,a){var s;return y(this,n),(s=t.call(this,sa.Publish,e)).TAG="[HMSPublishConnection]",s.observer=i,s.transport=a,s.nativeConnection=new RTCPeerConnection(r),s.nativeConnection.createDataChannel(Zr,{protocol:"SCTP"}),s.nativeConnection.onicecandidate=function(t){var n=t.candidate;n&&e.trickle(s.role,n)},s.nativeConnection.oniceconnectionstatechange=function(){s.observer.onIceConnectionChange(s.nativeConnection.iceConnectionState)},s.nativeConnection.onconnectionstatechange=function(){s.observer.onConnectionStateChange(s.nativeConnection.connectionState)},s}return k(n,[{key:"initAfterJoin",value:function(){var e=this;this.nativeConnection.onnegotiationneeded=function(){return hn(e,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return wn.d(this.TAG,"onnegotiationneeded"),e.next=3,this.observer.onRenegotiationNeeded();case 3:case"end":return e.stop()}}),e,this)})))}}},{key:"trackUpdate",value:function(e){this.transport.trackUpdate(e)}}]),n}(Ta),Sa=function(){function e(t,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";y(this,e),this.TAG="[HMSDataChannel]",this.nativeChannel=t,this.observer=n,this.metadata=i,t.onmessage=function(e){r.observer.onMessage(e.data)}}return k(e,[{key:"id",get:function(){return this.nativeChannel.id}},{key:"label",get:function(){return this.nativeChannel.label}},{key:"readyState",get:function(){return this.nativeChannel.readyState}},{key:"send",value:function(e){wn.d(this.TAG,"[".concat(this.metadata,"] Sending [size=").concat(e.length,"] message=").concat(e)),this.nativeChannel.send(e)}},{key:"close",value:function(){this.nativeChannel.close()}}]),e}(),wa=function(e){Le(n,e);var t=Me(n);function n(e,r,i){var a;return y(this,n),(a=t.call(this,sa.Subscribe,e)).TAG="[HMSSubscribeConnection]",a.remoteStreams=new Map,a.MAX_RETRIES=3,a.pendingMessageQueue=[],a.eventEmitter=new(en())({maxListeners:15}),a.handlePendingApiMessages=function(){a.eventEmitter.emit("open",!0),a.pendingMessageQueue.length>0&&(wn.d(a.TAG,"Found pending message queue, sending messages"),a.pendingMessageQueue.forEach((function(e){return a.sendOverApiDataChannel(e)})),a.pendingMessageQueue.length=0)},a.sendMessage=function(e,t){return hn(Ae(a),null,c().mark((function n(){var r,i,a,s,o;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.t0="open"!==(null==(r=this.apiChannel)?void 0:r.readyState),!n.t0){n.next=4;break}return n.next=4,this.eventEmitter.waitFor("open");case 4:a=0;case 5:if(!(a<this.MAX_RETRIES)){n.next=26;break}return this.apiChannel.send(e),n.next=9,this.waitForResponse(t);case 9:if(i=n.sent,!(s=i.error)){n.next=22;break}if(404!==s.code){n.next=15;break}return wn.d(this.TAG,"Track not found ".concat(t),{request:e,try:a+1,error:s}),n.abrupt("break",26);case 15:if(wn.e(this.TAG,"Failed sending ".concat(t),{request:e,try:a+1,error:s}),s.code/100==5||429===s.code){n.next=17;break}throw Error("code=".concat(s.code,", message=").concat(s.message));case 17:return o=1e3*(2+2*Math.random()),n.next=20,Fr(o);case 20:n.next=23;break;case 22:return n.abrupt("break",26);case 23:a++,n.next=5;break;case 26:return n.abrupt("return",i);case 27:case"end":return n.stop()}}),n,this)})))},a.waitForResponse=function(e){return hn(Ae(a),null,c().mark((function t(){var n,r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.eventEmitter.waitFor("message",(function(t){return t.includes(e)}));case 2:return n=t.sent,r=JSON.parse(n[0]),t.abrupt("return",(wn.d(this.TAG,"response for ".concat(e," -"),JSON.stringify(r,null,2)),r));case 5:case"end":return t.stop()}}),t,this)})))},a.observer=i,a.nativeConnection=new RTCPeerConnection(r),a.initNativeConnectionCallbacks(),a}return k(n,[{key:"initNativeConnectionCallbacks",value:function(){var e=this;this.nativeConnection.oniceconnectionstatechange=function(){e.observer.onIceConnectionChange(e.nativeConnection.iceConnectionState)},this.nativeConnection.onconnectionstatechange=function(){e.observer.onConnectionStateChange(e.nativeConnection.connectionState)},this.nativeConnection.ondatachannel=function(t){t.channel.label===Zr&&(e.apiChannel=new Sa(t.channel,{onMessage:function(t){e.eventEmitter.emit("message",t),e.observer.onApiChannelMessage(t)}},"role=".concat(e.role)),t.channel.onopen=e.handlePendingApiMessages)},this.nativeConnection.onicecandidate=function(t){null!==t.candidate&&e.signal.trickle(e.role,t.candidate)},this.nativeConnection.ontrack=function(t){var n,r=t.streams[0],i=r.id;if(!e.remoteStreams.has(i)){var a=new xr(r,e);e.remoteStreams.set(i,a),r.onremovetrack=function(t){var n=a.tracks.findIndex((function(e){return e.nativeTrack.id===t.track.id}));if(n>=0){var r=a.tracks[n];e.observer.onTrackRemove(r),a.tracks.splice(n,1),0===a.tracks.length&&e.remoteStreams.delete(i)}}}var s=e.remoteStreams.get(i),o=new("audio"===t.track.kind?Kr:yi)(s,t.track),u=function(e,t){var n;if((null==e?void 0:e.sdp)&&t){var r=(0,tn.Qc)(e.sdp).media.find((function(e){return ha(e.mid)&&parseInt(e.mid)===parseInt(t)}));return null==(n=null==r?void 0:r.msid)?void 0:n.split(" ")[1]}}(e.remoteDescription,null==(n=t.transceiver)?void 0:n.mid);u&&o.setSdpTrackId(u),s.tracks.push(o),e.observer.onTrackAdd(o)}}},{key:"sendOverApiDataChannel",value:function(e){this.apiChannel&&"open"===this.apiChannel.readyState?this.apiChannel.send(e):(wn.w(this.TAG,"API Data channel not ".concat(this.apiChannel?"open":"present",", queueing"),e),this.pendingMessageQueue.push(e))}},{key:"sendOverApiDataChannelWithResponse",value:function(e,t){return hn(this,null,c().mark((function n(){var r,i;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Xt(),i=JSON.stringify(ln({id:t||r,jsonrpc:"2.0"},e)),n.abrupt("return",this.sendMessage(i,r));case 2:case"end":return n.stop()}}),n,this)})))}},{key:"close",value:function(){var e=this,t=function(t){return Ce(xe(n.prototype),t,e)};return hn(this,null,c().mark((function e(){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t("close").call(this);case 2:null==(n=this.apiChannel)||n.close();case 3:case"end":return e.stop()}}),e,this)})))}}]),n}(Ta),xa=function(e,t,n,r){return hn(void 0,null,c().mark((function i(){var a,s,o,u,l,d;return c().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return o={},i.prev=1,i.next=4,null==(a=e.publish)?void 0:a.call(e,t.getTrackBeingSent());case 4:s=i.sent,u={},l={},d={},null==s||s.forEach((function(e){switch(e.type){case"outbound-rtp":l[e.id]=e;break;case"remote-inbound-rtp":d[e.ssrc]=e;break;case"codec":u[e.id]=e.mimeType}})),Object.keys(ln({},l)).forEach((function(e){var i,a,s=null==(i=l[e])?void 0:i.codecId,c=s?u[s]:void 0;c&&(a=c.substring(c.indexOf("/")+1));var f=l[e],h=d[f.ssrc];o[e]=dn(ln({},f),{bitrate:Da("bytesSent",f,null==r?void 0:r[e]),packetsLost:null==h?void 0:h.packetsLost,jitter:null==h?void 0:h.jitter,peerName:n,peerID:t.peerId,codec:a})})),i.next=12;break;case 9:i.prev=9,i.t0=i.catch(1),wn.w("[HMSWebrtcStats]","Error in getting local track stats",t,i.t0);case 12:return i.abrupt("return",o);case 13:case"end":return i.stop()}}),i,null,[[1,9]])})))},Ra=function(e,t,n,r){return hn(void 0,null,c().mark((function i(){var a,s,o,u,l;return c().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,null==(a=e.subscribe)?void 0:a.call(e,t.nativeTrack);case 3:s=i.sent,i.next=9;break;case 6:i.prev=6,i.t0=i.catch(0),wn.w("[HMSWebrtcStats]","Error in getting remote track stats",t,i.t0);case 9:return o=Ca(s),u=Da("bytesReceived",o,r),l=La("packetsLost",o,r),i.abrupt("return",((null==o?void 0:o.remote)&&Object.assign(o.remote,{packetsLostRate:La("packetsLost",o.remote,null==r?void 0:r.remote)}),o&&Object.assign(o,{bitrate:u,packetsLostRate:l,peerId:t.peerId,peerName:n,codec:o.codec})));case 11:case"end":return i.stop()}}),i,null,[[0,6]])})))},Ca=function(e){var t,n,r={};null==e||e.forEach((function(e){switch(e.type){case"inbound-rtp":case"outbound-rtp":t=e;break;case"remote-inbound-rtp":n=e;break;case"codec":r[e.id]=e.mimeType}}));var i,a=(null==t?void 0:t.codecId)?r[t.codecId]:void 0;return a&&(i=a.substring(a.indexOf("/")+1)),t&&Object.assign(t,{remote:n,codec:i})},Aa=function(e,t,n){var r=Ia(t),i=Da("publish"===e?"bytesSent":"bytesReceived",r,n&&n[e]);return r&&Object.assign(r,{bitrate:i})},Ia=function(e){var t;return e.forEach((function(n){"transport"===n.type&&(t=e.get(n.selectedCandidatePairId))})),t||e.forEach((function(e){"candidate-pair"===e.type&&e.selected&&(t=e)})),t},Pa=function(e){var t={packetsLost:0,jitter:0};return null==e||e.forEach((function(e){e.packetsLost&&(t.packetsLost+=e.packetsLost),e.jitter>t.jitter&&(t.jitter=e.jitter)})),t},_a=function(e,t){return Array.from(new Set(e.concat(t)))},Da=function(e,t,n){return 8*La(e,t,n)},La=function(e,t,n){var r=t&&t[e],i=n?n[e]:null;return[t,n,ha(r),ha(i)].every((function(e){return!!e}))?1e3*Oa(r,i,null==t?void 0:t.timestamp,null==n?void 0:n.timestamp):0},Oa=function(e,t,n,r){return ha(e)&&ha(t)&&n&&r?(e-t)/(n-r):0},Ma=function(){function e(t,n){var r;y(this,e),this.getStats=t,this.store=n,this.TAG="[HMSWebrtcStats]",this.peerStats={},this.remoteTrackStats={},this.localTrackStats={},this.localPeerID=null==(r=this.store.getLocalPeer())?void 0:r.peerId}return k(e,[{key:"getLocalPeerStats",value:function(){return this.peerStats[this.localPeerID]}},{key:"getRemoteTrackStats",value:function(e){return this.remoteTrackStats[e]}},{key:"getLocalTrackStats",value:function(){return this.localTrackStats}},{key:"updateStats",value:function(){return hn(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updateLocalPeerStats();case 2:return e.next=4,this.updateLocalTrackStats();case 4:return e.next=6,this.updateRemoteTrackStats();case 6:case"end":return e.stop()}}),e,this)})))}},{key:"updateLocalPeerStats",value:function(){return hn(this,null,c().mark((function e(){var t,n,r,i,a,s,o,u,l,d,f,h,p,v,g,m;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.getLocalPeerStats(),e.prev=1,e.next=4,null==(n=(t=this.getStats).publish)?void 0:n.call(t);case 4:u=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),wn.w(this.TAG,"Error in getting publish stats",e.t0);case 10:return l=u&&Aa("publish",u,o),e.prev=11,e.next=14,null==(i=(r=this.getStats).subscribe)?void 0:i.call(r);case 14:d=e.sent,e.next=20;break;case 17:e.prev=17,e.t1=e.catch(11),wn.w(this.TAG,"Error in getting subscribe stats",e.t1);case 20:f=d&&Aa("subscribe",d,o),h=Pa(d),p=h.packetsLost,v=h.jitter,g=Oa(p,null==(a=null==o?void 0:o.subscribe)?void 0:a.packetsLost,null==f?void 0:f.timestamp,null==(s=null==o?void 0:o.subscribe)?void 0:s.timestamp),m=f&&Object.assign(f,{packetsLostRate:g,jitter:v,packetsLost:p}),this.peerStats[this.localPeerID]={publish:l,subscribe:m};case 22:case"end":return e.stop()}}),e,this,[[1,7],[11,17]])})))}},{key:"updateRemoteTrackStats",value:function(){return hn(this,null,c().mark((function e(){var t,n,r,i,a,s,o,u,l,d,f=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.store.getTracksMap(),r=_a(Object.keys(this.remoteTrackStats),Object.keys(n)).filter((function(e){return n[e]&&n[e].peerId!==f.localPeerID})),i=S(r),e.prev=2,i.s();case 4:if((a=i.n()).done){e.next=19;break}if(s=a.value,!(o=n[s])){e.next=16;break}return u=o.peerId&&(null==(t=this.store.getPeerById(o.peerId))?void 0:t.name),l=this.getRemoteTrackStats(o.trackId),e.next=12,Ra(this.getStats,o,u,l);case 12:(d=e.sent)&&(this.remoteTrackStats[s]=d),e.next=17;break;case 16:delete this.remoteTrackStats[s];case 17:e.next=4;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(2),i.e(e.t0);case 24:return e.prev=24,i.f(),e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[2,21,24,27]])})))}},{key:"updateLocalTrackStats",value:function(){return hn(this,null,c().mark((function e(){var t,n,r,i,a,s,o,u,l;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.store.getLocalPeerTracks().reduce((function(e,t){return e[t.getTrackIDBeingSent()]=t,e}),{}),r=_a(Object.keys(this.localTrackStats),Object.keys(n)),i=S(r),e.prev=2,i.s();case 4:if((a=i.n()).done){e.next=18;break}if(s=a.value,!(o=n[s])){e.next=15;break}return u=null==(t=this.store.getLocalPeer())?void 0:t.name,e.next=11,xa(this.getStats,o,u,this.localTrackStats[s]);case 11:(l=e.sent)&&(this.localTrackStats[s]=l),e.next=16;break;case 15:delete this.localTrackStats[s];case 16:e.next=4;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(2),i.e(e.t0);case 23:return e.prev=23,i.f(),e.finish(23);case 26:case"end":return e.stop()}}),e,this,[[2,20,23,26]])})))}}]),e}(),Na=function(){function e(t,n,r,i){var a=this;y(this,e),this.store=t,this.eventBus=n,this.publishConnection=r,this.subscribeConnection=i,this.TAG="[HMSWebrtcInternals]",this.interval=1e3,this.isMonitored=!1,this.handleStatsUpdate=function(){return hn(a,null,c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null==(t=this.hmsStats)?void 0:t.updateStats();case 2:this.eventBus.statsUpdate.publish(this.hmsStats);case 3:case"end":return e.stop()}}),e,this)})))}}return k(e,[{key:"getPublishPeerConnection",value:function(){return this.publishConnection}},{key:"getSubscribePeerConnection",value:function(){return this.subscribeConnection}},{key:"getCurrentStats",value:function(){return this.hmsStats}},{key:"onStatsChange",value:function(e){var t=this;return this.eventBus.statsUpdate.subscribe(e),function(){t.eventBus.statsUpdate.unsubscribe(e)}}},{key:"setPeerConnections",value:function(e){var t,n,r=e.publish,i=e.subscribe;this.publishConnection=r,this.subscribeConnection=i,this.hmsStats=new Ma({publish:null==(t=this.publishConnection)?void 0:t.getStats.bind(this.publishConnection),subscribe:null==(n=this.subscribeConnection)?void 0:n.getStats.bind(this.subscribeConnection)},this.store)}},{key:"start",value:function(){return hn(this,null,c().mark((function e(){var t=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isMonitored){e.next=3;break}return wn.d(this.TAG,"Already started"),e.abrupt("return");case 3:this.stop(),this.isMonitored=!0,wn.d(this.TAG,"Starting Webrtc Stats Monitor"),this.startLoop().then((function(){return wn.d(t.TAG,"Stopping Webrtc Stats Monitor")})).catch((function(e){return wn.e(t.TAG,e.message)}));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"stop",value:function(){this.isMonitored=!1}},{key:"startLoop",value:function(){return hn(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isMonitored){e.next=7;break}return e.next=3,this.handleStatsUpdate();case 3:return e.next=5,Fr(this.interval);case 5:e.next=0;break;case 7:case"end":return e.stop()}}),e,this)})))}},{key:"cleanUp",value:function(){this.stop(),this.eventBus.statsUpdate.removeAllListeners()}}]),e}(),Fa="[InitService]",Ua=function(){function e(){y(this,e)}return k(e,null,[{key:"handleError",value:function(e,t){switch(e.status){case 404:throw Zn.EndpointUnreachable(Kn.INIT,t.message||e.statusText);case 200:break;default:throw Zn.ServerErrors(t.code||e.status,Kn.INIT,t.message||(null==e?void 0:e.statusText))}}},{key:"fetchInitConfig",value:function(e){return hn(this,arguments,c().mark((function e(t){var n,r,i,a,s,o,u,l,d,f,h;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.token,r=t.peerId,i=t.userAgent,a=t.initEndpoint,s=void 0===a?"https://prod-init.100ms.live":a,o=t.region,u=void 0===o?"":o,wn.d(Fa,"fetchInitConfig: initEndpoint=".concat(s," token=").concat(n," peerId=").concat(r," region=").concat(u," ")),l=Ba(s,r,i,u),e.prev=3,e.next=6,fetch(l,{headers:{Authorization:"Bearer ".concat(n)}});case 6:return d=e.sent,e.next=9,d.json();case 9:return f=e.sent,e.abrupt("return",(this.handleError(d,f),wn.d(Fa,"config is ".concat(JSON.stringify(f,null,2))),ja(f)));case 13:throw e.prev=13,e.t0=e.catch(3),h=e.t0,["Failed to fetch","NetworkError"].some((function(e){return h.message.includes(e)}))?Zn.EndpointUnreachable(Kn.INIT,h.message):h;case 17:case"end":return e.stop()}}),e,this,[[3,13]])})))}}]),e}();function Ba(e,t,n,r){try{var i=new URL("/init",e);return r&&r.trim().length>0&&i.searchParams.set("region",r.trim()),i.searchParams.set("peer_id",t),i.searchParams.set("user_agent_v2",n),i.toString()}catch(s){var a=s;throw wn.e(Fa,a.name,a.message),a}}function ja(e){var t;return dn(ln({},e),{rtcConfiguration:dn(ln({},e.rtcConfiguration),{iceServers:null==(t=e.rtcConfiguration)?void 0:t.ice_servers})})}function Ga(e){switch(e){case ba.JOIN:return Kn.JOIN;case ba.OFFER:return Kn.PUBLISH;case ba.ANSWER:return Kn.SUBSCRIBE;case ba.TRACK_UPDATE:return Kn.TRACK;default:return Kn.NONE}}!function(e){e.FLAG_SERVER_SUB_DEGRADATION="subscribeDegradation",e.FLAG_SERVER_SIMULCAST="simulcast",e.FLAG_NON_WEBRTC_DISABLE_OFFER="nonWebRTCDisableOffer"}(ya||(ya={})),function(e){e.JOIN="join",e.OFFER="offer",e.ANSWER="answer",e.TRICKLE="trickle",e.TRACK_UPDATE="track-update",e.BROADCAST="broadcast",e.ANALYTICS="analytics",e.SERVER_ERROR="on-error",e.SERVER_WARNING="on-warning",e.SDK_NOTIFICATION="sdk-notification",e.LEAVE="leave",e.END_ROOM="end-room",e.PING="ping",e.ROLE_CHANGE_REQUEST="role-change-request",e.ROLE_CHANGE="role-change",e.TRACK_UPDATE_REQUEST="track-update-request",e.PEER_LEAVE_REQUEST="peer-leave-request",e.CHANGE_TRACK_MUTE_STATE_REQUEST="change-track-mute-state-request",e.START_RTMP_OR_RECORDING_REQUEST="rtmp-start",e.STOP_RTMP_AND_RECORDING_REQUEST="rtmp-stop",e.UPDATE_PEER_METADATA="peer-update",e.START_HLS_STREAMING="hls-start",e.STOP_HLS_STREAMING="hls-stop",e.HLS_TIMED_METADATA="hls-timed-metadata",e.SET_METADATA="set-metadata",e.GET_METADATA="get-metadata"}(ba||(ba={}));var Va=function(){function e(t){var n=this;y(this,e),this.TAG="[SIGNAL]: ",this.pongResponseTimes=new Nr(5),this.isJoinCompleted=!1,this.pendingTrickle=[],this.socket=null,this.callbacks=new Map,this._isConnected=!1,this.id=0,this.onCloseHandler=function(){},this.offlineListener=function(){wn.d(n.TAG,"Window network offline"),n.setIsConnected(!1,"Window network offline")},this.onlineListener=function(){wn.d(n.TAG,"Window network online"),n.observer.onNetworkOnline()},this.observer=t,window.addEventListener("offline",this.offlineListener),window.addEventListener("online",this.onlineListener),this.onMessageHandler=this.onMessageHandler.bind(this)}return k(e,[{key:"isConnected",get:function(){return this._isConnected}},{key:"setIsConnected",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";wn.d(this.TAG,"isConnected set id: ".concat(this.id,", oldValue: ").concat(this._isConnected,", newValue: ").concat(e)),this._isConnected!==e&&(this._isConnected&&!e?(this._isConnected=e,this.observer.onOffline(t)):!this._isConnected&&e&&(this._isConnected=e,this.observer.onOnline()))}},{key:"getPongResponseTimes",value:function(){return this.pongResponseTimes.toList()}},{key:"internalCall",value:function(e,t){return hn(this,null,c().mark((function n(){var r,i,a,s,o=this;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=Xt(),a={method:e,params:t,id:i,jsonrpc:"2.0"},null==(r=this.socket)||r.send(JSON.stringify(a)),n.prev=2,n.next=5,new Promise((function(e,t){o.callbacks.set(i,{resolve:e,reject:t})}));case 5:return n.abrupt("return",n.sent);case 8:throw n.prev=8,n.t0=n.catch(2),s=n.t0,nr.ServerErrors(Number(s.code),Ga(e),s.message);case 12:case"end":return n.stop()}}),n,this,[[2,8]])})))}},{key:"notify",value:function(e,t){var n,r,i={method:e,params:t};(null==(n=this.socket)?void 0:n.readyState)===WebSocket.OPEN&&(null==(r=this.socket)||r.send(JSON.stringify(i)))}},{key:"open",value:function(e){var t=this;return new Promise((function(n,r){var i=!1;t.socket&&(t.socket.close(),t.socket.removeEventListener("close",t.onCloseHandler),t.socket.removeEventListener("message",t.onMessageHandler)),t.socket=new WebSocket(e);var a=function(e){wn.e(t.TAG,"Error from websocket",e),i=!0,r(Xn.FailedToConnect(Kn.JOIN,"Error opening websocket connection - ".concat(e)))};t.onCloseHandler=function(e){wn.e("Websocket closed code=".concat(e.code)),i?t.setIsConnected(!1,"code: ".concat(e.code).concat(1e3!==e.code?", unexpected websocket close":"")):(i=!0,r(Xn.AbnormalClose(Kn.JOIN,"Error opening websocket connection - websocket closed unexpectedly with code=".concat(e.code))))},t.socket.addEventListener("error",a);t.socket.addEventListener("open",(function e(){var r,s;i=!0,n(),t.setIsConnected(!0),t.id++,null==(r=t.socket)||r.removeEventListener("open",e),null==(s=t.socket)||s.removeEventListener("error",a),t.pingPongLoop(t.id)})),t.socket.addEventListener("close",t.onCloseHandler),t.socket.addEventListener("message",t.onMessageHandler)}))}},{key:"close",value:function(){return hn(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window.removeEventListener("offline",this.offlineListener),window.removeEventListener("online",this.onlineListener),this.socket?(this.socket.close(1e3,"Normal Close"),this.setIsConnected(!1,"code: 1000, normal websocket close"),this.socket.removeEventListener("close",this.onCloseHandler),this.socket.removeEventListener("message",this.onMessageHandler)):this.setIsConnected(!1,"websocket not connected yet");case 1:case"end":return e.stop()}}),e,this)})))}},{key:"join",value:function(e,t,n,r,i,a){return hn(this,null,c().mark((function s(){var o,u,l=this;return c().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(this.isConnected){s.next=2;break}throw Xn.WebSocketConnectionLost(Kn.JOIN,"Failed to send join over WS connection");case 2:return o={name:e,disableVidAutoSub:n,data:t,offer:a,server_sub_degrade:r,simulcast:i},s.next=5,this.internalCall(ba.JOIN,o);case 5:return u=s.sent,s.abrupt("return",(this.isJoinCompleted=!0,this.pendingTrickle.forEach((function(e){var t=e.target,n=e.candidate;return l.trickle(t,n)})),this.pendingTrickle.length=0,wn.d(this.TAG,"join: response=".concat(JSON.stringify(u,null,1))),u));case 7:case"end":return s.stop()}}),s,this)})))}},{key:"trickle",value:function(e,t){this.isJoinCompleted?this.notify(ba.TRICKLE,{target:e,candidate:t}):this.pendingTrickle.push({target:e,candidate:t})}},{key:"offer",value:function(e,t){return hn(this,null,c().mark((function n(){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.call(ba.OFFER,{desc:e,tracks:Object.fromEntries(t)});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n,this)})))}},{key:"answer",value:function(e){this.notify(ba.ANSWER,{desc:e})}},{key:"trackUpdate",value:function(e){this.notify(ba.TRACK_UPDATE,{version:"1.0",tracks:Object.fromEntries(e)})}},{key:"broadcast",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(ba.BROADCAST,ln({version:"1.0"},e.toSignalParams()));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"leave",value:function(){this.notify(ba.LEAVE,{version:"1.0"})}},{key:"endRoom",value:function(e,t){return hn(this,null,c().mark((function n(){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.call(ba.END_ROOM,{lock:e,reason:t});case 2:case"end":return n.stop()}}),n,this)})))}},{key:"sendEvent",value:function(e){if(!this.isConnected)throw Error("".concat(this.TAG," not connected. Could not send event ").concat(e));this.notify(ba.ANALYTICS,e.toSignalParams())}},{key:"ping",value:function(e){var t=Date.now(),n=new Promise((function(n){setTimeout((function(){n(Date.now()-t)}),e+1)})),r=this.internalCall(ba.PING,{timestamp:t}).then((function(){return Date.now()-t})).catch((function(){return Date.now()-t}));return Promise.race([n,r])}},{key:"requestRoleChange",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(ba.ROLE_CHANGE_REQUEST,e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"requestBulkRoleChange",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(ba.ROLE_CHANGE_REQUEST,e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"acceptRoleChangeRequest",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(ba.ROLE_CHANGE,e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"requestTrackStateChange",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(ba.TRACK_UPDATE_REQUEST,e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"requestMultiTrackStateChange",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(ba.CHANGE_TRACK_MUTE_STATE_REQUEST,e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"removePeer",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(ba.PEER_LEAVE_REQUEST,e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"startRTMPOrRecording",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(ba.START_RTMP_OR_RECORDING_REQUEST,ln({version:"1.0"},e));case 2:case"end":return t.stop()}}),t,this)})))}},{key:"stopRTMPAndRecording",value:function(){return hn(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.call(ba.STOP_RTMP_AND_RECORDING_REQUEST,{version:"1.0"});case 2:case"end":return e.stop()}}),e,this)})))}},{key:"startHLSStreaming",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(ba.START_HLS_STREAMING,ln({version:"1.0"},e));case 2:case"end":return t.stop()}}),t,this)})))}},{key:"stopHLSStreaming",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(ba.STOP_HLS_STREAMING,ln({version:"1.0"},e));case 2:case"end":return t.stop()}}),t,this)})))}},{key:"sendHLSTimedMetadata",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(ba.HLS_TIMED_METADATA,ln({version:"1.0"},e));case 2:case"end":return t.stop()}}),t,this)})))}},{key:"updatePeer",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(ba.UPDATE_PEER_METADATA,ln({version:"1.0"},e));case 2:case"end":return t.stop()}}),t,this)})))}},{key:"setSessionMetadata",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(ba.SET_METADATA,ln({version:"1.0"},e));case 2:case"end":return t.stop()}}),t,this)})))}},{key:"getSessionMetadata",value:function(){return this.call(ba.GET_METADATA,{version:"1.0"})}},{key:"onMessageHandler",value:function(e){var t=e.data,n=JSON.parse(t);if(n.id)this.handleResponseWithId(n);else{if(!n.method)throw Error("WebSocket message has no 'method' or 'id' field, message=".concat(n));this.handleResponseWithMethod(n)}}},{key:"handleResponseWithId",value:function(e){var t=e,n=t.id;if(this.callbacks.has(n)){var r=this.callbacks.get(n);this.callbacks.delete(n),t.result?r.resolve(t.result):r.reject(t.error)}else this.observer.onNotification(t)}},{key:"handleResponseWithMethod",value:function(e){switch(e.method){case ba.OFFER:this.observer.onOffer(e.params);break;case ba.TRICKLE:this.observer.onTrickle(e.params);break;case ba.SERVER_ERROR:this.observer.onServerError(nr.ServerErrors(Number(e.params.code),Kn.NONE,e.params.message));break;case ba.SERVER_WARNING:wn.w(this.TAG,e.params);break;default:this.observer.onNotification(e)}}},{key:"pingPongLoop",value:function(e){return hn(this,null,c().mark((function t(){var n,r,i,a,s=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=(null==(n=window.HMS)?void 0:n.PING_TIMEOUT)||12e3,!this.isConnected){t.next=6;break}return t.next=4,this.ping(i);case 4:a=t.sent,this.pongResponseTimes.enqueue(a),a>i?(wn.d(this.TAG,"Pong timeout ".concat(e,", pageHidden=").concat("undefined"!=typeof document&&document.hidden)),this.id===e&&this.setIsConnected(!1,"ping pong failure")):setTimeout((function(){return s.pingPongLoop(e)}),(null==(r=window.HMS)?void 0:r.PING_INTERVAL)||1e3);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"call",value:function(e,t){return hn(this,null,c().mark((function n(){var r,i,a,s;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=3,i=nr.ServerErrors(500,e,"Default ".concat(e," error")),a=0;case 2:if(!(a<r)){n.next=20;break}return n.prev=3,wn.d(this.TAG,"Try number ".concat(a+1," sending ").concat(e),t),n.next=7,this.internalCall(e,t);case 7:return n.abrupt("return",n.sent);case 10:if(n.prev=10,n.t0=n.catch(3),i=n.t0,wn.e(this.TAG,"Failed sending ".concat(e),{method:e,try:a+1,params:t,error:i}),5===parseInt("".concat(i.code/100))||429===i.code){n.next=14;break}return n.abrupt("break",20);case 14:return s=1e3*(2+2*Math.random()),n.next=17,Fr(s);case 17:a++,n.next=2;break;case 20:throw wn.e("Sending ".concat(e," over WS failed after ").concat(r," retries"),{method:e,params:t,error:i}),i;case 21:case"end":return n.stop()}}),n,this,[[3,10]])})))}}]),e}(),Ka="[HMSTransport]:",Ha=function(){function e(t,n,r,i,a,s){var o,u,l=this;y(this,e),this.observer=t,this.deviceManager=n,this.store=r,this.eventBus=i,this.analyticsEventsService=a,this.analyticsTimer=s,this.state=ia.Disconnected,this.trackStates=new Map,this.publishConnection=null,this.subscribeConnection=null,this.maxSubscribeBitrate=0,this.joinRetryCount=0,this.callbacks=new Map,this.signalObserver={onOffer:function(e){return hn(l,null,c().mark((function t(){var n,r,i,a,s;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.subscribeConnection){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,this.subscribeConnection.setRemoteDescription(e);case 5:wn.d(Ka,"[SUBSCRIBE] Adding ".concat(this.subscribeConnection.candidates.length," ice-candidates"),this.subscribeConnection.candidates),n=S(this.subscribeConnection.candidates),t.prev=7,n.s();case 9:if((r=n.n()).done){t.next=15;break}return i=r.value,t.next=13,this.subscribeConnection.addIceCandidate(i);case 13:t.next=9;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(7),n.e(t.t0);case 20:return t.prev=20,n.f(),t.finish(20);case 23:return this.subscribeConnection.candidates.length=0,t.next=26,this.subscribeConnection.createAnswer();case 26:return a=t.sent,t.next=29,this.subscribeConnection.setLocalDescription(a);case 29:this.signal.answer(a),wn.d(Ka,"[role=SUBSCRIBE] onOffer renegotiation DONE \u2705"),t.next=37;break;case 33:throw t.prev=33,t.t1=t.catch(0),wn.d(Ka,"[role=SUBSCRIBE] onOffer renegotiation FAILED \u274c"),this.state=ia.Failed,s=t.t1 instanceof Gn?t.t1:rr.Unknown(Kn.PUBLISH,t.t1.message),this.eventBus.analytics.publish(Vn.subscribeFail(s)),s;case 37:case"end":return t.stop()}}),t,this,[[0,33],[7,17,20,23]])})))},onTrickle:function(e){return hn(l,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(null==(n=e.target===sa.Publish?this.publishConnection:this.subscribeConnection)?void 0:n.remoteDescription)){t.next=6;break}return t.next=4,n.addIceCandidate(e.candidate);case 4:t.next=7;break;case 6:null==n||n.candidates.push(e.candidate);case 7:case"end":return t.stop()}}),t,this)})))},onNotification:function(e){return l.observer.onNotification(e)},onServerError:function(e){return hn(l,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.observer.onStateChange(ia.Failed,e);case 2:case"end":return t.stop()}}),t,this)})))},onFailure:function(e){l.joinParameters&&l.retryScheduler.schedule({category:Ui.SignalDisconnect,error:e,task:l.retrySignalDisconnectTask,originalState:l.state})},onOffline:function(e){return hn(l,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:wn.d(Ka,"socket offline",ia[this.state]);try{this.state!==ia.Leaving&&this.joinParameters&&this.retryScheduler.schedule({category:Ui.SignalDisconnect,error:Xn.WebSocketConnectionLost(Kn.RECONNECT_SIGNAL,e),task:this.retrySignalDisconnectTask,originalState:this.state})}catch(n){console.error(n)}case 2:case"end":return t.stop()}}),t,this)})))},onOnline:function(){var e;wn.d(Ka,"socket online",ia[l.state]),l.analyticsSignalTransport.flushFailedEvents(null==(e=l.store.getLocalPeer())?void 0:e.peerId)},onNetworkOnline:function(){l.analyticsEventsService.flushFailedClientEvents()}},this.signal=new Va(this.signalObserver),this.analyticsSignalTransport=new da(this.signal),this.publishConnectionObserver={onRenegotiationNeeded:function(){return hn(l,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.performPublishRenegotiation();case 2:case"end":return e.stop()}}),e,this)})))},onIceConnectionChange:function(e){return hn(l,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:("disconnected"===e?wn.w.bind(wn):wn.d.bind(wn))(Ka,"Publish ice connection state change: ".concat(e));case 1:case"end":return t.stop()}}),t)})))},onConnectionStateChange:function(e){return hn(l,null,c().mark((function t(){var n,r,i,a,s,o=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(("disconnected"===e?wn.w.bind(wn):wn.d.bind(wn))(Ka,"Publish connection state change: ".concat(e)),"connected"===e&&(null==(n=this.publishConnection)||n.logSelectedIceCandidatePairs()),"disconnected"===e&&setTimeout((function(){var e,t,n,r,i;"disconnected"===(null==(e=o.publishConnection)?void 0:e.connectionState)&&o.handleIceConnectionFailure(sa.Publish,tr.ICEDisconnected(Kn.PUBLISH,"local candidate - ".concat(null==(n=null==(t=o.publishConnection)?void 0:t.selectedCandidatePair)?void 0:n.local.candidate,"; remote candidate - ").concat(null==(i=null==(r=o.publishConnection)?void 0:r.selectedCandidatePair)?void 0:i.remote.candidate)))}),5e3),t.t0="failed"===e,!t.t0){t.next=7;break}return t.next=7,this.handleIceConnectionFailure(sa.Publish,tr.ICEFailure(Kn.PUBLISH,"local candidate - ".concat(null==(i=null==(r=this.publishConnection)?void 0:r.selectedCandidatePair)?void 0:i.local.candidate,"; remote candidate - ").concat(null==(s=null==(a=this.publishConnection)?void 0:a.selectedCandidatePair)?void 0:s.remote.candidate)));case 7:case"end":return t.stop()}}),t,this)})))}},this.subscribeConnectionObserver={onApiChannelMessage:function(e){l.observer.onNotification(JSON.parse(e))},onTrackAdd:function(e){wn.d(Ka,"[Subscribe] onTrackAdd","".concat(e)),l.observer.onTrackAdd(e)},onTrackRemove:function(e){wn.d(Ka,"[Subscribe] onTrackRemove","".concat(e)),l.observer.onTrackRemove(e)},onIceConnectionChange:function(e){return hn(l,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:("disconnected"===e?wn.w.bind(wn):wn.d.bind(wn))(Ka,"Subscribe ice connection state change: ".concat(e)),"connected"===e&&(n=this.callbacks.get(ei),this.callbacks.delete(ei),n&&n.promise.resolve(!0));case 1:case"end":return t.stop()}}),t,this)})))},onConnectionStateChange:function(e){return hn(l,null,c().mark((function t(){var n,r,i,a,s=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(("disconnected"===e?wn.w.bind(wn):wn.d.bind(wn))(Ka,"Subscribe connection state change: ".concat(e)),t.t0="failed"===e,!t.t0){t.next=5;break}return t.next=5,this.handleIceConnectionFailure(sa.Subscribe,tr.ICEFailure(Kn.SUBSCRIBE,"local candidate - ".concat(null==(r=null==(n=this.subscribeConnection)?void 0:n.selectedCandidatePair)?void 0:r.local.candidate,"; remote candidate - ").concat(null==(a=null==(i=this.subscribeConnection)?void 0:i.selectedCandidatePair)?void 0:a.remote.candidate)));case 5:"disconnected"===e&&setTimeout((function(){var e,t,n,r,i;"disconnected"===(null==(e=s.subscribeConnection)?void 0:e.connectionState)&&s.handleIceConnectionFailure(sa.Subscribe,tr.ICEDisconnected(Kn.SUBSCRIBE,"local candidate - ".concat(null==(n=null==(t=s.subscribeConnection)?void 0:t.selectedCandidatePair)?void 0:n.local.candidate,"; remote candidate - ").concat(null==(i=null==(r=s.subscribeConnection)?void 0:r.selectedCandidatePair)?void 0:i.remote.candidate)))}),5e3),"connected"===e&&this.handleSubscribeConnectionConnected();case 7:case"end":return t.stop()}}),t,this)})))}},this.handleLocalRoleUpdate=function(e){return hn(l,[e],c().mark((function e(t){var n,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.oldRole,r=t.newRole,e.t0=!(!this.doesRoleNeedWebRTC(n)&&this.doesRoleNeedWebRTC(r)),e.t0){e.next=7;break}return wn.i(Ka,"Local peer role updated to webrtc role, creating PeerConnections and performing inital publish negotiation \u23f3"),this.createPeerConnections(),e.next=7,this.negotiateOnFirstPublish();case 7:case"end":return e.stop()}}),e,this)})))},this.retryPublishIceFailedTask=function(){return hn(l,null,c().mark((function e(){var t,n=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.publishConnection||"connected"===this.publishConnection.iceConnectionState&&"connected"===this.publishConnection.connectionState){e.next=6;break}return t=new Promise((function(e,t){n.callbacks.set(Xr,{promise:{resolve:e,reject:t},action:Kn.RESTART_ICE,extra:{}})})),e.next=4,this.performPublishRenegotiation({iceRestart:!0});case 4:return e.next=6,t;case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e,this)})))},this.retrySubscribeIceFailedTask=function(){return hn(l,null,c().mark((function e(){var t,n,r=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.subscribeConnection||"connected"===this.subscribeConnection.iceConnectionState&&"connected"===this.subscribeConnection.connectionState){e.next=3;break}return t=new Promise((function(e,t){r.callbacks.set(ei,{promise:{resolve:e,reject:t},action:Kn.RESTART_ICE,extra:{}})})),n=new Promise((function(e){setTimeout(e,6e4,!1)})),e.abrupt("return",Promise.race([t,n]));case 3:return e.abrupt("return",!0);case 4:case"end":return e.stop()}}),e,this)})))},this.retrySignalDisconnectTask=function(){return hn(l,null,c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(wn.d(Ka,"retrySignalDisconnectTask",{signalConnected:this.signal.isConnected}),this.signal.isConnected){e.next=8;break}return e.prev=1,e.next=4,this.internalConnect(this.joinParameters.authToken,this.joinParameters.endpoint,this.joinParameters.peerId);case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:if(!this.store.getRoom().joinedAt){e.next=17;break}if(e.t2=this.signal.isConnected,!e.t2){e.next=14;break}return e.next=13,this.retryPublishIceFailedTask();case 13:e.t2=e.sent;case 14:e.t1=e.t2,e.next=18;break;case 17:e.t1=this.signal.isConnected;case 18:return t=e.t1,e.abrupt("return",(this.signal.trackUpdate(this.trackStates),t));case 20:case"end":return e.stop()}}),e,this,[[1,6]])})))},this.webrtcInternals=new Na(this.store,this.eventBus,null==(o=this.publishConnection)?void 0:o.nativeConnection,null==(u=this.subscribeConnection)?void 0:u.nativeConnection);this.retryScheduler=new ua((function(e,t){return hn(l,null,c().mark((function n(){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.t0=e!==this.state,!n.t0){n.next=5;break}return this.state=e,n.next=5,this.observer.onStateChange(this.state,t);case 5:case"end":return n.stop()}}),n,this)})))}),this.sendErrorAnalyticsEvent.bind(this)),this.eventBus.statsUpdate.subscribe((function(e){var t,n,r=(null==(n=null==(t=e.getLocalPeerStats())?void 0:t.subscribe)?void 0:n.bitrate)||0;l.maxSubscribeBitrate=Math.max(l.maxSubscribeBitrate,r)}))}return k(e,[{key:"getWebrtcInternals",value:function(){return this.webrtcInternals}},{key:"isFlagEnabled",value:function(e){var t,n=null==(t=this.initConfig)?void 0:t.config;return((null==n?void 0:n.enabledFlags)||[]).includes(e)}},{key:"preview",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return hn(this,null,c().mark((function a(){var s;return c().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.connect(e,t,n,r,i);case 2:return s=a.sent,a.abrupt("return",(this.state=ia.Preview,this.observer.onStateChange(this.state),s));case 4:case"end":return a.stop()}}),a,this)})))}},{key:"join",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return hn(this,null,c().mark((function a(){var s;return c().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(wn.d(Ka,"join: started \u23f0"),a.prev=1,a.t0=!this.signal.isConnected||!this.initConfig,!a.t0){a.next=6;break}return a.next=6,this.connect(e,r,t,n,i);case 6:if(this.validateNotDisconnected("connect"),a.t1=this.initConfig,!a.t1){a.next=16;break}return a.next=11,this.waitForLocalRoleAvailability();case 11:return a.next=13,this.createConnectionsAndNegotiateJoin(n,i);case 13:return a.next=15,this.initRtcStatsMonitor();case 15:wn.d(Ka,"\u2705 join: Negotiated over PUBLISH connection");case 16:a.next=26;break;case 18:return a.prev=18,a.t2=a.catch(1),wn.e(Ka,"join: failed \u274c [token=".concat(e,"]"),a.t2),this.state=ia.Failed,(s=a.t2).isTerminal=s.isTerminal||500===s.code,a.next=25,this.observer.onStateChange(this.state,s);case 25:throw s;case 26:wn.i(Ka,"\u2705 join: successful"),this.state=ia.Joined,this.observer.onStateChange(this.state);case 27:case"end":return a.stop()}}),a,this,[[1,18]])})))}},{key:"connect",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return hn(this,null,c().mark((function a(){var s,o=this;return c().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return this.setTransportStateForConnect(),this.joinParameters=new ra(e,n,r.name,r.metaData,t,i),a.prev=1,a.next=4,this.internalConnect(e,t,n);case 4:return a.abrupt("return",a.sent);case 7:if(a.prev=7,a.t0=a.catch(1),!(a.t0 instanceof Gn&&([Wn.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,Wn.WebSocketConnectionErrors.FAILED_TO_CONNECT,Wn.WebSocketConnectionErrors.ABNORMAL_CLOSE,Wn.InitAPIErrors.ENDPOINT_UNREACHABLE].includes(a.t0.code)||a.t0.code.toString().startsWith("5")||a.t0.code.toString().startsWith("429")))){a.next=15;break}return s=function(){return hn(o,null,c().mark((function r(){return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.internalConnect(e,t,n);case 2:return r.abrupt("return",Boolean(this.initConfig&&this.initConfig.endpoint));case 3:case"end":return r.stop()}}),r,this)})))},a.next=13,this.retryScheduler.schedule({category:Ui.ConnectFailed,error:a.t0,task:s,originalState:this.state,maxFailedRetries:5,changeState:!1});case 13:a.next=16;break;case 15:throw a.t0;case 16:case"end":return a.stop()}}),a,this,[[1,7]])})))}},{key:"leave",value:function(e){return hn(this,null,c().mark((function t(){var n,r,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.retryScheduler.reset(),this.joinParameters=void 0,wn.d(Ka,"leaving in transport"),t.prev=1,this.state=ia.Leaving,null==(n=this.webrtcInternals)||n.cleanUp(),t.next=6,null==(r=this.publishConnection)?void 0:r.close();case 6:return t.next=8,null==(i=this.subscribeConnection)?void 0:i.close();case 8:if(!e){t.next=10;break}try{this.signal.leave(),wn.d(Ka,"signal leave done")}catch(P){wn.w(Ka,"failed to send leave on websocket to server",P)}case 10:return this.analyticsEventsService.flushFailedClientEvents(),this.analyticsEventsService.reset(),t.next=14,this.signal.close();case 14:t.next=19;break;case 16:t.prev=16,t.t0=t.catch(1),this.eventBus.analytics.publish(Vn.disconnect(t.t0)),wn.e(Ka,"leave: FAILED \u274c",t.t0);case 19:return t.prev=19,this.state=ia.Disconnected,this.observer.onStateChange(this.state),t.finish(19);case 22:case"end":return t.stop()}}),t,this,[[1,16,19,22]])})))}},{key:"publish",value:function(e){return hn(this,null,c().mark((function t(){var n,r,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=S(e),t.prev=1,n.s();case 3:if((r=n.n()).done){t.next=15;break}return i=r.value,t.prev=5,t.next=8,this.publishTrack(i);case 8:t.next=13;break;case 10:t.prev=10,t.t0=t.catch(5),this.eventBus.analytics.publish(Vn.publish({devices:this.deviceManager.getDevices(),error:t.t0}));case 13:t.next=3;break;case 15:t.next=20;break;case 17:t.prev=17,t.t1=t.catch(1),n.e(t.t1);case 20:return t.prev=20,n.f(),t.finish(20);case 23:case"end":return t.stop()}}),t,this,[[1,17,20,23],[5,10]])})))}},{key:"unpublish",value:function(e){return hn(this,null,c().mark((function t(){var n,r,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=S(e),t.prev=1,n.s();case 3:if((r=n.n()).done){t.next=9;break}return i=r.value,t.next=7,this.unpublishTrack(i);case 7:t.next=3;break;case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),n.e(t.t0);case 14:return t.prev=14,n.f(),t.finish(14);case 17:case"end":return t.stop()}}),t,this,[[1,11,14,17]])})))}},{key:"sendMessage",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.signal.broadcast(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"trackUpdate",value:function(e){var t=Array.from(this.trackStates.values()).find((function(t){return e.type===t.type&&e.source===t.source}));if(t){var n=new Qi(dn(ln({},t),{mute:!e.enabled}));this.trackStates.set(t.track_id,n),wn.d(Ka,"Track Update",this.trackStates,e),this.signal.trackUpdate(new Map([[t.track_id,n]]))}}},{key:"changeRole",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return hn(this,null,c().mark((function r(){return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.signal.requestRoleChange({requested_for:e.peerId,role:t,force:n});case 2:case"end":return r.stop()}}),r,this)})))}},{key:"changeRoleOfPeer",value:function(e,t,n){return hn(this,null,c().mark((function r(){return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.signal.requestRoleChange({requested_for:e.peerId,role:t,force:n});case 2:case"end":return r.stop()}}),r,this)})))}},{key:"changeRoleOfPeersWithRoles",value:function(e,t){return hn(this,null,c().mark((function n(){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.signal.requestBulkRoleChange({roles:e.map((function(e){return e.name})),role:t,force:!0});case 2:case"end":return n.stop()}}),n,this)})))}},{key:"acceptRoleChange",value:function(e){return hn(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.signal.acceptRoleChangeRequest({requested_by:null==(n=e.requestedBy)?void 0:n.peerId,role:e.role.name,token:e.token});case 2:case"end":return t.stop()}}),t,this)})))}},{key:"endRoom",value:function(e,t){return hn(this,null,c().mark((function n(){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.signal.endRoom(e,t);case 2:case"end":return n.stop()}}),n,this)})))}},{key:"removePeer",value:function(e,t){return hn(this,null,c().mark((function n(){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.signal.removePeer({requested_for:e,reason:t});case 2:case"end":return n.stop()}}),n,this)})))}},{key:"startRTMPOrRecording",value:function(e){return hn(this,null,c().mark((function t(){var n,r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={meeting_url:e.meetingURL,record:e.record},(null==(n=e.rtmpURLs)?void 0:n.length)&&(r.rtmp_urls=e.rtmpURLs),e.resolution&&(r.resolution=e.resolution),t.next=5,this.signal.startRTMPOrRecording(r);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"stopRTMPOrRecording",value:function(){return hn(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.stopRTMPAndRecording();case 2:case"end":return e.stop()}}),e,this)})))}},{key:"startHLSStreaming",value:function(e){return hn(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={},e&&e.variants&&e.variants.length>0&&(n.variants=e.variants.map((function(e){var t={meeting_url:e.meetingURL};return e.metadata&&(t.metadata=e.metadata),t}))),(null==e?void 0:e.recording)&&(n.hls_recording={single_file_per_layer:e.recording.singleFilePerLayer,hls_vod:e.recording.hlsVod}),t.next=5,this.signal.startHLSStreaming(n);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"stopHLSStreaming",value:function(e){return hn(this,null,c().mark((function t(){var n,r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=4;break}return r={variants:null==(n=null==e?void 0:e.variants)?void 0:n.map((function(e){var t={meeting_url:e.meetingURL};return e.metadata&&(t.metadata=e.metadata),t}))},t.next=4,this.signal.stopHLSStreaming(r);case 4:return t.next=6,this.signal.stopHLSStreaming();case 6:case"end":return t.stop()}}),t,this)})))}},{key:"sendHLSTimedMetadata",value:function(e){return hn(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.length>0)){t.next=4;break}return n={metadata_objs:e},t.next=4,this.signal.sendHLSTimedMetadata(n);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"changeName",value:function(e){return hn(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.store.getLocalPeer(),t.t0=n&&n.name!==e,!t.t0){t.next=5;break}return t.next=5,this.signal.updatePeer({name:e});case 5:case"end":return t.stop()}}),t,this)})))}},{key:"changeMetadata",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.signal.updatePeer({data:e});case 2:case"end":return t.stop()}}),t,this)})))}},{key:"getSessionMetadata",value:function(){return this.signal.getSessionMetadata()}},{key:"setSessionMetadata",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.signal.setSessionMetadata({data:e});case 2:case"end":return t.stop()}}),t,this)})))}},{key:"changeTrackState",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.signal.requestTrackStateChange(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"changeMultiTrackState",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.signal.requestMultiTrackStateChange(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"publishTrack",value:function(e){return hn(this,null,c().mark((function t(){var n,r,i,a=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.publishedTrackId=e.getTrackIDBeingSent(),wn.d(Ka,"\u23f3 publishTrack: trackId=".concat(e.trackId,", toPublishTrackId=").concat(e.publishedTrackId),"".concat(e)),this.trackStates.set(e.publishedTrackId,new Qi(e)),n=new Promise((function(e,t){a.callbacks.set(Xr,{promise:{resolve:e,reject:t},action:Kn.PUBLISH,extra:{}})})),(r=e.stream).setConnection(this.publishConnection),i=this.store.getSimulcastLayers(e.source),r.addTransceiver(e,i),wn.time("publish-".concat(e.trackId,"-").concat(e.type)),t.next=8,n;case 8:return wn.timeEnd("publish-".concat(e.trackId,"-").concat(e.type)),this.store.addTrack(e),t.next=12,r.setMaxBitrateAndFramerate(e).then((function(){wn.d(Ka,"Setting maxBitrate=".concat(e.settings.maxBitrate," kpbs").concat(e instanceof $r?" and maxFramerate=".concat(e.settings.maxFramerate):""," for ").concat(e.source," ").concat(e.type," ").concat(e.trackId))})).catch((function(e){return wn.w(Ka,"Failed setting maxBitrate and maxFramerate",e)}));case 12:wn.d(Ka,"\u2705 publishTrack: trackId=".concat(e.trackId),"".concat(e),this.callbacks);case 13:case"end":return t.stop()}}),t,this)})))}},{key:"unpublishTrack",value:function(e){return hn(this,null,c().mark((function t(){var n,r,i=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return wn.d(Ka,"\u23f3 unpublishTrack: trackId=".concat(e.trackId),"".concat(e)),e.publishedTrackId&&this.trackStates.has(e.publishedTrackId)?this.trackStates.delete(e.publishedTrackId):(n=Array.from(this.trackStates.values()).find((function(t){return e.type===t.type&&e.source===t.source})),n&&this.trackStates.delete(n.track_id)),r=new Promise((function(e,t){i.callbacks.set(Xr,{promise:{resolve:e,reject:t},action:Kn.UNPUBLISH,extra:{}})})),e.stream.removeSender(e),t.next=5,r;case 5:return t.next=7,e.cleanup();case 7:this.store.removeTrack(e.trackId),wn.d(Ka,"\u2705 unpublishTrack: trackId=".concat(e.trackId),this.callbacks);case 9:case"end":return t.stop()}}),t,this)})))}},{key:"waitForLocalRoleAvailability",value:function(){var e=this;if(!this.store.hasRoleDetailsArrived())return new Promise((function(t){e.eventBus.policyChange.subscribeOnce((function(){return t()}))}))}},{key:"createConnectionsAndNegotiateJoin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return hn(this,null,c().mark((function n(){var r;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(r=this.doesLocalPeerNeedWebRTC())&&this.createPeerConnections(),this.analyticsTimer.start(jn.JOIN_RESPONSE),n.next=5,this.negotiateJoinWithRetry({name:e.name,data:e.metaData,autoSubscribeVideo:t,isWebRTC:r});case 5:this.analyticsTimer.end(jn.JOIN_RESPONSE);case 6:case"end":return n.stop()}}),n,this)})))}},{key:"createPeerConnections",value:function(){this.initConfig&&(this.publishConnection||(this.publishConnection=new Ea(this.signal,this.initConfig.rtcConfiguration,this.publishConnectionObserver,this)),this.subscribeConnection||(this.subscribeConnection=new wa(this.signal,this.initConfig.rtcConfiguration,this.subscribeConnectionObserver)))}},{key:"negotiateJoinWithRetry",value:function(e){return hn(this,arguments,c().mark((function e(t){var n,r,i,a,s,o,u,l=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.name,r=t.data,i=t.autoSubscribeVideo,a=t.isWebRTC,s=void 0===a||a,e.prev=1,e.next=4,this.negotiateJoin({name:n,data:r,autoSubscribeVideo:i,isWebRTC:s});case 4:case 15:e.next=18;break;case 6:if(e.prev=6,e.t0=e.catch(1),wn.e(Ka,"Join negotiation failed \u274c",e.t0),o=e.t0 instanceof Gn?e.t0:nr.ServerErrors(500,Kn.JOIN,"Websocket join error - ".concat(e.t0.message)),5!==parseInt("".concat(o.code/100))&&429!==o.code){e.next=17;break}return this.joinRetryCount=0,o.isTerminal=!1,u=function(){return hn(l,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.joinRetryCount++,e.next=3,this.negotiateJoin({name:n,data:r,autoSubscribeVideo:i,isWebRTC:s});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})))},e.next=15,this.retryScheduler.schedule({category:Ui.JoinWSMessageFailed,error:o,task:u,originalState:ia.Joined,maxFailedRetries:3,changeState:!1});case 17:throw e.t0;case 18:case"end":return e.stop()}}),e,this,[[1,6]])})))}},{key:"negotiateJoin",value:function(e){return hn(this,arguments,c().mark((function e(t){var n,r,i,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.name,r=t.data,i=t.autoSubscribeVideo,a=t.isWebRTC,!(void 0===a||a)){e.next=7;break}return e.next=4,this.negotiateJoinWebRTC({name:n,data:r,autoSubscribeVideo:i});case 4:e.t0=e.sent,e.next=10;break;case 7:return e.next=9,this.negotiateJoinNonWebRTC({name:n,data:r,autoSubscribeVideo:i});case 9:e.t0=e.sent;case 10:return e.abrupt("return",e.t0);case 11:case"end":return e.stop()}}),e,this)})))}},{key:"negotiateJoinWebRTC",value:function(e){return hn(this,arguments,c().mark((function e(t){var n,r,i,a,s,o,u,l,d,f;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.name,r=t.data,i=t.autoSubscribeVideo,wn.d(Ka,"\u23f3 join: Negotiating over PUBLISH connection"),this.publishConnection){e.next=3;break}return e.abrupt("return",(wn.e(Ka,"Publish peer connection not found, cannot negotiate"),!1));case 3:return e.next=5,this.publishConnection.createOffer();case 5:return a=e.sent,e.next=8,this.publishConnection.setLocalDescription(a);case 8:return s=this.isFlagEnabled(ya.FLAG_SERVER_SUB_DEGRADATION),o=this.isFlagEnabled(ya.FLAG_SERVER_SIMULCAST),e.next=12,this.signal.join(n,r,!i,s,o,a);case 12:return u=e.sent,e.next=15,this.publishConnection.setRemoteDescription(u);case 15:l=S(this.publishConnection.candidates),e.prev=16,l.s();case 18:if((d=l.n()).done){e.next=24;break}return f=d.value,e.next=22,this.publishConnection.addIceCandidate(f);case 22:e.next=18;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(16),l.e(e.t0);case 29:return e.prev=29,l.f(),e.finish(29);case 32:return e.abrupt("return",(this.publishConnection.initAfterJoin(),!!u));case 33:case"end":return e.stop()}}),e,this,[[16,26,29,32]])})))}},{key:"negotiateJoinNonWebRTC",value:function(e){return hn(this,arguments,c().mark((function e(t){var n,r,i,a,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.name,r=t.data,i=t.autoSubscribeVideo,wn.d(Ka,"\u23f3 join: Negotiating Non-WebRTC"),a=this.isFlagEnabled(ya.FLAG_SERVER_SUB_DEGRADATION),s=this.isFlagEnabled(ya.FLAG_SERVER_SIMULCAST),e.next=5,this.signal.join(n,r,!i,a,s);case 5:return e.abrupt("return",!!e.sent);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"negotiateOnFirstPublish",value:function(){return hn(this,null,c().mark((function e(){var t,n,r,i,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(wn.d(Ka,"\u23f3 Negotiating offer over PUBLISH connection"),this.publishConnection){e.next=2;break}return e.abrupt("return",(wn.e(Ka,"Publish peer connection not found, cannot negotiate"),!1));case 2:return e.next=4,this.publishConnection.createOffer(this.trackStates);case 4:return t=e.sent,e.next=7,this.publishConnection.setLocalDescription(t);case 7:return e.next=9,this.signal.offer(t,this.trackStates);case 9:return n=e.sent,e.next=12,this.publishConnection.setRemoteDescription(n);case 12:r=S(this.publishConnection.candidates),e.prev=13,r.s();case 15:if((i=r.n()).done){e.next=21;break}return a=i.value,e.next=19,this.publishConnection.addIceCandidate(a);case 19:e.next=15;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(13),r.e(e.t0);case 26:return e.prev=26,r.f(),e.finish(26);case 29:return e.abrupt("return",(this.publishConnection.initAfterJoin(),!!n));case 30:case"end":return e.stop()}}),e,this,[[13,23,26,29]])})))}},{key:"performPublishRenegotiation",value:function(e){return hn(this,null,c().mark((function t(){var n,r,i,a;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(wn.d(Ka,"\u23f3 [role=PUBLISH] onRenegotiationNeeded START",this.trackStates),!(n=this.callbacks.get(Xr))){t.next=27;break}if(this.publishConnection){t.next=6;break}return wn.e(Ka,"Publish peer connection not found, cannot renegotiate"),t.abrupt("return");case 6:return t.prev=6,t.next=9,this.publishConnection.createOffer(this.trackStates,e);case 9:return r=t.sent,t.next=12,this.publishConnection.setLocalDescription(r);case 12:return wn.time("renegotiation-offer-exchange"),t.next=15,this.signal.offer(r,this.trackStates);case 15:return i=t.sent,this.callbacks.delete(Xr),wn.timeEnd("renegotiation-offer-exchange"),t.next=20,this.publishConnection.setRemoteDescription(i);case 20:n.promise.resolve(!0),wn.d(Ka,"[role=PUBLISH] onRenegotiationNeeded DONE \u2705"),t.next=27;break;case 24:t.prev=24,t.t0=t.catch(6),a=t.t0 instanceof Gn?t.t0:rr.Unknown(Kn.PUBLISH,t.t0.message),n.promise.reject(a),wn.d(Ka,"[role=PUBLISH] onRenegotiationNeeded FAILED \u274c");case 27:case"end":return t.stop()}}),t,this,[[6,24]])})))}},{key:"handleIceConnectionFailure",value:function(e,t){return hn(this,null,c().mark((function n(){var r;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:(r=this.callbacks.get(e===sa.Publish?Xr:ei))&&r.action===Kn.RESTART_ICE||(e===sa.Publish?this.retryScheduler.schedule({category:Ui.PublishIceConnectionFailed,error:t,task:this.retryPublishIceFailedTask,originalState:ia.Joined}):this.retryScheduler.schedule({category:Ui.SubscribeIceConnectionFailed,error:t,task:this.retrySubscribeIceFailedTask,originalState:ia.Joined,maxFailedRetries:1}));case 2:case"end":return n.stop()}}),n,this)})))}},{key:"internalConnect",value:function(e,t,n){return hn(this,null,c().mark((function r(){var i;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return wn.d(Ka,"connect: started \u23f0"),i=new Date,r.prev=2,this.analyticsTimer.start(jn.INIT),r.next=6,Ua.fetchInitConfig({token:e,peerId:n,userAgent:this.store.getUserAgent(),initEndpoint:t});case 6:return this.initConfig=r.sent,this.analyticsTimer.end(jn.INIT),Ai.setWebsocketEndpoint(this.initConfig.endpoint),this.validateNotDisconnected("post init"),r.next=12,this.openSignal(e,n);case 12:return this.store.setSimulcastEnabled(this.isFlagEnabled(ya.FLAG_SERVER_SIMULCAST)),wn.d(Ka,"Adding Analytics Transport: JsonRpcSignal"),this.analyticsEventsService.setTransport(this.analyticsSignalTransport),this.analyticsEventsService.flush(),r.abrupt("return",this.initConfig);case 19:throw r.prev=19,r.t0=r.catch(2),this.state!==ia.Reconnecting&&this.eventBus.analytics.publish(Vn.connect(r.t0,this.getAdditionalAnalyticsProperties(),i,new Date,t)),wn.d(Ka,"\u274c internal connect: failed",r.t0),r.t0;case 22:case"end":return r.stop()}}),r,this,[[2,19]])})))}},{key:"validateNotDisconnected",value:function(e){if(this.state===ia.Disconnected)throw wn.w(Ka,"aborting join as transport state is disconnected"),rr.ValidationFailed("leave called before join could complete - stage=".concat(e))}},{key:"openSignal",value:function(e,t){return hn(this,null,c().mark((function n(){var r;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.initConfig){n.next=2;break}throw Zn.InitConfigNotAvailable(Kn.INIT,"Init Config not found");case 2:return wn.d(Ka,"\u23f3 internal connect: connecting to ws endpoint",this.initConfig.endpoint),(r=new URL(this.initConfig.endpoint)).searchParams.set("peer",t),r.searchParams.set("token",e),r.searchParams.set("user_agent_v2",this.store.getUserAgent()),this.endpoint=r.toString(),this.analyticsTimer.start(jn.WEBSOCKET_CONNECT),n.next=11,this.signal.open(this.endpoint);case 11:this.analyticsTimer.end(jn.WEBSOCKET_CONNECT),this.analyticsTimer.start(jn.ON_POLICY_CHANGE),this.analyticsTimer.start(jn.ROOM_STATE),wn.d(Ka,"\u2705 internal connect: connected to ws endpoint");case 15:case"end":return n.stop()}}),n,this)})))}},{key:"initRtcStatsMonitor",value:function(){return hn(this,null,c().mark((function e(){var t,n,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==(r=this.webrtcInternals)||r.setPeerConnections({publish:null==(t=this.publishConnection)?void 0:t.nativeConnection,subscribe:null==(n=this.subscribeConnection)?void 0:n.nativeConnection});case 1:case"end":return e.stop()}}),e,this)})))}},{key:"doesRoleNeedWebRTC",value:function(e){var t,n;if(!this.isFlagEnabled(ya.FLAG_NON_WEBRTC_DISABLE_OFFER))return!0;var r=Boolean(e.publishParams.allowed&&(null==(t=e.publishParams.allowed)?void 0:t.length)>0),i=Boolean(e.subscribeParams.subscribeToRoles&&(null==(n=e.subscribeParams.subscribeToRoles)?void 0:n.length)>0);return r||i}},{key:"doesLocalPeerNeedWebRTC",value:function(){var e,t=null==(e=this.store.getLocalPeer())?void 0:e.role;return!t||this.doesRoleNeedWebRTC(t)}},{key:"handleSubscribeConnectionConnected",value:function(){var e;null==(e=this.subscribeConnection)||e.logSelectedIceCandidatePairs();var t=this.callbacks.get(ei);this.callbacks.delete(ei),t&&t.promise.resolve(!0)}},{key:"setTransportStateForConnect",value:function(){if(this.state===ia.Failed&&(this.state=ia.Disconnected),this.state!==ia.Disconnected&&this.state!==ia.Reconnecting)throw nr.AlreadyJoined(Kn.JOIN,"Cannot join a meeting in ".concat(this.state," state"));this.state===ia.Disconnected&&(this.state=ia.Connecting,this.observer.onStateChange(this.state))}},{key:"sendErrorAnalyticsEvent",value:function(e,t){var n,r=this.getAdditionalAnalyticsProperties();switch(t){case Ui.ConnectFailed:n=Vn.connect(e,r);break;case Ui.SignalDisconnect:n=Vn.disconnect(e,r);break;case Ui.JoinWSMessageFailed:n=Vn.join({error:e,time:this.analyticsTimer.getTimeTaken(jn.JOIN),init_response_time:this.analyticsTimer.getTimeTaken(jn.INIT),ws_connect_time:this.analyticsTimer.getTimeTaken(jn.WEBSOCKET_CONNECT),on_policy_change_time:this.analyticsTimer.getTimeTaken(jn.ON_POLICY_CHANGE),local_audio_track_time:this.analyticsTimer.getTimeTaken(jn.LOCAL_AUDIO_TRACK),local_video_track_time:this.analyticsTimer.getTimeTaken(jn.LOCAL_VIDEO_TRACK),retries_join:this.joinRetryCount});break;case Ui.PublishIceConnectionFailed:n=Vn.publish({error:e});break;case Ui.SubscribeIceConnectionFailed:n=Vn.subscribeFail(e)}this.eventBus.analytics.publish(n)}},{key:"getAdditionalAnalyticsProperties",value:function(){var e,t,n,r,i,a,s,o,u=function(){if(yn&&"undefined"!=typeof navigator.connection){var e=navigator.connection;return{downlink:e.downlink,downlinkMax:e.downlinkMax,effectiveType:e.effectiveType,rtt:e.rtt,saveData:e.saveData,type:e.type}}}(),c="undefined"!=typeof document&&document.hidden,l=this.store.getRemoteVideoTracks().filter((function(e){return e.degraded})).length;return{network_info:u,document_hidden:c,num_degraded_tracks:l,bitrate:{publish:null==(r=null==(n=null==(t=null==(e=this.getWebrtcInternals())?void 0:e.getCurrentStats())?void 0:t.getLocalPeerStats())?void 0:n.publish)?void 0:r.bitrate,subscribe:null==(o=null==(s=null==(a=null==(i=this.getWebrtcInternals())?void 0:i.getCurrentStats())?void 0:a.getLocalPeerStats())?void 0:s.subscribe)?void 0:o.bitrate},max_sub_bitrate:this.maxSubscribeBitrate,recent_pong_response_times:this.signal.getPongResponseTimes(),transport_state:this.state}}}]),e}();function za(e){if(!e||0===e.length)throw Zn.InvalidTokenFormat(Kn.INIT,"Token cannot be an empty string or undefined or null");var t=e.split(".");if(3!==t.length)throw Zn.InvalidTokenFormat(Kn.INIT,"Expected 3 '.' separate fields - header, payload and signature respectively");var n=atob(t[1]);try{var r=JSON.parse(n);return{roomId:r.room_id,userId:r.user_id,role:r.role}}catch(C){throw Zn.InvalidTokenFormat(Kn.INIT,"couldn't parse to json - ".concat(C.message))}}var Wa={isAudioMuted:!1,isVideoMuted:!1,audioInputDeviceId:"default",audioOutputDeviceId:"default",videoDeviceId:"default"},qa={published:!1,isInitialised:!1,isReconnecting:!1,isPreviewInProgress:!1,isJoinInProgress:!1,deviceManagersInitialised:!1},Ya=function(){function e(){var t=this;y(this,e),this.TAG="[HMSSdk]:",this.transportState=ia.Disconnected,this.analyticsTimer=new zn,this.sdkState=ln({},qa),this.handleAutoplayError=function(e){var n,r;null==(r=null==(n=t.errorListener)?void 0:n.onError)||r.call(n,e)},this.observer={onNotification:function(e){if(e.method!==Jr.PEER_LEAVE_REQUEST){switch(e.method){case Jr.POLICY_CHANGE:t.analyticsTimer.end(jn.ON_POLICY_CHANGE);break;case Jr.PEER_LIST:t.analyticsTimer.end(jn.PEER_LIST);break;case Jr.ROOM_STATE:t.analyticsTimer.end(jn.ROOM_STATE)}t.notificationManager.handleNotification(e,t.sdkState.isReconnecting)}else t.handlePeerLeaveRequest(e.params)},onTrackAdd:function(e){t.notificationManager.handleTrackAdd(e)},onTrackRemove:function(e){t.notificationManager.handleTrackRemove(e)},onFailure:function(e){var n;null==(n=t.errorListener)||n.onError(e)},onStateChange:function(e,n){return hn(t,null,c().mark((function t(){var r,i,a,s=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=function(e){return hn(s,null,c().mark((function t(){var n,r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.internalLeave(!0,e);case 2:!this.sdkState.isPreviewInProgress&&!this.sdkState.isJoinInProgress&&(null==(r=null==(n=this.errorListener)?void 0:n.onError)||r.call(n,e)),this.sdkState.isReconnecting=!1;case 4:case"end":return t.stop()}}),t,this)})))},t.t0=e,t.next=t.t0===ia.Preview||t.t0===ia.Joined?4:t.t0===ia.Failed?6:t.t0===ia.Reconnecting?9:11;break;case 4:return this.transportState===ia.Reconnecting&&(null==(r=this.listener)||r.onReconnected()),t.abrupt("break",11);case 6:return t.next=8,a(n);case 8:return t.abrupt("break",11);case 9:return this.sdkState.isReconnecting=!0,null==(i=this.listener)||i.onReconnecting(n),t.abrupt("break",11);case 11:this.transportState=e,wn.d(this.TAG,"Transport State Change",this.transportState);case 12:case"end":return t.stop()}}),t,this)})))}},this.handlePeerLeaveRequest=function(e){var n,r=e.requested_by?t.store.getPeerById(e.requested_by):void 0,i={roomEnded:e.room_end,reason:e.reason,requestedBy:r};null==(n=t.listener)||n.onRemovedFromRoom(i),t.internalLeave(!1)},this.handleDeviceChange=function(e){var n,r,i,a,s,o;if(wn.d(t.TAG,"Device Change event",e),null==(r=null==(n=t.deviceChangeListener)?void 0:n.onDeviceChange)||r.call(n,e),e.error&&e.type){var u=e.type.includes("audio")?null==(i=t.localPeer)?void 0:i.audioTrack:null==(a=t.localPeer)?void 0:a.videoTrack;null==(s=t.errorListener)||s.onError(e.error),[Wn.TracksErrors.CANT_ACCESS_CAPTURE_DEVICE,Wn.TracksErrors.DEVICE_IN_USE,Wn.TracksErrors.DEVICE_NOT_AVAILABLE].includes(e.error.code)&&u&&(u.setEnabled(!1),null==(o=t.listener)||o.onTrackUpdate(Jn.TRACK_MUTED,u,t.localPeer))}},this.handleAudioPluginError=function(e){var n;wn.e(t.TAG,"Audio Plugin Error event",e),null==(n=t.errorListener)||n.onError(e)},this.handleLocalRoleUpdate=function(e){return hn(t,[e],c().mark((function e(t){var n,r,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.oldRole,r=t.newRole,e.next=3,this.transport.handleLocalRoleUpdate({oldRole:n,newRole:r});case 3:return e.next=5,null==(i=this.roleChangeManager)?void 0:i.handleLocalPeerRoleUpdate({oldRole:n,newRole:r});case 5:case"end":return e.stop()}}),e,this)})))},this.sendAudioPresenceFailed=function(){var e=er.NoAudioDetected(Kn.PREVIEW);wn.w(t.TAG,"Audio Presence Failure",t.transportState,e)},this.sendJoinAnalyticsEvent=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1?arguments[1]:void 0;t.eventBus.analytics.publish(Vn.join(dn(ln({error:n},t.analyticsTimer.getTimes()),{time:t.analyticsTimer.getTimeTaken(jn.JOIN),is_preview_called:e})))},this.sendPreviewAnalyticsEvent=function(e){t.eventBus.analytics.publish(Vn.preview(dn(ln({error:e},t.analyticsTimer.getTimes(jn.ROOM_STATE)),{time:t.analyticsTimer.getTimeTaken(jn.PREVIEW)})))},this.sendAnalyticsEvent=function(e){t.analyticsEventsService.queue(e).flush()}}return k(e,[{key:"initStoreAndManagers",value:function(){if(this.sdkState.isInitialised)return this.notificationManager.setListener(this.listener),void this.audioSinkManager.setListener(this.listener);this.sdkState.isInitialised=!0,this.store=new Ii,this.eventBus=new Ni,this.networkTestManager=new wi(this.eventBus,this.listener),this.playlistManager=new na(this,this.eventBus),this.notificationManager=new Yi(this.store,this.eventBus,this.listener,this.audioListener),this.deviceManager=new Li(this.store,this.eventBus),this.audioSinkManager=new Di(this.store,this.deviceManager,this.eventBus),this.audioOutput=new Oi(this.deviceManager,this.audioSinkManager),this.audioSinkManager.setListener(this.listener),this.eventBus.autoplayError.subscribe(this.handleAutoplayError),this.localTrackManager=new Si(this.store,this.observer,this.deviceManager,this.eventBus,this.analyticsTimer),this.analyticsEventsService=new Pi(this.store),this.transport=new Ha(this.observer,this.deviceManager,this.store,this.eventBus,this.analyticsEventsService,this.analyticsTimer),this.eventBus.analytics.subscribe(this.sendAnalyticsEvent),this.eventBus.deviceChange.subscribe(this.handleDeviceChange),this.eventBus.audioPluginFailed.subscribe(this.handleAudioPluginError)}},{key:"validateJoined",value:function(e){if(!this.localPeer)throw rr.NotConnected(Kn.VALIDATION,"Not connected - ".concat(e))}},{key:"refreshDevices",value:function(){return hn(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateJoined("refreshDevices"),e.next=3,this.deviceManager.init(!0);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"getWebrtcInternals",value:function(){var e;return null==(e=this.transport)?void 0:e.getWebrtcInternals()}},{key:"getPlaylistManager",value:function(){return this.playlistManager}},{key:"getRecordingState",value:function(){var e;return null==(e=this.store.getRoom())?void 0:e.recording}},{key:"getRTMPState",value:function(){var e;return null==(e=this.store.getRoom())?void 0:e.rtmp}},{key:"getHLSState",value:function(){var e;return null==(e=this.store.getRoom())?void 0:e.hls}},{key:"localPeer",get:function(){var e;return null==(e=this.store)?void 0:e.getLocalPeer()}},{key:"preview",value:function(e,t){return hn(this,null,c().mark((function n(){var r,i,a,s=this;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(va(),pa(),!this.sdkState.isPreviewInProgress){n.next=2;break}return n.abrupt("return",Promise.reject(rr.PreviewAlreadyInProgress(Kn.PREVIEW,"Preview already called")));case 2:return this.analyticsTimer.start(jn.PREVIEW),this.setUpPreview(e,t),e.alwaysRequestPermissions&&this.localTrackManager.requestPermissions().then((function(){return hn(s,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initDeviceManagers();case 2:case"end":return e.stop()}}),e,this)})))})),r=!1,i=!1,a=setTimeout((function(){var e,t;(!r||!i)&&(null==(t=null==(e=s.listener)?void 0:e.onNetworkQuality)||t.call(e,-1))}),3e3),n.abrupt("return",new Promise((function(n,o){var u=function(e){var t;s.analyticsTimer.end(jn.PREVIEW),e&&(null==(t=s.errorListener)||t.onError(e)),s.sendPreviewAnalyticsEvent(e),s.sdkState.isPreviewInProgress=!1,o(e)};s.eventBus.policyChange.subscribeOnce((function(){return hn(s,null,c().mark((function r(){var i,a,s,o,u=this;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.asRole&&(s=this.store.getPolicyForRole(e.asRole))&&(null==(i=this.localPeer)||i.updateRole(s)),r.next=3,this.localTrackManager.getTracksToPublish(e.settings||Wa);case 3:return(o=r.sent).forEach((function(e){return u.setLocalPeerTrack(e)})),(null==(a=this.localPeer)?void 0:a.audioTrack)&&this.initPreviewTrackAudioLevelMonitor(),r.next=8,this.initDeviceManagers();case 8:this.sdkState.isPreviewInProgress=!1,this.analyticsTimer.end(jn.PREVIEW),t.onPreview(this.store.getRoom(),o),this.sendPreviewAnalyticsEvent(),n();case 13:case"end":return r.stop()}}),r,this)})))})),s.eventBus.leave.subscribeOnce(u),s.transport.preview(e.authToken,e.initEndpoint,s.localPeer.peerId,{name:e.userName,metaData:e.metaData||""},e.autoVideoSubscribe).then((function(t){var n;r=!0,clearTimeout(a),t&&e.captureNetworkQualityInPreview&&s.networkTestManager.start(null==(n=t.config)?void 0:n.networkHealth).then((function(){i=!0}))})).catch(u)})));case 5:case"end":return n.stop()}}),n,this)})))}},{key:"join",value:function(e,t){return hn(this,null,c().mark((function n(){var r,i,a,s,o,u,l,d,f,h;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(va(),pa(),!this.sdkState.isPreviewInProgress){n.next=2;break}throw rr.NotReady(Kn.JOIN,"Preview is in progress, can't join");case 2:return this.analyticsTimer.start(jn.JOIN),this.sdkState.isJoinInProgress=!0,o=this.transportState===ia.Preview,u=za(e.authToken),l=u.roomId,d=u.userId,f=u.role,h=null==(i=null==(r=this.localPeer)?void 0:r.role)?void 0:i.name,null==(a=this.networkTestManager)||a.stop(),this.listener=t,this.commonSetup(e,l,t),this.removeDevicesFromConfig(e),this.store.setConfig(e),this.store.createAndSetUserAgent(this.frameworkInfo),Mr.resumeContext(),this.localPeer?(this.localPeer.name=e.userName,this.localPeer.role=this.store.getPolicyForRole(f),this.localPeer.customerUserId=d,this.localPeer.metadata=e.metaData):this.createAndAddLocalPeerToStore(e,f,d),this.roleChangeManager=new xi(this.store,this.transport,this.getAndPublishTracks.bind(this),this.removeTrack.bind(this),this.listener),this.eventBus.localRoleUpdate.subscribe(this.handleLocalRoleUpdate),wn.d(this.TAG,"SDK Store",this.store),wn.d(this.TAG,"\u23f3 Joining room ".concat(l)),wn.time("join-room-".concat(l)),n.prev=5,n.next=8,this.transport.join(e.authToken,this.localPeer.peerId,{name:e.userName,metaData:e.metaData},e.initEndpoint,e.autoVideoSubscribe);case 8:return wn.d(this.TAG,"\u2705 Joined room ".concat(l)),this.analyticsTimer.start(jn.PEER_LIST),n.next=12,this.notifyJoin();case 12:return this.sdkState.isJoinInProgress=!1,this.sendJoinAnalyticsEvent(o),n.next=16,this.publish(e.settings||Wa,h);case 16:n.next=21;break;case 18:throw n.prev=18,n.t0=n.catch(5),this.analyticsTimer.end(jn.JOIN),this.sdkState.isJoinInProgress=!1,null==(s=this.listener)||s.onError(n.t0),this.sendJoinAnalyticsEvent(o,n.t0),wn.e(this.TAG,"Unable to join room",n.t0),n.t0;case 21:wn.timeEnd("join-room-".concat(l));case 22:case"end":return n.stop()}}),n,this,[[5,18]])})))}},{key:"stringifyMetadata",value:function(e){e.metaData&&"string"!=typeof e.metaData?e.metaData=JSON.stringify(e.metaData):e.metaData||(e.metaData="")}},{key:"cleanUp",value:function(){var e,t;this.cleanDeviceManagers(),this.eventBus.analytics.unsubscribe(this.sendAnalyticsEvent),this.analyticsTimer.cleanUp(),Ar.cleanup(),this.playlistManager.cleanup(),wn.cleanUp(),this.sdkState=ln({},qa),this.localPeer&&(null==(e=this.localPeer.audioTrack)||e.cleanup(),this.localPeer.audioTrack=void 0,null==(t=this.localPeer.videoTrack)||t.cleanup(),this.localPeer.videoTrack=void 0),this.store.cleanUp(),this.listener=void 0,this.roleChangeManager&&this.eventBus.localRoleUpdate.unsubscribe(this.roleChangeManager.handleLocalPeerRoleUpdate)}},{key:"leave",value:function(e){return this.internalLeave(e)}},{key:"internalLeave",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;return hn(this,null,c().mark((function n(){var r,i,a,s;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(a=this.store.getRoom())){n.next=10;break}return s=a.id,null==(r=this.networkTestManager)||r.stop(),this.eventBus.leave.publish(t),wn.d(this.TAG,"\u23f3 Leaving room ".concat(s)),n.next=8,null==(i=this.transport)?void 0:i.leave(e);case 8:this.cleanUp(),wn.d(this.TAG,"\u2705 Left room ".concat(s));case 10:case"end":return n.stop()}}),n,this)})))}},{key:"getLocalPeer",value:function(){return this.store.getLocalPeer()}},{key:"getPeers",value:function(){var e=this.store.getPeers();return e.length<50&&wn.d(this.TAG,"Got peers(".concat(e.length,")"),e.toString()),e}},{key:"getAudioOutput",value:function(){return this.audioOutput}},{key:"sendMessage",value:function(e,t){this.sendMessageInternal({message:t,type:e})}},{key:"sendBroadcastMessage",value:function(e,t){return hn(this,null,c().mark((function n(){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.sendMessageInternal({message:e,type:t});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n,this)})))}},{key:"sendGroupMessage",value:function(e,t,n){return hn(this,null,c().mark((function r(){var i;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=this.store.getKnownRoles(),0!==(t.filter((function(e){return i[e.name]}))||[]).length){r.next=3;break}throw rr.ValidationFailed("No valid role is present",t);case 3:return r.next=5,this.sendMessageInternal({message:e,recipientRoles:t,type:n});case 5:return r.abrupt("return",r.sent);case 6:case"end":return r.stop()}}),r,this)})))}},{key:"sendDirectMessage",value:function(e,t,n){return hn(this,null,c().mark((function r(){var i;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.store.getPeerById(t.peerId)){r.next=2;break}throw rr.ValidationFailed("Invalid peer - peer not present in the room",t);case 2:if((null==(i=this.localPeer)?void 0:i.peerId)!==t.peerId){r.next=4;break}throw rr.ValidationFailed("Cannot send message to self");case 4:return r.next=6,this.sendMessageInternal({message:e,recipientPeer:t,type:n});case 6:return r.abrupt("return",r.sent);case 7:case"end":return r.stop()}}),r,this)})))}},{key:"sendMessageInternal",value:function(e){return hn(this,arguments,c().mark((function e(t){var n,r,i,a,s,o,u;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.recipientRoles,r=t.recipientPeer,i=t.type,a=void 0===i?"chat":i,""!==(s=t.message).replace(/\u200b/g," ").trim()){e.next=3;break}throw wn.w(this.TAG,"sendMessage","Ignoring empty message send"),rr.ValidationFailed("Empty message not allowed");case 3:return o=new xn({sender:this.localPeer,type:a,message:s,recipientPeer:r,recipientRoles:n,time:new Date}),wn.d(this.TAG,"Sending Message: ",o),e.next=7,this.transport.sendMessage(o);case 7:return u=e.sent,e.abrupt("return",(o.time=new Date(u.timestamp),o));case 9:case"end":return e.stop()}}),e,this)})))}},{key:"startScreenShare",value:function(e,t){return hn(this,null,c().mark((function n(){var r,i,a,s,o,u,l=this;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(s=this.store.getPublishParams()){n.next=3;break}return n.abrupt("return");case 3:if((o=s.allowed)&&o.includes("screen")){n.next=7;break}return wn.e(this.TAG,"Role ".concat(null==(r=this.localPeer)?void 0:r.role," cannot share screen")),n.abrupt("return");case 7:if(!(null==(a=null==(i=this.localPeer)?void 0:i.auxiliaryTracks)?void 0:a.find((function(e){return"screen"===e.source})))){n.next=9;break}throw Error("Cannot share multiple screens");case 9:return n.next=11,this.getScreenshareTracks(e,t);case 11:if(u=n.sent,this.localPeer){n.next=15;break}return wn.d(this.TAG,"Screenshared when not connected"),u.forEach((function(e){e.cleanup()})),n.abrupt("return");case 15:return n.next=17,this.transport.publish(u);case 17:u.forEach((function(e){var t,n,r;e.peerId=null==(t=l.localPeer)?void 0:t.peerId,null==(n=l.localPeer)||n.auxiliaryTracks.push(e),null==(r=l.listener)||r.onTrackUpdate(Jn.TRACK_ADDED,e,l.localPeer)}));case 18:case"end":return n.stop()}}),n,this)})))}},{key:"stopEndedScreenshare",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return wn.d(this.TAG,"\u2705 Screenshare ended natively"),t.next=3,this.stopScreenShare();case 3:e();case 4:case"end":return t.stop()}}),t,this)})))}},{key:"stopScreenShare",value:function(){return hn(this,null,c().mark((function e(){var t,n,r,i,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(wn.d(this.TAG,"\u2705 Screenshare ended from app"),n=null==(t=this.localPeer)?void 0:t.auxiliaryTracks.filter((function(e){return"screen"===e.source})),!n){e.next=20;break}r=S(n),e.prev=4,r.s();case 6:if((i=r.n()).done){e.next=12;break}return a=i.value,e.next=10,this.removeTrack(a.trackId);case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),r.e(e.t0);case 17:return e.prev=17,r.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[4,14,17,20]])})))}},{key:"addTrack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"regular";return hn(this,null,c().mark((function n(){var r,i,a,s,o,u,l,d;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=3;break}return wn.w(this.TAG,"Please pass a valid MediaStreamTrack"),n.abrupt("return");case 3:if(this.localPeer){n.next=5;break}throw rr.NotConnected(Kn.VALIDATION,"No local peer present, cannot addTrack");case 5:if(!this.localPeer.auxiliaryTracks.find((function(t){return t.trackId===e.id}))){n.next=7;break}return n.abrupt("return");case 7:return o=e.kind,u=new MediaStream([e]),l=new ki(u),d=new("audio"===o?Vr:$r)(l,e,t,this.eventBus),this.setPlaylistSettings({track:e,hmsTrack:d,source:t}),n.next=11,null==(r=this.transport)?void 0:r.publish([d]);case 11:d.peerId=null==(i=this.localPeer)?void 0:i.peerId,null==(a=this.localPeer)||a.auxiliaryTracks.push(d),null==(s=this.listener)||s.onTrackUpdate(Jn.TRACK_ADDED,d,this.localPeer);case 14:case"end":return n.stop()}}),n,this)})))}},{key:"removeTrack",value:function(e){return hn(this,null,c().mark((function t(){var n,r,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.localPeer){t.next=2;break}throw rr.NotConnected(Kn.VALIDATION,"No local peer present, cannot removeTrack");case 2:if(!((r=this.localPeer.auxiliaryTracks.findIndex((function(t){return t.trackId===e})))>-1)){t.next=17;break}if(!(i=this.localPeer.auxiliaryTracks[r]).publishedTrackId){t.next=10;break}return t.next=8,this.transport.unpublish([i]);case 8:t.next=12;break;case 10:return t.next=12,i.cleanup();case 12:"audioplaylist"===i.source?this.playlistManager.stop(dr.audio):"videoplaylist"===i.source&&this.playlistManager.stop(dr.video),this.localPeer.auxiliaryTracks.splice(r,1),null==(n=this.listener)||n.onTrackUpdate(Jn.TRACK_REMOVED,i,this.localPeer),t.next=18;break;case 17:wn.w(this.TAG,"No track found for ".concat(e));case 18:case"end":return t.stop()}}),t,this)})))}},{key:"setAnalyticsLevel",value:function(e){this.analyticsEventsService.level=e}},{key:"setLogLevel",value:function(e){wn.level=e}},{key:"addAudioListener",value:function(e){this.audioListener=e,this.notificationManager.setAudioListener(e)}},{key:"addConnectionQualityListener",value:function(e){this.notificationManager.setConnectionQualityListener(e)}},{key:"changeRole",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return hn(this,null,c().mark((function r(){var i;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.t0=!e.role||e.role.name===t,r.t0){r.next=4;break}return r.next=4,null==(i=this.transport)?void 0:i.changeRoleOfPeer(e,t,n);case 4:case"end":return r.stop()}}),r,this)})))}},{key:"changeRoleOfPeer",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return hn(this,null,c().mark((function r(){var i;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.t0=!e.role||e.role.name===t,r.t0){r.next=4;break}return r.next=4,null==(i=this.transport)?void 0:i.changeRoleOfPeer(e,t,n);case 4:case"end":return r.stop()}}),r,this)})))}},{key:"changeRoleOfPeersWithRoles",value:function(e,t){return hn(this,null,c().mark((function n(){var r;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.t0=e.length<=0||!t,n.t0){n.next=4;break}return n.next=4,null==(r=this.transport)?void 0:r.changeRoleOfPeersWithRoles(e,t);case 4:case"end":return n.stop()}}),n,this)})))}},{key:"acceptChangeRole",value:function(e){return hn(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,null==(n=this.transport)?void 0:n.acceptRoleChange(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"endRoom",value:function(e,t){return hn(this,null,c().mark((function n(){var r;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.localPeer){n.next=2;break}throw rr.NotConnected(Kn.VALIDATION,"No local peer present, cannot end room");case 2:return n.next=4,null==(r=this.transport)?void 0:r.endRoom(e,t);case 4:return n.next=6,this.leave();case 6:case"end":return n.stop()}}),n,this)})))}},{key:"removePeer",value:function(e,t){return hn(this,null,c().mark((function n(){var r;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.localPeer){n.next=2;break}throw rr.NotConnected(Kn.VALIDATION,"No local peer present, cannot remove peer");case 2:if(this.store.getPeerById(e.peerId)){n.next=4;break}throw rr.ValidationFailed("Invalid peer, given peer not present in room",e);case 4:return n.next=6,null==(r=this.transport)?void 0:r.removePeer(e.peerId,t);case 6:case"end":return n.stop()}}),n,this)})))}},{key:"startRTMPOrRecording",value:function(e){return hn(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.localPeer){t.next=2;break}throw rr.NotConnected(Kn.VALIDATION,"No local peer present, cannot start streaming or recording");case 2:return t.next=4,null==(n=this.transport)?void 0:n.startRTMPOrRecording(e);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"stopRTMPAndRecording",value:function(){return hn(this,null,c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.localPeer){e.next=2;break}throw rr.NotConnected(Kn.VALIDATION,"No local peer present, cannot stop streaming or recording");case 2:return e.next=4,null==(t=this.transport)?void 0:t.stopRTMPOrRecording();case 4:case"end":return e.stop()}}),e,this)})))}},{key:"startHLSStreaming",value:function(e){return hn(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.localPeer){t.next=2;break}throw rr.NotConnected(Kn.VALIDATION,"No local peer present, cannot start HLS streaming");case 2:return t.next=4,null==(n=this.transport)?void 0:n.startHLSStreaming(e);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"stopHLSStreaming",value:function(e){return hn(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.localPeer){t.next=2;break}throw rr.NotConnected(Kn.VALIDATION,"No local peer present, cannot stop HLS streaming");case 2:return t.next=4,null==(n=this.transport)?void 0:n.stopHLSStreaming(e);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"sendHLSTimedMetadata",value:function(e){return hn(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.validateJoined("sendHLSTimedMetadata"),t.next=3,null==(n=this.transport)?void 0:n.sendHLSTimedMetadata(e);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"changeName",value:function(e){return hn(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.validateJoined("changeName"),t.next=3,null==(n=this.transport)?void 0:n.changeName(e);case 3:this.notificationManager.updateLocalPeer({name:e});case 4:case"end":return t.stop()}}),t,this)})))}},{key:"changeMetadata",value:function(e){return hn(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.validateJoined("changeMetadata"),t.next=3,null==(n=this.transport)?void 0:n.changeMetadata(e);case 3:this.notificationManager.updateLocalPeer({metadata:e});case 4:case"end":return t.stop()}}),t,this)})))}},{key:"setSessionMetadata",value:function(e){return hn(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.transport.setSessionMetadata(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"getSessionMetadata",value:function(){return hn(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.transport.getSessionMetadata();case 2:return e.abrupt("return",e.sent.data);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"getRoles",value:function(){return Object.values(this.store.getKnownRoles())}},{key:"changeTrackState",value:function(e,t){return hn(this,null,c().mark((function n(){var r,i;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.type!==hr.VIDEO||"regular"===e.source){n.next=3;break}return wn.w(this.TAG,"Muting non-regular video tracks is currently not supported"),n.abrupt("return");case 3:if(e.enabled!==t){n.next=6;break}return wn.w(this.TAG,"Aborting change track state, track already has enabled - ".concat(t),e),n.abrupt("return");case 6:if(this.store.getTrackById(e.trackId)){n.next=8;break}throw rr.ValidationFailed("No track found for change track state",e);case 8:if(i=this.store.getPeerByTrackId(e.trackId)){n.next=11;break}throw rr.ValidationFailed("No peer found for change track state",e);case 11:return n.next=13,null==(r=this.transport)?void 0:r.changeTrackState({requested_for:i.peerId,track_id:e.trackId,stream_id:e.stream.id,mute:!t});case 13:case"end":return n.stop()}}),n,this)})))}},{key:"changeMultiTrackState",value:function(e){return hn(this,null,c().mark((function t(){var n,r,i,a,s;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("boolean"==typeof e.enabled){t.next=2;break}throw rr.ValidationFailed("Pass a boolean for enabled");case 2:return r=e.enabled,i=e.roles,a=e.type,s=e.source,t.next=5,null==(n=this.transport)?void 0:n.changeMultiTrackState({value:!r,type:a,source:s,roles:null==i?void 0:i.map((function(e){return null==e?void 0:e.name}))});case 5:case"end":return t.stop()}}),t,this)})))}},{key:"setFrameworkInfo",value:function(e){this.frameworkInfo=e}},{key:"publish",value:function(e,t){return hn(this,null,c().mark((function n(){var r,i,a,s,o=this;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(![this.store.getPublishParams(),!this.sdkState.published,!mn].every((function(e){return!!e}))){n.next=4;break}return s=t&&t!==(null==(i=null==(r=this.localPeer)?void 0:r.role)?void 0:i.name)?function(){var e;return null==(e=o.roleChangeManager)?void 0:e.handleLocalPeerRoleUpdate({oldRole:o.store.getPolicyForRole(t),newRole:o.localPeer.role})}:function(){return o.getAndPublishTracks(e)},n.next=4,null==(a=null==s?void 0:s())?void 0:a.catch((function(e){var t;wn.e(o.TAG,"Error in publish",e),null==(t=o.listener)||t.onError(e)}));case 4:case"end":return n.stop()}}),n,this)})))}},{key:"getAndPublishTracks",value:function(e){return hn(this,null,c().mark((function t(){var n,r,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.localTrackManager.getTracksToPublish(e);case 2:return i=t.sent,t.next=5,this.setAndPublishTracks(i);case 5:null==(r=null==(n=this.localPeer)?void 0:n.audioTrack)||r.initAudioLevelMonitor(),this.sdkState.published=!0;case 7:case"end":return t.stop()}}),t,this)})))}},{key:"setAndPublishTracks",value:function(e){return hn(this,null,c().mark((function t(){var n,r,i,a;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=S(e),t.prev=1,r.s();case 3:if((i=r.n()).done){t.next=11;break}return a=i.value,t.next=7,this.transport.publish([a]);case 7:this.setLocalPeerTrack(a),null==(n=this.listener)||n.onTrackUpdate(Jn.TRACK_ADDED,a,this.localPeer);case 9:t.next=3;break;case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(1),r.e(t.t0);case 16:return t.prev=16,r.f(),t.finish(16);case 19:return t.next=21,this.initDeviceManagers();case 21:case"end":return t.stop()}}),t,this,[[1,13,16,19]])})))}},{key:"setLocalPeerTrack",value:function(e){var t;switch(e.peerId=null==(t=this.localPeer)?void 0:t.peerId,e.type){case hr.AUDIO:this.localPeer.audioTrack=e;break;case hr.VIDEO:this.localPeer.videoTrack=e}}},{key:"initDeviceManagers",value:function(){return hn(this,null,c().mark((function e(){var t,n,r,i,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.sdkState.deviceManagersInitialised,e.t0){e.next=12;break}return this.sdkState.deviceManagersInitialised=!0,e.next=5,this.deviceManager.init();case 5:return e.next=7,this.deviceManager.updateOutputDevice(null==(n=null==(t=this.store.getConfig())?void 0:t.settings)?void 0:n.audioOutputDeviceId);case 7:if(e.t1=e.sent,e.t1){e.next=11;break}return e.next=11,this.deviceManager.updateOutputDevice(null==(i=null==(r=Ar.getSelection())?void 0:r.audioOutput)?void 0:i.deviceId);case 11:this.audioSinkManager.init(null==(a=this.store.getConfig())?void 0:a.audioSinkElementId);case 12:case"end":return e.stop()}}),e,this)})))}},{key:"cleanDeviceManagers",value:function(){this.eventBus.deviceChange.unsubscribe(this.handleDeviceChange),this.eventBus.audioPluginFailed.unsubscribe(this.handleAudioPluginError),this.eventBus.autoplayError.unsubscribe(this.handleAutoplayError),this.deviceManager.cleanUp(),this.audioSinkManager.cleanUp()}},{key:"initPreviewTrackAudioLevelMonitor",value:function(){var e,t=this,n=null==(e=this.localPeer)?void 0:e.audioTrack;null==n||n.initAudioLevelMonitor(),this.eventBus.trackAudioLevelUpdate.subscribe((function(e){var r,i=e&&e.track.trackId===(null==n?void 0:n.trackId)?[{audioLevel:e.audioLevel,peer:t.localPeer,track:n}]:[];t.store.updateSpeakers(i),null==(r=t.audioListener)||r.onAudioLevelUpdate(i)})),this.eventBus.localAudioSilence.subscribe(this.sendAudioPresenceFailed)}},{key:"notifyJoin",value:function(){var e,t=this,n=this.store.getLocalPeer(),r=this.store.getRoom();return r.joinedAt=new Date,n&&(n.joinedAt=r.joinedAt),(null==n?void 0:n.role)?(this.analyticsTimer.end(jn.JOIN),void(null==(e=this.listener)||e.onJoin(r))):new Promise((function(e,n){t.eventBus.policyChange.subscribeOnce((function(){var n;t.analyticsTimer.end(jn.JOIN),null==(n=t.listener)||n.onJoin(r),e()})),t.eventBus.leave.subscribeOnce((function(e){n(e)}))}))}},{key:"setUpPreview",value:function(e,t){this.listener=t,this.sdkState.isPreviewInProgress=!0;var n=za(e.authToken),r=n.roomId,i=n.userId,a=n.role;this.commonSetup(e,r,t),this.store.setConfig(e),this.store.createAndSetUserAgent(this.frameworkInfo),this.createAndAddLocalPeerToStore(e,e.asRole||a,i),wn.d(this.TAG,"SDK Store",this.store)}},{key:"setPlaylistSettings",value:function(e){return hn(this,arguments,c().mark((function e(t){var n,r,i,a,s,o,u;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.track,r=t.hmsTrack,"videoplaylist"!==(i=t.source)){e.next=8;break}return a={},"audio"===n.kind?a.maxBitrate=64:(a.maxBitrate=1e3,s=n.getSettings(),o=s.width,u=s.height,a.width=o,a.height=u),e.next=6,r.setSettings(a);case 6:e.next=12;break;case 8:if(e.t0="audioplaylist"===i,!e.t0){e.next=12;break}return e.next=12,r.setSettings({maxBitrate:64});case 12:case"end":return e.stop()}}),e)})))}},{key:"createAndAddLocalPeerToStore",value:function(e,t,n){var r=this.store.getPolicyForRole(t),i=new Pn({name:e.userName||"",customerUserId:n,metadata:e.metaData||"",role:r});this.store.addPeer(i)}},{key:"commonSetup",value:function(e,t,n){this.stringifyMetadata(e),e.initEndpoint||(e.initEndpoint="https://prod-init.100ms.live"),this.errorListener=n,this.deviceChangeListener=n,this.initStoreAndManagers(),this.store.setErrorListener(this.errorListener),this.store.getRoom()||this.store.setRoom(new Rn(t,this.store))}},{key:"removeDevicesFromConfig",value:function(e){this.store.getConfig()&&e.settings&&(delete e.settings.audioOutputDeviceId,delete e.settings.videoDeviceId,delete e.settings.audioInputDeviceId)}},{key:"getScreenshareTracks",value:function(e,t){return hn(this,null,c().mark((function n(){var r,i,a,s,o,u,l=this;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.localTrackManager.getLocalScreen(t);case 2:if(r=n.sent,i=p(r,2),a=i[0],s=i[1],o=function(){l.stopEndedScreenshare(e)},u=[],!(null==t?void 0:t.audioOnly)){n.next=14;break}if(a.nativeTrack.stop(),s){n.next=11;break}throw er.NothingToReturn(Kn.TRACK,"Select share audio when sharing screen","No audio found");case 11:u.push(s),s.nativeTrack.onended=o,n.next=15;break;case 14:u.push(a),a.nativeTrack.onended=o,s&&u.push(s);case 15:return n.abrupt("return",u);case 16:case"end":return n.stop()}}),n,this)})))}}]),e}();function Qa(e,t){return e===t}function Ja(e,t,n){if(null===t||null===n||t.length!==n.length)return!1;for(var r=t.length,i=0;i<r;i++)if(!e(t[i],n[i]))return!1;return!0}function $a(e){var t=Array.isArray(e[0])?e[0]:e;if(!t.every((function(e){return"function"===typeof e}))){var n=t.map((function(e){return typeof e})).join(", ");throw new Error("Selector creators expect all input-selectors to be functions, instead received the following types: ["+n+"]")}return t}wn.i("adapter","".concat(jt.browserDetails.browser," v").concat(jt.browserDetails.version));var Xa,Za,es=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(){for(var t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];var a=0,s=r.pop(),o=$a(r),u=e.apply(void 0,[function(){return a++,s.apply(null,arguments)}].concat(n)),c=e((function(){for(var e=[],t=o.length,n=0;n<t;n++)e.push(o[n].apply(null,arguments));return u.apply(null,e)}));return c.resultFunc=s,c.dependencies=o,c.recomputations=function(){return a},c.resetRecomputations=function(){return a=0},c}}((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Qa,n=null,r=null;return function(){return Ja(t,n,arguments)||(r=e.apply(null,arguments)),n=arguments,r}}));var ts,ns=Object.defineProperty,rs=Object.defineProperties,is=Object.getOwnPropertyDescriptors,as=Object.getOwnPropertySymbols,ss=Object.prototype.hasOwnProperty,os=Object.prototype.propertyIsEnumerable,us=function(e,t,n){return t in e?ns(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},cs=function(e,t){for(var n in t||(t={}))ss.call(t,n)&&us(e,n,t[n]);if(as){var r,i=S(as(t));try{for(i.s();!(r=i.n()).done;){n=r.value;os.call(t,n)&&us(e,n,t[n])}}catch(a){i.e(a)}finally{i.f()}}return e},ls=function(e,t){return rs(e,is(t))},ds=function(e,t,n){return new Promise((function(r,i){var a=function(e){try{o(n.next(e))}catch(te){i(te)}},s=function(e){try{o(n.throw(e))}catch(te){i(te)}},o=function(e){return e.done?r(e.value):Promise.resolve(e.value).then(a,s)};o((n=n.apply(e,t)).next())}))},fs=function(e,t){return function(){return t||e((t={exports:{}}).exports,t),t.exports}}((function(e,t){t.exports={version:"0.8.3",license:"MIT",main:"dist/index.cjs.js",module:"dist/index.js",typings:"dist/index.d.ts",files:["dist","src"],engines:{node:">=12"},exports:{".":{require:"./dist/index.cjs.js",import:"./dist/index.js",default:"./dist/index.js"}},scripts:{prestart:"rm -rf dist && yarn types:build",start:'concurrently "yarn dev" "yarn types"',dev:"node ../../scripts/dev","build:only":"node ../../scripts/build",build:"yarn build:only && yarn types:build",types:"tsc -w","types:build":"tsc -p tsconfig.json",format:"prettier --write src/**/*.ts",test:"jest --maxWorkers=1","test:watch":"jest --watch","test:coverage":"jest --coverage",lint:"eslint -c ../../.eslintrc .","lint:fix":"yarn lint --fix",prepare:"yarn build",size:"size-limit",analyze:"size-limit --why",docs:"rm -rf ./docs && typedoc && rm -f ./docs/README.md && mkdir ./docs/home &&mv ./docs/modules.md ./docs/home/content.md && node ../../scripts/docs-store && npx prettier --write './docs/**/*'"},name:"@100mslive/hms-video-store",author:"100ms",sideEffects:!1,dependencies:{"@100mslive/hms-video":"0.7.3",eventemitter2:"^6.4.7",immer:"^9.0.6",reselect:"4.0.0",zustand:"3.5.7"},devDependencies:{"ts-node":"^10.4.0",tslib:"^2.2.0"},description:"This is an addon to the core sdk provided by 100ms. It abstracts away the intricacies of data management and provides a flux based reactive data store where data flows in only one direction.",repository:{type:"git",url:"git+https://github.com/100mslive/hms-video-store.git"},keywords:["video","webrtc","conferencing","100ms"],bugs:{url:"https://github.com/100mslive/hms-video-store/issues"},homepage:"https://github.com/100mslive/hms-video-store#readme",gitHead:"8193e1162ae5138fe8fc001aaecce1cf7624bd9e"}}));!function(e){e.Disconnected="Disconnected",e.Preview="Preview",e.Connecting="Connecting",e.Connected="Connected",e.Reconnecting="Reconnecting",e.Disconnecting="Disconnecting",e.Failed="Failed"}(ts||(ts={}));var hs,ps,vs,gs,ms=function(){return{room:{id:"",isConnected:!1,name:"",peers:[],localPeer:"",roomState:ts.Disconnected,recording:{browser:{running:!1},server:{running:!1},hls:{running:!1}},rtmp:{running:!1},hls:{running:!1,variants:[]},sessionId:""},peers:{},tracks:{},playlist:{audio:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1},video:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1}},messages:{byID:{},allIDs:[]},speakers:{},connectionQualities:{},settings:{audioInputDeviceId:"",audioOutputDeviceId:"",videoInputDeviceId:""},devices:{audioInput:[],audioOutput:[],videoInput:[]},roles:{},roleChangeRequests:[],preview:{},errors:[]}},ys=function(){return{peerStats:{},remoteTrackStats:{},localTrackStats:{},localPeer:{id:""}}};!function(e){e.CHAT="chat"}(hs||(hs={})),function(e){e.INFO="info",e.ERROR="error"}(ps||(ps={})),function(e){e.PEER_JOINED="PEER_JOINED",e.PEER_LEFT="PEER_LEFT",e.PEER_LIST="PEER_LIST",e.NEW_MESSAGE="NEW_MESSAGE",e.ERROR="ERROR",e.RECONNECTING="RECONNECTING",e.RECONNECTED="RECONNECTED",e.TRACK_ADDED="TRACK_ADDED",e.TRACK_REMOVED="TRACK_REMOVED",e.TRACK_MUTED="TRACK_MUTED",e.TRACK_UNMUTED="TRACK_UNMUTED",e.TRACK_DEGRADED="TRACK_DEGRADED",e.TRACK_RESTORED="TRACK_RESTORED",e.TRACK_DESCRIPTION_CHANGED="TRACK_DESCRIPTION_CHANGED",e.ROLE_UPDATED="ROLE_UPDATED",e.CHANGE_TRACK_STATE_REQUEST="CHANGE_TRACK_STATE_REQUEST",e.CHANGE_MULTI_TRACK_STATE_REQUEST="CHANGE_MULTI_TRACK_STATE_REQUEST",e.ROOM_ENDED="ROOM_ENDED",e.REMOVED_FROM_ROOM="REMOVED_FROM_ROOM",e.DEVICE_CHANGE_UPDATE="DEVICE_CHANGE_UPDATE",e.PLAYLIST_TRACK_ENDED="PLAYLIST_TRACK_ENDED",e.NAME_UPDATED="NAME_UPDATED",e.METADATA_UPDATED="METADATA_UPDATED"}(vs||(vs={})),function(e){e.audio="audio",e.video="video"}(gs||(gs={}));var bs=(E(Xa={},Qn.PEER_JOINED,vs.PEER_JOINED),E(Xa,Qn.PEER_LEFT,vs.PEER_LEFT),E(Xa,Qn.ROLE_UPDATED,vs.ROLE_UPDATED),E(Xa,Qn.NAME_UPDATED,vs.NAME_UPDATED),E(Xa,Qn.METADATA_UPDATED,vs.METADATA_UPDATED),Xa),ks=(E(Za={},Jn.TRACK_ADDED,vs.TRACK_ADDED),E(Za,Jn.TRACK_REMOVED,vs.TRACK_REMOVED),E(Za,Jn.TRACK_MUTED,vs.TRACK_MUTED),E(Za,Jn.TRACK_UNMUTED,vs.TRACK_UNMUTED),E(Za,Jn.TRACK_DEGRADED,vs.TRACK_DEGRADED),E(Za,Jn.TRACK_RESTORED,vs.TRACK_RESTORED),E(Za,Jn.TRACK_DESCRIPTION_CHANGED,vs.TRACK_DESCRIPTION_CHANGED),Za);function Ts(e,t){var n,r;if(t){var i,a=S(t.auxiliaryTracks);try{for(a.s();!(i=a.n()).done;){var s=e[i.value];ws(s)&&(r=Es(s)?s:r,n=Ss(s)?s:n)}}catch(o){a.e(o)}finally{a.f()}}return{video:n,audio:r}}function Es(e){return e&&"audio"===e.type}function Ss(e){return e&&"video"===e.type}function ws(e){return e&&"screen"===e.source}function xs(e){return e&&"audioplaylist"===e.source}function Rs(e){return e&&"videoplaylist"===e.source}function Cs(e){return!!e&&Boolean(null==e?void 0:e.degraded)}function As(e,t){return!(!t||!e.tracks[t])&&e.tracks[t].enabled}var Is=function(e){return e.room},Ps=(es((function(e){return e.errors}),(function(e){return 0===e.length?null:e.at(-1)})),es(Is,(function(e){return e.id})),function(e){return e.peers}),_s=function(e){return e.messages.byID},Ds=function(e){return e.messages.allIDs},Ls=function(e){return e.tracks},Os=function(e){return e.settings},Ms=function(e){return e.appData},Ns=es([Is],(function(e){return e&&e.isConnected})),Fs=(es([Ns,Is],(function(e,t){return e?void 0!==t.peerCount?t.peerCount||1:t.peers.length:Math.max(void 0!==t.peerCount?t.peerCount:t.peers.length-1,0)})),es([Is,Ps],(function(e,t){return e.peers.map((function(e){return t[e]}))}))),Us=es(Ls,(function(e){return Object.values(e)})),Bs=es(Is,Ps,(function(e,t){return t[e.localPeer]})),js=es(Is,(function(e){return e.localPeer})),Gs=(es(Bs,(function(e){return null==e?void 0:e.name})),es(Bs,(function(e){return null==e?void 0:e.roleName})),es(Bs,(function(e){return null==e?void 0:e.audioTrack}))),Vs=es(Bs,(function(e){return null==e?void 0:e.videoTrack})),Ks=es(Bs,(function(e){return null==e?void 0:e.auxiliaryTracks})),Hs=es([Gs,Vs,Ks],(function(e,t,n){var r=T(n);return e&&r.unshift(e),t&&r.unshift(t),r})),zs=(es(Fs,(function(e){return e.filter((function(e){return!e.isLocal}))})),es(Ps,(function(e){return e.speakers}),(function(e,t){var n=Object.entries(t).sort((function(e,t){var n,r,i=(null==(n=e[1])?void 0:n.audioLevel)||0;return((null==(r=t[1])?void 0:r.audioLevel)||0)>i?1:-1}));if(n.length>0&&n[0][1].audioLevel&&n[0][1].audioLevel>0){var r=n[0][1].peerID;if(r in e)return e[r]}return null})),function(e){var t=Bs(e);return As(e,null==t?void 0:t.audioTrack)}),Ws=function(e){var t=Bs(e);return As(e,null==t?void 0:t.videoTrack)},qs=function(e){var t=Bs(e);return function(e,t){return!(!t||!e.tracks[t])&&e.tracks[t].displayEnabled}(e,null==t?void 0:t.videoTrack)},Ys=es(Bs,Ls,(function(e,t){var n=Ts(t,e),r=n.video,i=n.audio;return!(!r&&!i)})),Qs=es(Ps,Ls,(function(e,t){var n;for(var r in e){var i=e[r],a=Ts(t,i),s=a.video,o=a.audio;if(s)return i;o&&!n&&(n=i)}return n})),Js=(es(Qs,(function(e){return!!e})),es(Ps,Ls,(function(e,t){for(var n in e){var r=e[n],i=Ts(t,r),a=i.audio;if(!i.video&&a)return r}})),es(Ps,Ls,(function(e,t){var n=[],r=[];for(var i in e){var a=e[i],s=Ts(t,a),o=s.video,u=s.audio;o?n.push(a):u&&r.push(a)}return n.concat(r)})),es(Ps,Ls,(function(e,t){for(var n in t){var r=t[n];if(Rs(r)&&Ss(r)&&r.peerId)return e[r.peerId]}})),es(Ps,Ls,(function(e,t){for(var n in t){var r=t[n];if(xs(r)&&r.peerId)return e[r.peerId]}})),es(Us,(function(e){return e.filter(Cs)})),es(Ds,(function(e){return e.length}))),$s=(es(_s,(function(e){return Object.values(e).filter((function(e){return!e.read})).length})),es(Ds,_s,(function(e,t){var n=[];return e.forEach((function(e){n.push(t[e])})),n}))),Xs=es([Is],(function(e){return e&&e.roomState})),Zs=(es(Xs,(function(e){return e===ts.Preview})),es(Is,(function(e){return e.roomState!==ts.Disconnected})),function(e){return e.roles}),eo=(es([Zs],(function(e){return Object.keys(e)})),es([Bs,Zs],(function(e,t){return(null==e?void 0:e.roleName)?t[e.roleName]:null}))),to=(es([eo],(function(e){var t;return!!(null==(t=null==e?void 0:e.subscribeParams)?void 0:t.subscribeToRoles)&&e.subscribeParams.subscribeToRoles.length>0})),es(eo,(function(e){return null==e?void 0:e.permissions}))),no=(es(Is,(function(e){return e.recording})),es(Is,(function(e){return e.rtmp})),es(Is,(function(e){return e.hls}))),ro=(es(Is,(function(e){return e.sessionId})),es(Is,(function(e){return e.startedAt})),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gs.audio;return function(t){return t.playlist[e].list}}),io=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gs.audio;return function(t){return t.playlist[e].selection}},ao=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gs.audio;return function(t){return t.playlist[e].progress}},so=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gs.audio;return function(t){return t.playlist[e].currentTime}},oo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gs.audio;return function(t){return t.playlist[e].playbackRate}},uo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gs.audio;return function(t){return t.playlist[e].volume}},co=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gs.audio;return es(ro(e),(function(e){return Object.values(e)}))},lo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gs.audio;return es(ro(e),io(e),(function(e,t){if(t.id)return e[t.id]}))},fo={selection:io(gs.audio),progress:ao(gs.audio),currentTime:so(gs.audio),playbackRate:oo(gs.audio),volume:uo(gs.audio),list:co(gs.audio),selectedItem:lo(gs.audio)},ho={selection:io(gs.video),progress:ao(gs.video),currentTime:so(gs.video),playbackRate:oo(gs.video),volume:uo(gs.video),list:co(gs.video),selectedItem:lo(gs.video)};function po(e){return function(t){return function(n){return e(n,t)}}}var vo="HMS-Store:",go=function(){function e(){y(this,e)}return k(e,null,[{key:"v",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,[bn.VERBOSE,e].concat(n))}},{key:"d",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log.apply(this,[bn.DEBUG].concat(t))}},{key:"i",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log.apply(this,[bn.INFO].concat(t))}},{key:"w",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log.apply(this,[bn.WARN].concat(t))}},{key:"e",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log.apply(this,[bn.ERROR].concat(t))}},{key:"time",value:function(e){this.log(bn.TIME,"[HMSPerformanceTiming]",e)}},{key:"timeEnd",value:function(e){this.log(bn.TIMEEND,"[HMSPerformanceTiming]",e,e)}},{key:"cleanUp",value:function(){performance.clearMarks(),performance.clearMeasures()}},{key:"log",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(!(this.level.valueOf()>e.valueOf()))switch(e){case bn.VERBOSE:var i;(i=console).log.apply(i,[vo].concat(n));break;case bn.DEBUG:var a;(a=console).debug.apply(a,[vo].concat(n));break;case bn.INFO:var s;(s=console).info.apply(s,[vo].concat(n));break;case bn.WARN:var o;(o=console).warn.apply(o,[vo].concat(n));break;case bn.ERROR:var u;(u=console).error.apply(u,[vo].concat(n));break;case bn.TIME:performance.mark(n[1]);break;case bn.TIMEEND:var c=n[0],l=n[1];try{var d=performance.measure(l,l);this.log(bn.DEBUG,c,l,null==d?void 0:d.duration),performance.clearMarks(l),performance.clearMeasures(l)}catch(d){this.log(bn.DEBUG,c,l,d)}}}}]),e}();go.level=bn.VERBOSE;var mo=function(e,t){return t},yo=function(e,t){return t},bo=function(e,t){return t},ko=es([Ps,mo],(function(e,t){return t?e[t]:null})),To=es([Ls,yo],(function(e,t){return t?e[t]:null})),Eo=es([Ls,yo],(function(e,t){if(!t)return null;var n=e[t];return"video"===(null==n?void 0:n.type)?n:null})),So=es([Ls,yo],(function(e,t){if(!t)return null;var n=e[t];return"audio"===(null==n?void 0:n.type)?n:null})),wo=es([Ls,yo],(function(e,t){if(!t)return null;var n=e[t];return"audio"===(null==n?void 0:n.type)&&"screen"===(null==n?void 0:n.source)?n:null})),xo=es([Ls,yo],(function(e,t){if(!t)return null;var n=e[t];return"video"===(null==n?void 0:n.type)&&"screen"===(null==n?void 0:n.source)?n:null})),Ro=po(ko),Co=(po(es([Ms,function(e,t){return t}],(function(e,t){if(e)return t?e[t]:e}))),po(es(ko,(function(e){return null==e?void 0:e.name}))),po(To)),Ao=po(Eo),Io=(po(So),po(wo),po(xo),po((function(e,t){var n=ko(e,t);if(n&&n.videoTrack&&""!==n.videoTrack)return e.tracks[n.videoTrack]})),po((function(e,t){var n=ko(e,t);if(n&&n.audioTrack&&""!==n.audioTrack)return e.tracks[n.audioTrack]}))),Po=(po((function(e,t){var n=ko(e,t);return(null==n?void 0:n.auxiliaryTracks.map((function(t){return e.tracks[t]})))||[]})),function(e,t){return t?e.speakers[t]:null}),_o=(po(es(Po,(function(e){return(null==e?void 0:e.audioLevel)||0}))),po(es((function(e,t){var n=Io(t)(e);return Po(e,null==n?void 0:n.id)}),(function(e){return(null==e?void 0:e.audioLevel)||0}))),po((function(e,t){if(t)return e.connectionQualities[t]})),po((function(e,t){var n=ko(e,t);if(n){var r=null==n?void 0:n.auxiliaryTracks.find((function(t){return Es(e.tracks[t])}));return r?e.tracks[r]:void 0}})),po(es(Ls,ko,(function(e,t){var n=null==t?void 0:t.auxiliaryTracks.find((function(t){var n=e[t];return Rs(n)&&Ss(n)}));return n?e[n]:void 0}))),po(es(Ls,ko,(function(e,t){var n=null==t?void 0:t.auxiliaryTracks.find((function(t){var n=e[t];return Rs(n)&&Es(n)}));return n?e[n]:void 0}))),po(es(Ls,ko,(function(e,t){var n=null==t?void 0:t.auxiliaryTracks.find((function(t){var n=e[t];return xs(n)&&Es(n)}));return n?e[n]:void 0}))),po(es(Ls,ko,(function(e,t){return Ts(e,t)})))),Do=function(e){return es(_o(e),(function(e){return e.audio}))},Lo=(po((function(e,t){var n=ko(e,t);return As(e,null==n?void 0:n.audioTrack)})),po((function(e,t){var n=ko(e,t);return As(e,null==n?void 0:n.videoTrack)})),po((function(e,t){if(t&&e.tracks[t])return 0===e.tracks[t].volume}))),Oo=(po((function(e,t){var n=ko(e,t);return Lo(null==n?void 0:n.audioTrack)(e)})),po((function(e,t){var n=Do(t)(e);return Lo(null==n?void 0:n.id)(e)})),po((function(e,t){var n=To(e,t);if(n)return"audio"!==n.type?void go.w("Please pass audio track here"):n.volume}))),Mo=(po((function(e,t){var n=ko(e,t);return Oo(null==n?void 0:n.audioTrack)(e)})),po((function(e,t){var n=Do(t)(e);return Oo(null==n?void 0:n.id)(e)})),po((function(e,t){var n=To(e,t);if(n)return"video"!==n.type?void go.w("Please pass video track here"):n.layer})),es([$s,js,mo],(function(e,t,n){if(n)return e.filter((function(e){var r;return!(!e.recipientPeer&&!(null==(r=e.recipientRoles)?void 0:r.length)||e.sender&&![t,n].includes(e.sender))&&[t,n].includes(e.recipientPeer)}))}))),No=es([$s,bo],(function(e,t){if(t)return e.filter((function(e){var n,r;return!!(null==(n=e.recipientRoles)?void 0:n.length)&&(null==(r=e.recipientRoles)?void 0:r.includes(t))}))})),Fo=es($s,(function(e){return e.filter((function(e){var t;return!e.recipientPeer&&!(null==(t=e.recipientRoles)?void 0:t.length)}))})),Uo=es([No,bo],(function(e){return e?e.filter((function(e){return!e.read})).length:0})),Bo=es([Mo,mo],(function(e){return e?e.filter((function(e){return!e.read})).length:0})),jo=(es(Fo,(function(e){return e.filter((function(e){return!e.read})).length})),po(Mo),po(No),po(Uo),po(Bo),es([Ps,Ls],(function(e,t){return Object.values(e).map((function(e){var n;return{peer:e,isAudioEnabled:!!e.audioTrack&&(null==(n=t[e.audioTrack])?void 0:n.enabled)}}))})),es([function(e){return e.roleChangeRequests[0]||null},Ps,Zs],(function(e,t,n){return e?{requestedBy:e.requestedBy?t[e.requestedBy]:void 0,role:n[e.roleName],token:e.token}:null})),es([eo],(function(e){var t,n=!1,r=!1,i=!1;return(null==(t=null==e?void 0:e.publishParams)?void 0:t.allowed)&&(n=e.publishParams.allowed.includes("video"),r=e.publishParams.allowed.includes("audio"),i=e.publishParams.allowed.includes("screen")),{video:n,audio:r,screen:i}})),es([Vs,Ls],(function(e,t){var n=null;return e&&(n=t[e]),(null==n?void 0:n.plugins)||[]})),es([Gs,Ls],(function(e,t){var n=null;return e&&(n=t[e]),(null==n?void 0:n.plugins)||[]})),"hmsNotification"),Go=function(){function e(t){var n=this;y(this,e),this.id=0,this.onNotification=function(e,t){var r=function(n){if(t&&!(Array.isArray(t)?t.includes(n.type):t===n.type))return;e(n)};return n.eventEmitter.addListener(jo,r),function(){n.eventEmitter.removeListener(jo,r)}},this.store=t,this.eventEmitter=new Zt.EventEmitter2({maxListeners:Object.keys(vs).length})}return k(e,[{key:"sendPlaylistTrackEnded",value:function(e){var t=this.createNotification(vs.PLAYLIST_TRACK_ENDED,e,ps.INFO);this.emitEvent(t)}},{key:"sendDeviceChange",value:function(e){var t,n=this.createNotification(vs.DEVICE_CHANGE_UPDATE,e,e.error?ps.ERROR:ps.INFO,"Selected ".concat(e.type," device - ").concat(null==(t=e.selection)?void 0:t.label));this.emitEvent(n)}},{key:"sendLeaveRoom",value:function(e){var t,n=null==(t=e.requestedBy)?void 0:t.name,r=this.createNotification(e.roomEnded||!n?vs.ROOM_ENDED:vs.REMOVED_FROM_ROOM,e,ps.INFO,"".concat(e.roomEnded?"Room ended":"Removed from room"," ").concat(n?"by ".concat(n):""));this.emitEvent(r)}},{key:"sendPeerList",value:function(e){var t=this.createNotification(vs.PEER_LIST,e,ps.INFO);this.emitEvent(t)}},{key:"sendPeerUpdate",value:function(e,t){var n=this.store.getState(Ro(null==t?void 0:t.id))||t,r=bs[e];if(r){var i=this.createNotification(r,n,ps.INFO);this.emitEvent(i)}}},{key:"sendTrackUpdate",value:function(e,t){var n=this.store.getState(Co(t)),r=ks[e];if(r){var i=this.createNotification(r,n,ps.INFO);this.emitEvent(i)}}},{key:"sendMessageReceived",value:function(e){var t=this.createNotification(vs.NEW_MESSAGE,e,ps.INFO);this.emitEvent(t)}},{key:"sendError",value:function(e){var t=this.createNotification(vs.ERROR,e,ps.ERROR);this.emitEvent(t)}},{key:"sendReconnecting",value:function(e){var t=this.createNotification(vs.RECONNECTING,e,ps.ERROR);this.emitEvent(t)}},{key:"sendReconnected",value:function(){var e=this.createNotification(vs.RECONNECTED,null,ps.INFO);this.emitEvent(e)}},{key:"sendChangeTrackStateRequest",value:function(e){var t=this.createNotification(vs.CHANGE_TRACK_STATE_REQUEST,e,ps.INFO);this.emitEvent(t)}},{key:"sendChangeMultiTrackStateRequest",value:function(e){var t=this.createNotification(vs.CHANGE_MULTI_TRACK_STATE_REQUEST,e,ps.INFO);this.emitEvent(t)}},{key:"emitEvent",value:function(e){this.eventEmitter.emit(jo,e)}},{key:"createNotification",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return this.id++,{id:this.id,type:e,message:r,data:t,severity:n}}}]),e}();function Vo(e){return e instanceof Kr||e instanceof yi}var Ko,Ho,zo=function(e,t){var n,r=S($o(Object.keys(e),Object.keys(t)));try{for(r.s();!(n=r.n()).done;){var i=n.value,a=e[i],s=t[i];qo(a,s)?Object.assign(a,s):Yo(a,s)?delete e[i]:Qo(a,s)&&(e[i]=s)}}catch(o){r.e(o)}finally{r.f()}},Wo=function(e,t){e.plugins&&Jo(e.plugins,t.plugins)&&(t.plugins=e.plugins),"video"===e.type&&e.layerDefinitions&&Jo(e.layerDefinitions,t.layerDefinitions)&&(t.layerDefinitions=e.layerDefinitions)},qo=function(e,t){return e&&t},Yo=function(e,t){return e&&!t},Qo=function(e,t){return!e&&t},Jo=function(e,t){if(e===t||0===e.length&&0===(null==t?void 0:t.length))return!0;if(!e||!t||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},$o=function(e,t){var n,r=new Set,i=S(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;r.add(a)}}catch(c){i.e(c)}finally{i.f()}var s,o=S(t);try{for(o.s();!(s=o.n()).done;){var u=s.value;r.add(u)}}catch(c){o.e(c)}finally{o.f()}return Array.from(r)},Xo=function(){function e(){y(this,e)}return k(e,null,[{key:"convertPeer",value:function(e){var t,n,r;return{id:e.peerId,name:e.name,roleName:null==(t=e.role)?void 0:t.name,isLocal:e.isLocal,videoTrack:null==(n=e.videoTrack)?void 0:n.trackId,audioTrack:null==(r=e.audioTrack)?void 0:r.trackId,auxiliaryTracks:e.auxiliaryTracks.map((function(e){return e.trackId})),customerUserId:e.customerUserId,metadata:e.metadata,joinedAt:e.joinedAt}}},{key:"convertTrack",value:function(e,t){var n={id:e.trackId,source:e.source,type:e.type,enabled:e.enabled,displayEnabled:e.enabled,peerId:e.peerId||t};return this.enrichTrack(n,e),n}},{key:"enrichTrack",value:function(t,n){var r=n.getMediaTrackSettings();n instanceof Kr&&(t.volume=n.getVolume()||0),e.updateDeviceID(t,n),"video"===t.type&&("screen"===t.source?(t.displaySurface=r.displaySurface,e.enrichScreenTrack(t,n)):"regular"===t.source&&(t.facingMode=r.facingMode),t.height=r.height,t.width=r.width,e.enrichVideoTrack(t,n)),e.enrichPluginsDetails(t,n)}},{key:"updateDeviceID",value:function(e,t){var n;e.deviceID=t instanceof $r||t instanceof Vr?t.settings.deviceId:null==(n=t.getMediaTrackSettings())?void 0:n.deviceId}},{key:"enrichVideoTrack",value:function(e,t){t instanceof yi&&(e.layer=t.getLayer(),e.preferredLayer=t.getPreferredLayer(),e.degraded=t.degraded),(t instanceof yi||t instanceof $r)&&(Jo(t.getSimulcastDefinitions(),e.layerDefinitions)||(e.layerDefinitions=t.getSimulcastDefinitions()))}},{key:"enrichScreenTrack",value:function(e,t){var n,r;if(t instanceof $r){var i=null==(n=t.getCaptureHandle)?void 0:n.call(t);(null==i?void 0:i.handle)!==(null==(r=e.captureHandle)?void 0:r.handle)&&(e.captureHandle=i),t.isCurrentTab&&(e.displaySurface="selfBrowser")}}},{key:"enrichPluginsDetails",value:function(e,t){(t instanceof $r||t instanceof Vr)&&(Jo(t.getPlugins(),e.plugins)||(e.plugins=t.getPlugins()))}},{key:"convertRoom",value:function(t){var n,r,i=e.convertRecordingStreamingState(null==t?void 0:t.recording,null==t?void 0:t.rtmp,null==t?void 0:t.hls),a=i.recording,s=i.rtmp,o=i.hls;return{id:t.id,name:t.name,localPeer:null!=(r=null==(n=t.localPeer)?void 0:n.peerId)?r:"",recording:a,rtmp:s,hls:o,sessionId:t.sessionId,startedAt:t.startedAt,joinedAt:t.joinedAt,peerCount:t.peerCount}}},{key:"convertMessage",value:function(e){var t,n,r,i,a,s,o;return{sender:null==(t=e.sender)?void 0:t.peerId,senderName:null==(n=e.sender)?void 0:n.name,senderRole:null==(i=null==(r=e.sender)?void 0:r.role)?void 0:i.name,senderUserId:null==(a=e.sender)?void 0:a.customerUserId,recipientPeer:null==(s=e.recipientPeer)?void 0:s.peerId,recipientRoles:null==(o=e.recipientRoles)?void 0:o.map((function(e){return e.name})),time:e.time,type:e.type,message:e.message}}},{key:"convertRoles",value:function(e){var t={};return e&&e.forEach((function(e){t[e.name]=e})),t}},{key:"convertRoleChangeRequest",value:function(e){var t;return{requestedBy:null==(t=e.requestedBy)?void 0:t.peerId,roleName:e.role.name,token:e.token}}},{key:"convertException",value:function(e){return{code:e.code,action:e.action,name:e.name,message:e.message,description:e.description,isTerminal:e.isTerminal,nativeError:e.nativeError,timestamp:new Date}}},{key:"convertDeviceChangeUpdate",value:function(e){var t={devices:e.devices,selection:e.selection,type:e.type};return e.error&&(t.error=this.convertException(e.error)),t}},{key:"convertPlaylist",value:function(e){return{audio:this.getConvertedPlaylistType(e,gs.audio),video:this.getConvertedPlaylistType(e,gs.video)}}},{key:"convertPlaylistItem",value:function(e,t){var n=t.type,r=e.getCurrentSelection(n),i=e.isPlaying(n),a=t.url===(null==r?void 0:r.url);return ls(cs({},t),{type:t.type,selected:a,playing:a&&i})}},{key:"getConvertedPlaylistType",value:function(t,n){var r={},i=t.getCurrentSelection(n),a=t.getCurrentProgress(n),s=t.getVolume(n),o=t.getList(n),u=t.getCurrentIndex(n);return t.getList(n).forEach((function(n){r[n.id]=e.convertPlaylistItem(t,n)})),{list:r,selection:{id:null==i?void 0:i.id,hasPrevious:u>0,hasNext:u<o.length-1},progress:a,volume:s,currentTime:t.getCurrentTime(n),playbackRate:t.getPlaybackRate(n)}}},{key:"convertRecordingStreamingState",value:function(e,t,n){var r;return{recording:{browser:cs({running:!1},null==e?void 0:e.browser),server:cs({running:!1},null==e?void 0:e.server),hls:cs({running:!1},null==e?void 0:e.hls)},rtmp:cs({running:!1},t),hls:{variants:(null==(r=null==n?void 0:n.variants)?void 0:r.map((function(e){return e})))||[],running:!!(null==n?void 0:n.running),error:null==n?void 0:n.error}}}}]),e}(),Zo=function(){function e(t,n,r,i){y(this,e),this.playlistManager=t,this.syncPlaylistState=r,this.store=i,this.type=n}return k(e,[{key:"play",value:function(e){return ds(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=3;break}return go.w("Please pass id to play"),t.abrupt("return");case 3:return t.next=5,this.playlistManager.setEnabled(!0,{id:e,type:this.type});case 5:case"end":return t.stop()}}),t,this)})))}},{key:"pause",value:function(){return ds(this,null,c().mark((function e(){var t,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.type===gs.audio?fo:ho,(n=this.store.getState(t.selection)).id){e.next=4;break}return go.w("No item is currently playing to pause"),e.abrupt("return");case 4:return e.next=6,this.playlistManager.setEnabled(!1,{id:n.id,type:this.type});case 6:case"end":return e.stop()}}),e,this)})))}},{key:"playNext",value:function(){return ds(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.playlistManager.playNext(this.type);case 2:case"end":return e.stop()}}),e,this)})))}},{key:"playPrevious",value:function(){return ds(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.playlistManager.playPrevious(this.type);case 2:case"end":return e.stop()}}),e,this)})))}},{key:"seek",value:function(e){this.playlistManager.seek(e,this.type),this.syncPlaylistState("seekOn".concat(this.type,"Playlist"))}},{key:"seekTo",value:function(e){this.playlistManager.seekTo(e,this.type),this.syncPlaylistState("seekToOn".concat(this.type,"Playlist"))}},{key:"setVolume",value:function(e){this.playlistManager.setVolume(e,this.type),this.syncPlaylistState("setVolumeOn".concat(this.type,"Playlist"))}},{key:"setList",value:function(e){this.playlistManager.setList(e),this.syncPlaylistState("setListOn".concat(this.type,"Playlist"))}},{key:"stop",value:function(){return ds(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.playlistManager.stop(this.type);case 2:this.syncPlaylistState("stop".concat(this.type,"Playlist"));case 3:case"end":return e.stop()}}),e,this)})))}},{key:"setIsAutoplayOn",value:function(e){this.playlistManager.setIsAutoplayOn(this.type,e)}},{key:"setPlaybackRate",value:function(e){this.playlistManager.setPlaybackRate(this.type,e),this.syncPlaylistState("set".concat(this.type,"PlaybackRate"))}},{key:"removeItem",value:function(e){return ds(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.playlistManager.removeItem(e,this.type);case 2:return n=t.sent,t.abrupt("return",(n&&this.syncPlaylistState("remove".concat(this.type,"PlaylistItem")),n));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"clearList",value:function(){return ds(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.playlistManager.clearList(this.type);case 2:this.syncPlaylistState("clear".concat(this.type,"Playlist"));case 3:case"end":return e.stop()}}),e,this)})))}}]),e}(),eu=function(){function e(t,n,r){var i=this;y(this,e),this.hmsSDKTracks={},this.hmsSDKPeers={},this.isRoomJoinCalled=!1,this.ignoredMessageTypes=[],this.setProgress=function(e){var t=e.type,n=e.progress;i.setState((function(e){e.playlist[t].progress=n,e.playlist[t].currentTime=i.sdk.getPlaylistManager().getCurrentTime(t)}),"playlistProgress")},this.syncPlaylistState=function(e){i.setState((function(e){Object.assign(e.playlist,Xo.convertPlaylist(i.sdk.getPlaylistManager()))}),e)},this.sendPeerUpdateNotification=function(e,t){var n=i.store.getState(Ro(t.peerId)),r=bs[e]||"peerUpdate";i.syncRoomState(r),n||(n=i.store.getState(Ro(t.peerId))),i.hmsNotifications.sendPeerUpdate(e,n)},this.setState=function(e,t){return i.store.namedSetState(e,t)},this.store=t,this.sdk=n,this.hmsNotifications=r}return k(e,[{key:"refreshDevices",value:function(){return ds(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sdk.refreshDevices();case 2:case"end":return e.stop()}}),e,this)})))}},{key:"unblockAudio",value:function(){return ds(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sdk.getAudioOutput().unblockAutoplay();case 2:case"end":return e.stop()}}),e,this)})))}},{key:"setVolume",value:function(e,t){return ds(this,null,c().mark((function n(){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t){n.next=5;break}return n.next=3,this.setTrackVolume(e,t);case 3:n.next=8;break;case 5:return n.next=7,this.sdk.getAudioOutput().setVolume(e);case 7:this.syncRoomState("setOutputVolume");case 8:case"end":return n.stop()}}),n,this)})))}},{key:"setAudioOutputDevice",value:function(e){return ds(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.getAudioOutput().setDevice(e);case 2:if(t.t0=t.sent,!t.t0){t.next=5;break}this.setState((function(t){t.settings.audioOutputDeviceId=e}),"setAudioOutputDevice");case 5:case"end":return t.stop()}}),t,this)})))}},{key:"setPreferredLayer",value:function(e,t){return ds(this,null,c().mark((function n(){var r,i;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(i=this.hmsSDKTracks[e])){n.next=17;break}if(!(i instanceof yi)){n.next=14;break}if(t!==$n.NONE){n.next=6;break}return go.w("layer ".concat($n.NONE," will be ignored")),n.abrupt("return");case 6:if((null==(r=this.store.getState(Ao(e)))?void 0:r.preferredLayer)!==t){n.next=9;break}return go.w("preferred layer is already ".concat(t)),n.abrupt("return");case 9:return this.setState((function(n){var r=n.tracks[e];r&&(r.preferredLayer=t)}),"setPreferredLayer"),n.next=12,i.setPreferredLayer(t);case 12:n.next=15;break;case 14:go.w("track ".concat(e," is not a remote video track"));case 15:n.next=18;break;case 17:this.logPossibleInconsistency("track ".concat(e," not present, unable to set preffer layer"));case 18:case"end":return n.stop()}}),n,this)})))}},{key:"preview",value:function(e){return ds(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isRoomJoinCalled){t.next=3;break}return this.logPossibleInconsistency("attempting to call preview after join was called"),t.abrupt("return");case 3:if((n=this.store.getState(Xs))!==ts.Preview&&n!==ts.Connecting){t.next=7;break}return this.logPossibleInconsistency("attempting to call preview while room is in preview/connecting"),t.abrupt("return");case 7:return t.prev=7,this.setState((function(e){e.room.roomState=ts.Connecting}),"connecting"),t.next=11,this.sdkPreviewWithListeners(e);case 11:t.next=16;break;case 13:throw t.prev=13,t.t0=t.catch(7),go.e("Cannot show preview. Failed to connect to room - ",t.t0),t.t0;case 16:case"end":return t.stop()}}),t,this,[[7,13]])})))}},{key:"join",value:function(e){return ds(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isRoomJoinCalled){t.next=3;break}return this.logPossibleInconsistency("room join is called again"),t.abrupt("return");case 3:return t.prev=3,this.isRoomJoinCalled=!0,this.setState((function(e){e.room.roomState=ts.Connecting}),"join"),t.next=8,this.sdkJoinWithListeners(e);case 8:t.next=13;break;case 10:throw t.prev=10,t.t0=t.catch(3),this.isRoomJoinCalled=!1,go.e("Failed to connect to room - ",t.t0),t.t0;case 13:case"end":return t.stop()}}),t,this,[[3,10]])})))}},{key:"leave",value:function(){return ds(this,null,c().mark((function e(){var t,n,r,i=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.store.getState(Ns),n=!0,t||(n=!1,this.logPossibleInconsistency("room leave is called when no room is connected")),r=this.store.getState(Xs),e.abrupt("return",(this.setState((function(e){e.room.roomState=ts.Disconnecting}),"leaving"),this.sdk.leave(n).then((function(){i.resetState("leave"),go.i("left room")})).catch((function(e){go.e("error in leaving room - ",e),i.setState((function(e){e.room.roomState=r}),"revertLeave")}))));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"setScreenShareEnabled",value:function(e,t){return ds(this,null,c().mark((function n(){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("boolean"==typeof t&&(t={audioOnly:t}),n.prev=1,!e){n.next=7;break}return n.next=5,this.startScreenShare(t);case 5:n.next=9;break;case 7:return n.next=9,this.stopScreenShare();case 9:n.next=14;break;case 11:throw n.prev=11,n.t0=n.catch(1),this.hmsNotifications.sendError(Xo.convertException(n.t0)),n.t0;case 14:case"end":return n.stop()}}),n,this,[[1,11]])})))}},{key:"addTrack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"regular";return ds(this,null,c().mark((function n(){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.sdk.addTrack(e,t);case 2:this.syncRoomState("addTrack");case 3:case"end":return n.stop()}}),n,this)})))}},{key:"removeTrack",value:function(e){return ds(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.removeTrack(e);case 2:this.syncRoomState("removeTrack");case 3:case"end":return t.stop()}}),t,this)})))}},{key:"setLocalAudioEnabled",value:function(e){return ds(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.store.getState(Gs),t.t0=n,!t.t0){t.next=5;break}return t.next=5,this.setEnabledTrack(n,e);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"setLocalVideoEnabled",value:function(e){return ds(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.store.getState(Vs),t.t0=n,!t.t0){t.next=5;break}return t.next=5,this.setEnabledTrack(n,e);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"setEnabledTrack",value:function(e,t){return ds(this,null,c().mark((function n(){var r,i,a=this;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((null==(r=this.store.getState().tracks[e])?void 0:r.enabled)!==t){n.next=3;break}return this.logPossibleInconsistency("local track[".concat(e,"] enabled state - ").concat(t)),n.abrupt("return");case 3:return this.setState((function(n){n.tracks[e]?n.tracks[e].displayEnabled=t:a.logPossibleInconsistency("track id not found for setEnabled")}),"displayEnabled"),n.prev=4,n.next=7,this.setEnabledSDKTrack(e,t);case 7:this.syncRoomState("setEnabled"),n.next=13;break;case 10:throw n.prev=10,n.t0=n.catch(4),this.setState((function(n){n.tracks[e].displayEnabled=!t}),"rollbackDisplayEnabled"),this.hmsNotifications.sendError(Xo.convertException(n.t0)),n.t0;case 13:i=t?Jn.TRACK_UNMUTED:Jn.TRACK_MUTED,this.hmsNotifications.sendTrackUpdate(i,e);case 15:case"end":return n.stop()}}),n,this,[[4,10]])})))}},{key:"setAudioSettings",value:function(e){return ds(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.store.getState(Gs),t.t0=n,!t.t0){t.next=6;break}return t.next=5,this.setSDKLocalAudioTrackSettings(n,e);case 5:this.syncRoomState("setAudioSettings");case 6:case"end":return t.stop()}}),t,this)})))}},{key:"setVideoSettings",value:function(e){return ds(this,null,c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.store.getState(Vs),t.t0=n,!t.t0){t.next=6;break}return t.next=5,this.setSDKLocalVideoTrackSettings(n,e);case 5:this.syncRoomState("setVideoSettings");case 6:case"end":return t.stop()}}),t,this)})))}},{key:"sendMessage",value:function(e){this.sendBroadcastMessage(e)}},{key:"sendBroadcastMessage",value:function(e,t){return ds(this,null,c().mark((function n(){var r;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.sdk.sendBroadcastMessage(e,t);case 2:r=n.sent,this.updateMessageInStore(r,{message:e,type:t});case 4:case"end":return n.stop()}}),n,this)})))}},{key:"sendGroupMessage",value:function(e,t,n){return ds(this,null,c().mark((function r(){var i,a,s;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=this.store.getState(Zs),a=t.map((function(e){return i[e]})),r.next=4,this.sdk.sendGroupMessage(e,a,n);case 4:s=r.sent,this.updateMessageInStore(s,{message:e,recipientRoles:t,type:n});case 6:case"end":return r.stop()}}),r,this)})))}},{key:"sendDirectMessage",value:function(e,t,n){return ds(this,null,c().mark((function r(){var i,a;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=this.hmsSDKPeers[t],r.next=3,this.sdk.sendDirectMessage(e,i,n);case 3:a=r.sent,this.updateMessageInStore(a,{message:e,recipientPeer:i.peerId,type:n});case 5:case"end":return r.stop()}}),r,this)})))}},{key:"updateMessageInStore",value:function(e,t){if(!e)throw go.w("sendMessage","Failed to send message",t),Error("sendMessage Failed - ".concat(JSON.stringify(t)));var n=Xo.convertMessage(e);return n.read=!0,n.senderName="You",n.ignored=this.ignoredMessageTypes.includes(n.type),this.putMessageInStore(n),n}},{key:"setMessageRead",value:function(e,t){var n=this;this.setState((function(r){t?r.messages.byID[t]?r.messages.byID[t].read=e:n.logPossibleInconsistency("no message with id is found"):r.messages.allIDs.forEach((function(t){r.messages.byID[t].read=e}))}),"setMessageRead")}},{key:"attachVideo",value:function(e,t){return ds(this,null,c().mark((function n(){var r=this;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.localAndVideoUnmuting(e)){n.next=2;break}return n.abrupt("return",new Promise((function(n){var i=r.store.subscribe((function(a){return ds(r,null,c().mark((function r(){return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.t0=a,!r.t0){r.next=6;break}return r.next=4,this.attachVideoInternal(e,t);case 4:i(),n();case 6:case"end":return r.stop()}}),r,this)})))}),Ws)})));case 2:return n.next=4,this.attachVideoInternal(e,t);case 4:case"end":return n.stop()}}),n,this)})))}},{key:"detachVideo",value:function(e,t){return ds(this,null,c().mark((function n(){var r;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:"video"===(null==(r=this.hmsSDKTracks[e])?void 0:r.type)?r.removeSink(t):(t&&(t.srcObject=null),this.logPossibleInconsistency("no video track found to remove sink"));case 2:case"end":return n.stop()}}),n,this)})))}},{key:"addPluginToVideoTrack",value:function(e,t){return ds(this,null,c().mark((function n(){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.addRemoveVideoPlugin(e,"add",t));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"addPluginToAudioTrack",value:function(e){return ds(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.addRemoveAudioPlugin(e,"add"));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"validateVideoPluginSupport",value:function(e){var t={isSupported:!1};if(!e)return go.w("no plugin passed in for checking support"),t.errMsg="no plugin passed in for checking support",t;var n=this.store.getState(Vs);if(!n)return go.w("video Track not added to local peer yet"),t.errMsg="call this function only after local peer has video track",t;var r=this.hmsSDKTracks[n];return r?t=r.validatePlugin(e):(go.w("track ".concat(n," not present, unable to validate plugin")),t.errMsg="track ".concat(n," not present, unable to validate plugin")),t}},{key:"validateAudioPluginSupport",value:function(e){var t={isSupported:!1};if(!e)return go.w('no plugin passed in for checking support"'),t.errMsg='no plugin passed in for checking support"',t;var n=this.store.getState(Gs);if(!n)return go.w("audio track not added to local peer yet"),t.errMsg="call this function only after local peer has audio track",t;var r=this.hmsSDKTracks[n];return r?t=r.validatePlugin(e):(go.w("track ".concat(n," not present, unable to validate plugin")),t.errMsg="track ".concat(n," not present, unable to validate plugin")),t}},{key:"removePluginFromVideoTrack",value:function(e){return ds(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.addRemoveVideoPlugin(e,"remove"));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"removePluginFromAudioTrack",value:function(e){return ds(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.addRemoveAudioPlugin(e,"remove"));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"changeRole",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return ds(this,null,c().mark((function r(){var i;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=this.hmsSDKPeers[e]){r.next=4;break}return this.logPossibleInconsistency("Unknown peer ID given ".concat(e," for changerole")),r.abrupt("return");case 4:return r.next=6,this.sdk.changeRoleOfPeer(i,t,n);case 6:case"end":return r.stop()}}),r,this)})))}},{key:"changeRoleOfPeer",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return ds(this,null,c().mark((function r(){var i;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=this.hmsSDKPeers[e]){r.next=4;break}return this.logPossibleInconsistency("Unknown peer ID given ".concat(e," for changerole")),r.abrupt("return");case 4:return r.next=6,this.sdk.changeRoleOfPeer(i,t,n);case 6:case"end":return r.stop()}}),r,this)})))}},{key:"changeRoleOfPeersWithRoles",value:function(e,t){return ds(this,null,c().mark((function n(){var r;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=this.sdk.getRoles().filter((function(t){return e.includes(t.name)})),n.next=3,this.sdk.changeRoleOfPeersWithRoles(r,t);case 3:case"end":return n.stop()}}),n,this)})))}},{key:"acceptChangeRole",value:function(e){return ds(this,null,c().mark((function t(){var n,r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n=e.requestedBy?this.hmsSDKPeers[e.requestedBy.id]:void 0)||go.w("peer for which role change is requested no longer available - ".concat(e.requestedBy)),r={requestedBy:n,role:e.role,token:e.token},t.next=5,this.sdk.acceptChangeRole(r);case 5:this.removeRoleChangeRequest(e);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"initAppData",value:function(e){this.setState((function(t){t.appData=e}),"initAppData")}},{key:"setAppData",value:function(e,t,n){var r="Object"===(null==t?void 0:t.constructor.name);this.setState((function(i){if(i.appData)n&&r?Object.assign(i.appData[e],t):i.appData[e]=t;else{var a=E({},e,t);i.appData=a}}),"setAppData-".concat(e))}},{key:"rejectChangeRole",value:function(e){this.removeRoleChangeRequest(e)}},{key:"endRoom",value:function(e,t){return ds(this,null,c().mark((function n(){var r,i;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null==(r=this.store.getState(to))?void 0:r.endRoom){n.next=4;break}return go.w("You are not allowed to perform this action - endRoom"),n.abrupt("return");case 4:return i=this.store.getState(Xs),this.setState((function(e){e.room.roomState=ts.Disconnecting}),"endingRoom"),n.prev=6,n.next=9,this.sdk.endRoom(e,t);case 9:this.resetState("endRoom"),n.next=15;break;case 12:n.prev=12,n.t0=n.catch(6),go.e("error in ending room - ",n.t0),this.setState((function(e){e.room.roomState=i}),"revertEndRoom");case 15:case"end":return n.stop()}}),n,this,[[6,12]])})))}},{key:"removePeer",value:function(e,t){return ds(this,null,c().mark((function n(){var r;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=this.hmsSDKPeers[e])||r.isLocal){n.next=6;break}return n.next=4,this.sdk.removePeer(r,t);case 4:n.next=8;break;case 6:return this.logPossibleInconsistency("No remote peer found for peerID - ".concat(e)),n.abrupt("return");case 8:case"end":return n.stop()}}),n,this)})))}},{key:"startRTMPOrRecording",value:function(e){return ds(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.startRTMPOrRecording(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"stopRTMPAndRecording",value:function(){return ds(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sdk.stopRTMPAndRecording();case 2:case"end":return e.stop()}}),e,this)})))}},{key:"startHLSStreaming",value:function(e){return ds(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.startHLSStreaming(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"stopHLSStreaming",value:function(e){return ds(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.stopHLSStreaming(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"sendHLSTimedMetadata",value:function(e){return ds(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.sendHLSTimedMetadata(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"changeName",value:function(e){return ds(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.changeName(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"changeMetadata",value:function(e){return ds(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"string"!=typeof e&&(e=JSON.stringify(e)),t.next=3,this.sdk.changeMetadata(e);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"setSessionMetadata",value:function(e){return ds(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.setSessionMetadata(e);case 2:this.setState((function(t){t.sessionMetadata=e}),"setSessionMetadata");case 3:case"end":return t.stop()}}),t,this)})))}},{key:"populateSessionMetadata",value:function(){return ds(this,null,c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sdk.getSessionMetadata();case 2:t=e.sent,this.setState((function(e){e.sessionMetadata=t}),"populateSessionMetadata");case 4:case"end":return e.stop()}}),e,this)})))}},{key:"setRemoteTrackEnabled",value:function(e,t){return ds(this,null,c().mark((function n(){var r,i=this;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("string"!=typeof e){n.next=10;break}if(!(r=this.hmsSDKTracks[e])||!Vo(r)){n.next=7;break}return n.next=5,this.sdk.changeTrackState(r,t);case 5:n.next=8;break;case 7:this.logPossibleInconsistency("No remote track with ID ".concat(e," found for change track state"));case 8:n.next=11;break;case 10:Array.isArray(e)&&e.forEach((function(e){return i.setRemoteTrackEnabled(e,t)}));case 11:case"end":return n.stop()}}),n,this)})))}},{key:"setRemoteTracksEnabled",value:function(e){return ds(this,null,c().mark((function t(){var n,r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={enabled:e.enabled,type:e.type,source:e.source},e.roles&&(r=this.store.getState(Zs),n.roles=e.roles.map((function(e){return r[e]}))),t.next=4,this.sdk.changeMultiTrackState(n);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"setLogLevel",value:function(e){go.level=e,this.sdk.setLogLevel(e)}},{key:"setFrameworkInfo",value:function(e){this.sdk.setFrameworkInfo(e)}},{key:"ignoreMessageTypes",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t)this.ignoredMessageTypes=e;else{var n,r=S(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.ignoredMessageTypes.includes(i)||this.ignoredMessageTypes.push(i)}}catch(a){r.e(a)}finally{r.f()}}}},{key:"resetState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"resetState";this.isRoomJoinCalled=!1,this.hmsSDKTracks={},go.cleanUp(),this.setState((function(e){Object.assign(e,ms())}),e)}},{key:"sdkJoinWithListeners",value:function(e){return ds(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.join(e,{onJoin:this.onJoin.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onTrackUpdate:this.onTrackUpdate.bind(this),onMessageReceived:this.onMessageReceived.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onRoleChangeRequest:this.onRoleChangeRequest.bind(this),onRoleUpdate:this.onRoleUpdate.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onChangeTrackStateRequest:this.onChangeTrackStateRequest.bind(this),onChangeMultiTrackStateRequest:this.onChangeMultiTrackStateRequest.bind(this),onRemovedFromRoom:this.onRemovedFromRoom.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this)});case 2:this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)}),this.sdk.addConnectionQualityListener({onConnectionQualityUpdate:this.onConnectionQualityUpdate.bind(this)});case 4:case"end":return t.stop()}}),t,this)})))}},{key:"onRemovedFromRoom",value:function(e){var t,n=this.store.getState(Ro(null==(t=e.requestedBy)?void 0:t.peerId));this.hmsNotifications.sendLeaveRoom(ls(cs({},e),{requestedBy:n||void 0}));var r=e.roomEnded||!n?"roomEnded":"removedFromRoom";go.i("resetting state after peer removed ".concat(r),e),this.resetState(r)}},{key:"onDeviceChange",value:function(e){var t=this,n=e.devices;if(n){var r=this.store.getState(Bs);if(this.setState((function(e){Jo(e.devices.audioInput,n.audioInput)||(e.devices.audioInput=n.audioInput),Jo(e.devices.videoInput,n.videoInput)||(e.devices.videoInput=n.videoInput),Jo(e.devices.audioOutput,n.audioOutput)||(e.devices.audioOutput=n.audioOutput),t.hmsSDKPeers[null==r?void 0:r.id]&&Object.assign(e.settings,t.getMediaSettings(t.hmsSDKPeers[null==r?void 0:r.id]))}),"deviceChange"),e.selection){var i=Xo.convertDeviceChangeUpdate(e);this.hmsNotifications.sendDeviceChange(i)}}}},{key:"sdkPreviewWithListeners",value:function(e){return ds(this,null,c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.preview(e,{onPreview:this.onPreview.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this)});case 2:this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)});case 3:case"end":return t.stop()}}),t,this)})))}},{key:"onNetworkQuality",value:function(e){var t=this;this.setState((function(n){var r,i=n.room.localPeer||(null==(r=t.sdk.getLocalPeer())?void 0:r.peerId);i&&(n.connectionQualities[i]={peerID:i,downlinkQuality:e})}),"ConnectionQuality")}},{key:"startScreenShare",value:function(e){return ds(this,null,c().mark((function t(){var n=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.store.getState(Ys)){t.next=4;break}this.logPossibleInconsistency("start screenshare is called while it's on"),t.next=7;break;case 4:return t.next=6,this.sdk.startScreenShare((function(){return n.syncRoomState("screenshareStopped")}),e);case 6:this.syncRoomState("startScreenShare");case 7:case"end":return t.stop()}}),t,this)})))}},{key:"stopScreenShare",value:function(){return ds(this,null,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.store.getState(Ys)){e.next=6;break}return e.next=3,this.sdk.stopScreenShare();case 3:this.syncRoomState("stopScreenShare"),e.next=7;break;case 6:this.logPossibleInconsistency("stop screenshare is called while it's not on");case 7:case"end":return e.stop()}}),e,this)})))}},{key:"attachVideoInternal",value:function(e,t){return ds(this,null,c().mark((function n(){var r;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=this.hmsSDKTracks[e])||"video"!==r.type){n.next=6;break}return n.next=4,r.addSink(t);case 4:n.next=7;break;case 6:this.logPossibleInconsistency("no video track found to add sink");case 7:case"end":return n.stop()}}),n,this)})))}},{key:"syncRoomState",value:function(e){var t=this;e="".concat(e,"_fullSync"),go.time("store-sync-".concat(e));var n,r={},i=[],a={},s={},o={},u=S(this.sdk.getPeers());try{for(u.s();!(n=u.n()).done;){var c=n.value,l=Xo.convertPeer(c);r[l.id]=l,i.push(l.id),this.hmsSDKPeers[l.id]=c;var d,f=S([c.audioTrack,c.videoTrack].concat(T(c.auxiliaryTracks)));try{for(f.s();!(d=f.n()).done;){var h=d.value;if(h){var p=Xo.convertTrack(h);a[p.id]=p,s[h.trackId]=h}}}catch(y){f.e(y)}finally{f.f()}l.isLocal&&Object.assign(o,this.getMediaSettings(c))}}catch(y){u.e(y)}finally{u.f()}var v=this.sdk.getRecordingState(),g=this.sdk.getRTMPState(),m=this.sdk.getHLSState();this.setState((function(e){e.room.peers=i;var n=e.peers,u=e.tracks;(function(e,t){var n,r=S($o(Object.keys(e),Object.keys(t)));try{for(r.s();!(n=r.n()).done;){var i=n.value,a=e[i],s=t[i];qo(a,s)?(Jo(a.auxiliaryTracks,s.auxiliaryTracks)&&(s.auxiliaryTracks=a.auxiliaryTracks),Object.assign(a,s)):Yo(a,s)?delete e[i]:Qo(a,s)&&(e[i]=s)}}catch(y){r.e(y)}finally{r.f()}})(n,r),function(e,t){var n,r=S($o(Object.keys(e),Object.keys(t)));try{for(r.s();!(n=r.n()).done;){var i=n.value,a=e[i],s=t[i];qo(a,s)?(Wo(a,s),Object.assign(a,s)):Yo(a,s)?delete e[i]:Qo(a,s)&&(e[i]=s)}}catch(y){r.e(y)}finally{r.f()}}(u,a),Object.assign(e.settings,o),t.hmsSDKTracks=s,Object.assign(e.roles,Xo.convertRoles(t.sdk.getRoles())),Object.assign(e.playlist,Xo.convertPlaylist(t.sdk.getPlaylistManager())),Object.assign(e.room,Xo.convertRecordingStreamingState(v,g,m)),function(e,t){e.room.roomState===ts.Preview?e.preview.peer?Object.assign(e.preview.peer,t[e.room.localPeer]):e.preview.peer=t[e.room.localPeer]:delete e.preview.peer}(e,n)}),e),go.timeEnd("store-sync-".concat(e))}},{key:"onPreview",value:function(e){this.setState((function(t){Object.assign(t.room,Xo.convertRoom(e)),t.room.roomState=ts.Preview}),"previewStart"),this.syncRoomState("previewSync")}},{key:"onJoin",value:function(e){var t=this,n=this.sdk.getPlaylistManager();this.audioPlaylist=new Zo(n,gs.audio,this.syncPlaylistState.bind(this),this.store),this.videoPlaylist=new Zo(n,gs.video,this.syncRoomState.bind(this),this.store),this.syncRoomState("joinSync"),this.setState((function(t){Object.assign(t.room,Xo.convertRoom(e)),t.room.isConnected=!0,t.room.roomState=ts.Connected}),"joined"),n.onProgress(this.setProgress),n.onNewTrackStart((function(e){t.syncPlaylistState("".concat(e.type,"PlaylistUpdate"))})),n.onPlaylistEnded((function(e){t.syncPlaylistState("".concat(e,"PlaylistEnded"))})),n.onCurrentTrackEnded((function(e){t.hmsNotifications.sendPlaylistTrackEnded(Xo.convertPlaylistItem(n,e)),t.syncPlaylistState("".concat(e.type,"PlaylistItemEnded"))}))}},{key:"onRoomUpdate",value:function(e,t){this.setState((function(e){Object.assign(e.room,Xo.convertRoom(t))}),e)}},{key:"onPeerUpdate",value:function(e,t){if(![Qn.BECAME_DOMINANT_SPEAKER,Qn.RESIGNED_DOMINANT_SPEAKER].includes(e)){if(Array.isArray(t)){this.syncRoomState("peersJoined");var n,r=[],i=S(t);try{for(i.s();!(n=i.n()).done;){var a=n.value,s=this.store.getState(Ro(a.peerId));s&&r.push(s)}}catch(o){i.e(o)}finally{i.f()}return void this.hmsNotifications.sendPeerList(r)}this.sendPeerUpdateNotification(e,t)}}},{key:"onTrackUpdate",value:function(e,t,n){if(e===Jn.TRACK_REMOVED)this.hmsNotifications.sendTrackUpdate(e,t.trackId),this.handleTrackRemove(t,n);else{var r=ks[e]||"trackUpdate";this.syncRoomState(r),this.hmsNotifications.sendTrackUpdate(e,t.trackId)}}},{key:"onMessageReceived",value:function(e){var t=Xo.convertMessage(e);t.read=!1,t.ignored=this.ignoredMessageTypes.includes(t.type),this.putMessageInStore(t),this.hmsNotifications.sendMessageReceived(t)}},{key:"putMessageInStore",value:function(e){var t=this;e.ignored||this.setState((function(n){e.id=String(t.store.getState(Js)+1),n.messages.byID[e.id]=e,n.messages.allIDs.push(e.id)}),"newMessage")}},{key:"onAudioLevelUpdate",value:function(e){this.setState((function(t){var n={};e.forEach((function(e){if(e.track&&e.peer){var r=e.track.trackId;n[r]=e.audioLevel,t.speakers[r]||(t.speakers[r]={audioLevel:e.audioLevel,peerID:e.peer.peerId,trackID:r})}}));for(var r=0,i=Object.entries(t.speakers);r<i.length;r++){var a=p(i[r],2),s=a[0],o=a[1];o.audioLevel=n[s]||0,0===o.audioLevel&&delete t.speakers[s]}}),"audioLevel")}},{key:"onConnectionQualityUpdate",value:function(e){this.setState((function(t){var n=new Set;e.forEach((function(e){var r=e.peerID;!r||(n.add(r),t.connectionQualities[r]?Object.assign(t.connectionQualities[r],e):t.connectionQualities[r]=e)}));for(var r=0,i=Object.keys(t.connectionQualities);r<i.length;r++){var a=i[r];n.has(a)||delete t.connectionQualities[a]}}),"connectionQuality")}},{key:"onChangeTrackStateRequest",value:function(e){var t,n=this.store.getState(Ro(null==(t=e.requestedBy)?void 0:t.peerId)),r=this.getStoreLocalTrackIDfromSDKTrack(e.track),i=this.store.getState(Co(r));if(!i)return this.logPossibleInconsistency("Not found track for which track state change was requested, ".concat(e.track));e.enabled||this.syncRoomState("changeTrackStateRequest"),this.hmsNotifications.sendChangeTrackStateRequest({requestedBy:n||void 0,track:i,enabled:e.enabled})}},{key:"onChangeMultiTrackStateRequest",value:function(e){var t,n=this.store.getState(Ro(null==(t=e.requestedBy)?void 0:t.peerId));e.enabled||this.syncRoomState("changeMultiTrackStateRequest");var r,i=[],a=this.store.getState(Ls),s=S(e.tracks);try{for(s.s();!(r=s.n()).done;){var o=r.value,u=this.getStoreLocalTrackIDfromSDKTrack(o);u&&a[u]&&i.push(a[u])}}catch(c){s.e(c)}finally{s.f()}this.hmsNotifications.sendChangeMultiTrackStateRequest({requestedBy:n||void 0,tracks:i,enabled:e.enabled,type:e.type,source:e.source})}},{key:"onReconnected",value:function(){this.syncRoomState("reconnectedSync"),this.hmsNotifications.sendReconnected(),this.setState((function(e){e.room.roomState=e.room.isConnected?ts.Connected:ts.Preview}),"reconnected")}},{key:"onReconnecting",value:function(e){var t=Xo.convertException(e);go.e("Reconnection: received error from sdk",t),this.hmsNotifications.sendReconnecting(t),this.setState((function(e){e.room.roomState=ts.Reconnecting,e.errors.push(t)}),"reconnecting")}},{key:"onError",value:function(e){var t=Xo.convertException(e);t.isTerminal?(this.leave().then((function(){return go.e("error from SDK, left room.")})),this.setState((function(e){e.room.roomState=ts.Failed,e.errors.push(t)}),"errorTerminal")):this.store.getState().errors.length<50&&this.setState((function(e){e.errors.push(t)}),"error"),this.syncRoomState("errorSync"),this.hmsNotifications.sendError(t),go.e("received error from sdk",t instanceof Gn?"".concat(t):t)}},{key:"handleTrackRemove",value:function(e,t){var n=this;this.setState((function(r){var i=r.peers[t.peerId],a=r.tracks,s=e.trackId;if(n.isSameStoreSDKTrack(s,null==i?void 0:i.audioTrack))null==i||delete i.audioTrack;else if(n.isSameStoreSDKTrack(s,null==i?void 0:i.videoTrack))null==i||delete i.videoTrack;else{var o=null==i?void 0:i.auxiliaryTracks.indexOf(s);o>-1&&n.isSameStoreSDKTrack(s,null==i?void 0:i.auxiliaryTracks[o])&&(null==i||i.auxiliaryTracks.splice(o,1))}delete a[s],delete n.hmsSDKTracks[s]}),"trackRemoved")}},{key:"setEnabledSDKTrack",value:function(e,t){return ds(this,null,c().mark((function n(){var r;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=this.hmsSDKTracks[e])){n.next=6;break}return n.next=4,r.setEnabled(t);case 4:n.next=7;break;case 6:this.logPossibleInconsistency("track ".concat(e," not present, unable to enabled/disable"));case 7:case"end":return n.stop()}}),n,this)})))}},{key:"setSDKLocalVideoTrackSettings",value:function(e,t){return ds(this,null,c().mark((function n(){var r;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=this.hmsSDKTracks[e])){n.next=6;break}return n.next=4,r.setSettings(t);case 4:n.next=7;break;case 6:this.logPossibleInconsistency("local track ".concat(e," not present, unable to set settings"));case 7:case"end":return n.stop()}}),n,this)})))}},{key:"setSDKLocalAudioTrackSettings",value:function(e,t){return ds(this,null,c().mark((function n(){var r;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=this.hmsSDKTracks[e])){n.next=6;break}return n.next=4,r.setSettings(t);case 4:n.next=7;break;case 6:this.logPossibleInconsistency("local track ".concat(e," not present, unable to set settings"));case 7:case"end":return n.stop()}}),n,this)})))}},{key:"getMediaSettings",value:function(e){var t,n=this.store.getState(Os),r=e.audioTrack,i=e.videoTrack;return{audioInputDeviceId:(null==r?void 0:r.settings.deviceId)||n.audioInputDeviceId,videoInputDeviceId:(null==i?void 0:i.settings.deviceId)||n.videoInputDeviceId,audioOutputDeviceId:null==(t=this.sdk.getAudioOutput().getDevice())?void 0:t.deviceId}}},{key:"setTrackVolume",value:function(e,t){return ds(this,null,c().mark((function n(){var r;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=this.hmsSDKTracks[t])){n.next=11;break}if(!(r instanceof Rr)){n.next=8;break}return n.next=5,r.setVolume(e);case 5:this.setState((function(n){var r=n.tracks[t];r&&"audio"===r.type&&(r.volume=e)}),"trackVolume"),n.next=9;break;case 8:go.w("track ".concat(t," is not an audio track"));case 9:n.next=12;break;case 11:this.logPossibleInconsistency("track ".concat(t," not present, unable to set volume"));case 12:case"end":return n.stop()}}),n,this)})))}},{key:"localAndVideoUnmuting",value:function(e){if(this.store.getState(Bs).videoTrack!==e)return!1;var t=this.store.getState(qs),n=this.store.getState(Ws);return t&&!n}},{key:"logPossibleInconsistency",value:function(e){go.w("possible inconsistency detected - ",e)}},{key:"addRemoveVideoPlugin",value:function(e,t,n){return ds(this,null,c().mark((function r(){var i,a;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e){r.next=3;break}return go.w("Invalid plugin received in store"),r.abrupt("return");case 3:if(!(i=this.store.getState(Vs))){r.next=20;break}if(!(a=this.hmsSDKTracks[i])){r.next=19;break}if("add"!==t){r.next=12;break}return r.next=10,a.addPlugin(e,n);case 10:r.next=16;break;case 12:if(r.t0="remove"===t,!r.t0){r.next=16;break}return r.next=16,a.removePlugin(e);case 16:this.syncRoomState("".concat(t,"VideoPlugin")),r.next=20;break;case 19:this.logPossibleInconsistency("track ".concat(i," not present, unable to remove plugin"));case 20:case"end":return r.stop()}}),r,this)})))}},{key:"addRemoveAudioPlugin",value:function(e,t){return ds(this,null,c().mark((function n(){var r,i;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=3;break}return go.w("Invalid plugin received in store"),n.abrupt("return");case 3:if(!(r=this.store.getState(Gs))){n.next=20;break}if(!(i=this.hmsSDKTracks[r])){n.next=19;break}if("add"!==t){n.next=12;break}return n.next=10,i.addPlugin(e);case 10:n.next=16;break;case 12:if(n.t0="remove"===t,!n.t0){n.next=16;break}return n.next=16,i.removePlugin(e);case 16:this.syncRoomState("".concat(t,"AudioPlugin")),n.next=20;break;case 19:this.logPossibleInconsistency("track ".concat(r," not present, unable to remove plugin"));case 20:case"end":return n.stop()}}),n,this)})))}},{key:"isSameStoreSDKTrack",value:function(e,t){var n;return!!t&&(null==(n=this.hmsSDKTracks[t])?void 0:n.trackId)===e}},{key:"onRoleChangeRequest",value:function(e){this.setState((function(t){0===t.roleChangeRequests.length&&t.roleChangeRequests.push(Xo.convertRoleChangeRequest(e))}),"roleChangeRequest")}},{key:"removeRoleChangeRequest",value:function(e){this.setState((function(t){var n=t.roleChangeRequests.findIndex((function(t){return t.token===e.token}));-1!==n&&t.roleChangeRequests.splice(n,1)}),"removeRoleChangeRequest")}},{key:"onRoleUpdate",value:function(){this.syncRoomState("roleUpdate")}},{key:"getStoreLocalTrackIDfromSDKTrack",value:function(e){var t=this;return this.store.getState(Hs).find((function(n){return t.hmsSDKTracks[n].trackId===e.trackId}))}}]),e}(),tu=function(e){return yn?"".concat(e," ").concat(document.title):e},nu=function(){function e(t,n,r){y(this,e),this.store=t,this.actions=n,this.notifications=r}return k(e,[{key:"getStore",value:function(){return this.store}},{key:"getActions",value:function(){return this.actions}},{key:"getNotifications",value:function(){return{onNotification:this.notifications.onNotification}}}]),e}(),ru=function(e,t,n){var r,i,a=iu(n,t);null==(r=e.getWebrtcInternals())||r.start();var s=null==(i=e.getWebrtcInternals())?void 0:i.onStatsChange((function(r){return au(t,r,n,e)}));return function(){a(),s&&s()}},iu=function(e,t){var n,r,i;return e.getState(js)?t.namedSetState((function(t){t.localPeer.id=e.getState(js)}),"localpeer-id"):n=e.subscribe((function(e){e&&t.namedSetState((function(t){t.localPeer.id=e}),"localpeer-id")}),js),e.getState(Vs)?t.namedSetState((function(t){t.localPeer.videoTrack=e.getState(Vs)}),"localpeer-videotrack-id"):r=e.subscribe((function(e){e&&t.namedSetState((function(t){t.localPeer.videoTrack=e}),"localpeer-videotrack-id")}),Vs),e.getState(Gs)?t.namedSetState((function(t){t.localPeer.audioTrack=e.getState(Gs)}),"localpeer-audiotrack-id"):i=e.subscribe((function(e){e&&t.namedSetState((function(t){t.localPeer.audioTrack=e}),"localpeer-audiotrack-id")}),Gs),function(){null==n||n(),null==r||r(),null==i||i()}},au=function(e,t,n,r){var i=n.getState(Ls);e.namedSetState((function(e){var a,s=n.getState(js),o={},u=Object.keys(i).filter((function(e){return i[e].peerId!==s})),c=S(u);try{for(c.s();!(a=c.n()).done;){var l=a.value,d=t.getRemoteTrackStats(l);d&&(o[l]=d)}}catch(h){c.e(h)}finally{c.f()}zo(e.remoteTrackStats,o);var f=E({},s,t.getLocalPeerStats());zo(e.peerStats,f),function(e,t,n){var r,i=n.reduce((function(e,n){return e[n.firstTrackId]=Object.values(t[n.getTrackIDBeingSent()]||{}).sort((function(e,t){return e.rid&&t.rid?e.rid<t.rid?-1:1:0})),e}),{}),a=S($o(Object.keys(e),Object.keys(i)));try{for(a.s();!(r=a.n()).done;){var s=r.value;i[s]?e[s]=i[s]:delete e[s]}}catch(h){a.e(h)}finally{a.f()}}(e.localTrackStats,t.getLocalTrackStats(),r.store.getLocalPeerTracks())}),"webrtc-stats")},su=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"resetState";e.namedSetState((function(e){Object.assign(e,{peerStats:{},remoteTrackStats:{},localTrackStats:{},localPeer:{id:""}})}),t)},ou=k((function e(t,n){var r=this;y(this,e),this.hmsStore=t,this.sdk=n,this.store=vu.createNewHMSStore(tu("HMSStatsStore"),ys),this.getState=this.store.getState,this.subscribe=this.store.subscribe,this.getPublishPeerConnection=function(){return new Promise((function(e){var t,n;"Connected"===r.hmsStore.getState(Xs)?e(null==(n=null==(t=r.sdk)?void 0:t.getWebrtcInternals())?void 0:n.getPublishPeerConnection()):r.hmsStore.subscribe((function(t){var n,i;"Connected"===t&&e(null==(i=null==(n=r.sdk)?void 0:n.getWebrtcInternals())?void 0:i.getPublishPeerConnection())}),Xs)}))},this.getSubscribePeerConnection=function(){return new Promise((function(e){var t,n;"Connected"===r.hmsStore.getState(Xs)?e(null==(n=null==(t=r.sdk)?void 0:t.getWebrtcInternals())?void 0:n.getSubscribePeerConnection()):r.hmsStore.subscribe((function(t){var n,i;"Connected"===t&&e(null==(i=null==(n=r.sdk)?void 0:n.getWebrtcInternals())?void 0:i.getSubscribePeerConnection())}),Xs)}))},this.sdk&&function(e,t,n){var r;n.getState(Xs)===ts.Connected&&(r=ru(e,t,n)),n.subscribe((function(i){[ts.Connected,ts.Reconnecting].includes(i)?r||(r=ru(e,t,n)):[ts.Disconnected,ts.Failed].includes(i)&&r&&(su(t,i),r(),r=void 0)}),Xs)}(this.sdk,this.store,this.hmsStore)})),uu=function(e,t){return t},cu=function(e){return e.peerStats},lu=function(e){return e.localTrackStats},du=es([cu,function(e){return e.localPeer.id}],(function(e,t){return e[t]})),fu=(es(du,(function(e){var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.packetsLost})),es(du,(function(e){var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.jitter})),es(du,(function(e){var t;return null==(t=null==e?void 0:e.publish)?void 0:t.bitrate})),es(du,(function(e){var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.bitrate})),es(du,(function(e){var t;return null==(t=null==e?void 0:e.publish)?void 0:t.availableOutgoingBitrate})),es(du,(function(e){var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.availableIncomingBitrate})),es(du,(function(e){var t;return null==(t=null==e?void 0:e.publish)?void 0:t.bytesSent})),es(du,(function(e){var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.bytesReceived})),es([cu,function(e,t){return t}],(function(e,t){return t?e[t]:void 0}))),hu=es([function(e){return e.remoteTrackStats},uu],(function(e,t){return t?e[t]:void 0})),pu=es([lu,uu],(function(e,t){return t?e[t]:void 0})),vu=(po(fu),po(hu),es([lu,function(e){return e.localPeer.audioTrack}],(function(e,t){var n;return t?null==(n=e[t])?void 0:n[0]:void 0})),po(es(pu,(function(e){return null==e?void 0:e[0]}))),es([lu,function(e){return e.localPeer.videoTrack}],(function(e,t){var n;return t?null==(n=e[t])?void 0:n[0]:void 0})),po(es(pu,(function(e){return e}))),function(){function e(t,n,r){var i=this;y(this,e),this.getStats=function(){return i.stats||(i.stats=new ou(i.store,i.sdk)),i.stats},this.store=t||e.createNewHMSStore(tu("HMSStore"),ms),this.notifications=r||new Go(this.store),n?this.actions=n:(this.sdk=new Ya,this.actions=new eu(this.store,this.sdk,this.notifications)),this.actions.setFrameworkInfo({type:"js",sdkVersion:fs().version}),this.initialTriggerOnSubscribe=!1,yn&&(window.__hms=this,window.__beam=new nu(this.store,this.actions,this.notifications))}return k(e,[{key:"triggerOnSubscribe",value:function(){this.initialTriggerOnSubscribe||(e.makeStoreTriggerOnSubscribe(this.store),this.initialTriggerOnSubscribe=!0)}},{key:"getStore",value:function(){return this.store}},{key:"getHMSActions",value:function(){return this.actions}},{key:"getActions",value:function(){return this.actions}},{key:"getNotifications",value:function(){return{onNotification:this.notifications.onNotification}}}],[{key:"createNewHMSStore",value:function(t,n){var r=we((function(){return n()})),i=r.setState;r.setState=function(e){var t="function"==typeof e?Ee(e):e;i(t)};var a=r.getState;r.getState=function(e){return e?e(a()):a()},e.compareWithShallowCheckInSubscribe(r);var s=e.setUpDevtools(r,t);return ls(cs({},r),{namedSetState:s})}},{key:"makeStoreTriggerOnSubscribe",value:function(e){var t=e.subscribe;e.subscribe=function(n,r,i){return n(e.getState(r),void 0),t(n,r,i)}}},{key:"compareWithShallowCheckInSubscribe",value:function(e){var t=e.subscribe;e.subscribe=function(e,n,r){return n||(n=function(e){return e}),t(e,n,r=r||Se)}}},{key:"setUpDevtools",value:function(t,n){var r;try{r=window.__REDUX_DEVTOOLS_EXTENSION__||window.top.__REDUX_DEVTOOLS_EXTENSION__}catch(P){}if(!r)return function(e){t.setState(e)};var i=r.connect(e.devtoolsOptions(n));i.prefix=n?"".concat(n," > "):"";var a=t.setState;return t.setState=function(e){a(e),i.send("".concat(i.prefix,"setState"),t.getState())},i.subscribe(e.devtoolsSubscribe(i,t,a)),i.send("setUpStore",t.getState()),function(e,n){a(e);var r=n||"".concat(i.prefix,"action");i.send(r,t.getState())}}},{key:"devtoolsOptions",value:function(e){return{name:e,actionsBlacklist:["audioLevel","playlistProgress","connectionQuality"]}}},{key:"devtoolsSubscribe",value:function(e,t,n){return function(r){var i,a,s,o;if("DISPATCH"===r.type&&r.state)["JUMP_TO_ACTION","JUMP_TO_STATE"].includes(r.payload.type)?n(JSON.parse(r.state)):t.setState(JSON.parse(r.state));else if("DISPATCH"===r.type&&"COMMIT"===(null==(i=r.payload)?void 0:i.type))e.init(t.getState());else if("DISPATCH"===r.type&&"IMPORT_STATE"===(null==(a=r.payload)?void 0:a.type)){var u=null==(s=r.payload.nextLiftedState)?void 0:s.actionsById;((null==(o=r.payload.nextLiftedState)?void 0:o.computedStates)||[]).forEach((function(r,i){var a=r.state,s=u[i]||"".concat(e.prefix,"setState");0===i?e.init(a):(n(a),e.send(s,t.getState()))}))}}}}]),e}());function gu(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(var r=0;r<n.length;r++)if(!Object.prototype.hasOwnProperty.call(t,n[r])||!Object.is(e[n[r]],t[n[r]]))return!1;return!0}(Ho=Ko||(Ko={}))[Ho.VERBOSE=0]="VERBOSE",Ho[Ho.DEBUG=1]="DEBUG",Ho[Ho.INFO=2]="INFO",Ho[Ho.WARN=3]="WARN",Ho[Ho.ERROR=4]="ERROR",Ho[Ho.NONE=5]="NONE";var mu=function(){function e(){y(this,e)}return k(e,null,[{key:"v",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,[Ko.VERBOSE,e].concat(n))}},{key:"d",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,[Ko.DEBUG,e].concat(n))}},{key:"i",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,[Ko.INFO,e].concat(n))}},{key:"w",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,[Ko.WARN,e].concat(n))}},{key:"e",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,[Ko.ERROR,e].concat(n))}},{key:"log",value:function(e,t){for(var n,r,i,a,s,o=arguments.length,u=new Array(o>2?o-2:0),c=2;c<o;c++)u[c-2]=arguments[c];if(!(this.level.valueOf()>e.valueOf()))switch(e){case Ko.VERBOSE:(n=console).log.apply(n,["HMSui-components: ",t].concat(u));break;case Ko.DEBUG:(r=console).debug.apply(r,["HMSui-components: ",t].concat(u));break;case Ko.INFO:(i=console).info.apply(i,["HMSui-components: ",t].concat(u));break;case Ko.WARN:(a=console).warn.apply(a,["HMSui-components: ",t].concat(u));break;case Ko.ERROR:(s=console).error.apply(s,["HMSui-components: ",t].concat(u))}}}]),e}();mu.level=Ko.VERBOSE;var yu="It seems like you forgot to add your component within a top level HMSRoomProvider, please refer to 100ms react docs(https://docs.100ms.live/javascript/v2/features/integration#react-hooks) to check on the required steps for using this hook.";var bu,ku="undefined"!=typeof window,Tu=(0,a.createContext)(null),Eu=function(e){var t=e.children,n=e.actions,r=e.store,i=e.notifications,s=e.stats,o=e.isHMSStatsOn,u=void 0!==o&&o,c=e.leaveOnUnload,l=void 0===c||c;if(!bu){var d=function(){throw new Error("modifying store is not allowed")};if(n&&r)bu={actions:n,store:m(Object.assign(Object.assign({},r),{setState:d,destroy:d}))},i&&(bu.notifications=i),s&&(bu.statsStore=m({getState:s.getState,subscribe:s.subscribe,setState:d,destroy:d}));else{var f=new vu;if(bu={actions:f.getActions(),store:m(Object.assign(Object.assign({},f.getStore()),{setState:d,destroy:d})),notifications:f.getNotifications()},u){var h=f.getStats();bu.statsStore=m({getState:h.getState,subscribe:h.subscribe,setState:d,destroy:d})}}bu.actions.setFrameworkInfo({type:"react-web",version:a.version,sdkVersion:"0.6.3"})}return(0,a.useEffect)((function(){if(ku&&l){var e=function(){return bu.actions.leave()};return window.addEventListener("beforeunload",e),function(){window.removeEventListener("beforeunload",e)}}return function(){}}),[l]),a.createElement(Tu.Provider,{value:bu},t)},Su=function(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:gu;t||mu.w("fetching full store without passing any selector may have a heavy performance impact on your website.");var r=(0,a.useContext)(e);if(!r)throw new Error(yu);return(0,r.store)(t,n)}}(Tu),wu=(function(e){}(Tu),function(){var e=(0,a.useContext)(Tu);if(!e)throw new Error(yu);return e.actions}),xu=n(184);var Ru=function(){var e=p((0,a.useState)(""),2),t=e[0],n=e[1],r=p((0,a.useState)("broadcaster"),2),i=r[0],s=r[1],o=wu(),u=function(){var e=d(c().mark((function e(n){var r,a,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.next=3,fetch("".concat("https://prod-in2.100ms.live/hmsapi/den4iks.app.100ms.live/","api/token"),{method:"POST",body:JSON.stringify({user_id:"".concat(Date.now()),role:i,type:"app",room_id:"63f12f36da7e7ca812840d18"})});case 3:return r=e.sent,e.next=6,r.json();case 6:a=e.sent,s=a.token,o.join({userName:t,authToken:s});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,xu.jsxs)("form",{className:"join",onSubmit:u,children:[(0,xu.jsx)("input",{type:"text",required:!0,placeholder:"Enter name",value:t,onChange:function(e){return n(e.target.value)}}),(0,xu.jsxs)("select",{type:"text",required:!0,value:i,onChange:function(e){return s(e.target.value)},placeholder:"Select Role",children:[(0,xu.jsx)("option",{children:"broadcaster"}),(0,xu.jsx)("option",{children:"hls-viewer"})]}),(0,xu.jsx)("button",{children:"Join"})]})};function Cu(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((r=r.apply(e,t||[])).next())}))}function Au(){return Au=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Au.apply(this,arguments)}function Iu(e,t){return Iu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Iu(e,t)}var Pu=new Map,_u=new WeakMap,Du=0,Lu=void 0;function Ou(e){return Object.keys(e).sort().filter((function(t){return void 0!==e[t]})).map((function(t){return t+"_"+("root"===t?function(e){return e?(_u.has(e)||(Du+=1,_u.set(e,Du.toString())),_u.get(e)):"0"}(e.root):e[t])})).toString()}function Mu(e,t,n,r){if(void 0===n&&(n={}),void 0===r&&(r=Lu),"undefined"===typeof window.IntersectionObserver&&void 0!==r){var i=e.getBoundingClientRect();return t(r,{isIntersecting:r,target:e,intersectionRatio:"number"===typeof n.threshold?n.threshold:0,time:0,boundingClientRect:i,intersectionRect:i,rootBounds:i}),function(){}}var a=function(e){var t=Ou(e),n=Pu.get(t);if(!n){var r,i=new Map,a=new IntersectionObserver((function(t){t.forEach((function(t){var n,a=t.isIntersecting&&r.some((function(e){return t.intersectionRatio>=e}));e.trackVisibility&&"undefined"===typeof t.isVisible&&(t.isVisible=a),null==(n=i.get(t.target))||n.forEach((function(e){e(a,t)}))}))}),e);r=a.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),n={id:t,observer:a,elements:i},Pu.set(t,n)}return n}(n),s=a.id,o=a.observer,u=a.elements,c=u.get(e)||[];return u.has(e)||u.set(e,c),c.push(t),o.observe(e),function(){c.splice(c.indexOf(t),1),0===c.length&&(u.delete(e),o.unobserve(e)),0===u.size&&(o.disconnect(),Pu.delete(s))}}var Nu=["children","as","triggerOnce","threshold","root","rootMargin","onChange","skip","trackVisibility","delay","initialInView","fallbackInView"];function Fu(e){return"function"!==typeof e.children}var Uu=function(e){var t,n;function r(t){var n;return(n=e.call(this,t)||this).node=null,n._unobserveCb=null,n.handleNode=function(e){n.node&&(n.unobserve(),e||n.props.triggerOnce||n.props.skip||n.setState({inView:!!n.props.initialInView,entry:void 0})),n.node=e||null,n.observeNode()},n.handleChange=function(e,t){e&&n.props.triggerOnce&&n.unobserve(),Fu(n.props)||n.setState({inView:e,entry:t}),n.props.onChange&&n.props.onChange(e,t)},n.state={inView:!!t.initialInView,entry:void 0},n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,Iu(t,n);var i=r.prototype;return i.componentDidUpdate=function(e){e.rootMargin===this.props.rootMargin&&e.root===this.props.root&&e.threshold===this.props.threshold&&e.skip===this.props.skip&&e.trackVisibility===this.props.trackVisibility&&e.delay===this.props.delay||(this.unobserve(),this.observeNode())},i.componentWillUnmount=function(){this.unobserve(),this.node=null},i.observeNode=function(){if(this.node&&!this.props.skip){var e=this.props,t=e.threshold,n=e.root,r=e.rootMargin,i=e.trackVisibility,a=e.delay,s=e.fallbackInView;this._unobserveCb=Mu(this.node,this.handleChange,{threshold:t,root:n,rootMargin:r,trackVisibility:i,delay:a},s)}},i.unobserve=function(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)},i.render=function(){if(!Fu(this.props)){var e=this.state,t=e.inView,n=e.entry;return this.props.children({inView:t,entry:n,ref:this.handleNode})}var r=this.props,i=r.children,s=r.as,o=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(r,Nu);return a.createElement(s||"div",Au({ref:this.handleNode},o),i)},r}(a.Component);Uu.displayName="InView",Uu.defaultProps={threshold:0,triggerOnce:!1,initialInView:!1};var Bu=n(164),ju=function(e,t){return ju=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},ju(e,t)};function Gu(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}ju(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var Vu=function(){return Vu=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Vu.apply(this,arguments)};function Ku(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}var Hu="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{};var zu=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},Wu="object"==typeof Hu&&Hu&&Hu.Object===Object&&Hu,qu="object"==typeof self&&self&&self.Object===Object&&self,Yu=Wu||qu||Function("return this")(),Qu=Yu,Ju=function(){return Qu.Date.now()},$u=/\s/;var Xu=function(e){for(var t=e.length;t--&&$u.test(e.charAt(t)););return t},Zu=/^\s+/;var ec=function(e){return e?e.slice(0,Xu(e)+1).replace(Zu,""):e},tc=Yu.Symbol,nc=tc,rc=Object.prototype,ic=rc.hasOwnProperty,ac=rc.toString,sc=nc?nc.toStringTag:void 0;var oc=function(e){var t=ic.call(e,sc),n=e[sc];try{e[sc]=void 0;var r=!0}catch(a){}var i=ac.call(e);return r&&(t?e[sc]=n:delete e[sc]),i},uc=Object.prototype.toString;var cc=oc,lc=function(e){return uc.call(e)},dc=tc?tc.toStringTag:void 0;var fc=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":dc&&dc in Object(e)?cc(e):lc(e)},hc=function(e){return null!=e&&"object"==typeof e};var pc=ec,vc=zu,gc=function(e){return"symbol"==typeof e||hc(e)&&"[object Symbol]"==fc(e)},mc=/^[-+]0x[0-9a-f]+$/i,yc=/^0b[01]+$/i,bc=/^0o[0-7]+$/i,kc=parseInt;var Tc=zu,Ec=Ju,Sc=function(e){if("number"==typeof e)return e;if(gc(e))return NaN;if(vc(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=vc(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=pc(e);var n=yc.test(e);return n||bc.test(e)?kc(e.slice(2),n?2:8):mc.test(e)?NaN:+e},wc=Math.max,xc=Math.min;var Rc=function(e,t,n){var r,i,a,s,o,u,c=0,l=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function h(t){var n=r,a=i;return r=i=void 0,c=t,s=e.apply(a,n)}function p(e){return c=e,o=setTimeout(g,t),l?h(e):s}function v(e){var n=e-u;return void 0===u||n>=t||n<0||d&&e-c>=a}function g(){var e=Ec();if(v(e))return m(e);o=setTimeout(g,function(e){var n=t-(e-u);return d?xc(n,a-(e-c)):n}(e))}function m(e){return o=void 0,f&&r?h(e):(r=i=void 0,s)}function y(){var e=Ec(),n=v(e);if(r=arguments,i=this,u=e,n){if(void 0===o)return p(u);if(d)return clearTimeout(o),o=setTimeout(g,t),h(u)}return void 0===o&&(o=setTimeout(g,t)),s}return t=Sc(t)||0,Tc(n)&&(l=!!n.leading,a=(d="maxWait"in n)?wc(Sc(n.maxWait)||0,t):a,f="trailing"in n?!!n.trailing:f),y.cancel=function(){void 0!==o&&clearTimeout(o),c=0,r=u=i=o=void 0},y.flush=function(){return void 0===o?s:m(Ec())},y},Cc=Rc,Ac=zu;var Ic=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return Ac(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),Cc(e,t,{leading:r,maxWait:t,trailing:i})},Pc=function(e,t,n,r){switch(t){case"debounce":return Rc(e,n,r);case"throttle":return Ic(e,n,r);default:return e}},_c=function(e){return"function"===typeof e},Dc=function(){return"undefined"===typeof window},Lc=function(e){return e instanceof Element||e instanceof HTMLDocument},Oc=function(e,t,n,r){return function(i){var a=i.width,s=i.height;t((function(t){return t.width===a&&t.height===s||t.width===a&&!r||t.height===s&&!n?t:(e&&_c(e)&&e(a,s),{width:a,height:s})}))}};!function(e){function t(t){var n=e.call(this,t)||this;n.cancelHandler=function(){n.resizeHandler&&n.resizeHandler.cancel&&(n.resizeHandler.cancel(),n.resizeHandler=null)},n.attachObserver=function(){var e=n.props,t=e.targetRef,r=e.observerOptions;if(!Dc()){t&&t.current&&(n.targetRef.current=t.current);var i=n.getElement();i&&(n.observableElement&&n.observableElement===i||(n.observableElement=i,n.resizeObserver.observe(i,r)))}},n.getElement=function(){var e=n.props,t=e.querySelector,r=e.targetDomEl;if(Dc())return null;if(t)return document.querySelector(t);if(r&&Lc(r))return r;if(n.targetRef&&Lc(n.targetRef.current))return n.targetRef.current;var i=(0,Bu.findDOMNode)(n);if(!i)return null;switch(n.getRenderType()){case"renderProp":case"childFunction":case"child":case"childArray":return i;default:return i.parentElement}},n.createResizeHandler=function(e){var t=n.props,r=t.handleWidth,i=void 0===r||r,a=t.handleHeight,s=void 0===a||a,o=t.onResize;if(i||s){var u=Oc(o,n.setState.bind(n),i,s);e.forEach((function(e){var t=e&&e.contentRect||{},r=t.width,i=t.height;!n.skipOnMount&&!Dc()&&u({width:r,height:i}),n.skipOnMount=!1}))}},n.getRenderType=function(){var e=n.props,t=e.render,r=e.children;return _c(t)?"renderProp":_c(r)?"childFunction":(0,a.isValidElement)(r)?"child":Array.isArray(r)?"childArray":"parent"};var r=t.skipOnMount,i=t.refreshMode,s=t.refreshRate,o=void 0===s?1e3:s,u=t.refreshOptions;return n.state={width:void 0,height:void 0},n.skipOnMount=r,n.targetRef=(0,a.createRef)(),n.observableElement=null,Dc()||(n.resizeHandler=Pc(n.createResizeHandler,i,o,u),n.resizeObserver=new window.ResizeObserver(n.resizeHandler)),n}Gu(t,e),t.prototype.componentDidMount=function(){this.attachObserver()},t.prototype.componentDidUpdate=function(){this.attachObserver()},t.prototype.componentWillUnmount=function(){Dc()||(this.observableElement=null,this.resizeObserver.disconnect(),this.cancelHandler())},t.prototype.render=function(){var e,t=this.props,n=t.render,r=t.children,i=t.nodeType,s=void 0===i?"div":i,o=this.state,u={width:o.width,height:o.height,targetRef:this.targetRef};switch(this.getRenderType()){case"renderProp":return n&&n(u);case"childFunction":return(e=r)(u);case"child":if((e=r).type&&"string"===typeof e.type){var c=Ku(u,["targetRef"]);return(0,a.cloneElement)(e,c)}return(0,a.cloneElement)(e,u);case"childArray":return(e=r).map((function(e){return!!e&&(0,a.cloneElement)(e,u)}));default:return a.createElement(s,null)}}}(a.PureComponent);var Mc=Dc()?a.useEffect:a.useLayoutEffect;var Nc=function(e){var t,n,r=e.layerDefinitions,i=e.width,a=e.height,s=Number.MAX_VALUE,o=S(r);try{for(o.s();!(n=o.n()).done;){var u=n.value,c=u.resolution,l=u.layer,d=Math.abs(i-(c.width||0))+Math.abs(a-(c.height||0));d<s&&(s=d,t=l)}}catch(f){o.e(f)}finally{o.f()}return t},Fc=function(e){var t,n=e.trackId,r=e.attach,i=e.threshold,s=void 0===i?.5:i,o=wu(),u=(0,a.useRef)(null),l=Su(Ao(n)),d=function(e){var t=void 0===e?{}:e,n=t.threshold,r=t.delay,i=t.trackVisibility,s=t.rootMargin,o=t.root,u=t.triggerOnce,c=t.skip,l=t.initialInView,d=t.fallbackInView,f=a.useRef(),h=a.useState({inView:!!l}),p=h[0],v=h[1],g=a.useCallback((function(e){void 0!==f.current&&(f.current(),f.current=void 0),c||e&&(f.current=Mu(e,(function(e,t){v({inView:e,entry:t}),t.isIntersecting&&u&&f.current&&(f.current(),f.current=void 0)}),{root:o,rootMargin:s,threshold:n,trackVisibility:i,delay:r},d))}),[Array.isArray(n)?n.toString():n,o,s,u,c,i,d,r]);(0,a.useEffect)((function(){f.current||!p.entry||u||c||v({inView:!!l})}));var m=[g,p.inView,p.entry];return m.ref=m[0],m.inView=m[1],m.entry=m[2],m}({threshold:s}),f=d.ref,h=d.inView,p=function(e){void 0===e&&(e={});var t=e.skipOnMount,n=void 0!==t&&t,r=e.refreshMode,i=e.refreshRate,s=void 0===i?1e3:i,o=e.refreshOptions,u=e.handleWidth,c=void 0===u||u,l=e.handleHeight,d=void 0===l||l,f=e.targetRef,h=e.observerOptions,p=e.onResize,v=(0,a.useRef)(n),g=(0,a.useRef)(null),m=null!==f&&void 0!==f?f:g,y=(0,a.useRef)(),b=(0,a.useState)({width:void 0,height:void 0}),k=b[0],T=b[1];return Mc((function(){if(!Dc()){var e=Oc(p,T,c,d);y.current=Pc((function(t){(c||d)&&t.forEach((function(t){var n=t&&t.contentRect||{},r=n.width,i=n.height;!v.current&&!Dc()&&e({width:r,height:i}),v.current=!1}))}),r,s,o);var t=new window.ResizeObserver(y.current);return m.current&&t.observe(m.current,h),function(){t.disconnect();var e=y.current;e&&e.cancel&&e.cancel()}}}),[r,s,o,c,d,p,h,m.current]),Vu({ref:m},k)}({refreshMode:"debounce",refreshRate:300}),v=p.width,g=void 0===v?0:v,m=p.height,y=void 0===m?0:m,b=p.ref,k=(0,a.useCallback)((function(){return Cu(void 0,void 0,void 0,c().mark((function e(){var t,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(g>0&&y>0&&h&&(null===(t=null==l?void 0:l.layerDefinitions)||void 0===t?void 0:t.length)&&b.current&&(null==l?void 0:l.enabled))||(null==l?void 0:l.degraded)){e.next=4;break}return n=Nc({layerDefinitions:l.layerDefinitions,width:g,height:y}),e.next=4,o.setPreferredLayer(null==l?void 0:l.id,n);case 4:case"end":return e.stop()}}),e)})))}),[g,y,null==l?void 0:l.id,o,null==l?void 0:l.enabled,null==l?void 0:l.degraded,b,h]),T=(0,a.useCallback)((function(e){var t;e&&(u.current=e,f(e),(null===(t=null==l?void 0:l.layerDefinitions)||void 0===t?void 0:t.length)&&(b.current=e))}),[f,null===(t=null==l?void 0:l.layerDefinitions)||void 0===t?void 0:t.length,b]);return(0,a.useEffect)((function(){k()}),[k]),(0,a.useEffect)((function(){Cu(void 0,void 0,void 0,c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!u.current||!(null==l?void 0:l.id)){e.next=10;break}if(t=!0,ku&&(t="visible"===window.getComputedStyle(u.current).visibility),!(h&&l.enabled&&t&&!1!==r)){e.next=8;break}return e.next=6,o.attachVideo(l.id,u.current);case 6:e.next=10;break;case 8:return e.next=10,o.detachVideo(l.id,u.current);case 10:case"end":return e.stop()}}),e)})))}),[o,h,u,null==l?void 0:l.id,null==l?void 0:l.enabled,null==l?void 0:l.deviceID,null==l?void 0:l.plugins,r]),(0,a.useEffect)((function(){return function(){Cu(void 0,void 0,void 0,c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!u.current||!l){e.next=9;break}return e.prev=1,e.next=4,o.detachVideo(l.id,u.current);case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),mu.w("detach video error for track",l.id,e.t0);case 9:case"end":return e.stop()}}),e,null,[[1,6]])})))}}),[]),{videoRef:T}};var Uc=function(e){var t=e.peer,n=e.peers,r=Fc({trackId:t.videoTrack}).videoRef;return(0,xu.jsx)("video",{ref:r,className:function(){var e=n.filter((function(e){return"broadcaster"===e.roleName}));return e.length}()>=2?"video":"",autoPlay:!0,muted:!0,playsInline:!0})},Bc=n(843),jc=n.n(Bc);var Gc=function(){var e,t=(0,a.useRef)(null),n=null===(e=Su(no).variants[0])||void 0===e?void 0:e.url;return(0,a.useEffect)((function(){if(t.current&&n){var e=t.current.canPlayType("application/vnd.apple.mpegurl");if(jc().isSupported()){var r=new(jc());r.loadSource(n),r.attachMedia(t.current)}else e&&(t.current.src=n)}}),[n]),(0,xu.jsx)("video",{ref:t,autoPlay:!0,controls:!0})};var Vc=function(){var e=Su(Fs),t=Su(Bs);return(0,xu.jsxs)("div",{className:"stream",children:["hls-viewer"===t.roleName&&(0,xu.jsx)(Gc,{}),"broadcaster"===t.roleName&&e.filter((function(e){return"broadcaster"===e.roleName})).map((function(t){return(0,xu.jsx)(Uc,{peer:t,peers:e},t.id)}))]})};var Kc=function(e){var t=e.message,n=Su(Bs);return(0,xu.jsxs)("div",{className:"message ".concat(t.senderUserId===n.customerUserId&&"myMessage"),children:[(0,xu.jsx)("span",{children:t.senderName}),(0,xu.jsx)("p",{children:t.message})]})};var Hc=function(){var e=p((0,a.useState)("chat"),2),t=e[0],n=e[1],r=p((0,a.useState)(""),2),i=r[0],s=r[1],o=Su($s),u=wu(),c=Su(Fs);return(0,xu.jsxs)("div",{className:"rightBox",children:[(0,xu.jsxs)("div",{className:"rightBox__head",children:[(0,xu.jsx)("span",{onClick:function(){return n("chat")},className:"chat"===t?"selected":"",children:"Chat"}),(0,xu.jsx)("span",{className:"participants"===t?"selected":"",onClick:function(){return n("participants")},children:"Participants"})]}),(0,xu.jsxs)("div",{className:"rightBox__optionView",children:["chat"===t&&(0,xu.jsxs)(xu.Fragment,{children:[(0,xu.jsx)("div",{className:"rightBox__chats",children:o.map((function(e){return(0,xu.jsx)(Kc,{message:e},e.id)}))}),(0,xu.jsx)("form",{name:"send-message",onSubmit:function(e){e.preventDefault(),u.sendBroadcastMessage(i),s("")},children:(0,xu.jsx)("input",{onChange:function(e){return s(e.target.value)},value:i,placeholder:"Write your message"})})]}),"participants"===t&&(0,xu.jsx)("div",{className:"rightBox__participants",children:c.map((function(e){return(0,xu.jsxs)("div",{className:"rightBox__participant",children:[e.name,(0,xu.jsx)("p",{children:e.roleName})]})}))})]})]})};function zc(){return zc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},zc.apply(this,arguments)}function Wc(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}function qc(e){var t,n,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=qc(e[t]))&&(r&&(r+=" "),r+=n);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}var Yc=function(){for(var e,t,n=0,r="";n<arguments.length;)(e=arguments[n++])&&(t=qc(e))&&(r&&(r+=" "),r+=t);return r};function Qc(e,t,n){var r={};return Object.keys(e).forEach((function(i){r[i]=e[i].reduce((function(e,r){return r&&(e.push(t(r)),n&&n[r]&&e.push(n[r])),e}),[]).join(" ")})),r}function Jc(e){for(var t="https://mui.com/production-error/?code="+e,n=1;n<arguments.length;n+=1)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified MUI error #"+e+"; visit "+t+" for the full message."}function $c(e){if("string"!==typeof e)throw new Error(Jc(7));return e.charAt(0).toUpperCase()+e.slice(1)}var Xc=$c;function Zc(e,t){var n=zc({},t);return Object.keys(e).forEach((function(t){void 0===n[t]&&(n[t]=e[t])})),n}function el(e){return null!==e&&"object"===typeof e&&e.constructor===Object}function tl(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{clone:!0},r=n.clone?zc({},e):e;return el(e)&&el(t)&&Object.keys(t).forEach((function(i){"__proto__"!==i&&(el(t[i])&&i in e&&el(e[i])?r[i]=tl(e[i],t[i],n):r[i]=t[i])})),r}var nl=["values","unit","step"];function rl(e){var t=e.values,n=void 0===t?{xs:0,sm:600,md:900,lg:1200,xl:1536}:t,r=e.unit,i=void 0===r?"px":r,a=e.step,s=void 0===a?5:a,o=Wc(e,nl),u=function(e){var t=Object.keys(e).map((function(t){return{key:t,val:e[t]}}))||[];return t.sort((function(e,t){return e.val-t.val})),t.reduce((function(e,t){return zc({},e,E({},t.key,t.val))}),{})}(n),c=Object.keys(u);function l(e){var t="number"===typeof n[e]?n[e]:e;return"@media (min-width:".concat(t).concat(i,")")}function d(e){var t="number"===typeof n[e]?n[e]:e;return"@media (max-width:".concat(t-s/100).concat(i,")")}function f(e,t){var r=c.indexOf(t);return"@media (min-width:".concat("number"===typeof n[e]?n[e]:e).concat(i,") and ")+"(max-width:".concat((-1!==r&&"number"===typeof n[c[r]]?n[c[r]]:t)-s/100).concat(i,")")}return zc({keys:c,values:u,up:l,down:d,between:f,only:function(e){return c.indexOf(e)+1<c.length?f(e,c[c.indexOf(e)+1]):l(e)},not:function(e){var t=c.indexOf(e);return 0===t?l(c[1]):t===c.length-1?d(c[t]):f(e,c[c.indexOf(e)+1]).replace("@media","@media not all and")},unit:i},o)}var il={borderRadius:4},al={xs:0,sm:600,md:900,lg:1200,xl:1536},sl={keys:["xs","sm","md","lg","xl"],up:function(e){return"@media (min-width:".concat(al[e],"px)")}};function ol(e,t,n){var r=e.theme||{};if(Array.isArray(t)){var i=r.breakpoints||sl;return t.reduce((function(e,r,a){return e[i.up(i.keys[a])]=n(t[a]),e}),{})}if("object"===typeof t){var a=r.breakpoints||sl;return Object.keys(t).reduce((function(e,r){if(-1!==Object.keys(a.values||al).indexOf(r)){e[a.up(r)]=n(t[r],r)}else{var i=r;e[i]=t[i]}return e}),{})}return n(t)}function ul(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=null==(e=t.keys)?void 0:e.reduce((function(e,n){return e[t.up(n)]={},e}),{});return n||{}}function cl(e,t){return e.reduce((function(e,t){var n=e[t];return(!n||0===Object.keys(n).length)&&delete e[t],e}),t)}function ll(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t||"string"!==typeof t)return null;if(e&&e.vars&&n){var r="vars.".concat(t).split(".").reduce((function(e,t){return e&&e[t]?e[t]:null}),e);if(null!=r)return r}return t.split(".").reduce((function(e,t){return e&&null!=e[t]?e[t]:null}),e)}function dl(e,t,n){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;return r="function"===typeof e?e(n):Array.isArray(e)?e[n]||i:ll(e,n)||i,t&&(r=t(r)),r}var fl=function(e){var t=e.prop,n=e.cssProperty,r=void 0===n?e.prop:n,i=e.themeKey,a=e.transform,s=function(e){if(null==e[t])return null;var n=e[t],s=ll(e.theme,i)||{};return ol(e,n,(function(e){var n=dl(s,a,e);return e===n&&"string"===typeof e&&(n=dl(s,a,"".concat(t).concat("default"===e?"":$c(e)),e)),!1===r?n:E({},r,n)}))};return s.propTypes={},s.filterProps=[t],s};var hl=function(e,t){return t?tl(e,t,{clone:!1}):e};var pl={m:"margin",p:"padding"},vl={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},gl={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},ml=function(e){var t={};return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}}((function(e){if(e.length>2){if(!gl[e])return[e];e=gl[e]}var t=p(e.split(""),2),n=t[0],r=t[1],i=pl[n],a=vl[r]||"";return Array.isArray(a)?a.map((function(e){return i+e})):[i+a]})),yl=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],bl=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"],kl=[].concat(yl,bl);function Tl(e,t,n,r){var i,a=null!=(i=ll(e,t,!1))?i:n;return"number"===typeof a?function(e){return"string"===typeof e?e:a*e}:Array.isArray(a)?function(e){return"string"===typeof e?e:a[e]}:"function"===typeof a?a:function(){}}function El(e){return Tl(e,"spacing",8)}function Sl(e,t){if("string"===typeof t||null==t)return t;var n=e(Math.abs(t));return t>=0?n:"number"===typeof n?-n:"-".concat(n)}function wl(e,t,n,r){if(-1===t.indexOf(n))return null;var i=function(e,t){return function(n){return e.reduce((function(e,r){return e[r]=Sl(t,n),e}),{})}}(ml(n),r);return ol(e,e[n],i)}function xl(e,t){var n=El(e.theme);return Object.keys(e).map((function(r){return wl(e,t,r,n)})).reduce(hl,{})}function Rl(e){return xl(e,yl)}function Cl(e){return xl(e,bl)}function Al(e){return xl(e,kl)}Rl.propTypes={},Rl.filterProps=yl,Cl.propTypes={},Cl.filterProps=bl,Al.propTypes={},Al.filterProps=kl;var Il=Al;function Pl(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;if(e.mui)return e;var t=El({spacing:e}),n=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=0===n.length?[1]:n;return i.map((function(e){var n=t(e);return"number"===typeof n?"".concat(n,"px"):n})).join(" ")};return n.mui=!0,n}var _l=["breakpoints","palette","spacing","shape"];var Dl=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.breakpoints,n=void 0===t?{}:t,r=e.palette,i=void 0===r?{}:r,a=e.spacing,s=e.shape,o=void 0===s?{}:s,u=Wc(e,_l),c=rl(n),l=Pl(a),d=tl({breakpoints:c,direction:"ltr",components:{},palette:zc({mode:"light"},i),spacing:l,shape:zc({},il,o)},u),f=arguments.length,h=new Array(f>1?f-1:0),p=1;p<f;p++)h[p-1]=arguments[p];return d=h.reduce((function(e,t){return tl(e,t)}),d)};var Ll=a.createContext(null);function Ol(){return a.useContext(Ll)}function Ml(e){return 0===Object.keys(e).length}var Nl=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=Ol();return!t||Ml(t)?e:t},Fl=Dl();var Ul=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Fl;return Nl(e)};function Bl(e){var t=e.props,n=e.name,r=e.defaultTheme,i=function(e){var t=e.theme,n=e.name,r=e.props;return t&&t.components&&t.components[n]&&t.components[n].defaultProps?Zc(t.components[n].defaultProps,r):r}({theme:Ul(r),name:n,props:t});return i}function jl(e,t){var n;return zc({toolbar:(n={minHeight:56},E(n,e.up("xs"),{"@media (orientation: landscape)":{minHeight:48}}),E(n,e.up("sm"),{minHeight:64}),n)},t)}function Gl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(Math.max(t,e),n)}function Vl(e){if(e.type)return e;if("#"===e.charAt(0))return Vl(function(e){e=e.slice(1);var t=new RegExp(".{1,".concat(e.length>=6?2:1,"}"),"g"),n=e.match(t);return n&&1===n[0].length&&(n=n.map((function(e){return e+e}))),n?"rgb".concat(4===n.length?"a":"","(").concat(n.map((function(e,t){return t<3?parseInt(e,16):Math.round(parseInt(e,16)/255*1e3)/1e3})).join(", "),")"):""}(e));var t=e.indexOf("("),n=e.substring(0,t);if(-1===["rgb","rgba","hsl","hsla","color"].indexOf(n))throw new Error(Jc(9,e));var r,i=e.substring(t+1,e.length-1);if("color"===n){if(r=(i=i.split(" ")).shift(),4===i.length&&"/"===i[3].charAt(0)&&(i[3]=i[3].slice(1)),-1===["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].indexOf(r))throw new Error(Jc(10,r))}else i=i.split(",");return{type:n,values:i=i.map((function(e){return parseFloat(e)})),colorSpace:r}}function Kl(e){var t=e.type,n=e.colorSpace,r=e.values;return-1!==t.indexOf("rgb")?r=r.map((function(e,t){return t<3?parseInt(e,10):e})):-1!==t.indexOf("hsl")&&(r[1]="".concat(r[1],"%"),r[2]="".concat(r[2],"%")),r=-1!==t.indexOf("color")?"".concat(n," ").concat(r.join(" ")):"".concat(r.join(", ")),"".concat(t,"(").concat(r,")")}function Hl(e){var t="hsl"===(e=Vl(e)).type?Vl(function(e){var t=(e=Vl(e)).values,n=t[0],r=t[1]/100,i=t[2]/100,a=r*Math.min(i,1-i),s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e+n/30)%12;return i-a*Math.max(Math.min(t-3,9-t,1),-1)},o="rgb",u=[Math.round(255*s(0)),Math.round(255*s(8)),Math.round(255*s(4))];return"hsla"===e.type&&(o+="a",u.push(t[3])),Kl({type:o,values:u})}(e)).values:e.values;return t=t.map((function(t){return"color"!==e.type&&(t/=255),t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)})),Number((.2126*t[0]+.7152*t[1]+.0722*t[2]).toFixed(3))}function zl(e,t){return e=Vl(e),t=Gl(t),"rgb"!==e.type&&"hsl"!==e.type||(e.type+="a"),"color"===e.type?e.values[3]="/".concat(t):e.values[3]=t,Kl(e)}function Wl(e,t){if(e=Vl(e),t=Gl(t),-1!==e.type.indexOf("hsl"))e.values[2]*=1-t;else if(-1!==e.type.indexOf("rgb")||-1!==e.type.indexOf("color"))for(var n=0;n<3;n+=1)e.values[n]*=1-t;return Kl(e)}function ql(e,t){if(e=Vl(e),t=Gl(t),-1!==e.type.indexOf("hsl"))e.values[2]+=(100-e.values[2])*t;else if(-1!==e.type.indexOf("rgb"))for(var n=0;n<3;n+=1)e.values[n]+=(255-e.values[n])*t;else if(-1!==e.type.indexOf("color"))for(var r=0;r<3;r+=1)e.values[r]+=(1-e.values[r])*t;return Kl(e)}var Yl={black:"#000",white:"#fff"},Ql={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"},Jl={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},$l={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},Xl={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},Zl={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},ed={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},td={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},nd=["mode","contrastThreshold","tonalOffset"],rd={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:Yl.white,default:Yl.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},id={text:{primary:Yl.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:Yl.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function ad(e,t,n,r){var i=r.light||r,a=r.dark||1.5*r;e[t]||(e.hasOwnProperty(n)?e[t]=e[n]:"light"===t?e.light=ql(e.main,i):"dark"===t&&(e.dark=Wl(e.main,a)))}function sd(e){var t=e.mode,n=void 0===t?"light":t,r=e.contrastThreshold,i=void 0===r?3:r,a=e.tonalOffset,s=void 0===a?.2:a,o=Wc(e,nd),u=e.primary||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:Zl[200],light:Zl[50],dark:Zl[400]}:{main:Zl[700],light:Zl[400],dark:Zl[800]}}(n),c=e.secondary||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:Jl[200],light:Jl[50],dark:Jl[400]}:{main:Jl[500],light:Jl[300],dark:Jl[700]}}(n),l=e.error||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:$l[500],light:$l[300],dark:$l[700]}:{main:$l[700],light:$l[400],dark:$l[800]}}(n),d=e.info||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:ed[400],light:ed[300],dark:ed[700]}:{main:ed[700],light:ed[500],dark:ed[900]}}(n),f=e.success||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:td[400],light:td[300],dark:td[700]}:{main:td[800],light:td[500],dark:td[900]}}(n),h=e.warning||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:Xl[400],light:Xl[300],dark:Xl[700]}:{main:"#ed6c02",light:Xl[500],dark:Xl[900]}}(n);function p(e){var t=function(e,t){var n=Hl(e),r=Hl(t);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)}(e,id.text.primary)>=i?id.text.primary:rd.text.primary;return t}var v=function(e){var t=e.color,n=e.name,r=e.mainShade,i=void 0===r?500:r,a=e.lightShade,o=void 0===a?300:a,u=e.darkShade,c=void 0===u?700:u;if(!(t=zc({},t)).main&&t[i]&&(t.main=t[i]),!t.hasOwnProperty("main"))throw new Error(Jc(11,n?" (".concat(n,")"):"",i));if("string"!==typeof t.main)throw new Error(Jc(12,n?" (".concat(n,")"):"",JSON.stringify(t.main)));return ad(t,"light",o,s),ad(t,"dark",c,s),t.contrastText||(t.contrastText=p(t.main)),t},g={dark:id,light:rd};return tl(zc({common:zc({},Yl),mode:n,primary:v({color:u,name:"primary"}),secondary:v({color:c,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:v({color:l,name:"error"}),warning:v({color:h,name:"warning"}),info:v({color:d,name:"info"}),success:v({color:f,name:"success"}),grey:Ql,contrastThreshold:i,getContrastText:p,augmentColor:v,tonalOffset:s},g[n]),o)}var od=["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"];var ud={textTransform:"uppercase"},cd='"Roboto", "Helvetica", "Arial", sans-serif';function ld(e,t){var n="function"===typeof t?t(e):t,r=n.fontFamily,i=void 0===r?cd:r,a=n.fontSize,s=void 0===a?14:a,o=n.fontWeightLight,u=void 0===o?300:o,c=n.fontWeightRegular,l=void 0===c?400:c,d=n.fontWeightMedium,f=void 0===d?500:d,h=n.fontWeightBold,p=void 0===h?700:h,v=n.htmlFontSize,g=void 0===v?16:v,m=n.allVariants,y=n.pxToRem,b=Wc(n,od);var k=s/14,T=y||function(e){return"".concat(e/g*k,"rem")},E=function(e,t,n,r,a){return zc({fontFamily:i,fontWeight:e,fontSize:T(t),lineHeight:n},i===cd?{letterSpacing:"".concat((s=r/t,Math.round(1e5*s)/1e5),"em")}:{},a,m);var s},S={h1:E(u,96,1.167,-1.5),h2:E(u,60,1.2,-.5),h3:E(l,48,1.167,0),h4:E(l,34,1.235,.25),h5:E(l,24,1.334,0),h6:E(f,20,1.6,.15),subtitle1:E(l,16,1.75,.15),subtitle2:E(f,14,1.57,.1),body1:E(l,16,1.5,.15),body2:E(l,14,1.43,.15),button:E(f,14,1.75,.4,ud),caption:E(l,12,1.66,.4),overline:E(l,12,2.66,1,ud)};return tl(zc({htmlFontSize:g,pxToRem:T,fontFamily:i,fontSize:s,fontWeightLight:u,fontWeightRegular:l,fontWeightMedium:f,fontWeightBold:p},S),b,{clone:!1})}function dd(){return["".concat(arguments.length<=0?void 0:arguments[0],"px ").concat(arguments.length<=1?void 0:arguments[1],"px ").concat(arguments.length<=2?void 0:arguments[2],"px ").concat(arguments.length<=3?void 0:arguments[3],"px rgba(0,0,0,").concat(.2,")"),"".concat(arguments.length<=4?void 0:arguments[4],"px ").concat(arguments.length<=5?void 0:arguments[5],"px ").concat(arguments.length<=6?void 0:arguments[6],"px ").concat(arguments.length<=7?void 0:arguments[7],"px rgba(0,0,0,").concat(.14,")"),"".concat(arguments.length<=8?void 0:arguments[8],"px ").concat(arguments.length<=9?void 0:arguments[9],"px ").concat(arguments.length<=10?void 0:arguments[10],"px ").concat(arguments.length<=11?void 0:arguments[11],"px rgba(0,0,0,").concat(.12,")")].join(",")}var fd=["none",dd(0,2,1,-1,0,1,1,0,0,1,3,0),dd(0,3,1,-2,0,2,2,0,0,1,5,0),dd(0,3,3,-2,0,3,4,0,0,1,8,0),dd(0,2,4,-1,0,4,5,0,0,1,10,0),dd(0,3,5,-1,0,5,8,0,0,1,14,0),dd(0,3,5,-1,0,6,10,0,0,1,18,0),dd(0,4,5,-2,0,7,10,1,0,2,16,1),dd(0,5,5,-3,0,8,10,1,0,3,14,2),dd(0,5,6,-3,0,9,12,1,0,3,16,2),dd(0,6,6,-3,0,10,14,1,0,4,18,3),dd(0,6,7,-4,0,11,15,1,0,4,20,3),dd(0,7,8,-4,0,12,17,2,0,5,22,4),dd(0,7,8,-4,0,13,19,2,0,5,24,4),dd(0,7,9,-4,0,14,21,2,0,5,26,4),dd(0,8,9,-5,0,15,22,2,0,6,28,5),dd(0,8,10,-5,0,16,24,2,0,6,30,5),dd(0,8,11,-5,0,17,26,2,0,6,32,5),dd(0,9,11,-5,0,18,28,2,0,7,34,6),dd(0,9,12,-6,0,19,29,2,0,7,36,6),dd(0,10,13,-6,0,20,31,3,0,8,38,7),dd(0,10,13,-6,0,21,33,3,0,8,40,7),dd(0,10,14,-6,0,22,35,3,0,8,42,7),dd(0,11,14,-7,0,23,36,3,0,9,44,8),dd(0,11,15,-7,0,24,38,3,0,9,46,8)],hd=["duration","easing","delay"],pd={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},vd={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function gd(e){return"".concat(Math.round(e),"ms")}function md(e){if(!e)return 0;var t=e/36;return Math.round(10*(4+15*Math.pow(t,.25)+t/5))}function yd(e){var t=zc({},pd,e.easing),n=zc({},vd,e.duration);return zc({getAutoHeightDuration:md,create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["all"],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.duration,a=void 0===i?n.standard:i,s=r.easing,o=void 0===s?t.easeInOut:s,u=r.delay,c=void 0===u?0:u;Wc(r,hd);return(Array.isArray(e)?e:[e]).map((function(e){return"".concat(e," ").concat("string"===typeof a?a:gd(a)," ").concat(o," ").concat("string"===typeof c?c:gd(c))})).join(",")}},e,{easing:t,duration:n})}var bd={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500},kd=["breakpoints","mixins","spacing","palette","transitions","typography","shape"];function Td(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.mixins,n=void 0===t?{}:t,r=e.palette,i=void 0===r?{}:r,a=e.transitions,s=void 0===a?{}:a,o=e.typography,u=void 0===o?{}:o,c=Wc(e,kd);if(e.vars)throw new Error(Jc(18));var l=sd(i),d=Dl(e),f=tl(d,{mixins:jl(d.breakpoints,n),palette:l,shadows:fd.slice(),typography:ld(l,u),transitions:yd(s),zIndex:zc({},bd)});f=tl(f,c);for(var h=arguments.length,p=new Array(h>1?h-1:0),v=1;v<h;v++)p[v-1]=arguments[v];return f=p.reduce((function(e,t){return tl(e,t)}),f)}var Ed=Td();function Sd(e){return Bl({props:e.props,name:e.name,defaultTheme:Ed})}var wd=function(e){var t=Object.create(null);return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}},xd=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,Rd=wd((function(e){return xd.test(e)||111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)<91}));var Cd=function(){function e(e){var t=this;this._insertTag=function(e){var n;n=0===t.tags.length?t.insertionPoint?t.insertionPoint.nextSibling:t.prepend?t.container.firstChild:t.before:t.tags[t.tags.length-1].nextSibling,t.container.insertBefore(e,n),t.tags.push(e)},this.isSpeedy=void 0===e.speedy||e.speedy,this.tags=[],this.ctr=0,this.nonce=e.nonce,this.key=e.key,this.container=e.container,this.prepend=e.prepend,this.insertionPoint=e.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(e){e.forEach(this._insertTag)},t.insert=function(e){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(function(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),void 0!==e.nonce&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}(this));var t=this.tags[this.tags.length-1];if(this.isSpeedy){var n=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}(t);try{n.insertRule(e,n.cssRules.length)}catch(r){0}}else t.appendChild(document.createTextNode(e));this.ctr++},t.flush=function(){this.tags.forEach((function(e){return e.parentNode&&e.parentNode.removeChild(e)})),this.tags=[],this.ctr=0},e}(),Ad=Math.abs,Id=String.fromCharCode,Pd=Object.assign;function _d(e){return e.trim()}function Dd(e,t,n){return e.replace(t,n)}function Ld(e,t){return e.indexOf(t)}function Od(e,t){return 0|e.charCodeAt(t)}function Md(e,t,n){return e.slice(t,n)}function Nd(e){return e.length}function Fd(e){return e.length}function Ud(e,t){return t.push(e),e}var Bd=1,jd=1,Gd=0,Vd=0,Kd=0,Hd="";function zd(e,t,n,r,i,a,s){return{value:e,root:t,parent:n,type:r,props:i,children:a,line:Bd,column:jd,length:s,return:""}}function Wd(e,t){return Pd(zd("",null,null,"",null,null,0),e,{length:-e.length},t)}function qd(){return Kd=Vd>0?Od(Hd,--Vd):0,jd--,10===Kd&&(jd=1,Bd--),Kd}function Yd(){return Kd=Vd<Gd?Od(Hd,Vd++):0,jd++,10===Kd&&(jd=1,Bd++),Kd}function Qd(){return Od(Hd,Vd)}function Jd(){return Vd}function $d(e,t){return Md(Hd,e,t)}function Xd(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Zd(e){return Bd=jd=1,Gd=Nd(Hd=e),Vd=0,[]}function ef(e){return Hd="",e}function tf(e){return _d($d(Vd-1,af(91===e?e+2:40===e?e+1:e)))}function nf(e){for(;(Kd=Qd())&&Kd<33;)Yd();return Xd(e)>2||Xd(Kd)>3?"":" "}function rf(e,t){for(;--t&&Yd()&&!(Kd<48||Kd>102||Kd>57&&Kd<65||Kd>70&&Kd<97););return $d(e,Jd()+(t<6&&32==Qd()&&32==Yd()))}function af(e){for(;Yd();)switch(Kd){case e:return Vd;case 34:case 39:34!==e&&39!==e&&af(Kd);break;case 40:41===e&&af(e);break;case 92:Yd()}return Vd}function sf(e,t){for(;Yd()&&e+Kd!==57&&(e+Kd!==84||47!==Qd()););return"/*"+$d(t,Vd-1)+"*"+Id(47===e?e:Yd())}function of(e){for(;!Xd(Qd());)Yd();return $d(e,Vd)}var uf="-ms-",cf="-moz-",lf="-webkit-",df="comm",ff="rule",hf="decl",pf="@keyframes";function vf(e,t){for(var n="",r=Fd(e),i=0;i<r;i++)n+=t(e[i],i,e,t)||"";return n}function gf(e,t,n,r){switch(e.type){case"@import":case hf:return e.return=e.return||e.value;case df:return"";case pf:return e.return=e.value+"{"+vf(e.children,r)+"}";case ff:e.value=e.props.join(",")}return Nd(n=vf(e.children,r))?e.return=e.value+"{"+n+"}":""}function mf(e,t){switch(function(e,t){return(((t<<2^Od(e,0))<<2^Od(e,1))<<2^Od(e,2))<<2^Od(e,3)}(e,t)){case 5103:return lf+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return lf+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return lf+e+cf+e+uf+e+e;case 6828:case 4268:return lf+e+uf+e+e;case 6165:return lf+e+uf+"flex-"+e+e;case 5187:return lf+e+Dd(e,/(\w+).+(:[^]+)/,"-webkit-box-$1$2-ms-flex-$1$2")+e;case 5443:return lf+e+uf+"flex-item-"+Dd(e,/flex-|-self/,"")+e;case 4675:return lf+e+uf+"flex-line-pack"+Dd(e,/align-content|flex-|-self/,"")+e;case 5548:return lf+e+uf+Dd(e,"shrink","negative")+e;case 5292:return lf+e+uf+Dd(e,"basis","preferred-size")+e;case 6060:return lf+"box-"+Dd(e,"-grow","")+lf+e+uf+Dd(e,"grow","positive")+e;case 4554:return lf+Dd(e,/([^-])(transform)/g,"$1-webkit-$2")+e;case 6187:return Dd(Dd(Dd(e,/(zoom-|grab)/,lf+"$1"),/(image-set)/,lf+"$1"),e,"")+e;case 5495:case 3959:return Dd(e,/(image-set\([^]*)/,lf+"$1$`$1");case 4968:return Dd(Dd(e,/(.+:)(flex-)?(.*)/,"-webkit-box-pack:$3-ms-flex-pack:$3"),/s.+-b[^;]+/,"justify")+lf+e+e;case 4095:case 3583:case 4068:case 2532:return Dd(e,/(.+)-inline(.+)/,lf+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Nd(e)-1-t>6)switch(Od(e,t+1)){case 109:if(45!==Od(e,t+4))break;case 102:return Dd(e,/(.+:)(.+)-([^]+)/,"$1-webkit-$2-$3$1"+cf+(108==Od(e,t+3)?"$3":"$2-$3"))+e;case 115:return~Ld(e,"stretch")?mf(Dd(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(115!==Od(e,t+1))break;case 6444:switch(Od(e,Nd(e)-3-(~Ld(e,"!important")&&10))){case 107:return Dd(e,":",":"+lf)+e;case 101:return Dd(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+lf+(45===Od(e,14)?"inline-":"")+"box$3$1"+lf+"$2$3$1"+uf+"$2box$3")+e}break;case 5936:switch(Od(e,t+11)){case 114:return lf+e+uf+Dd(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return lf+e+uf+Dd(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return lf+e+uf+Dd(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return lf+e+uf+e+e}return e}function yf(e){return ef(bf("",null,null,null,[""],e=Zd(e),0,[0],e))}function bf(e,t,n,r,i,a,s,o,u){for(var c=0,l=0,d=s,f=0,h=0,p=0,v=1,g=1,m=1,y=0,b="",k=i,T=a,E=r,S=b;g;)switch(p=y,y=Yd()){case 40:if(108!=p&&58==S.charCodeAt(d-1)){-1!=Ld(S+=Dd(tf(y),"&","&\f"),"&\f")&&(m=-1);break}case 34:case 39:case 91:S+=tf(y);break;case 9:case 10:case 13:case 32:S+=nf(p);break;case 92:S+=rf(Jd()-1,7);continue;case 47:switch(Qd()){case 42:case 47:Ud(Tf(sf(Yd(),Jd()),t,n),u);break;default:S+="/"}break;case 123*v:o[c++]=Nd(S)*m;case 125*v:case 59:case 0:switch(y){case 0:case 125:g=0;case 59+l:h>0&&Nd(S)-d&&Ud(h>32?Ef(S+";",r,n,d-1):Ef(Dd(S," ","")+";",r,n,d-2),u);break;case 59:S+=";";default:if(Ud(E=kf(S,t,n,c,l,i,o,b,k=[],T=[],d),a),123===y)if(0===l)bf(S,t,E,E,k,a,d,o,T);else switch(f){case 100:case 109:case 115:bf(e,E,E,r&&Ud(kf(e,E,E,0,0,i,o,b,i,k=[],d),T),i,T,d,o,r?k:T);break;default:bf(S,E,E,E,[""],T,0,o,T)}}c=l=h=0,v=m=1,b=S="",d=s;break;case 58:d=1+Nd(S),h=p;default:if(v<1)if(123==y)--v;else if(125==y&&0==v++&&125==qd())continue;switch(S+=Id(y),y*v){case 38:m=l>0?1:(S+="\f",-1);break;case 44:o[c++]=(Nd(S)-1)*m,m=1;break;case 64:45===Qd()&&(S+=tf(Yd())),f=Qd(),l=d=Nd(b=S+=of(Jd())),y++;break;case 45:45===p&&2==Nd(S)&&(v=0)}}return a}function kf(e,t,n,r,i,a,s,o,u,c,l){for(var d=i-1,f=0===i?a:[""],h=Fd(f),p=0,v=0,g=0;p<r;++p)for(var m=0,y=Md(e,d+1,d=Ad(v=s[p])),b=e;m<h;++m)(b=_d(v>0?f[m]+" "+y:Dd(y,/&\f/g,f[m])))&&(u[g++]=b);return zd(e,t,n,0===i?ff:o,u,c,l)}function Tf(e,t,n){return zd(e,t,n,df,Id(Kd),Md(e,2,-2),0)}function Ef(e,t,n,r){return zd(e,t,n,hf,Md(e,0,r),Md(e,r+1,-1),r)}var Sf=function(e,t,n){for(var r=0,i=0;r=i,i=Qd(),38===r&&12===i&&(t[n]=1),!Xd(i);)Yd();return $d(e,Vd)},wf=function(e,t){return ef(function(e,t){var n=-1,r=44;do{switch(Xd(r)){case 0:38===r&&12===Qd()&&(t[n]=1),e[n]+=Sf(Vd-1,t,n);break;case 2:e[n]+=tf(r);break;case 4:if(44===r){e[++n]=58===Qd()?"&\f":"",t[n]=e[n].length;break}default:e[n]+=Id(r)}}while(r=Yd());return e}(Zd(e),t))},xf=new WeakMap,Rf=function(e){if("rule"===e.type&&e.parent&&!(e.length<1)){for(var t=e.value,n=e.parent,r=e.column===n.column&&e.line===n.line;"rule"!==n.type;)if(!(n=n.parent))return;if((1!==e.props.length||58===t.charCodeAt(0)||xf.get(n))&&!r){xf.set(e,!0);for(var i=[],a=wf(t,i),s=n.props,o=0,u=0;o<a.length;o++)for(var c=0;c<s.length;c++,u++)e.props[u]=i[o]?a[o].replace(/&\f/g,s[c]):s[c]+" "+a[o]}}},Cf=function(e){if("decl"===e.type){var t=e.value;108===t.charCodeAt(0)&&98===t.charCodeAt(2)&&(e.return="",e.value="")}},Af=[function(e,t,n,r){if(e.length>-1&&!e.return)switch(e.type){case hf:e.return=mf(e.value,e.length);break;case pf:return vf([Wd(e,{value:Dd(e.value,"@","@"+lf)})],r);case ff:if(e.length)return function(e,t){return e.map(t).join("")}(e.props,(function(t){switch(function(e,t){return(e=t.exec(e))?e[0]:e}(t,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return vf([Wd(e,{props:[Dd(t,/:(read-\w+)/,":-moz-$1")]})],r);case"::placeholder":return vf([Wd(e,{props:[Dd(t,/:(plac\w+)/,":-webkit-input-$1")]}),Wd(e,{props:[Dd(t,/:(plac\w+)/,":-moz-$1")]}),Wd(e,{props:[Dd(t,/:(plac\w+)/,uf+"input-$1")]})],r)}return""}))}}],If=function(e){var t=e.key;if("css"===t){var n=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(n,(function(e){-1!==e.getAttribute("data-emotion").indexOf(" ")&&(document.head.appendChild(e),e.setAttribute("data-s",""))}))}var r=e.stylisPlugins||Af;var i,a,s={},o=[];i=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),(function(e){for(var t=e.getAttribute("data-emotion").split(" "),n=1;n<t.length;n++)s[t[n]]=!0;o.push(e)}));var u,c,l=[gf,(c=function(e){u.insert(e)},function(e){e.root||(e=e.return)&&c(e)})],d=function(e){var t=Fd(e);return function(n,r,i,a){for(var s="",o=0;o<t;o++)s+=e[o](n,r,i,a)||"";return s}}([Rf,Cf].concat(r,l));a=function(e,t,n,r){u=n,function(e){vf(yf(e),d)}(e?e+"{"+t.styles+"}":t.styles),r&&(f.inserted[t.name]=!0)};var f={key:t,sheet:new Cd({key:t,container:i,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:s,registered:{},insert:a};return f.sheet.hydrate(o),f};var Pf=function(e){for(var t,n=0,r=0,i=e.length;i>=4;++r,i-=4)t=1540483477*(65535&(t=255&e.charCodeAt(r)|(255&e.charCodeAt(++r))<<8|(255&e.charCodeAt(++r))<<16|(255&e.charCodeAt(++r))<<24))+(59797*(t>>>16)<<16),n=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&n)+(59797*(n>>>16)<<16);switch(i){case 3:n^=(255&e.charCodeAt(r+2))<<16;case 2:n^=(255&e.charCodeAt(r+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(r)))+(59797*(n>>>16)<<16)}return(((n=1540483477*(65535&(n^=n>>>13))+(59797*(n>>>16)<<16))^n>>>15)>>>0).toString(36)},_f={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Df=/[A-Z]|^ms/g,Lf=/_EMO_([^_]+?)_([^]*?)_EMO_/g,Of=function(e){return 45===e.charCodeAt(1)},Mf=function(e){return null!=e&&"boolean"!==typeof e},Nf=wd((function(e){return Of(e)?e:e.replace(Df,"-$&").toLowerCase()})),Ff=function(e,t){switch(e){case"animation":case"animationName":if("string"===typeof t)return t.replace(Lf,(function(e,t,n){return Bf={name:t,styles:n,next:Bf},t}))}return 1===_f[e]||Of(e)||"number"!==typeof t||0===t?t:t+"px"};function Uf(e,t,n){if(null==n)return"";if(void 0!==n.__emotion_styles)return n;switch(typeof n){case"boolean":return"";case"object":if(1===n.anim)return Bf={name:n.name,styles:n.styles,next:Bf},n.name;if(void 0!==n.styles){var r=n.next;if(void 0!==r)for(;void 0!==r;)Bf={name:r.name,styles:r.styles,next:Bf},r=r.next;return n.styles+";"}return function(e,t,n){var r="";if(Array.isArray(n))for(var i=0;i<n.length;i++)r+=Uf(e,t,n[i])+";";else for(var a in n){var s=n[a];if("object"!==typeof s)null!=t&&void 0!==t[s]?r+=a+"{"+t[s]+"}":Mf(s)&&(r+=Nf(a)+":"+Ff(a,s)+";");else if(!Array.isArray(s)||"string"!==typeof s[0]||null!=t&&void 0!==t[s[0]]){var o=Uf(e,t,s);switch(a){case"animation":case"animationName":r+=Nf(a)+":"+o+";";break;default:r+=a+"{"+o+"}"}}else for(var u=0;u<s.length;u++)Mf(s[u])&&(r+=Nf(a)+":"+Ff(a,s[u])+";")}return r}(e,t,n);case"function":if(void 0!==e){var i=Bf,a=n(e);return Bf=i,Uf(e,t,a)}}if(null==t)return n;var s=t[n];return void 0!==s?s:n}var Bf,jf=/label:\s*([^\s;\n{]+)\s*(;|$)/g;var Gf=function(e,t,n){if(1===e.length&&"object"===typeof e[0]&&null!==e[0]&&void 0!==e[0].styles)return e[0];var r=!0,i="";Bf=void 0;var a=e[0];null==a||void 0===a.raw?(r=!1,i+=Uf(n,t,a)):i+=a[0];for(var s=1;s<e.length;s++)i+=Uf(n,t,e[s]),r&&(i+=a[s]);jf.lastIndex=0;for(var o,u="";null!==(o=jf.exec(i));)u+="-"+o[1];return{name:Pf(i)+u,styles:i,next:Bf}},Vf=!!s.useInsertionEffect&&s.useInsertionEffect,Kf=Vf||function(e){return e()},Hf=(Vf||a.useLayoutEffect,(0,a.createContext)("undefined"!==typeof HTMLElement?If({key:"css"}):null));Hf.Provider;var zf=function(e){return(0,a.forwardRef)((function(t,n){var r=(0,a.useContext)(Hf);return e(t,r,n)}))},Wf=(0,a.createContext)({});function qf(e,t,n){var r="";return n.split(" ").forEach((function(n){void 0!==e[n]?t.push(e[n]+";"):r+=n+" "})),r}var Yf=function(e,t,n){var r=e.key+"-"+t.name;!1===n&&void 0===e.registered[r]&&(e.registered[r]=t.styles)},Qf=Rd,Jf=function(e){return"theme"!==e},$f=function(e){return"string"===typeof e&&e.charCodeAt(0)>96?Qf:Jf},Xf=function(e,t,n){var r;if(t){var i=t.shouldForwardProp;r=e.__emotion_forwardProp&&i?function(t){return e.__emotion_forwardProp(t)&&i(t)}:i}return"function"!==typeof r&&n&&(r=e.__emotion_forwardProp),r},Zf=function(e){var t=e.cache,n=e.serialized,r=e.isStringTag;Yf(t,n,r);Kf((function(){return function(e,t,n){Yf(e,t,n);var r=e.key+"-"+t.name;if(void 0===e.inserted[t.name]){var i=t;do{e.insert(t===i?"."+r:"",i,e.sheet,!0),i=i.next}while(void 0!==i)}}(t,n,r)}));return null},eh=function e(t,n){var r,i,s=t.__emotion_real===t,o=s&&t.__emotion_base||t;void 0!==n&&(r=n.label,i=n.target);var u=Xf(t,n,s),c=u||$f(o),l=!c("as");return function(){var d=arguments,f=s&&void 0!==t.__emotion_styles?t.__emotion_styles.slice(0):[];if(void 0!==r&&f.push("label:"+r+";"),null==d[0]||void 0===d[0].raw)f.push.apply(f,d);else{0,f.push(d[0][0]);for(var h=d.length,p=1;p<h;p++)f.push(d[p],d[0][p])}var v=zf((function(e,t,n){var r=l&&e.as||o,s="",d=[],h=e;if(null==e.theme){for(var p in h={},e)h[p]=e[p];h.theme=(0,a.useContext)(Wf)}"string"===typeof e.className?s=qf(t.registered,d,e.className):null!=e.className&&(s=e.className+" ");var v=Gf(f.concat(d),t.registered,h);s+=t.key+"-"+v.name,void 0!==i&&(s+=" "+i);var g=l&&void 0===u?$f(r):c,m={};for(var y in e)l&&"as"===y||g(y)&&(m[y]=e[y]);return m.className=s,m.ref=n,(0,a.createElement)(a.Fragment,null,(0,a.createElement)(Zf,{cache:t,serialized:v,isStringTag:"string"===typeof r}),(0,a.createElement)(r,m))}));return v.displayName=void 0!==r?r:"Styled("+("string"===typeof o?o:o.displayName||o.name||"Component")+")",v.defaultProps=t.defaultProps,v.__emotion_real=v,v.__emotion_base=o,v.__emotion_styles=f,v.__emotion_forwardProp=u,Object.defineProperty(v,"toString",{value:function(){return"."+i}}),v.withComponent=function(t,r){return e(t,zc({},n,r,{shouldForwardProp:Xf(v,r,!0)})).apply(void 0,f)},v}},th=eh.bind();["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"].forEach((function(e){th[e]=th(e)}));var nh=th;function rh(e,t){return nh(e,t)}var ih=function(e,t){Array.isArray(e.__emotion_styles)&&(e.__emotion_styles=t(e.__emotion_styles))},ah=["variant"];function sh(e){return 0===e.length}function oh(e){var t=e.variant,n=Wc(e,ah),r=t||"";return Object.keys(n).sort().forEach((function(t){r+="color"===t?sh(r)?e[t]:$c(e[t]):"".concat(sh(r)?t:$c(t)).concat($c(e[t].toString()))})),r}var uh=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.reduce((function(e,t){return t.filterProps.forEach((function(n){e[n]=t})),e}),{}),i=function(e){return Object.keys(e).reduce((function(t,n){return r[n]?hl(t,r[n](e)):t}),{})};return i.propTypes={},i.filterProps=t.reduce((function(e,t){return e.concat(t.filterProps)}),[]),i};function ch(e){return"number"!==typeof e?e:"".concat(e,"px solid")}var lh=fl({prop:"border",themeKey:"borders",transform:ch}),dh=fl({prop:"borderTop",themeKey:"borders",transform:ch}),fh=fl({prop:"borderRight",themeKey:"borders",transform:ch}),hh=fl({prop:"borderBottom",themeKey:"borders",transform:ch}),ph=fl({prop:"borderLeft",themeKey:"borders",transform:ch}),vh=fl({prop:"borderColor",themeKey:"palette"}),gh=fl({prop:"borderTopColor",themeKey:"palette"}),mh=fl({prop:"borderRightColor",themeKey:"palette"}),yh=fl({prop:"borderBottomColor",themeKey:"palette"}),bh=fl({prop:"borderLeftColor",themeKey:"palette"}),kh=function(e){if(void 0!==e.borderRadius&&null!==e.borderRadius){var t=Tl(e.theme,"shape.borderRadius",4);return ol(e,e.borderRadius,(function(e){return{borderRadius:Sl(t,e)}}))}return null};kh.propTypes={},kh.filterProps=["borderRadius"];var Th=uh(lh,dh,fh,hh,ph,vh,gh,mh,yh,bh,kh),Eh=uh(fl({prop:"displayPrint",cssProperty:!1,transform:function(e){return{"@media print":{display:e}}}}),fl({prop:"display"}),fl({prop:"overflow"}),fl({prop:"textOverflow"}),fl({prop:"visibility"}),fl({prop:"whiteSpace"})),Sh=uh(fl({prop:"flexBasis"}),fl({prop:"flexDirection"}),fl({prop:"flexWrap"}),fl({prop:"justifyContent"}),fl({prop:"alignItems"}),fl({prop:"alignContent"}),fl({prop:"order"}),fl({prop:"flex"}),fl({prop:"flexGrow"}),fl({prop:"flexShrink"}),fl({prop:"alignSelf"}),fl({prop:"justifyItems"}),fl({prop:"justifySelf"})),wh=function(e){if(void 0!==e.gap&&null!==e.gap){var t=Tl(e.theme,"spacing",8);return ol(e,e.gap,(function(e){return{gap:Sl(t,e)}}))}return null};wh.propTypes={},wh.filterProps=["gap"];var xh=function(e){if(void 0!==e.columnGap&&null!==e.columnGap){var t=Tl(e.theme,"spacing",8);return ol(e,e.columnGap,(function(e){return{columnGap:Sl(t,e)}}))}return null};xh.propTypes={},xh.filterProps=["columnGap"];var Rh=function(e){if(void 0!==e.rowGap&&null!==e.rowGap){var t=Tl(e.theme,"spacing",8);return ol(e,e.rowGap,(function(e){return{rowGap:Sl(t,e)}}))}return null};Rh.propTypes={},Rh.filterProps=["rowGap"];var Ch=uh(wh,xh,Rh,fl({prop:"gridColumn"}),fl({prop:"gridRow"}),fl({prop:"gridAutoFlow"}),fl({prop:"gridAutoColumns"}),fl({prop:"gridAutoRows"}),fl({prop:"gridTemplateColumns"}),fl({prop:"gridTemplateRows"}),fl({prop:"gridTemplateAreas"}),fl({prop:"gridArea"})),Ah=uh(fl({prop:"position"}),fl({prop:"zIndex",themeKey:"zIndex"}),fl({prop:"top"}),fl({prop:"right"}),fl({prop:"bottom"}),fl({prop:"left"})),Ih=uh(fl({prop:"color",themeKey:"palette"}),fl({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette"}),fl({prop:"backgroundColor",themeKey:"palette"})),Ph=fl({prop:"boxShadow",themeKey:"shadows"});function _h(e){return e<=1&&0!==e?"".concat(100*e,"%"):e}var Dh=fl({prop:"width",transform:_h}),Lh=function(e){if(void 0!==e.maxWidth&&null!==e.maxWidth){return ol(e,e.maxWidth,(function(t){var n,r,i;return{maxWidth:(null==(n=e.theme)||null==(r=n.breakpoints)||null==(i=r.values)?void 0:i[t])||al[t]||_h(t)}}))}return null};Lh.filterProps=["maxWidth"];var Oh=fl({prop:"minWidth",transform:_h}),Mh=fl({prop:"height",transform:_h}),Nh=fl({prop:"maxHeight",transform:_h}),Fh=fl({prop:"minHeight",transform:_h}),Uh=(fl({prop:"size",cssProperty:"width",transform:_h}),fl({prop:"size",cssProperty:"height",transform:_h}),uh(Dh,Lh,Oh,Mh,Nh,Fh,fl({prop:"boxSizing"}))),Bh=fl({prop:"fontFamily",themeKey:"typography"}),jh=fl({prop:"fontSize",themeKey:"typography"}),Gh=fl({prop:"fontStyle",themeKey:"typography"}),Vh=fl({prop:"fontWeight",themeKey:"typography"}),Kh=fl({prop:"letterSpacing"}),Hh=fl({prop:"textTransform"}),zh=fl({prop:"lineHeight"}),Wh=fl({prop:"textAlign"}),qh=uh(fl({prop:"typography",cssProperty:!1,themeKey:"typography"}),Bh,jh,Gh,Vh,Kh,zh,Wh,Hh),Yh={borders:Th.filterProps,display:Eh.filterProps,flexbox:Sh.filterProps,grid:Ch.filterProps,positions:Ah.filterProps,palette:Ih.filterProps,shadows:Ph.filterProps,sizing:Uh.filterProps,spacing:Il.filterProps,typography:qh.filterProps},Qh={borders:Th,display:Eh,flexbox:Sh,grid:Ch,positions:Ah,palette:Ih,shadows:Ph,sizing:Uh,spacing:Il,typography:qh};Object.keys(Yh).reduce((function(e,t){return Yh[t].forEach((function(n){e[n]=Qh[t]})),e}),{});function Jh(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.reduce((function(e,t){return e.concat(Object.keys(t))}),[]),i=new Set(r);return t.every((function(e){return i.size===Object.keys(e).length}))}function $h(e,t){return"function"===typeof e?e(t):e}var Xh=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Qh,t=Object.keys(e).reduce((function(t,n){return e[n].filterProps.forEach((function(r){t[r]=e[n]})),t}),{});function n(e,n,r){var i,a=(E(i={},e,n),E(i,"theme",r),i),s=t[e];return s?s(a):E({},e,n)}function r(e){var i=e||{},a=i.sx,s=i.theme,o=void 0===s?{}:s;if(!a)return null;function u(e){var i=e;if("function"===typeof e)i=e(o);else if("object"!==typeof e)return e;if(!i)return null;var a=ul(o.breakpoints),s=Object.keys(a),u=a;return Object.keys(i).forEach((function(e){var a=$h(i[e],o);if(null!==a&&void 0!==a)if("object"===typeof a)if(t[e])u=hl(u,n(e,a,o));else{var s=ol({theme:o},a,(function(t){return E({},e,t)}));Jh(s,a)?u[e]=r({sx:a,theme:o}):u=hl(u,s)}else u=hl(u,n(e,a,o))})),cl(s,u)}return Array.isArray(a)?a.map(u):u(a)}return r}();Xh.filterProps=["sx"];var Zh=Xh,ep=["name","slot","skipVariantsResolver","skipSx","overridesResolver"],tp=["theme"],np=["theme"];function rp(e){return 0===Object.keys(e).length}function ip(e){return"string"===typeof e&&e.charCodeAt(0)>96}var ap=function(e,t){return t.components&&t.components[e]&&t.components[e].styleOverrides?t.components[e].styleOverrides:null},sp=function(e,t){var n=[];t&&t.components&&t.components[e]&&t.components[e].variants&&(n=t.components[e].variants);var r={};return n.forEach((function(e){var t=oh(e.props);r[t]=e.style})),r},op=function(e,t,n,r){var i,a,s=e.ownerState,o=void 0===s?{}:s,u=[],c=null==n||null==(i=n.components)||null==(a=i[r])?void 0:a.variants;return c&&c.forEach((function(n){var r=!0;Object.keys(n.props).forEach((function(t){o[t]!==n.props[t]&&e[t]!==n.props[t]&&(r=!1)})),r&&u.push(t[oh(n.props)])})),u};function up(e){return"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e}var cp=Dl();var lp=function(e){return up(e)&&"classes"!==e},dp=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.defaultTheme,n=void 0===t?cp:t,r=e.rootShouldForwardProp,i=void 0===r?up:r,a=e.slotShouldForwardProp,s=void 0===a?up:a,o=e.styleFunctionSx,u=void 0===o?Zh:o,c=function(e){var t=rp(e.theme)?n:e.theme;return u(zc({},e,{theme:t}))};return c.__mui_systemSx=!0,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};ih(e,(function(e){return e.filter((function(e){return!(null!=e&&e.__mui_systemSx)}))}));var r,a=t.name,o=t.slot,u=t.skipVariantsResolver,l=t.skipSx,d=t.overridesResolver,f=Wc(t,ep),h=void 0!==u?u:o&&"Root"!==o||!1,v=l||!1;var g=up;"Root"===o?g=i:o?g=s:ip(e)&&(g=void 0);var m=rh(e,zc({shouldForwardProp:g,label:r},f)),y=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];var s=r?r.map((function(e){return"function"===typeof e&&e.__emotion_real!==e?function(t){var r=t.theme,i=Wc(t,tp);return e(zc({theme:rp(r)?n:r},i))}:e})):[],o=e;a&&d&&s.push((function(e){var t=rp(e.theme)?n:e.theme,r=ap(a,t);if(r){var i={};return Object.entries(r).forEach((function(n){var r=p(n,2),a=r[0],s=r[1];i[a]="function"===typeof s?s(zc({},e,{theme:t})):s})),d(e,i)}return null})),a&&!h&&s.push((function(e){var t=rp(e.theme)?n:e.theme;return op(e,sp(a,t),t,a)})),v||s.push(c);var u=s.length-r.length;if(Array.isArray(e)&&u>0){var l=new Array(u).fill("");(o=[].concat(T(e),T(l))).raw=[].concat(T(e.raw),T(l))}else"function"===typeof e&&e.__emotion_real!==e&&(o=function(t){var r=t.theme,i=Wc(t,np);return e(zc({theme:rp(r)?n:r},i))});var f=m.apply(void 0,[o].concat(T(s)));return f};return m.withConfig&&(y.withConfig=m.withConfig),y}}({defaultTheme:Ed,rootShouldForwardProp:lp}),fp=dp,hp=function(e){return e},pp=function(){var e=hp;return{configure:function(t){e=t},generate:function(t){return e(t)},reset:function(){e=hp}}}(),vp={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",required:"required",selected:"selected"};function gp(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Mui",r=vp[t];return r?"".concat(n,"-").concat(r):"".concat(pp.generate(e),"-").concat(t)}function mp(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Mui",r={};return t.forEach((function(t){r[t]=gp(e,t,n)})),r}function yp(e){return gp("MuiSvgIcon",e)}mp("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);var bp=["children","className","color","component","fontSize","htmlColor","inheritViewBox","titleAccess","viewBox"],kp=fp("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,"inherit"!==n.color&&t["color".concat(Xc(n.color))],t["fontSize".concat(Xc(n.fontSize))]]}})((function(e){var t,n,r,i,a,s,o,u,c,l,d,f,h,p,v,g,m,y=e.theme,b=e.ownerState;return{userSelect:"none",width:"1em",height:"1em",display:"inline-block",fill:"currentColor",flexShrink:0,transition:null==(t=y.transitions)||null==(n=t.create)?void 0:n.call(t,"fill",{duration:null==(r=y.transitions)||null==(i=r.duration)?void 0:i.shorter}),fontSize:{inherit:"inherit",small:(null==(a=y.typography)||null==(s=a.pxToRem)?void 0:s.call(a,20))||"1.25rem",medium:(null==(o=y.typography)||null==(u=o.pxToRem)?void 0:u.call(o,24))||"1.5rem",large:(null==(c=y.typography)||null==(l=c.pxToRem)?void 0:l.call(c,35))||"2.1875"}[b.fontSize],color:null!=(d=null==(f=(y.vars||y).palette)||null==(h=f[b.color])?void 0:h.main)?d:{action:null==(p=(y.vars||y).palette)||null==(v=p.action)?void 0:v.active,disabled:null==(g=(y.vars||y).palette)||null==(m=g.action)?void 0:m.disabled,inherit:void 0}[b.color]}})),Tp=a.forwardRef((function(e,t){var n=Sd({props:e,name:"MuiSvgIcon"}),r=n.children,i=n.className,a=n.color,s=void 0===a?"inherit":a,o=n.component,u=void 0===o?"svg":o,c=n.fontSize,l=void 0===c?"medium":c,d=n.htmlColor,f=n.inheritViewBox,h=void 0!==f&&f,p=n.titleAccess,v=n.viewBox,g=void 0===v?"0 0 24 24":v,m=Wc(n,bp),y=zc({},n,{color:s,component:u,fontSize:l,instanceFontSize:e.fontSize,inheritViewBox:h,viewBox:g}),b={};h||(b.viewBox=g);var k=function(e){var t=e.color,n=e.fontSize,r=e.classes;return Qc({root:["root","inherit"!==t&&"color".concat(Xc(t)),"fontSize".concat(Xc(n))]},yp,r)}(y);return(0,xu.jsxs)(kp,zc({as:u,className:Yc(k.root,i),ownerState:y,focusable:"false",color:d,"aria-hidden":!p||void 0,role:p?"img":void 0,ref:t},b,m,{children:[r,p?(0,xu.jsx)("title",{children:p}):null]}))}));Tp.muiName="SvgIcon";var Ep=Tp;function Sp(e,t){var n=function(n,r){return(0,xu.jsx)(Ep,zc({"data-testid":"".concat(t,"Icon"),ref:r},n,{children:e}))};return n.muiName=Ep.muiName,a.memo(a.forwardRef(n))}var wp=Sp((0,xu.jsx)("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5zm6 6c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"}),"MicNoneOutlined"),xp=Sp((0,xu.jsx)("path",{d:"M10.8 4.9c0-.66.54-1.2 1.2-1.2s1.2.54 1.2 1.2l-.01 3.91L15 10.6V5c0-1.66-1.34-3-3-3-1.54 0-2.79 1.16-2.96 2.65l1.76 1.76V4.9zM19 11h-1.7c0 .58-.1 1.13-.27 1.64l1.27 1.27c.44-.88.7-1.87.7-2.91zM4.41 2.86 3 4.27l6 6V11c0 1.66 1.34 3 3 3 .23 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.55-.9l4.2 4.2 1.41-1.41L4.41 2.86z"}),"MicOffOutlined"),Rp=Sp((0,xu.jsx)("path",{d:"M15 8v8H5V8h10m1-2H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4V7c0-.55-.45-1-1-1z"}),"VideocamOutlined"),Cp=Sp((0,xu.jsx)("path",{d:"m9.56 8-2-2-4.15-4.14L2 3.27 4.73 6H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.21 0 .39-.08.55-.18L19.73 21l1.41-1.41-8.86-8.86L9.56 8zM5 16V8h1.73l8 8H5zm10-8v2.61l6 6V6.5l-4 4V7c0-.55-.45-1-1-1h-5.61l2 2H15z"}),"VideocamOffOutlined"),Ap=Sp((0,xu.jsx)("path",{d:"m17 8-1.41 1.41L17.17 11H9v2h8.17l-1.58 1.58L17 16l4-4-4-4zM5 5h7V3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h7v-2H5V5z"}),"LogoutOutlined"),Ip=Sp((0,xu.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm4-4H8V8h8v8z"}),"StopCircleOutlined"),Pp=Sp((0,xu.jsx)("path",{d:"M14 12c0 .74-.4 1.38-1 1.72V22h-2v-8.28c-.6-.35-1-.98-1-1.72 0-1.1.9-2 2-2s2 .9 2 2zm-2-6c-3.31 0-6 2.69-6 6 0 1.74.75 3.31 1.94 4.4l1.42-1.42C8.53 14.25 8 13.19 8 12c0-2.21 1.79-4 4-4s4 1.79 4 4c0 1.19-.53 2.25-1.36 2.98l1.42 1.42C17.25 15.31 18 13.74 18 12c0-3.31-2.69-6-6-6zm0-4C6.48 2 2 6.48 2 12c0 2.85 1.2 5.41 3.11 7.24l1.42-1.42C4.98 16.36 4 14.29 4 12c0-4.41 3.59-8 8-8s8 3.59 8 8c0 2.29-.98 4.36-2.53 5.82l1.42 1.42C20.8 17.41 22 14.85 22 12c0-5.52-4.48-10-10-10z"}),"PodcastsOutlined");function _p(e,t){"function"===typeof e?e(t):e&&(e.current=t)}var Dp=function(e,t){return a.useMemo((function(){return null==e&&null==t?null:function(n){_p(e,n),_p(t,n)}}),[e,t])},Lp="undefined"!==typeof window?a.useLayoutEffect:a.useEffect;var Op,Mp=function(e){var t=a.useRef(e);return Lp((function(){t.current=e})),a.useCallback((function(){return t.current.apply(void 0,arguments)}),[])},Np=!0,Fp=!1,Up={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function Bp(e){e.metaKey||e.altKey||e.ctrlKey||(Np=!0)}function jp(){Np=!1}function Gp(){"hidden"===this.visibilityState&&Fp&&(Np=!0)}function Vp(e){var t=e.target;try{return t.matches(":focus-visible")}catch(n){}return Np||function(e){var t=e.type,n=e.tagName;return!("INPUT"!==n||!Up[t]||e.readOnly)||"TEXTAREA"===n&&!e.readOnly||!!e.isContentEditable}(t)}var Kp=function(){var e=a.useCallback((function(e){var t;null!=e&&((t=e.ownerDocument).addEventListener("keydown",Bp,!0),t.addEventListener("mousedown",jp,!0),t.addEventListener("pointerdown",jp,!0),t.addEventListener("touchstart",jp,!0),t.addEventListener("visibilitychange",Gp,!0))}),[]),t=a.useRef(!1);return{isFocusVisibleRef:t,onFocus:function(e){return!!Vp(e)&&(t.current=!0,!0)},onBlur:function(){return!!t.current&&(Fp=!0,window.clearTimeout(Op),Op=window.setTimeout((function(){Fp=!1}),100),t.current=!1,!0)},ref:e}};function Hp(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var zp=a.createContext(null);function Wp(e,t){var n=Object.create(null);return e&&a.Children.map(e,(function(e){return e})).forEach((function(e){n[e.key]=function(e){return t&&(0,a.isValidElement)(e)?t(e):e}(e)})),n}function qp(e,t,n){return null!=n[t]?n[t]:e.props[t]}function Yp(e,t,n){var r=Wp(e.children),i=function(e,t){function n(n){return n in t?t[n]:e[n]}e=e||{},t=t||{};var r,i=Object.create(null),a=[];for(var s in e)s in t?a.length&&(i[s]=a,a=[]):a.push(s);var o={};for(var u in t){if(i[u])for(r=0;r<i[u].length;r++){var c=i[u][r];o[i[u][r]]=n(c)}o[u]=n(u)}for(r=0;r<a.length;r++)o[a[r]]=n(a[r]);return o}(t,r);return Object.keys(i).forEach((function(s){var o=i[s];if((0,a.isValidElement)(o)){var u=s in t,c=s in r,l=t[s],d=(0,a.isValidElement)(l)&&!l.props.in;!c||u&&!d?c||!u||d?c&&u&&(0,a.isValidElement)(l)&&(i[s]=(0,a.cloneElement)(o,{onExited:n.bind(null,o),in:l.props.in,exit:qp(o,"exit",e),enter:qp(o,"enter",e)})):i[s]=(0,a.cloneElement)(o,{in:!1}):i[s]=(0,a.cloneElement)(o,{onExited:n.bind(null,o),in:!0,exit:qp(o,"exit",e),enter:qp(o,"enter",e)})}})),i}var Qp=Object.values||function(e){return Object.keys(e).map((function(t){return e[t]}))},Jp=function(e){var t,n;function r(t,n){var r,i=(r=e.call(this,t,n)||this).handleExited.bind(Ae(r));return r.state={contextValue:{isMounting:!0},handleExited:i,firstRender:!0},r}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,Ie(t,n);var i=r.prototype;return i.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},i.componentWillUnmount=function(){this.mounted=!1},r.getDerivedStateFromProps=function(e,t){var n,r,i=t.children,s=t.handleExited;return{children:t.firstRender?(n=e,r=s,Wp(n.children,(function(e){return(0,a.cloneElement)(e,{onExited:r.bind(null,e),in:!0,appear:qp(e,"appear",n),enter:qp(e,"enter",n),exit:qp(e,"exit",n)})}))):Yp(e,i,s),firstRender:!1}},i.handleExited=function(e,t){var n=Wp(this.props.children);e.key in n||(e.props.onExited&&e.props.onExited(t),this.mounted&&this.setState((function(t){var n=zc({},t.children);return delete n[e.key],{children:n}})))},i.render=function(){var e=this.props,t=e.component,n=e.childFactory,r=Wc(e,["component","childFactory"]),i=this.state.contextValue,s=Qp(this.state.children).map(n);return delete r.appear,delete r.enter,delete r.exit,null===t?a.createElement(zp.Provider,{value:i},s):a.createElement(zp.Provider,{value:i},a.createElement(t,r,s))},r}(a.Component);Jp.propTypes={},Jp.defaultProps={component:"div",childFactory:function(e){return e}};var $p=Jp;n(110);function Xp(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Gf(t)}var Zp=function(){var e=Xp.apply(void 0,arguments),t="animation-"+e.name;return{name:t,styles:"@keyframes "+t+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}};var ev=function(e){var t=e.className,n=e.classes,r=e.pulsate,i=void 0!==r&&r,s=e.rippleX,o=e.rippleY,u=e.rippleSize,c=e.in,l=e.onExited,d=e.timeout,f=p(a.useState(!1),2),h=f[0],v=f[1],g=Yc(t,n.ripple,n.rippleVisible,i&&n.ripplePulsate),m={width:u,height:u,top:-u/2+o,left:-u/2+s},y=Yc(n.child,h&&n.childLeaving,i&&n.childPulsate);return c||h||v(!0),a.useEffect((function(){if(!c&&null!=l){var e=setTimeout(l,d);return function(){clearTimeout(e)}}}),[l,c,d]),(0,xu.jsx)("span",{className:g,style:m,children:(0,xu.jsx)("span",{className:y})})};var tv,nv,rv,iv,av,sv,ov,uv,cv=mp("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),lv=["center","classes","className"],dv=Zp(av||(av=tv||(tv=Hp(["\n  0% {\n    transform: scale(0);\n    opacity: 0.1;\n  }\n\n  100% {\n    transform: scale(1);\n    opacity: 0.3;\n  }\n"])))),fv=Zp(sv||(sv=nv||(nv=Hp(["\n  0% {\n    opacity: 1;\n  }\n\n  100% {\n    opacity: 0;\n  }\n"])))),hv=Zp(ov||(ov=rv||(rv=Hp(["\n  0% {\n    transform: scale(1);\n  }\n\n  50% {\n    transform: scale(0.92);\n  }\n\n  100% {\n    transform: scale(1);\n  }\n"])))),pv=fp("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),vv=fp(ev,{name:"MuiTouchRipple",slot:"Ripple"})(uv||(uv=iv||(iv=Hp(["\n  opacity: 0;\n  position: absolute;\n\n  &."," {\n    opacity: 0.3;\n    transform: scale(1);\n    animation-name: ",";\n    animation-duration: ","ms;\n    animation-timing-function: ",";\n  }\n\n  &."," {\n    animation-duration: ","ms;\n  }\n\n  & ."," {\n    opacity: 1;\n    display: block;\n    width: 100%;\n    height: 100%;\n    border-radius: 50%;\n    background-color: currentColor;\n  }\n\n  & ."," {\n    opacity: 0;\n    animation-name: ",";\n    animation-duration: ","ms;\n    animation-timing-function: ",";\n  }\n\n  & ."," {\n    position: absolute;\n    /* @noflip */\n    left: 0px;\n    top: 0;\n    animation-name: ",";\n    animation-duration: 2500ms;\n    animation-timing-function: ",";\n    animation-iteration-count: infinite;\n    animation-delay: 200ms;\n  }\n"]))),cv.rippleVisible,dv,550,(function(e){return e.theme.transitions.easing.easeInOut}),cv.ripplePulsate,(function(e){return e.theme.transitions.duration.shorter}),cv.child,cv.childLeaving,fv,550,(function(e){return e.theme.transitions.easing.easeInOut}),cv.childPulsate,hv,(function(e){return e.theme.transitions.easing.easeInOut})),gv=a.forwardRef((function(e,t){var n=Sd({props:e,name:"MuiTouchRipple"}),r=n.center,i=void 0!==r&&r,s=n.classes,o=void 0===s?{}:s,u=n.className,c=Wc(n,lv),l=p(a.useState([]),2),d=l[0],f=l[1],h=a.useRef(0),v=a.useRef(null);a.useEffect((function(){v.current&&(v.current(),v.current=null)}),[d]);var g=a.useRef(!1),m=a.useRef(null),y=a.useRef(null),b=a.useRef(null);a.useEffect((function(){return function(){clearTimeout(m.current)}}),[]);var k=a.useCallback((function(e){var t=e.pulsate,n=e.rippleX,r=e.rippleY,i=e.rippleSize,a=e.cb;f((function(e){return[].concat(T(e),[(0,xu.jsx)(vv,{classes:{ripple:Yc(o.ripple,cv.ripple),rippleVisible:Yc(o.rippleVisible,cv.rippleVisible),ripplePulsate:Yc(o.ripplePulsate,cv.ripplePulsate),child:Yc(o.child,cv.child),childLeaving:Yc(o.childLeaving,cv.childLeaving),childPulsate:Yc(o.childPulsate,cv.childPulsate)},timeout:550,pulsate:t,rippleX:n,rippleY:r,rippleSize:i},h.current)])})),h.current+=1,v.current=a}),[o]),E=a.useCallback((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=t.pulsate,a=void 0!==r&&r,s=t.center,o=void 0===s?i||t.pulsate:s,u=t.fakeElement,c=void 0!==u&&u;if("mousedown"===(null==e?void 0:e.type)&&g.current)g.current=!1;else{"touchstart"===(null==e?void 0:e.type)&&(g.current=!0);var l,d,f,h=c?null:b.current,p=h?h.getBoundingClientRect():{width:0,height:0,left:0,top:0};if(o||void 0===e||0===e.clientX&&0===e.clientY||!e.clientX&&!e.touches)l=Math.round(p.width/2),d=Math.round(p.height/2);else{var v=e.touches&&e.touches.length>0?e.touches[0]:e,T=v.clientX,E=v.clientY;l=Math.round(T-p.left),d=Math.round(E-p.top)}if(o)(f=Math.sqrt((2*Math.pow(p.width,2)+Math.pow(p.height,2))/3))%2===0&&(f+=1);else{var S=2*Math.max(Math.abs((h?h.clientWidth:0)-l),l)+2,w=2*Math.max(Math.abs((h?h.clientHeight:0)-d),d)+2;f=Math.sqrt(Math.pow(S,2)+Math.pow(w,2))}null!=e&&e.touches?null===y.current&&(y.current=function(){k({pulsate:a,rippleX:l,rippleY:d,rippleSize:f,cb:n})},m.current=setTimeout((function(){y.current&&(y.current(),y.current=null)}),80)):k({pulsate:a,rippleX:l,rippleY:d,rippleSize:f,cb:n})}}),[i,k]),S=a.useCallback((function(){E({},{pulsate:!0})}),[E]),w=a.useCallback((function(e,t){if(clearTimeout(m.current),"touchend"===(null==e?void 0:e.type)&&y.current)return y.current(),y.current=null,void(m.current=setTimeout((function(){w(e,t)})));y.current=null,f((function(e){return e.length>0?e.slice(1):e})),v.current=t}),[]);return a.useImperativeHandle(t,(function(){return{pulsate:S,start:E,stop:w}}),[S,E,w]),(0,xu.jsx)(pv,zc({className:Yc(cv.root,o.root,u),ref:b},c,{children:(0,xu.jsx)($p,{component:null,exit:!0,children:d})}))})),mv=gv;function yv(e){return gp("MuiButtonBase",e)}var bv,kv=mp("MuiButtonBase",["root","disabled","focusVisible"]),Tv=["action","centerRipple","children","className","component","disabled","disableRipple","disableTouchRipple","focusRipple","focusVisibleClassName","LinkComponent","onBlur","onClick","onContextMenu","onDragLeave","onFocus","onFocusVisible","onKeyDown","onKeyUp","onMouseDown","onMouseLeave","onMouseUp","onTouchEnd","onTouchMove","onTouchStart","tabIndex","TouchRippleProps","touchRippleRef","type"],Ev=fp("button",{name:"MuiButtonBase",slot:"Root",overridesResolver:function(e,t){return t.root}})((E(bv={display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"}},"&.".concat(kv.disabled),{pointerEvents:"none",cursor:"default"}),E(bv,"@media print",{colorAdjust:"exact"}),bv)),Sv=a.forwardRef((function(e,t){var n=Sd({props:e,name:"MuiButtonBase"}),r=n.action,i=n.centerRipple,s=void 0!==i&&i,o=n.children,u=n.className,c=n.component,l=void 0===c?"button":c,d=n.disabled,f=void 0!==d&&d,h=n.disableRipple,v=void 0!==h&&h,g=n.disableTouchRipple,m=void 0!==g&&g,y=n.focusRipple,b=void 0!==y&&y,k=n.LinkComponent,T=void 0===k?"a":k,E=n.onBlur,S=n.onClick,w=n.onContextMenu,x=n.onDragLeave,R=n.onFocus,C=n.onFocusVisible,A=n.onKeyDown,I=n.onKeyUp,P=n.onMouseDown,_=n.onMouseLeave,D=n.onMouseUp,L=n.onTouchEnd,O=n.onTouchMove,M=n.onTouchStart,N=n.tabIndex,F=void 0===N?0:N,U=n.TouchRippleProps,B=n.touchRippleRef,j=n.type,G=Wc(n,Tv),V=a.useRef(null),K=a.useRef(null),H=Dp(K,B),z=Kp(),W=z.isFocusVisibleRef,q=z.onFocus,Y=z.onBlur,Q=z.ref,J=p(a.useState(!1),2),$=J[0],X=J[1];f&&$&&X(!1),a.useImperativeHandle(r,(function(){return{focusVisible:function(){X(!0),V.current.focus()}}}),[]);var Z=p(a.useState(!1),2),ee=Z[0],te=Z[1];a.useEffect((function(){te(!0)}),[]);var ne=ee&&!v&&!f;function re(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m;return Mp((function(r){return t&&t(r),!n&&K.current&&K.current[e](r),!0}))}a.useEffect((function(){$&&b&&!v&&ee&&K.current.pulsate()}),[v,b,$,ee]);var ie=re("start",P),ae=re("stop",w),se=re("stop",x),oe=re("stop",D),ue=re("stop",(function(e){$&&e.preventDefault(),_&&_(e)})),ce=re("start",M),le=re("stop",L),de=re("stop",O),fe=re("stop",(function(e){Y(e),!1===W.current&&X(!1),E&&E(e)}),!1),he=Mp((function(e){V.current||(V.current=e.currentTarget),q(e),!0===W.current&&(X(!0),C&&C(e)),R&&R(e)})),pe=function(){var e=V.current;return l&&"button"!==l&&!("A"===e.tagName&&e.href)},ve=a.useRef(!1),ge=Mp((function(e){b&&!ve.current&&$&&K.current&&" "===e.key&&(ve.current=!0,K.current.stop(e,(function(){K.current.start(e)}))),e.target===e.currentTarget&&pe()&&" "===e.key&&e.preventDefault(),A&&A(e),e.target===e.currentTarget&&pe()&&"Enter"===e.key&&!f&&(e.preventDefault(),S&&S(e))})),me=Mp((function(e){b&&" "===e.key&&K.current&&$&&!e.defaultPrevented&&(ve.current=!1,K.current.stop(e,(function(){K.current.pulsate(e)}))),I&&I(e),S&&e.target===e.currentTarget&&pe()&&" "===e.key&&!e.defaultPrevented&&S(e)})),ye=l;"button"===ye&&(G.href||G.to)&&(ye=T);var be={};"button"===ye?(be.type=void 0===j?"button":j,be.disabled=f):(G.href||G.to||(be.role="button"),f&&(be["aria-disabled"]=f));var ke=Dp(Q,V),Te=Dp(t,ke);var Ee=zc({},n,{centerRipple:s,component:l,disabled:f,disableRipple:v,disableTouchRipple:m,focusRipple:b,tabIndex:F,focusVisible:$}),Se=function(e){var t=e.disabled,n=e.focusVisible,r=e.focusVisibleClassName,i=Qc({root:["root",t&&"disabled",n&&"focusVisible"]},yv,e.classes);return n&&r&&(i.root+=" ".concat(r)),i}(Ee);return(0,xu.jsxs)(Ev,zc({as:ye,className:Yc(Se.root,u),ownerState:Ee,onBlur:fe,onClick:S,onContextMenu:ae,onFocus:he,onKeyDown:ge,onKeyUp:me,onMouseDown:ie,onMouseLeave:ue,onMouseUp:oe,onDragLeave:se,onTouchEnd:le,onTouchMove:de,onTouchStart:ce,ref:Te,tabIndex:f?-1:F,type:j},be,G,{children:[o,ne?(0,xu.jsx)(mv,zc({ref:H,center:s},U)):null]}))})),wv=Sv;function xv(e){return gp("MuiIconButton",e)}var Rv=mp("MuiIconButton",["root","disabled","colorInherit","colorPrimary","colorSecondary","edgeStart","edgeEnd","sizeSmall","sizeMedium","sizeLarge"]),Cv=["edge","children","className","color","disabled","disableFocusRipple","size"],Av=fp(wv,{name:"MuiIconButton",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,"default"!==n.color&&t["color".concat(Xc(n.color))],n.edge&&t["edge".concat(Xc(n.edge))],t["size".concat(Xc(n.size))]]}})((function(e){var t=e.theme,n=e.ownerState;return zc({textAlign:"center",flex:"0 0 auto",fontSize:t.typography.pxToRem(24),padding:8,borderRadius:"50%",overflow:"visible",color:(t.vars||t).palette.action.active,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest})},!n.disableRipple&&{"&:hover":{backgroundColor:t.vars?"rgba(".concat(t.vars.palette.action.activeChannel," / ").concat(t.vars.palette.action.hoverOpacity,")"):zl(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"start"===n.edge&&{marginLeft:"small"===n.size?-3:-12},"end"===n.edge&&{marginRight:"small"===n.size?-3:-12})}),(function(e){var t=e.theme,n=e.ownerState;return zc({},"inherit"===n.color&&{color:"inherit"},"inherit"!==n.color&&"default"!==n.color&&zc({color:(t.vars||t).palette[n.color].main},!n.disableRipple&&{"&:hover":{backgroundColor:t.vars?"rgba(".concat(t.vars.palette[n.color].mainChannel," / ").concat(t.vars.palette.action.hoverOpacity,")"):zl(t.palette[n.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}}),"small"===n.size&&{padding:5,fontSize:t.typography.pxToRem(18)},"large"===n.size&&{padding:12,fontSize:t.typography.pxToRem(28)},E({},"&.".concat(Rv.disabled),{backgroundColor:"transparent",color:(t.vars||t).palette.action.disabled}))})),Iv=a.forwardRef((function(e,t){var n=Sd({props:e,name:"MuiIconButton"}),r=n.edge,i=void 0!==r&&r,a=n.children,s=n.className,o=n.color,u=void 0===o?"default":o,c=n.disabled,l=void 0!==c&&c,d=n.disableFocusRipple,f=void 0!==d&&d,h=n.size,p=void 0===h?"medium":h,v=Wc(n,Cv),g=zc({},n,{edge:i,color:u,disabled:l,disableFocusRipple:f,size:p}),m=function(e){var t=e.classes,n=e.disabled,r=e.color,i=e.edge,a=e.size;return Qc({root:["root",n&&"disabled","default"!==r&&"color".concat(Xc(r)),i&&"edge".concat(Xc(i)),"size".concat(Xc(a))]},xv,t)}(g);return(0,xu.jsx)(Av,zc({className:Yc(m.root,s),centerRipple:!0,focusRipple:!f,disabled:l,ref:t,ownerState:g},v,{children:a}))})),Pv=Iv;function _v(e){return gp("MuiButton",e)}var Dv=mp("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","iconSizeSmall","iconSizeMedium","iconSizeLarge"]);var Lv=a.createContext({}),Ov=["children","color","component","className","disabled","disableElevation","disableFocusRipple","endIcon","focusVisibleClassName","fullWidth","size","startIcon","type","variant"],Mv=["root"],Nv=function(e){return zc({},"small"===e.size&&{"& > *:nth-of-type(1)":{fontSize:18}},"medium"===e.size&&{"& > *:nth-of-type(1)":{fontSize:20}},"large"===e.size&&{"& > *:nth-of-type(1)":{fontSize:22}})},Fv=fp(wv,{shouldForwardProp:function(e){return lp(e)||"classes"===e},name:"MuiButton",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,t[n.variant],t["".concat(n.variant).concat(Xc(n.color))],t["size".concat(Xc(n.size))],t["".concat(n.variant,"Size").concat(Xc(n.size))],"inherit"===n.color&&t.colorInherit,n.disableElevation&&t.disableElevation,n.fullWidth&&t.fullWidth]}})((function(e){var t,n,r,i=e.theme,a=e.ownerState;return zc({},i.typography.button,(E(t={minWidth:64,padding:"6px 16px",borderRadius:(i.vars||i).shape.borderRadius,transition:i.transitions.create(["background-color","box-shadow","border-color","color"],{duration:i.transitions.duration.short}),"&:hover":zc({textDecoration:"none",backgroundColor:i.vars?"rgba(".concat(i.vars.palette.text.primaryChannel," / ").concat(i.vars.palette.action.hoverOpacity,")"):zl(i.palette.text.primary,i.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"text"===a.variant&&"inherit"!==a.color&&{backgroundColor:i.vars?"rgba(".concat(i.vars.palette[a.color].mainChannel," / ").concat(i.vars.palette.action.hoverOpacity,")"):zl(i.palette[a.color].main,i.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"outlined"===a.variant&&"inherit"!==a.color&&{border:"1px solid ".concat((i.vars||i).palette[a.color].main),backgroundColor:i.vars?"rgba(".concat(i.vars.palette[a.color].mainChannel," / ").concat(i.vars.palette.action.hoverOpacity,")"):zl(i.palette[a.color].main,i.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"contained"===a.variant&&{backgroundColor:(i.vars||i).palette.grey.A100,boxShadow:(i.vars||i).shadows[4],"@media (hover: none)":{boxShadow:(i.vars||i).shadows[2],backgroundColor:(i.vars||i).palette.grey[300]}},"contained"===a.variant&&"inherit"!==a.color&&{backgroundColor:(i.vars||i).palette[a.color].dark,"@media (hover: none)":{backgroundColor:(i.vars||i).palette[a.color].main}}),"&:active":zc({},"contained"===a.variant&&{boxShadow:(i.vars||i).shadows[8]})},"&.".concat(Dv.focusVisible),zc({},"contained"===a.variant&&{boxShadow:(i.vars||i).shadows[6]})),E(t,"&.".concat(Dv.disabled),zc({color:(i.vars||i).palette.action.disabled},"outlined"===a.variant&&{border:"1px solid ".concat((i.vars||i).palette.action.disabledBackground)},"outlined"===a.variant&&"secondary"===a.color&&{border:"1px solid ".concat((i.vars||i).palette.action.disabled)},"contained"===a.variant&&{color:(i.vars||i).palette.action.disabled,boxShadow:(i.vars||i).shadows[0],backgroundColor:(i.vars||i).palette.action.disabledBackground})),t),"text"===a.variant&&{padding:"6px 8px"},"text"===a.variant&&"inherit"!==a.color&&{color:(i.vars||i).palette[a.color].main},"outlined"===a.variant&&{padding:"5px 15px",border:"1px solid currentColor"},"outlined"===a.variant&&"inherit"!==a.color&&{color:(i.vars||i).palette[a.color].main,border:i.vars?"1px solid rgba(".concat(i.vars.palette[a.color].mainChannel," / 0.5)"):"1px solid ".concat(zl(i.palette[a.color].main,.5))},"contained"===a.variant&&{color:i.vars?i.vars.palette.text.primary:null==(n=(r=i.palette).getContrastText)?void 0:n.call(r,i.palette.grey[300]),backgroundColor:(i.vars||i).palette.grey[300],boxShadow:(i.vars||i).shadows[2]},"contained"===a.variant&&"inherit"!==a.color&&{color:(i.vars||i).palette[a.color].contrastText,backgroundColor:(i.vars||i).palette[a.color].main},"inherit"===a.color&&{color:"inherit",borderColor:"currentColor"},"small"===a.size&&"text"===a.variant&&{padding:"4px 5px",fontSize:i.typography.pxToRem(13)},"large"===a.size&&"text"===a.variant&&{padding:"8px 11px",fontSize:i.typography.pxToRem(15)},"small"===a.size&&"outlined"===a.variant&&{padding:"3px 9px",fontSize:i.typography.pxToRem(13)},"large"===a.size&&"outlined"===a.variant&&{padding:"7px 21px",fontSize:i.typography.pxToRem(15)},"small"===a.size&&"contained"===a.variant&&{padding:"4px 10px",fontSize:i.typography.pxToRem(13)},"large"===a.size&&"contained"===a.variant&&{padding:"8px 22px",fontSize:i.typography.pxToRem(15)},a.fullWidth&&{width:"100%"})}),(function(e){var t;return e.ownerState.disableElevation&&(E(t={boxShadow:"none","&:hover":{boxShadow:"none"}},"&.".concat(Dv.focusVisible),{boxShadow:"none"}),E(t,"&:active",{boxShadow:"none"}),E(t,"&.".concat(Dv.disabled),{boxShadow:"none"}),t)})),Uv=fp("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:function(e,t){var n=e.ownerState;return[t.startIcon,t["iconSize".concat(Xc(n.size))]]}})((function(e){var t=e.ownerState;return zc({display:"inherit",marginRight:8,marginLeft:-4},"small"===t.size&&{marginLeft:-2},Nv(t))})),Bv=fp("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:function(e,t){var n=e.ownerState;return[t.endIcon,t["iconSize".concat(Xc(n.size))]]}})((function(e){var t=e.ownerState;return zc({display:"inherit",marginRight:-4,marginLeft:8},"small"===t.size&&{marginRight:-2},Nv(t))})),jv=a.forwardRef((function(e,t){var n=a.useContext(Lv),r=Sd({props:Zc(n,e),name:"MuiButton"}),i=r.children,s=r.color,o=void 0===s?"primary":s,u=r.component,c=void 0===u?"button":u,l=r.className,d=r.disabled,f=void 0!==d&&d,h=r.disableElevation,p=void 0!==h&&h,v=r.disableFocusRipple,g=void 0!==v&&v,m=r.endIcon,y=r.focusVisibleClassName,b=r.fullWidth,k=void 0!==b&&b,T=r.size,E=void 0===T?"medium":T,S=r.startIcon,w=r.type,x=r.variant,R=void 0===x?"text":x,C=Wc(r,Ov),A=zc({},r,{color:o,component:c,disabled:f,disableElevation:p,disableFocusRipple:g,fullWidth:k,size:E,type:w,variant:R}),I=function(e){var t=e.color,n=e.disableElevation,r=e.fullWidth,i=e.size,a=e.variant,s=e.classes;return zc({},s,Qc({root:["root",a,"".concat(a).concat(Xc(t)),"size".concat(Xc(i)),"".concat(a,"Size").concat(Xc(i)),"inherit"===t&&"colorInherit",n&&"disableElevation",r&&"fullWidth"],label:["label"],startIcon:["startIcon","iconSize".concat(Xc(i))],endIcon:["endIcon","iconSize".concat(Xc(i))]},_v,s))}(A),P=I.root,_=Wc(I,Mv),D=S&&(0,xu.jsx)(Uv,{className:_.startIcon,ownerState:A,children:S}),L=m&&(0,xu.jsx)(Bv,{className:_.endIcon,ownerState:A,children:m});return(0,xu.jsxs)(Fv,zc({ownerState:A,className:Yc(n.className,P,l),component:c,disabled:f,focusRipple:!g,focusVisibleClassName:Yc(_.focusVisible,y),ref:t,type:w},C,{classes:_,children:[D,i,L]}))})),Gv=jv;var Vv=function(){var e=wu(),t=Su(no),n=Su(zs),r=Su(Ws),i=Su(Bs),a=function(){var t=d(c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.startHLSStreaming();case 3:t.next=8;break;case 5:t.prev=5,t.t0=t.catch(0),alert("failed to start hls ".concat(t.t0));case 8:case"end":return t.stop()}}),t,null,[[0,5]])})));return function(){return t.apply(this,arguments)}}(),s=function(){var t=d(c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.stopHLSStreaming();case 3:t.next=8;break;case 5:t.prev=5,t.t0=t.catch(0),alert("failed to stop hls ".concat(t.t0));case 8:case"end":return t.stop()}}),t,null,[[0,5]])})));return function(){return t.apply(this,arguments)}}(),o=function(){var t=d(c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setLocalAudioEnabled(!n);case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),u=function(){var t=d(c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setLocalVideoEnabled(!r);case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),l=function(){var t=d(c().mark((function t(){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("broadcaster"!==i.roleName){t.next=6;break}return e.leave(),t.next=4,e.stopHLSStreaming();case 4:t.next=7;break;case 6:e.leave();case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return(0,xu.jsx)("div",{className:"controls",children:"broadcaster"===i.roleName?(0,xu.jsxs)(xu.Fragment,{children:[(0,xu.jsx)(Pv,{onClick:o,children:n?(0,xu.jsx)(wp,{}):(0,xu.jsx)(xp,{})}),(0,xu.jsx)(Pv,{onClick:u,children:r?(0,xu.jsx)(Rp,{}):(0,xu.jsx)(Cp,{})}),(0,xu.jsxs)(Gv,{variant:"contained",disableElevation:!0,className:"leave",onClick:l,children:[(0,xu.jsx)(Ap,{})," Leave Room"]}),t.running?(0,xu.jsxs)(Gv,{variant:"contained",disableElevation:!0,className:"leave",onClick:s,children:[(0,xu.jsx)(Ip,{})," Stop Streaming"]}):(0,xu.jsxs)(Gv,{variant:"contained",disableElevation:!0,onClick:a,children:[(0,xu.jsx)(Pp,{})," Go Live"]})]}):(0,xu.jsxs)(Gv,{variant:"contained",disableElevation:!0,className:"leave",onClick:l,children:[(0,xu.jsx)(Ap,{})," Leave Room"]})})};var Kv=function(){return(0,xu.jsxs)("div",{className:"room",children:[(0,xu.jsxs)("div",{className:"room__streamSpace",children:[(0,xu.jsx)(Vc,{}),(0,xu.jsx)(Vv,{})]}),(0,xu.jsx)(Hc,{})]})};var Hv=function(){var e=Su(Ns);return(0,xu.jsx)("div",{className:"App wrapper",children:e?(0,xu.jsx)(Kv,{}):(0,xu.jsx)(Ru,{})})};o.createRoot(document.getElementById("root")).render((0,xu.jsx)(a.StrictMode,{children:(0,xu.jsx)(Eu,{children:(0,xu.jsx)(Hv,{})})}))}()}();
//# sourceMappingURL=main.9abc46df.js.map